[
    {
        "title": "Azure AD Health Monitoring Agent Registry Keys Access",
        "description": "This detection uses Windows security events to detect suspicious access attempts to the registry key of Azure AD Health monitoring agent.\nThis detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object HKLM\\SOFTWARE\\Microsoft\\Microsoft Online\\Reporting\\MonitoringAgent.\n",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID IN (\"4656\", \"4663\") AND ObjectType = \"Key\" AND ObjectName LIKE \"\\\\REGISTRY\\\\MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Microsoft Online\\\\Reporting\\\\MonitoringAgent\" ESCAPE '\\') AND NOT ((ProcessName LIKE \"%Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe%\" ESCAPE '\\' OR ProcessName LIKE \"%Microsoft.Identity.Health.Adfs.InsightsService.exe%\" ESCAPE '\\' OR ProcessName LIKE \"%Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe%\" ESCAPE '\\' OR ProcessName LIKE \"%Microsoft.Identity.Health.Adfs.PshSurrogate.exe%\" ESCAPE '\\' OR ProcessName LIKE \"%Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Azure AD Health Service Agents Registry Keys Access",
        "description": "This detection uses Windows security events to detect suspicious access attempts to the registry key values and sub-keys of Azure AD Health service agents (e.g AD FS).\nInformation from AD Health service agents can be used to potentially abuse some of the features provided by those services in the cloud (e.g. Federation).\nThis detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object: HKLM:\\SOFTWARE\\Microsoft\\ADHealthAgent.\nMake sure you set the SACL to propagate to its sub-keys.\n",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID IN (\"4656\", \"4663\") AND ObjectType = \"Key\" AND ObjectName LIKE \"\\\\REGISTRY\\\\MACHINE\\\\SOFTWARE\\\\Microsoft\\\\ADHealthAgent\" ESCAPE '\\') AND NOT ((ProcessName LIKE \"%Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe%\" ESCAPE '\\' OR ProcessName LIKE \"%Microsoft.Identity.Health.Adfs.InsightsService.exe%\" ESCAPE '\\' OR ProcessName LIKE \"%Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe%\" ESCAPE '\\' OR ProcessName LIKE \"%Microsoft.Identity.Health.Adfs.PshSurrogate.exe%\" ESCAPE '\\' OR ProcessName LIKE \"%Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Powerview Add-DomainObjectAcl DCSync AD Extend Right",
        "description": "backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5136\" AND AttributeLDAPDisplayName = \"ntSecurityDescriptor\" AND (AttributeValue LIKE \"%1131f6ad-9c07-11d1-f79f-00c04fc2dcd2%\" ESCAPE '\\' OR AttributeValue LIKE \"%1131f6aa-9c07-11d1-f79f-00c04fc2dcd2%\" ESCAPE '\\' OR AttributeValue LIKE \"%89e95b76-444d-4c62-991a-0facbeda640c%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "AD Privileged Users or Groups Reconnaissance",
        "description": "Detect priv users or groups recon based on 4661 eventid and known privileged users or groups SIDs",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4661\" AND (ObjectType LIKE \"SAM\\_USER\" ESCAPE '\\' OR ObjectType LIKE \"SAM\\_GROUP\" ESCAPE '\\')) AND ((ObjectName LIKE \"%-512\" ESCAPE '\\' OR ObjectName LIKE \"%-502\" ESCAPE '\\' OR ObjectName LIKE \"%-500\" ESCAPE '\\' OR ObjectName LIKE \"%-505\" ESCAPE '\\' OR ObjectName LIKE \"%-519\" ESCAPE '\\' OR ObjectName LIKE \"%-520\" ESCAPE '\\' OR ObjectName LIKE \"%-544\" ESCAPE '\\' OR ObjectName LIKE \"%-551\" ESCAPE '\\' OR ObjectName LIKE \"%-555\" ESCAPE '\\') OR ObjectName LIKE \"%admin%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Admin User Remote Logon",
        "description": "Detect remote login by Administrator user (depending on internal pattern).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4624\" AND LogonType = \"10\" AND AuthenticationPackageName = \"Negotiate\" AND TargetUserName LIKE \"Admin%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Access to ADMIN$ Share",
        "description": "Detects access to $ADMIN share",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5140\" AND ShareName = \"Admin$\") AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "AD Object WriteDAC Access",
        "description": "Detects WRITE_DAC access to a domain object",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4662\" AND ObjectServer = \"DS\" AND AccessMask = \"0x40000\" AND ObjectType IN (\"19195a5b-6da0-11d0-afd3-00c04fd930c9\", \"domainDNS\"))"
        ]
    },
    {
        "title": "Active Directory Replication from Non Machine Account",
        "description": "Detects potential abuse of Active Directory Replication Service (ADRS) from a non machine account to request credentials.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4662\" AND AccessMask = \"0x100\" AND (Properties LIKE \"%1131f6aa-9c07-11d1-f79f-00c04fc2dcd2%\" ESCAPE '\\' OR Properties LIKE \"%1131f6ad-9c07-11d1-f79f-00c04fc2dcd2%\" ESCAPE '\\' OR Properties LIKE \"%89e95b76-444d-4c62-991a-0facbeda640c%\" ESCAPE '\\')) AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\' OR SubjectUserName LIKE \"MSOL\\_%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "AD User Enumeration",
        "description": "Detects access to a domain user from a non-machine account",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4662\" AND ObjectType LIKE \"%bf967aba-0de6-11d0-a285-00aa003049e2%\" ESCAPE '\\') AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\' OR SubjectUserName LIKE \"MSOL\\_%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Enabled User Right in AD to Control User Objects",
        "description": "Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4704\" AND (PrivilegeList LIKE \"%SeEnableDelegationPrivilege%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Weak Encryption Enabled and Kerberoast",
        "description": "Detects scenario where weak encryption is enabled for a user profile which could be used for hash/password cracking.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4738\" AND ((((NewUacValue LIKE \"%8___\" ESCAPE '\\' OR NewUacValue LIKE \"%9___\" ESCAPE '\\' OR NewUacValue LIKE \"%A___\" ESCAPE '\\' OR NewUacValue LIKE \"%B___\" ESCAPE '\\' OR NewUacValue LIKE \"%C___\" ESCAPE '\\' OR NewUacValue LIKE \"%D___\" ESCAPE '\\' OR NewUacValue LIKE \"%E___\" ESCAPE '\\' OR NewUacValue LIKE \"%F___\" ESCAPE '\\') AND NOT ((OldUacValue LIKE \"%8___\" ESCAPE '\\' OR OldUacValue LIKE \"%9___\" ESCAPE '\\' OR OldUacValue LIKE \"%A___\" ESCAPE '\\' OR OldUacValue LIKE \"%B___\" ESCAPE '\\' OR OldUacValue LIKE \"%C___\" ESCAPE '\\' OR OldUacValue LIKE \"%D___\" ESCAPE '\\' OR OldUacValue LIKE \"%E___\" ESCAPE '\\' OR OldUacValue LIKE \"%F___\" ESCAPE '\\'))) OR ((NewUacValue LIKE \"%1____\" ESCAPE '\\' OR NewUacValue LIKE \"%3____\" ESCAPE '\\' OR NewUacValue LIKE \"%5____\" ESCAPE '\\' OR NewUacValue LIKE \"%7____\" ESCAPE '\\' OR NewUacValue LIKE \"%9____\" ESCAPE '\\' OR NewUacValue LIKE \"%B____\" ESCAPE '\\' OR NewUacValue LIKE \"%D____\" ESCAPE '\\' OR NewUacValue LIKE \"%F____\" ESCAPE '\\') AND NOT ((OldUacValue LIKE \"%1____\" ESCAPE '\\' OR OldUacValue LIKE \"%3____\" ESCAPE '\\' OR OldUacValue LIKE \"%5____\" ESCAPE '\\' OR OldUacValue LIKE \"%7____\" ESCAPE '\\' OR OldUacValue LIKE \"%9____\" ESCAPE '\\' OR OldUacValue LIKE \"%B____\" ESCAPE '\\' OR OldUacValue LIKE \"%D____\" ESCAPE '\\' OR OldUacValue LIKE \"%F____\" ESCAPE '\\')))) OR ((NewUacValue LIKE \"%8__\" ESCAPE '\\' OR NewUacValue LIKE \"%9__\" ESCAPE '\\' OR NewUacValue LIKE \"%A__\" ESCAPE '\\' OR NewUacValue LIKE \"%B__\" ESCAPE '\\' OR NewUacValue LIKE \"%C__\" ESCAPE '\\' OR NewUacValue LIKE \"%D__\" ESCAPE '\\' OR NewUacValue LIKE \"%E__\" ESCAPE '\\' OR NewUacValue LIKE \"%F__\" ESCAPE '\\') AND NOT ((OldUacValue LIKE \"%8__\" ESCAPE '\\' OR OldUacValue LIKE \"%9__\" ESCAPE '\\' OR OldUacValue LIKE \"%A__\" ESCAPE '\\' OR OldUacValue LIKE \"%B__\" ESCAPE '\\' OR OldUacValue LIKE \"%C__\" ESCAPE '\\' OR OldUacValue LIKE \"%D__\" ESCAPE '\\' OR OldUacValue LIKE \"%E__\" ESCAPE '\\' OR OldUacValue LIKE \"%F__\" ESCAPE '\\')))))"
        ]
    },
    {
        "title": "LSASS Access Detected via Attack Surface Reduction",
        "description": "Detects Access to LSASS Process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1121\" AND Path LIKE \"%\\\\lsass.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Hacktool Ruler",
        "description": "This events that are generated when using the hacktool Ruler by Sensepost",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4776\" AND Workstation = \"RULER\") OR (EventID IN (\"4624\", \"4625\") AND WorkstationName = \"RULER\"))"
        ]
    },
    {
        "title": "File Was Not Allowed To Run",
        "description": "Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events.",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID IN (\"8004\", \"8007\")"
        ]
    },
    {
        "title": "Turla Service Install",
        "description": "This method detects a service install of malicious services mentioned in Carbon Paper - Turla report by ESET",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ServiceName IN (\"srservice\", \"ipvpn\", \"hkmsvc\"))"
        ]
    },
    {
        "title": "Chafer Activity",
        "description": "Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4698\" AND TaskName IN (\"SC Scheduled Scan\", \"UpdatMachine\"))"
        ]
    },
    {
        "title": "Chafer Activity",
        "description": "Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ServiceName IN (\"SC Scheduled Scan\", \"UpdatMachine\"))"
        ]
    },
    {
        "title": "GALLIUM Artefacts",
        "description": "Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"257\" AND QNAME IN (\"asyspy256.ddns.net\", \"hotkillmail9sddcc.ddns.net\", \"rosaf112.ddns.net\", \"cvdfhjh1231.myftp.biz\", \"sz2016rose.ddns.net\", \"dffwescwer4325.myftp.biz\", \"cvdfhjh1231.ddns.net\"))"
        ]
    },
    {
        "title": "Defrag Deactivation",
        "description": "Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4701\" AND TaskName LIKE \"\\\\Microsoft\\\\Windows\\\\Defrag\\\\ScheduledDefrag\" ESCAPE '\\')"
        ]
    },
    {
        "title": "StoneDrill Service Install",
        "description": "This method detects a service install of the malicious Microsoft Network Realtime Inspection Service service described in StoneDrill report by Kaspersky",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ServiceName = \"NtsSrv\" AND ServiceFileName LIKE \"% LocalService\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Turla PNG Dropper Service",
        "description": "This method detects malicious services mentioned in Turla PNG dropper report by NCC Group in November 2018",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ServiceName = \"WerFaultSvc\")"
        ]
    },
    {
        "title": "Operation Wocao Activity",
        "description": "Detects activity mentioned in Operation Wocao report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4799\" AND TargetUserName LIKE \"Administr%\" ESCAPE '\\' AND CallerProcessName LIKE \"%\\\\checkadmin.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Arbitrary Shell Command Execution Via Settingcontent-Ms",
        "description": "The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create \"shortcuts\" to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries.",
        "rule": [
            "SELECT * FROM eventlog WHERE (CommandLine LIKE \"%.SettingContent-ms%\" ESCAPE '\\' AND NOT (FilePath LIKE \"%immersivecontrolpanel%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Remote Task Creation via ATSVC Named Pipe",
        "description": "Detects remote task creation via at.exe or API interacting with ATSVC namedpipe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\IPC$\" ESCAPE '\\' AND RelativeTargetName = \"atsvc\" AND Accesses LIKE \"%WriteData%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Audit CVE Event",
        "description": "Detects events generated by Windows to indicate the exploitation of a known vulnerability (e.g. CVE-2020-0601)",
        "rule": [
            "SELECT * FROM eventlog WHERE Provider_Name = \"Microsoft-Windows-Audit-CVE\""
        ]
    },
    {
        "title": "Processes Accessing the Microphone and Webcam",
        "description": "Potential adversaries accessing the microphone and webcam in an endpoint.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"4657\", \"4656\", \"4663\") AND (ObjectName LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\CapabilityAccessManager\\\\ConsentStore\\\\microphone\\\\NonPackaged%\" ESCAPE '\\' OR ObjectName LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\CapabilityAccessManager\\\\ConsentStore\\\\webcam\\\\NonPackaged%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CobaltStrike Service Installations",
        "description": "Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ((ImagePath LIKE \"%ADMIN$%\" ESCAPE '\\' AND ImagePath LIKE \"%.exe%\" ESCAPE '\\') OR (ImagePath LIKE \"%\\%COMSPEC\\%%\" ESCAPE '\\' AND ImagePath LIKE \"%start%\" ESCAPE '\\' AND ImagePath LIKE \"%powershell%\" ESCAPE '\\') OR ImagePath LIKE \"%powershell -nop -w hidden -encodedcommand%\" ESCAPE '\\' OR (ImagePath LIKE \"%SUVYIChOZXctT2JqZWN0IE5ldC5XZWJjbGllbnQpLkRvd25sb2FkU3RyaW5nKCdodHRwOi8vMTI3LjAuMC4xO%\" ESCAPE '\\' OR ImagePath LIKE \"%lFWCAoTmV3LU9iamVjdCBOZXQuV2ViY2xpZW50KS5Eb3dubG9hZFN0cmluZygnaHR0cDovLzEyNy4wLjAuMT%\" ESCAPE '\\' OR ImagePath LIKE \"%JRVggKE5ldy1PYmplY3QgTmV0LldlYmNsaWVudCkuRG93bmxvYWRTdHJpbmcoJ2h0dHA6Ly8xMjcuMC4wLjE6%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "DCERPC SMB Spoolss Named Pipe",
        "description": "Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\IPC$\" ESCAPE '\\' AND RelativeTargetName = \"spoolss\")"
        ]
    },
    {
        "title": "T1021 DCOM InternetExplorer.Application Iertutil DLL Hijack",
        "description": "Detects a threat actor creating a file named `iertutil.dll` in the `C:\\Program Files\\Internet Explorer\\` directory over the network for a DCOM InternetExplorer DLL Hijack scenario.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5145\" AND RelativeTargetName LIKE \"%\\\\Internet Explorer\\\\iertutil.dll\" ESCAPE '\\') AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Mimikatz DC Sync",
        "description": "Detects Mimikatz DC sync security events",
        "rule": [
            "SELECT * FROM eventlog WHERE ((((EventID = \"4662\" AND (Properties LIKE \"%Replicating Directory Changes All%\" ESCAPE '\\' OR Properties LIKE \"%1131f6ad-9c07-11d1-f79f-00c04fc2dcd2%\" ESCAPE '\\')) AND NOT (SubjectDomainName = \"Window Manager\")) AND NOT ((SubjectUserName LIKE \"NT AUTHORITY%\" ESCAPE '\\' OR SubjectUserName LIKE \"MSOL\\_%\" ESCAPE '\\'))) AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Disabling Windows Event Auditing",
        "description": "Detects scenarios where system auditing (ie: windows event log auditing) is disabled. This may be used in a scenario where an entity would want to bypass local logging to evade detection when windows event logging is enabled and reviewed. Also, it is recommended to turn off \"Local Group Policy Object Processing\" via GPO, which will make sure that Active Directory GPOs take precedence over local/edited computer policies via something such as \"gpedit.msc\". Please note, that disabling \"Local Group Policy Object Processing\" may cause an issue in scenarios of one off specific GPO modifications -- however it is recommended to perform these modifications in Active Directory anyways.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4719\" AND (AuditPolicyChanges LIKE \"%\\%\\%8448%\" ESCAPE '\\' OR AuditPolicyChanges LIKE \"%\\%\\%8450%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "DPAPI Domain Backup Key Extraction",
        "description": "Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4662\" AND ObjectType = \"SecretObject\" AND AccessMask = \"0x2\" AND ObjectName = \"BCKUPKEY\")"
        ]
    },
    {
        "title": "DPAPI Domain Master Key Backup Attempt",
        "description": "Detects anyone attempting a backup for the DPAPI Master Key. This events gets generated at the source and not the Domain Controller.",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID = \"4692\""
        ]
    },
    {
        "title": "COMPlus_ETWEnabled Registry Modification",
        "description": "Potential adversaries stopping ETW providers recording loaded .NET assemblies.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4657\" AND ObjectName LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\.NETFramework\" ESCAPE '\\' AND ObjectValueName = \"ETWEnabled\" AND NewValue = \"0\")"
        ]
    },
    {
        "title": "Security Event Log Cleared",
        "description": "Checks for event id 1102 which indicates the security event log was cleared.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1102\" AND Provider_Name = \"Microsoft-Windows-Eventlog\")"
        ]
    },
    {
        "title": "MSExchange Transport Agent Installation",
        "description": "Detects the Installation of a Exchange Transport Agent",
        "rule": [
            "SELECT * FROM eventlog WHERE eventlog MATCH ('\"Install-TransportAgent\"')"
        ]
    },
    {
        "title": "CVE-2021-1675 Print Spooler Exploitation",
        "description": "Detects driver load events print service operational log that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"316\" AND (eventlog MATCH ('\"UNIDRV.DLL, kernelbase.dll, \" OR \" 123 \" OR \" 1234 \" OR \"mimispool\"')))"
        ]
    },
    {
        "title": "CVE-2021-1675 Print Spooler Exploitation IPC Access",
        "description": "Detects remote printer driver load from Detailed File Share in Security logs that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675 and CVE-2021-34527",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"\\\\\\*\\\\IPC$\" ESCAPE '\\' AND RelativeTargetName = \"spoolss\" AND AccessMask = \"0x3\" AND ObjectType = \"File\")"
        ]
    },
    {
        "title": "External Disk Drive Or USB Storage Device",
        "description": "Detects external diskdrives or plugged in USB devices , EventID 6416 on windows 10 or later",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"6416\" AND ClassName = \"DiskDrive\") OR DeviceDescription = \"USB Mass Storage Device\")"
        ]
    },
    {
        "title": "Enumeration via the Global Catalog",
        "description": "Detects enumeration of the global catalog (that can be performed using BloodHound or others AD reconnaissance tools). Adjust Threshold according to domain width.",
        "rule": [
            "SELECT * FROM (SELECT *,count(*) AS agg FROM eventlog WHERE (EventID = \"5156\" AND DestinationPort IN (\"3268\", \"3269\")) GROUP BY SourceAddress) WHERE agg > 2000"
        ]
    },
    {
        "title": "Persistence and Execution at Scale via GPO Scheduled Task",
        "description": "Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\SYSVOL\" ESCAPE '\\' AND RelativeTargetName LIKE \"%ScheduledTasks.xml\" ESCAPE '\\' AND (Accesses LIKE \"%WriteData%\" ESCAPE '\\' OR Accesses LIKE \"%\\%\\%4417%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "smbexec.py Service Installation",
        "description": "Detects the use of smbexec.py tool by detecting a specific service installation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ServiceName = \"BTOBTO\" AND ServiceFileName LIKE \"%\\\\execute.bat\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Hidden Local User Creation",
        "description": "Detects the creation of a local hidden user account which should not happen for event ID 4720.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4720\" AND TargetUserName LIKE \"%$\" ESCAPE '\\')"
        ]
    },
    {
        "title": "HybridConnectionManager Service Installation",
        "description": "Rule to detect the Hybrid Connection Manager service installation.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4697\" AND ServiceName = \"HybridConnectionManager\" AND ServiceFileName LIKE \"%HybridConnectionManager%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "HybridConnectionManager Service Running",
        "description": "Rule to detect the Hybrid Connection Manager service running on an endpoint.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"40300\", \"40301\", \"40302\") AND (eventlog MATCH ('\"HybridConnection\" OR \"sb://\" OR \"servicebus.windows.net\" OR \"HybridConnectionManage\"')))"
        ]
    },
    {
        "title": "Impacket PsExec Execution",
        "description": "Detects execution of Impacket's psexec.py.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\IPC$\" ESCAPE '\\' AND (RelativeTargetName LIKE \"%RemCom\\_stdint%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%RemCom\\_stdoutt%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%RemCom\\_stderrt%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Possible Impacket SecretDump Remote Activity",
        "description": "Detect AD credential dumping using impacket secretdump HKTL",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\ADMIN$\" ESCAPE '\\' AND RelativeTargetName LIKE \"%SYSTEM32\\\\%\" ESCAPE '\\' AND RelativeTargetName LIKE \"%.tmp%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "ISO Image Mount",
        "description": "Detects the mount of ISO images on an endpoint",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4663\" AND ObjectServer = \"Security\" AND ObjectType = \"File\" AND ObjectName LIKE \"\\\\Device\\\\CdRom%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "First Time Seen Remote Named Pipe",
        "description": "This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\IPC$\" ESCAPE '\\') AND NOT (EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\IPC$\" ESCAPE '\\' AND (RelativeTargetName LIKE \"atsvc\" ESCAPE '\\' OR RelativeTargetName LIKE \"samr\" ESCAPE '\\' OR RelativeTargetName LIKE \"lsarpc\" ESCAPE '\\' OR RelativeTargetName LIKE \"winreg\" ESCAPE '\\' OR RelativeTargetName LIKE \"netlogon\" ESCAPE '\\' OR RelativeTargetName LIKE \"srvsvc\" ESCAPE '\\' OR RelativeTargetName LIKE \"protected\\_storage\" ESCAPE '\\' OR RelativeTargetName LIKE \"wkssvc\" ESCAPE '\\' OR RelativeTargetName LIKE \"browser\" ESCAPE '\\' OR RelativeTargetName LIKE \"netdfs\" ESCAPE '\\' OR RelativeTargetName LIKE \"svcctl\" ESCAPE '\\' OR RelativeTargetName LIKE \"spoolss\" ESCAPE '\\' OR RelativeTargetName LIKE \"ntsvcs\" ESCAPE '\\' OR RelativeTargetName LIKE \"LSM\\_API\\_service\" ESCAPE '\\' OR RelativeTargetName LIKE \"HydraLsPipe\" ESCAPE '\\' OR RelativeTargetName LIKE \"TermSrv\\_API\\_service\" ESCAPE '\\' OR RelativeTargetName LIKE \"MsFteWds\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Correct Execution of Nltest.exe",
        "description": "The attacker might use LOLBAS nltest.exe for discovery of domain controllers, domain trusts, parent domain and the current user permissions.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4689\" AND ProcessName LIKE \"%nltest.exe\" ESCAPE '\\' AND Status = \"0x0\")"
        ]
    },
    {
        "title": "LSASS Access from Non System Account",
        "description": "Detects potential mimikatz-like tools accessing LSASS from non system account",
        "rule": [
            "SELECT * FROM eventlog WHERE (((EventID IN (\"4663\", \"4656\") AND AccessMask IN (\"0x40\", \"0x1400\", \"0x1000\", \"0x100000\", \"0x1410\", \"0x1010\", \"0x1438\", \"0x143a\", \"0x1418\", \"0x1f0fff\", \"0x1f1fff\", \"0x1f2fff\", \"0x1f3fff\", \"40\", \"1400\", \"1000\", \"100000\", \"1410\", \"1010\", \"1438\", \"143a\", \"1418\", \"1f0fff\", \"1f1fff\", \"1f2fff\", \"1f3fff\") AND ObjectType = \"Process\" AND ObjectName LIKE \"%\\\\lsass.exe\" ESCAPE '\\') AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\')) AND NOT (ProcessName LIKE \"C:\\\\Program Files%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Credential Dumping Tools Service Execution",
        "description": "Detects well-known credential dumping tools execution via service execution events",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND (ImagePath LIKE \"%fgexec%\" ESCAPE '\\' OR ImagePath LIKE \"%dumpsvc%\" ESCAPE '\\' OR ImagePath LIKE \"%cachedump%\" ESCAPE '\\' OR ImagePath LIKE \"%mimidrv%\" ESCAPE '\\' OR ImagePath LIKE \"%gsecdump%\" ESCAPE '\\' OR ImagePath LIKE \"%servpw%\" ESCAPE '\\' OR ImagePath LIKE \"%pwdump%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "WCE wceaux.dll Access",
        "description": "Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"4656\", \"4658\", \"4660\", \"4663\") AND ObjectName LIKE \"%\\\\wceaux.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Meterpreter or Cobalt Strike Getsystem Service Installation",
        "description": "Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ((ImagePath LIKE \"%cmd%\" ESCAPE '\\' AND ImagePath LIKE \"%/c%\" ESCAPE '\\' AND ImagePath LIKE \"%echo%\" ESCAPE '\\' AND ImagePath LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ImagePath LIKE \"%\\%COMSPEC\\%%\" ESCAPE '\\' AND ImagePath LIKE \"%/c%\" ESCAPE '\\' AND ImagePath LIKE \"%echo%\" ESCAPE '\\' AND ImagePath LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ImagePath LIKE \"%cmd.exe%\" ESCAPE '\\' AND ImagePath LIKE \"%/c%\" ESCAPE '\\' AND ImagePath LIKE \"%echo%\" ESCAPE '\\' AND ImagePath LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ImagePath LIKE \"%rundll32%\" ESCAPE '\\' AND ImagePath LIKE \"%.dll,a%\" ESCAPE '\\' AND ImagePath LIKE \"%/p:%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "MMC20 Lateral Movement",
        "description": "Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of \"-Embedding\" as a child of svchost.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\svchost.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\mmc.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-Embedding%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Moriya Rootkit",
        "description": "Detects the use of Moriya rootkit as described in the securelist's Operation TunnelSnake report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ServiceName = \"ZzNetSvc\")"
        ]
    },
    {
        "title": "NetNTLM Downgrade Attack",
        "description": "Detects NetNTLM downgrade attack",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4657\" AND ObjectName LIKE \"%\\\\REGISTRY\\\\MACHINE\\\\SYSTEM%\" ESCAPE '\\' AND ObjectName LIKE \"%ControlSet%\" ESCAPE '\\' AND ObjectName LIKE \"%\\\\Control\\\\Lsa%\" ESCAPE '\\' AND ObjectValueName IN (\"LmCompatibilityLevel\", \"NtlmMinClientSec\", \"RestrictSendingNTLMTraffic\"))"
        ]
    },
    {
        "title": "Mounted Windows Admin Shares with net.exe",
        "description": "Detects when an admin share is mounted using net.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"% use %\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\\\*\\\\%$%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "New or Renamed User Account with '$' in Attribute 'SamAccountName'.",
        "description": "Detects possible bypass EDR and SIEM via abnormal user account name.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"4720\", \"4781\") AND SamAccountName LIKE \"%$%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Denied Access To Remote Desktop",
        "description": "This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop. Often, this event can be generated by attackers when searching for available windows servers in the network.",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID = \"4825\""
        ]
    },
    {
        "title": "NTFS Vulnerability Exploitation",
        "description": "This the exploitation of a NTFS vulnerability as reported without many details via Twitter",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"55\" AND Origin = \"File System Driver\" AND Description LIKE \"%contains a corrupted file record%\" ESCAPE '\\' AND Description LIKE \"%The name of the file is \"\\\\\"%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Successful Overpass the Hash Attempt",
        "description": "Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz's sekurlsa::pth module.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4624\" AND LogonType = \"9\" AND LogonProcessName = \"seclogo\" AND AuthenticationPackageName = \"Negotiate\")"
        ]
    },
    {
        "title": "Pass the Hash Activity",
        "description": "Detects the attack technique pass the hash which is used to move laterally inside the network",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID IN (\"4624\", \"4625\") AND LogonType = \"3\" AND LogonProcessName = \"NtLmSsp\" AND WorkstationName LIKE \"\\%Workstations\\%\" ESCAPE '\\' AND ComputerName LIKE \"\\%Workstations\\%\" ESCAPE '\\') AND NOT (AccountName = \"ANONYMOUS LOGON\"))"
        ]
    },
    {
        "title": "Pass the Hash Activity 2",
        "description": "Detects the attack technique pass the hash which is used to move laterally inside the network",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4624\" AND ((SubjectUserSid = \"S-1-0-0\" AND LogonType = \"3\" AND LogonProcessName = \"NtLmSsp\" AND KeyLength = \"0\") OR (LogonType = \"9\" AND LogonProcessName = \"seclogo\"))) AND NOT (AccountName = \"ANONYMOUS LOGON\"))"
        ]
    },
    {
        "title": "Possible PetitPotam Coerce Authentication Attempt",
        "description": "Detect PetitPotam coerced authentication activity.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"\\\\\\*\" ESCAPE '\\' AND ShareName LIKE \"%\\\\IPC$\" ESCAPE '\\' AND RelativeTargetName = \"lsarpc\" AND SubjectUserName = \"ANONYMOUS LOGON\")"
        ]
    },
    {
        "title": "PetitPotam Suspicious Kerberos TGT Request",
        "description": "Detect suspicious Kerberos TGT requests. Once an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes. One way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus. This request will generate a 4768 event with some unusual fields depending on the environment. This analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts.",
        "rule": [
            "SELECT * FROM eventlog WHERE (((EventID = \"4768\" AND TargetUserName LIKE \"%$\" ESCAPE '\\' AND CertThumbprint LIKE \"%\" ESCAPE '\\') AND NOT (IpAddress = \"::1\")) AND NOT (CertThumbprint = \"\"))"
        ]
    },
    {
        "title": "Possible DC Shadow",
        "description": "Detects DCShadow via create new SPN",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4742\" AND ServicePrincipalNames LIKE \"%GC/%\" ESCAPE '\\') OR (EventID = \"5136\" AND AttributeLDAPDisplayName = \"servicePrincipalName\" AND AttributeValue LIKE \"GC/%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Scripts Installed as Services",
        "description": "Detects powershell script installed as a Service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND (ImagePath LIKE \"%powershell%\" ESCAPE '\\' OR ImagePath LIKE \"%pwsh%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Possible Zerologon (CVE-2020-1472) Exploitation",
        "description": "Detects Netlogon Elevation of Privilege Vulnerability aka Zerologon (CVE-2020-1472)",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4742\" AND SubjectUserName = \"ANONYMOUS LOGON\" AND TargetUserName LIKE \"\\%DC-MACHINE-NAME\\%\" ESCAPE '\\') AND NOT (PasswordLastSet = \"-\"))"
        ]
    },
    {
        "title": "Protected Storage Service Access",
        "description": "Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"%IPC%\" ESCAPE '\\' AND RelativeTargetName LIKE \"protected\\_storage\" ESCAPE '\\')"
        ]
    },
    {
        "title": "QuarksPwDump Clearing Access History",
        "description": "Detects QuarksPwDump clearing access history in hive",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"16\" AND HiveName LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\SAM%\" ESCAPE '\\' AND HiveName LIKE \"%.dmp\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Rare Schtasks Creations",
        "description": "Detects rare scheduled tasks creations that only appear a few times per time frame and could reveal password dumpers, backdoor installs or other types of malicious code",
        "rule": [
            "SELECT * FROM (SELECT *,count(*) AS agg FROM eventlog WHERE EventID = \"4698\" GROUP BY TaskName) WHERE agg < 5"
        ]
    },
    {
        "title": "Rare Service Installs",
        "description": "Detects rare service installs that only appear a few times per time frame and could reveal password dumpers, backdoor installs or other types of malicious services",
        "rule": [
            "SELECT * FROM (SELECT *,count(*) AS agg FROM eventlog WHERE EventID = \"7045\" GROUP BY ServiceFileName) WHERE agg < 5"
        ]
    },
    {
        "title": "Scanner PoC for CVE-2019-0708 RDP RCE Vuln",
        "description": "Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to  CVE-2019-0708 RDP RCE aka BlueKeep",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4625\" AND AccountName = \"AAAAAAA\")"
        ]
    },
    {
        "title": "RDP Login from Localhost",
        "description": "RDP login with localhost source address may be a tunnelled login",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4624\" AND LogonType = \"10\" AND IpAddress IN (\"::1\", \"127.0.0.1\"))"
        ]
    },
    {
        "title": "Potential RDP Exploit CVE-2019-0708",
        "description": "Detect suspicious error on protocol RDP, potential CVE-2019-0708",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"56\", \"50\") AND Provider_Name = \"TermDD\")"
        ]
    },
    {
        "title": "RDP over Reverse SSH Tunnel WFP",
        "description": "Detects svchost hosting RDP termsvcs communicating with the loopback address",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5156\" AND ((SourcePort = \"3389\" AND (DestAddress LIKE \"127.%\" ESCAPE '\\' OR DestAddress LIKE \"::1\" ESCAPE '\\')) OR (DestPort = \"3389\" AND (SourceAddress LIKE \"127.%\" ESCAPE '\\' OR SourceAddress LIKE \"::1\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Register new Logon Process by Rubeus",
        "description": "Detects potential use of Rubeus via registered new trusted logon process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4611\" AND LogonProcessName = \"User32LogonProcesss\")"
        ]
    },
    {
        "title": "Remote PowerShell Sessions Network Connections (WinRM)",
        "description": "Detects basic PowerShell Remoting (WinRM) by monitoring for network inbound connections to ports 5985 OR 5986",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5156\" AND DestPort IN (\"5985\", \"5986\") AND LayerRTID = \"44\")"
        ]
    },
    {
        "title": "Remote Registry Management Using Reg Utility",
        "description": "Remote registry management using REG utility from non-admin workstation",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5145\" AND RelativeTargetName LIKE \"%\\\\winreg%\" ESCAPE '\\') AND NOT (IpAddress LIKE \"\\%Admins\\_Workstations\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Root Certificate Installed",
        "description": "Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4104\" AND ScriptBlockText LIKE \"%Cert:\\\\LocalMachine\\\\Root%\" ESCAPE '\\' AND (ScriptBlockText LIKE \"%Move-Item%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Import-Certificate%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "SAM Registry Hive Handle Request",
        "description": "Detects handles requested to SAM registry hive",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4656\" AND ObjectType = \"Key\" AND ObjectName LIKE \"%\\\\SAM\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Scheduled Task Deletion",
        "description": "Detects scheduled task deletion events. Scheduled tasks are likely to be deleted if not used for persistence. Malicious Software often creates tasks directly under the root node e.g. \\TASKNAME",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID = \"4699\""
        ]
    },
    {
        "title": "SCM Database Handle Failure",
        "description": "Detects non-system users failing to get a handle of the SCM database.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4656\" AND ObjectType LIKE \"SC\\_MANAGER OBJECT\" ESCAPE '\\' AND ObjectName = \"servicesactive\" AND Keywords = \"Audit Failure\") AND NOT (SubjectLogonId = \"0x3e4\"))"
        ]
    },
    {
        "title": "SCM Database Privileged Operation",
        "description": "Detects non-system users performing privileged operation os the SCM database",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4674\" AND ObjectType LIKE \"SC\\_MANAGER OBJECT\" ESCAPE '\\' AND ObjectName = \"servicesactive\" AND PrivilegeList = \"SeTakeOwnershipPrivilege\") AND NOT (SubjectLogonId = \"0x3e4\"))"
        ]
    },
    {
        "title": "Remote WMI ActiveScriptEventConsumers",
        "description": "Detect potential adversaries leveraging WMI ActiveScriptEventConsumers remotely to move laterally in a network",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4624\" AND LogonType = \"3\" AND ProcessName LIKE \"%scrcons.exe\" ESCAPE '\\') AND NOT (TargetLogonId = \"0x3e7\"))"
        ]
    },
    {
        "title": "CobaltStrike Service Installations",
        "description": "Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4697\" AND ((ServiceFileName LIKE \"%ADMIN$%\" ESCAPE '\\' AND ServiceFileName LIKE \"%.exe%\" ESCAPE '\\') OR (ServiceFileName LIKE \"%\\%COMSPEC\\%%\" ESCAPE '\\' AND ServiceFileName LIKE \"%start%\" ESCAPE '\\' AND ServiceFileName LIKE \"%powershell%\" ESCAPE '\\') OR ServiceFileName LIKE \"%powershell -nop -w hidden -encodedcommand%\" ESCAPE '\\' OR (ServiceFileName LIKE \"%SUVYIChOZXctT2JqZWN0IE5ldC5XZWJjbGllbnQpLkRvd25sb2FkU3RyaW5nKCdodHRwOi8vMTI3LjAuMC4xO%\" ESCAPE '\\' OR ServiceFileName LIKE \"%lFWCAoTmV3LU9iamVjdCBOZXQuV2ViY2xpZW50KS5Eb3dubG9hZFN0cmluZygnaHR0cDovLzEyNy4wLjAuMT%\" ESCAPE '\\' OR ServiceFileName LIKE \"%JRVggKE5ldy1PYmplY3QgTmV0LldlYmNsaWVudCkuRG93bmxvYWRTdHJpbmcoJ2h0dHA6Ly8xMjcuMC4wLjE6%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Credential Dumping Tools Service Execution",
        "description": "Detects well-known credential dumping tools execution via service execution events",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4697\" AND (ServiceFileName LIKE \"%fgexec%\" ESCAPE '\\' OR ServiceFileName LIKE \"%dumpsvc%\" ESCAPE '\\' OR ServiceFileName LIKE \"%cachedump%\" ESCAPE '\\' OR ServiceFileName LIKE \"%mimidrv%\" ESCAPE '\\' OR ServiceFileName LIKE \"%gsecdump%\" ESCAPE '\\' OR ServiceFileName LIKE \"%servpw%\" ESCAPE '\\' OR ServiceFileName LIKE \"%pwdump%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malicious Service Installations",
        "description": "Detects known malicious service installs that only appear in cases of lateral movement, credential dumping, and other suspicious activities.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4697\" AND ServiceName = \"javamtsup\")"
        ]
    },
    {
        "title": "Meterpreter or Cobalt Strike Getsystem Service Installation",
        "description": "Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4697\" AND ((ServiceFileName LIKE \"%cmd%\" ESCAPE '\\' AND ServiceFileName LIKE \"%/c%\" ESCAPE '\\' AND ServiceFileName LIKE \"%echo%\" ESCAPE '\\' AND ServiceFileName LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ServiceFileName LIKE \"%\\%COMSPEC\\%%\" ESCAPE '\\' AND ServiceFileName LIKE \"%/c%\" ESCAPE '\\' AND ServiceFileName LIKE \"%echo%\" ESCAPE '\\' AND ServiceFileName LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ServiceFileName LIKE \"%cmd.exe%\" ESCAPE '\\' AND ServiceFileName LIKE \"%/c%\" ESCAPE '\\' AND ServiceFileName LIKE \"%echo%\" ESCAPE '\\' AND ServiceFileName LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ServiceFileName LIKE \"%rundll32%\" ESCAPE '\\' AND ServiceFileName LIKE \"%.dll,a%\" ESCAPE '\\' AND ServiceFileName LIKE \"%/p:%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "PowerShell Scripts Installed as Services",
        "description": "Detects powershell script installed as a Service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4697\" AND (ServiceFileName LIKE \"%powershell%\" ESCAPE '\\' OR ServiceFileName LIKE \"%pwsh%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Tap Driver Installation",
        "description": "Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4697\" AND ServiceFileName LIKE \"%tap0901%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SMB Create Remote File Admin Share",
        "description": "Look for non-system accounts SMB accessing a file with write (0x2) access mask via administrative share (i.e C$).",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5145\" AND ShareName LIKE \"%C$\" ESCAPE '\\' AND AccessMask = \"0x2\") AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Atera Agent Installation",
        "description": "Detects successful installation of Atera Remote Monitoring & Management (RMM) agent as recently found to be used by Conti operators",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1033\" AND Provider_Name = \"MsiInstaller\" AND Message LIKE \"%AteraAgent%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Detected Windows Software Discovery",
        "description": "Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4104\" AND ScriptBlockText LIKE \"%get-itemProperty%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%\\\\software\\\\%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%select-object%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%format-table%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Outbound Kerberos Connection",
        "description": "Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5156\" AND DestinationPort = \"88\") AND NOT ((Image LIKE \"%\\\\lsass.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\opera.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\chrome.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\firefox.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Werfault.exe Network Connection Outbound",
        "description": "Adversaries can migrate cobalt strike/metasploit/C2 beacons on compromised systems to legitimate werfault.exe process to avoid detection.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND Image = \"werfault.exe\" AND NOT ((EventID = \"3\" AND ParentImage = \"svchost.exe\" AND (DestinationIp LIKE \"104.42.151.234\" ESCAPE '\\' OR DestinationIp LIKE \"104.43.193.48\" ESCAPE '\\' OR DestinationIp LIKE \"52.255.188.83\" ESCAPE '\\' OR DestinationIp LIKE \"13.64.90.137\" ESCAPE '\\' OR DestinationIp LIKE \"168.61.161.212\" ESCAPE '\\' OR DestinationIp LIKE \"13.88.21.125\" ESCAPE '\\' OR DestinationIp LIKE \"40.88.32.150\" ESCAPE '\\' OR DestinationIp LIKE \"52.147.198.201\" ESCAPE '\\' OR DestinationIp LIKE \"52.239.207.100\" ESCAPE '\\' OR DestinationIp LIKE \"52.176.224.96\" ESCAPE '\\' OR DestinationIp LIKE \"2607:7700:0:24:0:1:287e:1894\" ESCAPE '\\' OR DestinationIp LIKE \"10.%\" ESCAPE '\\' OR DestinationIp LIKE \"192.168.%\" ESCAPE '\\' OR DestinationIp LIKE \"127.%\" ESCAPE '\\') AND (DestinationHostname LIKE \"%.windowsupdate.com%\" ESCAPE '\\' OR DestinationHostname LIKE \"%.microsoft.com%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Addition of Domain Trusts",
        "description": "Addition of domains is seldom and should be verified for legitimacy.",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID = \"4706\""
        ]
    },
    {
        "title": "Backup Catalog Deleted",
        "description": "Detects backup catalog deletions",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"524\" AND Provider_Name = \"Microsoft-Windows-Backup\")"
        ]
    },
    {
        "title": "Failed Code Integrity Checks",
        "description": "Code integrity failures may indicate tampered executables.",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID IN (\"5038\", \"6281\")"
        ]
    },
    {
        "title": "DHCP Server Loaded the CallOut DLL",
        "description": "This rule detects a DHCP server in which a specified Callout DLL (in registry) was loaded",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1033\" AND Provider_Name = \"Microsoft-Windows-DHCP-Server\")"
        ]
    },
    {
        "title": "DHCP Server Error Failed Loading the CallOut DLL",
        "description": "This rule detects a DHCP server error in which a specified Callout DLL (in registry) could not be loaded",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"1031\", \"1032\", \"1034\") AND Provider_Name = \"Microsoft-Windows-DHCP-Server\")"
        ]
    },
    {
        "title": "DNS Server Error Failed Loading the ServerLevelPluginDLL",
        "description": "This rule detects a DNS server error in which a specified plugin DLL (in registry) could not be loaded",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID IN (\"150\", \"770\")"
        ]
    },
    {
        "title": "Password Change on Directory Service Restore Mode (DSRM) Account",
        "description": "The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence.",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID = \"4794\""
        ]
    },
    {
        "title": "Eventlog Cleared",
        "description": "One of the Windows Eventlogs has been cleared. e.g. caused by \"wevtutil cl\" command execution",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"517\", \"1102\") AND Provider_Name = \"Microsoft-Windows-Eventlog\")"
        ]
    },
    {
        "title": "Suspicious Rejected SMB Guest Logon From IP",
        "description": "Detect Attempt PrintNightmare (CVE-2021-1675) Remote code execution in Windows Spooler Service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"31017\" AND Description LIKE \"%Rejected an insecure guest logon%\" ESCAPE '\\' AND UserName = \"\" AND ServerName LIKE \"\\\\1%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Multiple Users Attempting To Authenticate Using Explicit Credentials",
        "description": "Detects a source user failing to authenticate with multiple users using explicit credentials on a host.",
        "rule": [
            "SELECT * FROM (SELECT *,count(Account_Name) AS agg FROM eventlog WHERE EventID = \"4648\" GROUP BY ComputerName) WHERE agg > 10"
        ]
    },
    {
        "title": "Multiple Users Failing to Authenticate from Single Process",
        "description": "Detects failed logins with multiple accounts from a single process on the system.",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE ((EventID = \"4625\" AND LogonType = \"2\") AND NOT (ProcessName = \"-\")) GROUP BY ProcessName) WHERE agg > 10"
        ]
    },
    {
        "title": "Failed Logins with Different Accounts from Single Source System",
        "description": "Detects suspicious failed logins with different user accounts from a single source system",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE (EventID IN (\"529\", \"4625\") AND TargetUserName LIKE \"%\" ESCAPE '\\' AND WorkstationName LIKE \"%\" ESCAPE '\\') GROUP BY WorkstationName) WHERE agg > 3"
        ]
    },
    {
        "title": "Failed Logins with Different Accounts from Single Source System",
        "description": "Detects suspicious failed logins with different user accounts from a single source system",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE (EventID = \"4776\" AND TargetUserName LIKE \"%\" ESCAPE '\\' AND Workstation LIKE \"%\" ESCAPE '\\') GROUP BY Workstation) WHERE agg > 3"
        ]
    },
    {
        "title": "Valid Users Failing to Authenticate From Single Source Using Kerberos",
        "description": "Detects multiple failed logins with multiple valid domain accounts from a single source system using the Kerberos protocol.",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE ((EventID = \"4771\" AND Status = \"0x18\") AND NOT (TargetUserName LIKE \"%$\" ESCAPE '\\')) GROUP BY IpAddress) WHERE agg > 10"
        ]
    },
    {
        "title": "Disabled Users Failing To Authenticate From Source Using Kerberos",
        "description": "Detects failed logins with multiple disabled domain accounts from a single source system using the Kerberos protocol.",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE ((EventID = \"4768\" AND Status = \"0x12\") AND NOT (TargetUserName LIKE \"%$\" ESCAPE '\\')) GROUP BY IpAddress) WHERE agg > 10"
        ]
    },
    {
        "title": "Invalid Users Failing To Authenticate From Source Using Kerberos",
        "description": "Detects failed logins with multiple invalid domain accounts from a single source system using the Kerberos protocol.",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE ((EventID = \"4768\" AND Status = \"0x6\") AND NOT (TargetUserName LIKE \"%$\" ESCAPE '\\')) GROUP BY IpAddress) WHERE agg > 10"
        ]
    },
    {
        "title": "Valid Users Failing to Authenticate from Single Source Using NTLM",
        "description": "Detects failed logins with multiple valid domain accounts from a single source system using the NTLM protocol.",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE ((EventID = \"4776\" AND Status LIKE \"%0xC000006A\" ESCAPE '\\') AND NOT (TargetUserName LIKE \"%$\" ESCAPE '\\')) GROUP BY Workstation) WHERE agg > 10"
        ]
    },
    {
        "title": "Invalid Users Failing To Authenticate From Single Source Using NTLM",
        "description": "Detects failed logins with multiple invalid domain accounts from a single source system using the NTLM protocol.",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE ((EventID = \"4776\" AND Status LIKE \"%0xC0000064\" ESCAPE '\\') AND NOT (TargetUserName LIKE \"%$\" ESCAPE '\\')) GROUP BY Workstation) WHERE agg > 10"
        ]
    },
    {
        "title": "Account Tampering - Suspicious Failed Logon Reasons",
        "description": "This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"4625\", \"4776\") AND Status IN (\"0xC0000072\", \"0xC000006F\", \"0xC0000070\", \"0xC0000413\", \"0xC000018C\", \"0xC000015B\"))"
        ]
    },
    {
        "title": "Failed Logon From Public IP",
        "description": "A login from a public IP can indicate a misconfigured firewall or network boundary.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4625\" AND NOT ((IpAddress LIKE \"%-%\" ESCAPE '\\' OR (IpAddress LIKE \"10.%\" ESCAPE '\\' OR IpAddress LIKE \"192.168.%\" ESCAPE '\\' OR IpAddress LIKE \"172.16.%\" ESCAPE '\\' OR IpAddress LIKE \"172.17.%\" ESCAPE '\\' OR IpAddress LIKE \"172.18.%\" ESCAPE '\\' OR IpAddress LIKE \"172.19.%\" ESCAPE '\\' OR IpAddress LIKE \"172.20.%\" ESCAPE '\\' OR IpAddress LIKE \"172.21.%\" ESCAPE '\\' OR IpAddress LIKE \"172.22.%\" ESCAPE '\\' OR IpAddress LIKE \"172.23.%\" ESCAPE '\\' OR IpAddress LIKE \"172.24.%\" ESCAPE '\\' OR IpAddress LIKE \"172.25.%\" ESCAPE '\\' OR IpAddress LIKE \"172.26.%\" ESCAPE '\\' OR IpAddress LIKE \"172.27.%\" ESCAPE '\\' OR IpAddress LIKE \"172.28.%\" ESCAPE '\\' OR IpAddress LIKE \"172.29.%\" ESCAPE '\\' OR IpAddress LIKE \"172.30.%\" ESCAPE '\\' OR IpAddress LIKE \"172.31.%\" ESCAPE '\\' OR IpAddress LIKE \"127.%\" ESCAPE '\\' OR IpAddress LIKE \"169.254.%\" ESCAPE '\\') OR IpAddress = \"::1\" OR (IpAddress LIKE \"fe80::%\" ESCAPE '\\' OR IpAddress LIKE \"fc00::%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Multiple Users Remotely Failing To Authenticate From Single Source",
        "description": "Detects a source system failing to authenticate against a remote host with multiple users.",
        "rule": [
            "SELECT * FROM (SELECT *,count(TargetUserName) AS agg FROM eventlog WHERE ((EventID = \"4625\" AND LogonType = \"3\") AND NOT (IpAddress = \"-\")) GROUP BY IpAddress) WHERE agg > 10"
        ]
    },
    {
        "title": "Interactive Logon to Server Systems",
        "description": "Detects interactive console logons to Server Systems",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID IN (\"528\", \"529\", \"4624\", \"4625\") AND LogonType = \"2\" AND (ComputerName LIKE \"\\%ServerSystems\\%\" ESCAPE '\\' OR ComputerName LIKE \"\\%DomainControllers\\%\" ESCAPE '\\')) AND NOT (LogonProcessName = \"Advapi\" AND ComputerName LIKE \"\\%Workstations\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Kerberos Manipulation",
        "description": "This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"675\", \"4768\", \"4769\", \"4771\") AND FailureCode IN (\"0x9\", \"0xA\", \"0xB\", \"0xF\", \"0x10\", \"0x11\", \"0x13\", \"0x14\", \"0x1A\", \"0x1F\", \"0x21\", \"0x22\", \"0x23\", \"0x24\", \"0x26\", \"0x27\", \"0x28\", \"0x29\", \"0x2C\", \"0x2D\", \"0x2E\", \"0x2F\", \"0x31\", \"0x32\", \"0x3E\", \"0x3F\", \"0x40\", \"0x41\", \"0x43\", \"0x44\"))"
        ]
    },
    {
        "title": "Suspicious LDAP-Attributes Used",
        "description": "Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5136\" AND AttributeValue LIKE \"%\" ESCAPE '\\' AND AttributeLDAPDisplayName IN (\"primaryInternationalISDNNumber\", \"otherFacsimileTelephoneNumber\", \"primaryTelexNumber\"))"
        ]
    },
    {
        "title": "Suspicious Windows ANONYMOUS LOGON Local Account Created",
        "description": "Detects the creation of suspicious accounts similar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4720\" AND SamAccountName LIKE \"%ANONYMOUS%\" ESCAPE '\\' AND SamAccountName LIKE \"%LOGON%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Remote Logon with Explicit Credentials",
        "description": "Detects suspicious processes logging on with explicit credentials",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4648\" AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\pwsh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\winrs.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\reg.exe\" ESCAPE '\\')) AND NOT (TargetServerName = \"localhost\"))"
        ]
    },
    {
        "title": "Password Dumper Activity on LSASS",
        "description": "Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4656\" AND ProcessName LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND AccessMask = \"0x705\" AND ObjectType LIKE \"SAM\\_DOMAIN\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Generic Password Dumper Activity on LSASS",
        "description": "Detects process handle on LSASS process with certain access mask",
        "rule": [
            "SELECT * FROM eventlog WHERE (((ObjectName LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND ((EventID = \"4656\" AND (AccessMask LIKE \"%0x40%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1400%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1000%\" ESCAPE '\\' OR AccessMask LIKE \"%0x100000%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1410%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1010%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1438%\" ESCAPE '\\' OR AccessMask LIKE \"%0x143a%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1418%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1f0fff%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1f1fff%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1f2fff%\" ESCAPE '\\' OR AccessMask LIKE \"%0x1f3fff%\" ESCAPE '\\')) OR (EventID = \"4663\" AND (AccessList LIKE \"%4484%\" ESCAPE '\\' OR AccessList LIKE \"%4416%\" ESCAPE '\\')))) AND NOT ((ProcessName LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\taskmgr.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\procexp64.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\procexp.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\lsm.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\csrss.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\wininit.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\vmtoolsd.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\minionhost.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\VsTskMgr.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\thor64.exe\" ESCAPE '\\') AND (ProcessName LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR ProcessName LIKE \"C:\\\\Windows\\\\SysWow64\\\\%\" ESCAPE '\\' OR ProcessName LIKE \"C:\\\\Windows\\\\SysNative\\\\%\" ESCAPE '\\' OR ProcessName LIKE \"C:\\\\Program Files\\\\%\" ESCAPE '\\' OR ProcessName LIKE \"C:\\\\Windows\\\\Temp\\\\asgard2-agent\\\\%\" ESCAPE '\\'))) AND NOT ((ProcessName LIKE \"C:\\\\Program Files%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "MSHTA Suspicious Execution 01",
        "description": "Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%vbscript%\" ESCAPE '\\' OR CommandLine LIKE \"%.jpg%\" ESCAPE '\\' OR CommandLine LIKE \"%.png%\" ESCAPE '\\' OR CommandLine LIKE \"%.lnk%\" ESCAPE '\\' OR CommandLine LIKE \"%.xls%\" ESCAPE '\\' OR CommandLine LIKE \"%.doc%\" ESCAPE '\\' OR CommandLine LIKE \"%.zip%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Microsoft Malware Protection Engine Crash",
        "description": "This rule detects a suspicious crash of the Microsoft Malware Protection Engine",
        "rule": [
            "SELECT * FROM eventlog WHERE (((Provider_Name = \"Application Error\" AND EventID = \"1000\") OR (Provider_Name = \"Windows Error Reporting\" AND EventID = \"1001\")) AND (eventlog MATCH ('\"MsMpEng.exe\" AND \"mpengine.dll\"')))"
        ]
    },
    {
        "title": "Suspicious Multiple File Rename Or Delete Occurred",
        "description": "Detects multiple file rename or delete events occurrence within a specified period of time by a same user (these events may signalize about ransomware activity).",
        "rule": [
            "SELECT * FROM (SELECT *,count(*) AS agg FROM eventlog WHERE (EventID = \"4663\" AND ObjectType = \"File\" AND AccessList LIKE \"\\%\\%1537\" ESCAPE '\\' AND Keywords = \"0x8020000000000000\") GROUP BY SubjectLogonId) WHERE agg > 10"
        ]
    },
    {
        "title": "Reconnaissance Activity",
        "description": "Detects activity as \"net user administrator /domain\" and \"net group domain admins /domain\"",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4661\" AND (ObjectType LIKE \"SAM\\_USER\" ESCAPE '\\' OR ObjectType LIKE \"SAM\\_GROUP\" ESCAPE '\\') AND ObjectName LIKE \"S-1-5-21-%\" ESCAPE '\\' AND AccessMask = \"0x2d\" AND (ObjectName LIKE \"%-500\" ESCAPE '\\' OR ObjectName LIKE \"%-512\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "NTLM Logon",
        "description": "Detects logons using NTLM, which could be caused by a legacy source or attackers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"8002\" AND CallingProcessName LIKE \"%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Potential Remote Desktop Connection to Non-Domain Host",
        "description": "Detects logons using NTLM to hosts that are potentially not part of the domain.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"8001\" AND TargetName LIKE \"TERMSRV%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "ProcessHacker Privilege Elevation",
        "description": "Detects a ProcessHacker tool that elevated privileges to a very high level",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ServiceName LIKE \"ProcessHacker%\" ESCAPE '\\' AND AccountName = \"LocalSystem\")"
        ]
    },
    {
        "title": "Suspicious PsExec Execution",
        "description": "detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\IPC$\" ESCAPE '\\' AND (RelativeTargetName LIKE \"%-stdin\" ESCAPE '\\' OR RelativeTargetName LIKE \"%-stdout\" ESCAPE '\\' OR RelativeTargetName LIKE \"%-stderr\" ESCAPE '\\')) AND NOT (EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\IPC$\" ESCAPE '\\' AND RelativeTargetName LIKE \"PSEXESVC%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Access to Sensitive File Extensions",
        "description": "Detects known sensitive file extensions accessed on a network share",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND (RelativeTargetName LIKE \"%.pst\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.ost\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.msg\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.nst\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.oab\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.edb\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.nsf\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.bak\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.dmp\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.kirbi\" ESCAPE '\\' OR RelativeTargetName LIKE \"%\\\\groups.xml\" ESCAPE '\\' OR RelativeTargetName LIKE \"%.rdp\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Kerberos RC4 Ticket Encryption",
        "description": "Detects service ticket requests using RC4 encryption type",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4769\" AND TicketOptions = \"0x40810000\" AND TicketEncryptionType = \"0x17\") AND NOT (ServiceName LIKE \"$%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "RottenPotato Like Attack Pattern",
        "description": "Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4624\" AND LogonType = \"3\" AND TargetUserName LIKE \"ANONYMOUS\\_LOGON\" ESCAPE '\\' AND WorkstationName = \"-\" AND IpAddress = \"127.0.0.1\")"
        ]
    },
    {
        "title": "Secure Deletion with SDelete",
        "description": "Detects renaming of file while deletion with SDelete tool.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"4656\", \"4663\", \"4658\") AND (ObjectName LIKE \"%.AAA\" ESCAPE '\\' OR ObjectName LIKE \"%.ZZZ\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Unauthorized System Time Modification",
        "description": "Detect scenarios where a potentially unauthorized application or user is modifying the system time.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4616\" AND NOT (((ProcessName LIKE \"C:\\\\Program Files\\\\VMware\\\\VMware Tools\\\\vmtoolsd.exe\" ESCAPE '\\' OR ProcessName LIKE \"C:\\\\Windows\\\\System32\\\\VBoxService.exe\" ESCAPE '\\') OR (ProcessName LIKE \"C:\\\\Windows\\\\System32\\\\svchost.exe\" ESCAPE '\\' AND SubjectUserSid = \"S-1-5-19\"))))"
        ]
    },
    {
        "title": "Login with WMI",
        "description": "Detection of logins performed with WMI",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4624\" AND ProcessName LIKE \"%\\\\WmiPrvSE.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Remote Service Activity via SVCCTL Named Pipe",
        "description": "Detects remote service activity via remote access to the svcctl named pipe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND ShareName LIKE \"\\\\%\\\\IPC$\" ESCAPE '\\' AND RelativeTargetName = \"svcctl\" AND Accesses LIKE \"%WriteData%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SysKey Registry Keys Access",
        "description": "Detects handle requests and access operations to specific registry keys to calculate the SysKey",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"4656\", \"4663\") AND ObjectType = \"key\" AND (ObjectName LIKE \"%lsa\\\\JD\" ESCAPE '\\' OR ObjectName LIKE \"%lsa\\\\GBG\" ESCAPE '\\' OR ObjectName LIKE \"%lsa\\\\Skew1\" ESCAPE '\\' OR ObjectName LIKE \"%lsa\\\\Data\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Sysmon Channel Reference Deletion",
        "description": "Potential threat actor tampering with Sysmon manifest and eventually disabling it",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ObjectName LIKE \"%WINEVT\\\\Publishers\\\\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}%\" ESCAPE '\\' OR ObjectName LIKE \"%WINEVT\\\\Channels\\\\Microsoft-Windows-Sysmon/Operational%\" ESCAPE '\\') AND ((EventID = \"4657\" AND ObjectValueName = \"Enabled\" AND NewValue = \"0\") OR (EventID = \"4663\" AND AccessMask = \"65536\")))"
        ]
    },
    {
        "title": "Eventlog Cleared",
        "description": "One of the Windows Eventlogs has been cleared. e.g. caused by \"wevtutil cl\" command execution",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"104\" AND Provider_Name = \"Microsoft-Windows-Eventlog\")"
        ]
    },
    {
        "title": "Tap Driver Installation",
        "description": "Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7045\" AND ImagePath LIKE \"%tap0901%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Transferring Files with Credential Data via Network Shares",
        "description": "Transferring files with well-known filenames (sensitive files with credential data) using network shares",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5145\" AND (RelativeTargetName LIKE \"%\\\\mimidrv%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%\\\\lsass%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%\\\\windows\\\\minidump\\\\%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%\\\\hiberfil%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%\\\\sqldmpr%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%\\\\sam%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%\\\\ntds.dit%\" ESCAPE '\\' OR RelativeTargetName LIKE \"%\\\\security%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "USB Device Plugged",
        "description": "Detects plugged USB devices",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID IN (\"2003\", \"2100\", \"2102\")"
        ]
    },
    {
        "title": "User Added to Local Administrators",
        "description": "This rule triggers on user accounts that are added to the local Administrators group, which could be legitimate activity or a sign of privilege escalation activity",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4732\" AND (TargetUserName LIKE \"Administr%\" ESCAPE '\\' OR TargetSid = \"S-1-5-32-544\")) AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "User Couldn't Call a Privileged Service 'LsaRegisterLogonProcess'",
        "description": "The 'LsaRegisterLogonProcess' function verifies that the application making the function call is a logon process by checking that it has the SeTcbPrivilege privilege set. Possible Rubeus tries to get a handle to LSA.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4673\" AND Service = \"LsaRegisterLogonProcess()\" AND Keywords = \"0x8010000000000000\")"
        ]
    },
    {
        "title": "Local User Creation",
        "description": "Detects local user creation on windows servers, which shouldn't happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs.",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID = \"4720\""
        ]
    },
    {
        "title": "Suspicious Driver Loaded By User",
        "description": "Detects the loading of drivers via 'SeLoadDriverPrivilege' required to load or unload a device driver. With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers. If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers. This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"4673\" AND PrivilegeList = \"SeLoadDriverPrivilege\" AND Service = \"-\") AND NOT ((ProcessName LIKE \"%\\\\Windows\\\\System32\\\\Dism.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\Windows\\\\System32\\\\rundll32.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\Windows\\\\System32\\\\fltMC.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\Windows\\\\HelpPane.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\Windows\\\\System32\\\\mmc.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\Windows\\\\System32\\\\svchost.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\Windows\\\\System32\\\\wimserv.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\procexp64.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\procexp.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\procmon64.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\procmon.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Volume Shadow Copy Mount",
        "description": "Detects volume shadow copy mount",
        "rule": [
            "SELECT * FROM eventlog WHERE (Provider_Name = \"Microsoft-Windows-Ntfs\" AND EventID = \"98\" AND DeviceName LIKE \"%HarddiskVolumeShadowCopy%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "VSSAudit Security Event Source Registration",
        "description": "Detects the registration of the security event source VSSAudit. It would usually trigger when volume shadow copy operations happen.",
        "rule": [
            "SELECT * FROM eventlog WHERE (AuditSourceName = \"VSSAudit\" AND (EventID = \"4904\" OR EventID = \"4905\"))"
        ]
    },
    {
        "title": "Vulnerable Netlogon Secure Channel Connection Allowed",
        "description": "Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472.",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID = \"5829\""
        ]
    },
    {
        "title": "T1047 Wmiprvse Wbemcomn DLL Hijack",
        "description": "Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network for a WMI DLL Hijack scenario.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5145\" AND RelativeTargetName LIKE \"%\\\\wbem\\\\wbemcomn.dll\" ESCAPE '\\') AND NOT (SubjectUserName LIKE \"%$\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CobaltStrike Process Injection",
        "description": "Detects a possible remote threat creation with certain characteristics which are typical for Cobalt Strike beacons",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"8\" AND (TargetProcessAddress LIKE \"%0B80\" ESCAPE '\\' OR TargetProcessAddress LIKE \"%0C7C\" ESCAPE '\\' OR TargetProcessAddress LIKE \"%0C88\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CreateRemoteThread API and LoadLibrary",
        "description": "Detects potential use of CreateRemoteThread api and LoadLibrary function to inject DLL into a process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"8\" AND StartModule LIKE \"%\\\\kernel32.dll\" ESCAPE '\\' AND StartFunction = \"LoadLibraryA\")"
        ]
    },
    {
        "title": "Password Dumper Remote Thread in LSASS",
        "description": "Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage. The process in field Process is the malicious program. A single execution can lead to hundreds of events.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"8\" AND TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND StartModule = \"\")"
        ]
    },
    {
        "title": "Accessing WinAPI in PowerShell. Code Injection.",
        "description": "Detecting Code injection with PowerShell in another process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"8\" AND SourceImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Remote Thread Created",
        "description": "Offensive tradecraft is switching away from using APIs like \"CreateRemoteThread\", however, this is still largely observed in the wild. This rule aims to detect suspicious processes (those we would not expect to behave in this way like word.exe or outlook.exe) creating remote threads on other processes. It is a generalistic rule, but it should have a low FP ratio due to the selected range of processes.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"8\" AND (SourceImage LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\cvtres.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\defrag.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\dnx.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\esentutl.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\expand.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\explorer.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\find.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\findstr.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\forfiles.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\git.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\gpupdate.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\hh.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\iexplore.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\installutil.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\lync.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\makecab.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\mDNSResponder.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\monitoringhost.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\msbuild.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\msiexec.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\mspaint.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\outlook.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\ping.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\provtool.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\python.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\robocopy.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\runonce.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\sapcimc.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\smartscreen.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\spoolsv.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\tstheme.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\userinit.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\vssadmin.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\vssvc.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\w3wp.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\winlogon.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\winscp.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\word.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\wscript.exe\" ESCAPE '\\') AND NOT (SourceImage LIKE \"%Visual Studio%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Rundll32 Remote Thread Creation",
        "description": "Detects PowerShell remote thread creation in Rundll32.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"8\" AND SourceImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND TargetImage LIKE \"%\\\\rundll32.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Exports Registry Key To an Alternate Data Stream",
        "description": "Exports the target Registry key and hides it in the specified alternate data stream.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"15\" AND Image LIKE \"%\\\\regedit.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SyncAppvPublishingServer Execution to Bypass Powershell Restriction",
        "description": "Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.",
        "rule": [
            "SELECT * FROM eventlog WHERE eventlog MATCH ('\"SyncAppvPublishingServer.exe\"')"
        ]
    },
    {
        "title": "SyncAppvPublishingServer Execution to Bypass Powershell Restriction",
        "description": "Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\SyncAppvPublishingServer.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Mimikatz Detection LSASS Access",
        "description": "Detects process access to LSASS which is typical for Mimikatz (0x1000 PROCESS_QUERY_ LIMITED_INFORMATION, 0x0400 PROCESS_QUERY_ INFORMATION \"only old versions\", 0x0010 PROCESS_VM_READ)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND GrantedAccess IN (\"0x1410\", \"0x1010\"))"
        ]
    },
    {
        "title": "Suspicious Esentutl Use",
        "description": "Detects flags often used with the LOLBAS Esentutl for malicious activity. It could be used in rare cases by administrators to access locked files or during maintenance.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% /vss %\" ESCAPE '\\' AND CommandLine LIKE \"% /y %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Activity Related to NTDS.dit Domain Hash Retrieval",
        "description": "Detects suspicious commands that could be related to activity that uses volume shadow copy to steal and retrieve hashes from the NTDS.dit file remotely",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"vssadmin.exe Delete Shadows\" ESCAPE '\\' OR CommandLine LIKE \"vssadmin create shadow /for=C:\" ESCAPE '\\' OR CommandLine LIKE \"copy \\\\_\\\\GLOBALROOT\\\\Device\\\\%\\\\windows\\\\ntds\\\\ntds.dit\" ESCAPE '\\' OR CommandLine LIKE \"copy \\\\_\\\\GLOBALROOT\\\\Device\\\\%\\\\config\\\\SAM\" ESCAPE '\\' OR CommandLine LIKE \"vssadmin delete shadows /for=C:\" ESCAPE '\\' OR CommandLine LIKE \"reg SAVE HKLM\\\\SYSTEM \" ESCAPE '\\' OR CommandLine LIKE \"esentutl.exe /y /vss %\\\\ntds.dit%\" ESCAPE '\\' OR CommandLine LIKE \"esentutl.exe /y /vss %\\\\SAM\" ESCAPE '\\' OR CommandLine LIKE \"esentutl.exe /y /vss %\\\\SYSTEM\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "DNS HybridConnectionManager Service Bus",
        "description": "Detects Azure Hybrid Connection Manager services querying the Azure service bus service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"22\" AND QueryName LIKE \"%servicebus.windows.net%\" ESCAPE '\\' AND Image LIKE \"%HybridConnectionManager%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "DNS Query for MEGA.io Upload Domain",
        "description": "Detects DNS queries for subdomains used for upload to MEGA.io",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"22\" AND QueryName LIKE \"%userstorage.mega.co.nz%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Possible DNS Rebinding",
        "description": "Detects several different DNS-answers by one domain with IPs from internal and external networks. Normally, DNS-answer contain TTL >100. (DNS-record will saved in host cache for a while TTL).",
        "rule": [
            "SELECT * FROM (SELECT *,count(QueryName) AS agg FROM eventlog WHERE (EventID = \"22\" AND QueryName LIKE \"%\" ESCAPE '\\' AND QueryStatus = \"0\" AND (QueryResults LIKE \"(::ffff:)_10.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_192.168.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.16.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.17.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.18.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.19.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.20.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.21.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.22.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.23.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.24.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.25.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.26.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.27.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.28.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.29.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.30.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.31.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_127.%\" ESCAPE '\\') AND (QueryName LIKE \"%\" ESCAPE '\\' AND QueryStatus = \"0\") AND NOT ((QueryResults LIKE \"(::ffff:)_10.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_192.168.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.16.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.17.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.18.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.19.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.20.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.21.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.22.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.23.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.24.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.25.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.26.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.27.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.28.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.29.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.30.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_172.31.%\" ESCAPE '\\' OR QueryResults LIKE \"(::ffff:)_127.%\" ESCAPE '\\'))) GROUP BY ComputerName) WHERE agg > 3"
        ]
    },
    {
        "title": "Regsvr32 Network Activity",
        "description": "Detects network connections and DNS queries initiated by Regsvr32.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"22\" AND Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Credential Dumping Tools Service Execution",
        "description": "Detects well-known credential dumping tools execution via service execution events",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"6\" AND (ImagePath LIKE \"%fgexec%\" ESCAPE '\\' OR ImagePath LIKE \"%dumpsvc%\" ESCAPE '\\' OR ImagePath LIKE \"%cachedump%\" ESCAPE '\\' OR ImagePath LIKE \"%mimidrv%\" ESCAPE '\\' OR ImagePath LIKE \"%gsecdump%\" ESCAPE '\\' OR ImagePath LIKE \"%servpw%\" ESCAPE '\\' OR ImagePath LIKE \"%pwdump%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Meterpreter or Cobalt Strike Getsystem Service Installation",
        "description": "Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"6\" AND ((ImagePath LIKE \"%cmd%\" ESCAPE '\\' AND ImagePath LIKE \"%/c%\" ESCAPE '\\' AND ImagePath LIKE \"%echo%\" ESCAPE '\\' AND ImagePath LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ImagePath LIKE \"%\\%COMSPEC\\%%\" ESCAPE '\\' AND ImagePath LIKE \"%/c%\" ESCAPE '\\' AND ImagePath LIKE \"%echo%\" ESCAPE '\\' AND ImagePath LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ImagePath LIKE \"%cmd.exe%\" ESCAPE '\\' AND ImagePath LIKE \"%/c%\" ESCAPE '\\' AND ImagePath LIKE \"%echo%\" ESCAPE '\\' AND ImagePath LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (ImagePath LIKE \"%rundll32%\" ESCAPE '\\' AND ImagePath LIKE \"%.dll,a%\" ESCAPE '\\' AND ImagePath LIKE \"%/p:%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "PowerShell Scripts Run by a Services",
        "description": "Detects powershell script installed as a Service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"6\" AND (ImageLoaded LIKE \"%powershell%\" ESCAPE '\\' OR ImageLoaded LIKE \"%pwsh%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Driver Load from Temp",
        "description": "Detects a driver load from a temporary directory",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"6\" AND ImageLoaded LIKE \"%\\\\Temp\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Vulnerable Dell BIOS Update Driver Load",
        "description": "Detects the load of the vulnerable Dell BIOS update driver as reported in CVE-2021-21551",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"6\" AND (ImageLoaded LIKE \"%\\\\DBUtil\\_2\\_3.Sys%\" ESCAPE '\\' OR (Hashes LIKE \"%0296e2ce999e67c76352613a718e11516fe1b0efc3ffdb8918fc999dd76a73a5%\" ESCAPE '\\' OR Hashes LIKE \"%c948ae14761095e4d76b55d9de86412258be7afd%\" ESCAPE '\\' OR Hashes LIKE \"%c996d7971c49252c582171d9380360f2%\" ESCAPE '\\' OR Hashes LIKE \"%ddbf5ecca5c8086afde1fb4f551e9e6400e94f4428fe7fb5559da5cffa654cc1%\" ESCAPE '\\' OR Hashes LIKE \"%10b30bdee43b3a2ec4aa63375577ade650269d25%\" ESCAPE '\\' OR Hashes LIKE \"%d2fd132ab7bbc6bbb87a84f026fa0244%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "WinDivert Driver Load",
        "description": "Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection package for Windows",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"6\" AND (ImageLoaded LIKE \"%\\\\WinDivert.sys%\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\WinDivert64.sys%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Prefetch File Deletion",
        "description": "Detects the deletion of a prefetch file (AntiForensic)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"23\", \"26\") AND (TargetFilename LIKE \"C:\\\\Windows\\\\Prefetch\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%.pf\" ESCAPE '\\') AND NOT (Image LIKE \"C:\\\\windows\\\\system32\\\\svchost.exe\" ESCAPE '\\' AND User LIKE \"NT AUTHORITY\\\\SYSTEM\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Sysinternals SDelete File Deletion",
        "description": "A General detection to trigger for the deletion of files by Sysinternals SDelete. It looks for the common name pattern used to rename files.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"23\", \"26\") AND (TargetFilename LIKE \"%.AAA\" ESCAPE '\\' OR TargetFilename LIKE \"%.ZZZ\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows Spooler Service Suspicious File Deletion",
        "description": "Detect DLL deletions from Spooler Service driver folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"23\", \"26\") AND Image LIKE \"%spoolsv.exe\" ESCAPE '\\' AND TargetFilename LIKE \"%C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\3\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Advanced IP Scanner",
        "description": "Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\Advanced IP Scanner 2%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Unidentified Attacker November 2018",
        "description": "A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%ds7002.lnk%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CVE-2021-31979 CVE-2021-33771 Exploits by Sourgum",
        "description": "Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\physmem.sys%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\System32\\\\IME\\\\IMEJP\\\\imjpueact.dll%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\ime\\\\IMETC\\\\IMTCPROT.DLL%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\ime\\\\SHARED\\\\imecpmeid.dll%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\config\\\\spp\\\\ServiceState\\\\Recovery\\\\pac.dat%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\config\\\\cy-GB\\\\Setup\\\\SKB\\\\InputMethod\\\\TupTask.dat%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\config\\\\config\\\\startwus.dat%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\ime\\\\SHARED\\\\WimBootConfigurations.ini%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\ime\\\\IMEJP\\\\WimBootConfigurations.ini%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\system32\\\\ime\\\\IMETC\\\\WimBootConfigurations.ini%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "File Creation by Office Applications",
        "description": "This rule will monitor executable and script file creation by office applications. Please add more file extensions or magic bytes to the logic of your choice.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((Image LIKE \"%winword.exe\" ESCAPE '\\' OR Image LIKE \"%excel.exe\" ESCAPE '\\' OR Image LIKE \"%powerpnt.exe\" ESCAPE '\\') AND ((FileName LIKE \"%.exe\" ESCAPE '\\' OR FileName LIKE \"%.dll\" ESCAPE '\\' OR FileName LIKE \"%.ocx\" ESCAPE '\\' OR FileName LIKE \"%.com\" ESCAPE '\\' OR FileName LIKE \"%.ps1\" ESCAPE '\\' OR FileName LIKE \"%.vbs\" ESCAPE '\\' OR FileName LIKE \"%.sys\" ESCAPE '\\' OR FileName LIKE \"%.bat\" ESCAPE '\\' OR FileName LIKE \"%.scr\" ESCAPE '\\' OR FileName LIKE \"%.proj\" ESCAPE '\\') OR (FileMagicBytes LIKE \"4D5A%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Dumpert Process Dumper",
        "description": "Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"C:\\\\Windows\\\\Temp\\\\dumpert.dmp\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CreateMiniDump Hacktool",
        "description": "Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\lsass.dmp\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Adwind RAT / JRAT",
        "description": "Detects javaw.exe in AppData folder as used by Adwind / JRAT",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND ((TargetFilename LIKE \"%\\\\AppData\\\\Roaming\\\\Oracle\\\\bin\\\\java%\" ESCAPE '\\' AND TargetFilename LIKE \"%.exe%\" ESCAPE '\\') OR (TargetFilename LIKE \"%\\\\Retrive%\" ESCAPE '\\' AND TargetFilename LIKE \"%.vbs%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Moriya Rootkit",
        "description": "Detects the use of Moriya rootkit as described in the securelist's Operation TunnelSnake report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"C:\\\\Windows\\\\System32\\\\drivers\\\\MoriyaStreamWatchmen.sys\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Pingback Backdoor",
        "description": "Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"%updata.exe\" ESCAPE '\\' AND TargetFilename LIKE \"C:\\\\Windows\\\\oci.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Created Files by Office Applications",
        "description": "This rule will monitor executable and script file creation by office applications. Please add more file extensions or magic bytes to the logic of your choice.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((Image LIKE \"%winword.exe\" ESCAPE '\\' OR Image LIKE \"%excel.exe\" ESCAPE '\\' OR Image LIKE \"%powerpnt.exe\" ESCAPE '\\') AND (TargetFileName LIKE \"%.exe\" ESCAPE '\\' OR TargetFileName LIKE \"%.dll\" ESCAPE '\\' OR TargetFileName LIKE \"%.ocx\" ESCAPE '\\' OR TargetFileName LIKE \"%.com\" ESCAPE '\\' OR TargetFileName LIKE \"%.ps1\" ESCAPE '\\' OR TargetFileName LIKE \"%.vbs\" ESCAPE '\\' OR TargetFileName LIKE \"%.sys\" ESCAPE '\\' OR TargetFileName LIKE \"%.bat\" ESCAPE '\\' OR TargetFileName LIKE \"%.scr\" ESCAPE '\\' OR TargetFileName LIKE \"%.proj\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PsExec Tool Execution",
        "description": "Detects PsExec service installation and execution events (service and Sysmon)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\PSEXESVC.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Abusing Winsat Path Parsing - File",
        "description": "Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"C:\\\\Users\\\\%\" ESCAPE '\\' AND (TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\system32\\\\winsat.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\system32\\\\winmm.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "UAC Bypass Using Windows Media Player - File",
        "description": "Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND ((TargetFilename LIKE \"C:\\\\Users\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\OskSupport.dll\" ESCAPE '\\') OR (Image LIKE \"C:\\\\Windows\\\\system32\\\\DllHost.exe\" ESCAPE '\\' AND TargetFilename LIKE \"C:\\\\Program Files\\\\Windows Media Player\\\\osk.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl",
        "description": "Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%WsmPty.xsl\" ESCAPE '\\' OR TargetFilename LIKE \"%WsmTxt.xsl\" ESCAPE '\\') AND NOT ((TargetFilename LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Wmiprvse Wbemcomn DLL Hijack",
        "description": "Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network and loading it for a WMI DLL Hijack scenario.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image = \"System\" AND TargetFilename LIKE \"%\\\\wbem\\\\wbemcomn.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "File Created with System Process Name",
        "description": "Detects the creation of a executable with a system process name in a suspicious folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%\\\\svchost.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\services.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\spoolsv.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\lsass.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\smss.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\csrss.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\conhost.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\wininit.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\lsm.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\winlogon.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\explorer.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\taskhost.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Taskmgr.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\taskmgr.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\sihost.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\RuntimeBroker.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\runtimebroker.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\smartscreen.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\dllhost.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\audiodg.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\wlanext.exe\" ESCAPE '\\') AND NOT ((TargetFilename LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"C:\\\\Windows\\\\system32\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"C:\\\\Windows\\\\SysWow64\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"C:\\\\Windows\\\\winsxs\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"C:\\\\Windows\\\\WinSxS\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"\\\\SystemRoot\\\\System32\\\\%\" ESCAPE '\\') AND (Image LIKE \"%\\\\Windows\\\\System32\\\\dism.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Cred Dump Tools Dropped Files",
        "description": "Files with well-known filenames (parts of credential dump software or files produced by them) creation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%\\\\pwdump%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\kirbi%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\pwhashes%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\wce\\_ccache%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\wce\\_krbtkts%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\fgdump-log%\" ESCAPE '\\') AND (TargetFilename LIKE \"%\\\\test.pwd\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\lsremora64.dll\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\lsremora.dll\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\fgexec.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\wceaux.dll\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\SAM.out\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\SECURITY.out\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\SYSTEM.out\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\NTDS.out\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\DumpExt.dll\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\DumpSvc.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\cachedump64.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\cachedump.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\pstgdump.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\servpw.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\servpw64.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\pwdump.exe\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\procdump64.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CVE-2021-26858 Exchange Exploitation",
        "description": "Detects possible successful exploitation for vulnerability described in CVE-2021-26858 by looking for | creation of non-standard files on disk by Exchange Servers Unified Messaging service | which could indicate dropping web shells or other malicious content",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"%UMWorkerProcess.exe\" ESCAPE '\\' AND NOT ((TargetFilename LIKE \"%CacheCleanup.bin\" ESCAPE '\\' OR TargetFilename LIKE \"%.txt\" ESCAPE '\\' OR TargetFilename LIKE \"%.LOG\" ESCAPE '\\' OR TargetFilename LIKE \"%.cfg\" ESCAPE '\\' OR TargetFilename LIKE \"%cleanup.bin\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Powerup Write Hijack DLL",
        "description": "Powerup tool's Write Hijack DLL exploits DLL hijacking for privilege escalation. In it's default mode, it builds a self deleting .bat file which executes malicious command. The detection rule relies on creation of the malicious bat file (debug.bat by default).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND TargetFilename LIKE \"%.bat\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Detection of SafetyKatz",
        "description": "Detects possible SafetyKatz Behaviour",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\Temp\\\\debug.bin\" ESCAPE '\\')"
        ]
    },
    {
        "title": "LSASS Memory Dump File Creation",
        "description": "LSASS memory dump creation using operating systems utilities. Procdump will use process name in output file if no name is specified",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%lsass%\" ESCAPE '\\' AND TargetFilename LIKE \"%dmp\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Files Dropped to Program Files by Non-Priviledged Process",
        "description": "Search for dropping of files to Windows/Program Files fodlers by non-priviledged processes",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND IntegrityLevel = \"Medium\" AND ((TargetFilename LIKE \"%\\\\Program Files\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Program Files (x86)\\\\%\" ESCAPE '\\') OR (TargetFilename LIKE \"\\\\Windows\\\\%\" ESCAPE '\\' AND NOT (TargetFilename LIKE \"%temp%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Microsoft Office Add-In Loading",
        "description": "Detects add-ins that load when Microsoft Word or Excel starts (.wll/.xll are simply .dll fit for Word or Excel).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (((TargetFilename LIKE \"%\\\\Microsoft\\\\Word\\\\Startup\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%.wll\" ESCAPE '\\') OR (TargetFilename LIKE \"%\\\\Microsoft\\\\Excel\\\\Startup\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%.xll\" ESCAPE '\\')) OR (TargetFilename LIKE \"%\\\\Microsoft\\\\Addins\\\\%\" ESCAPE '\\' AND (TargetFilename LIKE \"%.xlam\" ESCAPE '\\' OR TargetFilename LIKE \"%.xla\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Outlook Form Installation",
        "description": "Detects the creation of new Outlook form which can contain malicious code",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"\\\\outlook.exe\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\appdata\\\\local\\\\microsoft\\\\FORMS\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PCRE.NET Package Temp Files",
        "description": "Detects processes creating temp files related to PCRE.NET package",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\ba9ea7344a4a5f591d6e5dc32a13494b\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Malicious PowerShell Commandlet Names",
        "description": "Detects the creation of known powershell scripts for exploitation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%\\\\Invoke-DllInjection.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-WmiCommand.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-GPPPassword.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-Keystrokes.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-VaultCredential.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-CredentialInjection.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-Mimikatz.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-NinjaCopy.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-TokenManipulation.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Out-Minidump.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\VolumeShadowCopyTools.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-ReflectivePEInjection.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-TimedScreenshot.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-UserHunter.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Find-GPOLocation.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-ACLScanner.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-DowngradeAccount.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-ServiceUnquoted.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-ServiceFilePermission.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-ServicePermission.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-ServiceAbuse.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Install-ServiceBinary.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-RegAutoLogon.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-VulnAutoRun.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-VulnSchTask.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-UnattendedInstallFile.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-WebConfig.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-ApplicationHost.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-RegAlwaysInstallElevated.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-Unconstrained.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Add-RegBackdoor.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Add-ScrnSaveBackdoor.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Gupt-Backdoor.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-ADSBackdoor.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Enabled-DuplicateToken.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PsUaCme.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Remove-Update.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Check-VM.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-LSASecret.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-PassHashes.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Show-TargetScreen.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Port-Scan.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PoshRatHttp.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PowerShellTCP.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PowerShellWMI.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Add-Exfiltration.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Add-Persistence.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Do-Exfiltration.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Start-CaptureServer.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-ShellCode.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-ChromeDump.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-ClipboardContents.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-FoxDump.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-IndexedItem.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-Screenshot.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-Inveigh.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-NetRipper.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-EgressCheck.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PostExfil.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PSInject.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-RunAs.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\MailRaider.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\New-HoneyHash.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Set-MacAttribute.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-DCSync.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PowerDump.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Exploit-Jboss.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-ThunderStruck.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-VoiceTroll.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Set-Wallpaper.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-InveighRelay.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PsExec.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-SSHCommand.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-SecurityPackages.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Install-SSP.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-BackdoorLNK.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\PowerBreach.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-SiteListPassword.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-System.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-BypassUAC.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-Tater.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-WScriptBypassUAC.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\PowerUp.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\PowerView.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Get-RickAstley.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Find-Fruit.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\HTTP-Login.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Find-TrustedDocuments.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-Paranoia.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-WinEnum.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-ARPScan.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-PortScan.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-ReverseDNSLookup.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-SMBScanner.ps1\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Invoke-Mimikittenz.ps1\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Writing Startup Shortcuts",
        "description": "Attempts to detect PowerShell writing startup shortcuts. This procedure was highlighted in Red Canary Intel Insights Oct. 2021, \"We frequently observe adversaries using PowerShell to write malicious .lnk files into the startup directory to establish persistence. Accordingly, this detection opportunity is likely to identify persistence mechanisms in multiple threats. In the context of Yellow Cockatoo, this persistence mechanism eventually launches the command-line script that leads to the installation of a malicious DLL\"",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\start menu\\\\programs\\\\startup\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%.lnk\" ESCAPE '\\')"
        ]
    },
    {
        "title": "QuarksPwDump Dump File",
        "description": "Detects a dump file written by QuarksPwDump password dumper",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\SAM-%\" ESCAPE '\\' AND TargetFilename LIKE \"%.dmp%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "RedMimicry Winnti Playbook Dropped File",
        "description": "Detects actions caused by the RedMimicry Winnti playbook",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%gthread-3.6.dll%\" ESCAPE '\\' OR TargetFilename LIKE \"%sigcmm-2.4.dll%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Windows\\\\Temp\\\\tmp.bat%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Startup Folder File Write",
        "description": "A General detection for files being created in the Windows startup directory. This could be an indicator of persistence.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%ProgramData\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\StartUp%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Powershell Profile.ps1 Modification",
        "description": "Detects a change in profile.ps1 of the Powershell profile",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\profile.ps1%\" ESCAPE '\\' AND (TargetFilename LIKE \"%\\\\My Documents\\\\PowerShell\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious ADSI-Cache Usage By Unknown Tool",
        "description": "Detects the usage of ADSI (LDAP) operations by tools. This may also detect tools like LDAPFragger.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%\\\\Local\\\\Microsoft\\\\Windows\\\\SchCache\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%.sch\" ESCAPE '\\') AND NOT ((Image LIKE \"C:\\\\windows\\\\system32\\\\svchost.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\windows\\\\system32\\\\dllhost.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\windows\\\\system32\\\\mmc.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\windows\\\\system32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\CCM\\\\CcmExec.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspcious CLR Logs Creation",
        "description": "Detects suspicious .NET assembly executions",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Microsoft\\\\CLR%\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\UsageLogs\\\\%\" ESCAPE '\\' AND (TargetFilename LIKE \"%mshta%\" ESCAPE '\\' OR TargetFilename LIKE \"%cscript%\" ESCAPE '\\' OR TargetFilename LIKE \"%wscript%\" ESCAPE '\\' OR TargetFilename LIKE \"%regsvr32%\" ESCAPE '\\' OR TargetFilename LIKE \"%wmic%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious desktop.ini Action",
        "description": "Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folder's content (i.e. renaming files) without changing them on disk.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\desktop.ini\" ESCAPE '\\' AND NOT ((Image LIKE \"C:\\\\Windows\\\\explorer.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\System32\\\\msiexec.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\System32\\\\mmc.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious PFX File Creation",
        "description": "A general detection for processes creating PFX files. This could be an indicator of an adversary exporting a local certificate to a PFX file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%.pfx\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious PROCEXP152.sys File Created In TMP",
        "description": "Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder. This driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%PROCEXP152.sys\" ESCAPE '\\') AND NOT ((Image LIKE \"%\\\\procexp64.exe%\" ESCAPE '\\' OR Image LIKE \"%\\\\procexp.exe%\" ESCAPE '\\' OR Image LIKE \"%\\\\procmon64.exe%\" ESCAPE '\\' OR Image LIKE \"%\\\\procmon.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Hijack Legit RDP Session to Move Laterally",
        "description": "Detects the usage of tsclient share to place a backdoor on the RDP source machine's startup folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"%\\\\mstsc.exe\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using Consent and Comctl32 - File",
        "description": "Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"C:\\\\Windows\\\\System32\\\\consent.exe.@%\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\comctl32.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using .NET Code Profiler on MMC",
        "description": "Detects the pattern of UAC Bypass using .NET Code Profiler and mmc.exe DLL hijacking (UACMe 39)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"C:\\\\Users\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\pe386.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using IEInstal - File",
        "description": "Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"C:\\\\Program Files\\\\Internet Explorer\\\\IEInstal.exe\" ESCAPE '\\' AND TargetFilename LIKE \"C:\\\\Users\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%consent.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using MSConfig Token Modification - File",
        "description": "Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"C:\\\\Users\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\pkgmgr.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using NTFS Reparse Point - File",
        "description": "Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"C:\\\\Users\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\api-ms-win-core-kernel32-legacy-l1.DLL\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Webshell Creation",
        "description": "Possible webshell file creation on a static web site",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND ((((TargetFilename LIKE \"%\\\\inetpub\\\\wwwroot\\\\%\" ESCAPE '\\' AND (TargetFilename LIKE \"%.asp%\" ESCAPE '\\' OR TargetFilename LIKE \"%.ashx%\" ESCAPE '\\' OR TargetFilename LIKE \"%.ph%\" ESCAPE '\\')) AND NOT ((TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Windows\\\\Temp\\\\%\" ESCAPE '\\'))) OR (((TargetFilename LIKE \"%\\\\www\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\htdocs\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\html\\\\%\" ESCAPE '\\') AND TargetFilename LIKE \"%.ph%\" ESCAPE '\\') AND NOT ((TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Windows\\\\Temp\\\\%\" ESCAPE '\\')))) OR ((TargetFilename LIKE \"%.jsp\" ESCAPE '\\' OR (TargetFilename LIKE \"%\\\\cgi-bin\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%.pl%\" ESCAPE '\\')) AND NOT ((TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Windows\\\\Temp\\\\%\" ESCAPE '\\')))))"
        ]
    },
    {
        "title": "WMI Persistence - Script Event Consumer File Write",
        "description": "Detects file writes of WMI script event consumer",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"C:\\\\WINDOWS\\\\system32\\\\wbem\\\\scrcons.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CVE-2021-1675 Print Spooler Exploitation Filename Pattern",
        "description": "Detects the default filename used in PoC code against print spooler vulnerability CVE-2021-1675",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\3\\\\old\\\\1\\\\123%\" ESCAPE '\\' OR TargetFilename LIKE \"%C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\3\\\\New\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Word Cab File Write CVE-2021-40444",
        "description": "Detects file creation patterns noticeable during the exploitation of CVE-2021-40444",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND Image LIKE \"\\\\winword.exe\" ESCAPE '\\' AND ((TargetFilename LIKE \"%.cab\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\Windows\\\\INetCache%\" ESCAPE '\\') OR (TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%.inf%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Typical HiveNightmare SAM File Export",
        "description": "Detects files written by the different tools that exploit HiveNightmare",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND ((TargetFilename LIKE \"%\\\\hive\\_sam\\_%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\SAM-2021-%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\SAM-2022-%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\SAM-haxx%\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\Sam.save%\" ESCAPE '\\') OR (TargetFilename LIKE \"C:\\\\windows\\\\temp\\\\sam\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Outlook C2 Macro Creation",
        "description": "Detects the creation of a macro file for Outlook. Goes with win_outlook_c2_registry_key. VbaProject.OTM is explicitly mentioned in T1137. Particularly interesting if both events Registry & File Creation happens at the same time.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%\\\\Microsoft\\\\Outlook\\\\VbaProject.OTM\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Rclone Config File Creation",
        "description": "Detects Rclone config file being created",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND TargetFilename LIKE \"%:\\\\Users\\\\%\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\.config\\\\rclone\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Desktopimgdownldr Target File",
        "description": "Detects a suspicious Microsoft desktopimgdownldr file creation that stores a file to a suspicious location or contains a file with a suspicious extension",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND ((Image LIKE \"%svchost.exe\" ESCAPE '\\' AND TargetFilename LIKE \"%\\\\Personalization\\\\LockScreenImage\\\\%\" ESCAPE '\\') AND NOT (TargetFilename LIKE \"%C:\\\\Windows\\\\%\" ESCAPE '\\')) AND NOT ((TargetFilename LIKE \"%.jpg%\" ESCAPE '\\' OR TargetFilename LIKE \"%.jpeg%\" ESCAPE '\\' OR TargetFilename LIKE \"%.png%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Pingback Backdoor",
        "description": "Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"%msdtc.exe\" ESCAPE '\\' AND ImageLoaded LIKE \"C:\\\\Windows\\\\oci.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SILENTTRINITY Stager Execution",
        "description": "Detects SILENTTRINITY stager use",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Description LIKE \"%st2stager%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Wmiprvse Wbemcomn DLL Hijack",
        "description": "Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network and loading it for a WMI DLL Hijack scenario.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\' AND ImageLoaded LIKE \"%\\\\wbem\\\\wbemcomn.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Time Travel Debugging Utility Usage",
        "description": "Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\tttracer.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Abusing Azure Browser SSO",
        "description": "Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account) wanting to perform SSO authentication in the browser. An attacker can use this to authenticate to Azure AD in a browser as that user.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND ImageLoaded LIKE \"%MicrosoftAccountTokenProvider.dll\" ESCAPE '\\' AND NOT ((Image LIKE \"%BackgroundTaskHost.exe\" ESCAPE '\\' OR Image LIKE \"%devenv.exe\" ESCAPE '\\' OR Image LIKE \"%iexplore.exe\" ESCAPE '\\' OR Image LIKE \"%MicrosoftEdge.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Alternate PowerShell Hosts",
        "description": "Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Description = \"System.Management.Automation\" AND ImageLoaded LIKE \"%System.Management.Automation%\" ESCAPE '\\') AND NOT (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "FoggyWeb Backdoor DLL Loading",
        "description": "Detects DLL image load activity as used by FoggyWeb backdoor loader",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"C:\\\\Windows\\\\ADFS\\\\version.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "In-memory PowerShell",
        "description": "Detects loading of essential DLL used by PowerShell, but not by the process powershell.exe. Detects meterpreter's \"load powershell\" extension.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (ImageLoaded LIKE \"%\\\\System.Management.Automation.Dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\System.Management.Automation.ni.Dll\" ESCAPE '\\') AND NOT ((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell\\_ise.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\WINDOWS\\\\System32\\\\sdiagnhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mscorsvw.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\WINDOWS\\\\System32\\\\RemoteFXvGPUDisablement.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sqlps.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wsmprovhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\winrshost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\syncappvpublishingserver.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\runscripthelper.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\ServerManager.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "PCRE.NET Package Image Load",
        "description": "Detects processes loading modules related to PCRE.NET package",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND ImageLoaded LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\ba9ea7344a4a5f591d6e5dc32a13494b\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PowerShell Execution",
        "description": "Detects execution of PowerShell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Description = \"System.Management.Automation\" AND ImageLoaded LIKE \"%System.Management.Automation%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "WMI Script Host Process Image Loaded",
        "description": "Detects signs of the WMI script host process %SystemRoot%\\system32\\wbem\\scrcons.exe functionality being used via images being loaded by a process.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"%\\\\scrcons.exe\" ESCAPE '\\' AND (ImageLoaded LIKE \"%\\\\vbscript.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wbemdisp.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wshom.ocx\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\scrrun.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows Spooler Service Suspicious Binary Load",
        "description": "Detect DLL Load from Spooler Service backup folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"%spoolsv.exe\" ESCAPE '\\' AND ImageLoaded LIKE \"%\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\3\\\\%\" ESCAPE '\\' AND ImageLoaded LIKE \"%.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Load of dbghelp/dbgcore DLL from Suspicious Process",
        "description": "Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes. Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll. As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND ((((ImageLoaded LIKE \"%\\\\dbghelp.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\dbgcore.dll\" ESCAPE '\\') AND (Image LIKE \"%\\\\msbuild.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\word.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\outlook.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\monitoringhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\dnx.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvcs.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\scriptrunner.exe\" ESCAPE '\\')) AND NOT (Image LIKE \"%Visual Studio%\" ESCAPE '\\')) OR (((ImageLoaded LIKE \"%\\\\dbghelp.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\dbgcore.dll\" ESCAPE '\\') AND Signed = \"FALSE\") AND NOT (Image LIKE \"%Visual Studio%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Fax Service DLL Search Order Hijack",
        "description": "The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND ((Image LIKE \"%fxssvc.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%ualapi.dll\" ESCAPE '\\')) AND NOT ((ImageLoaded LIKE \"C:\\\\Windows\\\\WinSxS\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Possible Process Hollowing Image Loading",
        "description": "Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\notepad.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\samlib.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\WinSCard.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "dotNET DLL Loaded Via Office Applications",
        "description": "Detects any assembly DLL being loaded by an Office Product",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\outlook.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"C:\\\\Windows\\\\assembly\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CLR DLL Loaded Via Office Applications",
        "description": "Detects CLR DLL being loaded by an Office Product",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\outlook.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\clr.dll%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "GAC DLL Loaded Via Office Applications",
        "description": "Detects any GAC DLL being loaded by an Office Product",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\outlook.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"C:\\\\Windows\\\\Microsoft.NET\\\\assembly\\\\GAC\\_MSIL%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Active Directory Parsing DLL Loaded Via Office Applications",
        "description": "Detects DSParse DLL being loaded by an Office Product",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\outlook.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\dsparse.dll%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Active Directory Kerberos DLL Loaded Via Office Applications",
        "description": "Detects Kerberos DLL being loaded by an Office Product",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\outlook.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\kerberos.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Python Py2Exe Image Load",
        "description": "Detects the image load of Python Core indicative of a Python script bundled with Py2Exe.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Description = \"Python Core\")"
        ]
    },
    {
        "title": "CLR DLL Loaded Via Scripting Applications",
        "description": "Detects CLR DLL being loaded by an scripting applications",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\clr.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\mscoree.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\mscorlib.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious System.Drawing Load",
        "description": "A General detection for processes loading System.Drawing.ni.dll. This could be an indicator of potential Screen Capture.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND ImageLoaded LIKE \"%\\\\System.Drawing.ni.dll\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\WmiPrvSE.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "VBA DLL Loaded Via Microsoft Word",
        "description": "Detects DLL's Loaded Via Word Containing VBA Macros",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\outlook.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\VBE7.DLL\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\VBEUI.DLL\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\VBE7INTL.DLL\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows Management Instrumentation DLL Loaded Via Microsoft Word",
        "description": "Detects DLL's Loaded Via Word Containing VBA Macros Executing WMI Commands",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\outlook.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\wmiutils.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wbemcomn.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wbemprox.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wbemdisp.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wbemsvc.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Svchost DLL Search Order Hijack",
        "description": "IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\\Windows\\System32\\ by default. An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services \"svchost.exe -k netsvcs\" to gain code execution on a remote machine.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND ((Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\tsmsisrv.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\tsvipsrv.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wlbsctrl.dll\" ESCAPE '\\')) AND NOT ((ImageLoaded LIKE \"C:\\\\Windows\\\\WinSxS\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Time Travel Debugging Utility Usage",
        "description": "Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (ImageLoaded LIKE \"%\\\\ttdrecord.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\ttdwriter.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\ttdloader.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "UAC Bypass With Fake DLL",
        "description": "Attempts to load dismcore.dll after dropping it",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (Image LIKE \"%\\\\dism.exe\" ESCAPE '\\') AND (ImageLoaded LIKE \"%\\\\dismcore.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "UIPromptForCredentials DLLs",
        "description": "Detects potential use of UIPromptForCredentials functions by looking for some of the DLLs needed for it.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND ((ImageLoaded LIKE \"%\\\\credui.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wincredui.dll\" ESCAPE '\\') OR OriginalFileName IN (\"credui.dll\", \"wincredui.dll\")))"
        ]
    },
    {
        "title": "Unsigned Image Loaded Into LSASS Process",
        "description": "Loading unsigned image (DLL, EXE) into LSASS process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND Signed = \"false\")"
        ]
    },
    {
        "title": "WMIC Loading Scripting Libraries",
        "description": "Detects threat actors proxy executing code and bypassing application controls by leveraging wmic and the `/FORMAT` argument switch to download and execute an XSL file (i.e js, vbs, etc).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' AND (ImageLoaded LIKE \"%\\\\jscript.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\vbscript.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "WMI Modules Loaded",
        "description": "Detects non wmiprvse loading WMI modules",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (ImageLoaded LIKE \"%\\\\wmiclnt.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\WmiApRpl.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wmiprov.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wmiutils.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wbemcomn.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wbemprox.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\WMINet\\_Utils.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\wbemsvc.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\fastprox.dll\" ESCAPE '\\') AND NOT ((Image LIKE \"%\\\\WmiPrvSE.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\WmiApSrv.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\DeviceCensus.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\CompatTelRunner.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sdiagnhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\SIHClient.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\ngentask.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\windows\\\\system32\\\\taskhostw.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\windows\\\\system32\\\\MoUsoCoreWorker.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\windows\\\\system32\\\\wbem\\\\WMIADAP.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "WMI Persistence - Command Line Event Consumer",
        "description": "Detects WMI command line event consumers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"C:\\\\Windows\\\\System32\\\\wbem\\\\WmiPrvSE.exe\" ESCAPE '\\' AND ImageLoaded LIKE \"%\\\\wbemcons.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious WSMAN Provider Image Loads",
        "description": "Detects signs of potential use of the WSMAN provider from uncommon processes locally and remote execution.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND ((EventID = \"7\" AND ((ImageLoaded LIKE \"%\\\\WsmSvc.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\WsmAuto.dll\" ESCAPE '\\' OR ImageLoaded LIKE \"%\\\\Microsoft.WSMan.Management.ni.dll\" ESCAPE '\\') OR OriginalFileName IN (\"WsmSvc.dll\", \"WSMANAUTOMATION.DLL\", \"Microsoft.WSMan.Management.dll\")) AND NOT (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\')) OR (Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' AND OriginalFileName = \"WsmWmiPl.dll\")))"
        ]
    },
    {
        "title": "Image Load of VSS_PS.dll by Uncommon Executable",
        "description": "Detects the image load of vss_ps.dll by uncommon executables using OriginalFileName datapoint",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND (ImageLoaded LIKE \"%\\\\vss\\_ps.dll\" ESCAPE '\\') AND NOT ((Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\vssvc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\srtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\tiworker.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\dllhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\searchindexer.exe\" ESCAPE '\\' OR Image LIKE \"%dismhost.exe\" ESCAPE '\\' OR Image LIKE \"%taskhostw.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\clussvc.exe\" ESCAPE '\\') AND Image LIKE \"%c:\\\\windows\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "APT PRIVATELOG Image Load Pattern",
        "description": "Detects an image load pattern as seen when a tool named PRIVATELOG is used and rarely observed under legitimate circumstances",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"7\" AND Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' AND ImageLoaded LIKE \"%\\\\clfsw32.dll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Antivirus Exploitation Framework Detection",
        "description": "Detects a highly relevant Antivirus alert that reports an exploitation framework",
        "rule": [
            "SELECT * FROM eventlog WHERE (Signature LIKE \"%MeteTool%\" ESCAPE '\\' OR Signature LIKE \"%MPreter%\" ESCAPE '\\' OR Signature LIKE \"%Meterpreter%\" ESCAPE '\\' OR Signature LIKE \"%Metasploit%\" ESCAPE '\\' OR Signature LIKE \"%PowerSploit%\" ESCAPE '\\' OR Signature LIKE \"%CobaltSrike%\" ESCAPE '\\' OR Signature LIKE \"%Swrort%\" ESCAPE '\\' OR Signature LIKE \"%Rozena%\" ESCAPE '\\' OR Signature LIKE \"%Backdoor.Cobalt%\" ESCAPE '\\' OR Signature LIKE \"%CobaltStr%\" ESCAPE '\\' OR Signature LIKE \"%COBEACON%\" ESCAPE '\\' OR Signature LIKE \"%Cometer%\" ESCAPE '\\' OR Signature LIKE \"%Razy%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Antivirus Hacktool Detection",
        "description": "Detects a highly relevant Antivirus alert that reports a hack tool or other attack tool",
        "rule": [
            "SELECT * FROM eventlog WHERE ((Signature LIKE \"HTOOL%\" ESCAPE '\\' OR Signature LIKE \"HKTL%\" ESCAPE '\\' OR Signature LIKE \"SecurityTool%\" ESCAPE '\\' OR Signature LIKE \"ATK/%\" ESCAPE '\\') OR (Signature LIKE \"%Hacktool%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Antivirus Password Dumper Detection",
        "description": "Detects a highly relevant Antivirus alert that reports a password dumper",
        "rule": [
            "SELECT * FROM eventlog WHERE (Signature LIKE \"%DumpCreds%\" ESCAPE '\\' OR Signature LIKE \"%Mimikatz%\" ESCAPE '\\' OR Signature LIKE \"%PWCrack%\" ESCAPE '\\' OR Signature LIKE \"%HTool/WCE%\" ESCAPE '\\' OR Signature LIKE \"%PSWtool%\" ESCAPE '\\' OR Signature LIKE \"%PWDump%\" ESCAPE '\\' OR Signature LIKE \"%SecurityTool%\" ESCAPE '\\' OR Signature LIKE \"%PShlSpy%\" ESCAPE '\\' OR Signature LIKE \"%Rubeus%\" ESCAPE '\\' OR Signature LIKE \"%Kekeo%\" ESCAPE '\\' OR Signature LIKE \"%LsassDump%\" ESCAPE '\\' OR Signature LIKE \"%Outflank%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Antivirus PrinterNightmare CVE-2021-34527 Exploit Detection",
        "description": "Detects the suspicious file that is created from PoC code against Windows Print Spooler Remote Code Execution Vulnerability CVE-2021-34527 (PrinterNightmare), CVE-2021-1675 .",
        "rule": [
            "SELECT * FROM eventlog WHERE FileName LIKE \"%C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Antivirus Relevant File Paths Alerts",
        "description": "Detects an Antivirus alert in a highly relevant file path or with a relevant file name",
        "rule": [
            "SELECT * FROM eventlog WHERE ((FileName LIKE \"C:\\\\Windows\\\\%\" ESCAPE '\\' OR FileName LIKE \"C:\\\\Temp\\\\%\" ESCAPE '\\' OR FileName LIKE \"C:\\\\PerfLogs\\\\%\" ESCAPE '\\' OR FileName LIKE \"C:\\\\Users\\\\Public\\\\%\" ESCAPE '\\' OR FileName LIKE \"C:\\\\Users\\\\Default\\\\%\" ESCAPE '\\') OR (FileName LIKE \"%\\\\Client\\\\%\" ESCAPE '\\' OR FileName LIKE \"%\\\\tsclient\\\\%\" ESCAPE '\\' OR FileName LIKE \"%\\\\inetpub\\\\%\" ESCAPE '\\' OR FileName LIKE \"%/www/%\" ESCAPE '\\' OR FileName LIKE \"%apache%\" ESCAPE '\\' OR FileName LIKE \"%tomcat%\" ESCAPE '\\' OR FileName LIKE \"%nginx%\" ESCAPE '\\' OR FileName LIKE \"%weblogic%\" ESCAPE '\\') OR (Filename LIKE \"%.ps1\" ESCAPE '\\' OR Filename LIKE \"%.psm1\" ESCAPE '\\' OR Filename LIKE \"%.vbs\" ESCAPE '\\' OR Filename LIKE \"%.bat\" ESCAPE '\\' OR Filename LIKE \"%.cmd\" ESCAPE '\\' OR Filename LIKE \"%.sh\" ESCAPE '\\' OR Filename LIKE \"%.chm\" ESCAPE '\\' OR Filename LIKE \"%.xml\" ESCAPE '\\' OR Filename LIKE \"%.txt\" ESCAPE '\\' OR Filename LIKE \"%.jsp\" ESCAPE '\\' OR Filename LIKE \"%.jspx\" ESCAPE '\\' OR Filename LIKE \"%.asp\" ESCAPE '\\' OR Filename LIKE \"%.aspx\" ESCAPE '\\' OR Filename LIKE \"%.ashx\" ESCAPE '\\' OR Filename LIKE \"%.asax\" ESCAPE '\\' OR Filename LIKE \"%.asmx\" ESCAPE '\\' OR Filename LIKE \"%.php\" ESCAPE '\\' OR Filename LIKE \"%.cfm\" ESCAPE '\\' OR Filename LIKE \"%.py\" ESCAPE '\\' OR Filename LIKE \"%.pyc\" ESCAPE '\\' OR Filename LIKE \"%.pl\" ESCAPE '\\' OR Filename LIKE \"%.rb\" ESCAPE '\\' OR Filename LIKE \"%.cgi\" ESCAPE '\\' OR Filename LIKE \"%.war\" ESCAPE '\\' OR Filename LIKE \"%.ear\" ESCAPE '\\' OR Filename LIKE \"%.hta\" ESCAPE '\\' OR Filename LIKE \"%.lnk\" ESCAPE '\\' OR Filename LIKE \"%.scf\" ESCAPE '\\' OR Filename LIKE \"%.sct\" ESCAPE '\\' OR Filename LIKE \"%.vbe\" ESCAPE '\\' OR Filename LIKE \"%.wsf\" ESCAPE '\\' OR Filename LIKE \"%.wsh\" ESCAPE '\\' OR Filename LIKE \"%.gif\" ESCAPE '\\' OR Filename LIKE \"%.png\" ESCAPE '\\' OR Filename LIKE \"%.jpg\" ESCAPE '\\' OR Filename LIKE \"%.jpeg\" ESCAPE '\\' OR Filename LIKE \"%.svg\" ESCAPE '\\' OR Filename LIKE \"%.dat\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Antivirus Web Shell Detection",
        "description": "Detects a highly relevant Antivirus alert that reports a web shell. It's highly recommended to tune this rule to the specific strings used by your anti virus solution by downloading a big webshell repo from e.g. github and checking the matches.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((Signature LIKE \"PHP/%\" ESCAPE '\\' OR Signature LIKE \"JSP/%\" ESCAPE '\\' OR Signature LIKE \"ASP/%\" ESCAPE '\\' OR Signature LIKE \"Perl/%\" ESCAPE '\\' OR Signature LIKE \"PHP.%\" ESCAPE '\\' OR Signature LIKE \"JSP.%\" ESCAPE '\\' OR Signature LIKE \"ASP.%\" ESCAPE '\\' OR Signature LIKE \"Perl.%\" ESCAPE '\\' OR Signature LIKE \"VBS/Uxor%\" ESCAPE '\\' OR Signature LIKE \"IIS/BackDoor%\" ESCAPE '\\' OR Signature LIKE \"JAVA/Backdoor%\" ESCAPE '\\' OR Signature LIKE \"Troj/ASP%\" ESCAPE '\\' OR Signature LIKE \"Troj/PHP%\" ESCAPE '\\' OR Signature LIKE \"Troj/JSP%\" ESCAPE '\\') OR (Signature LIKE \"%Webshell%\" ESCAPE '\\' OR Signature LIKE \"%Chopper%\" ESCAPE '\\' OR Signature LIKE \"%SinoChoper%\" ESCAPE '\\' OR Signature LIKE \"%ASPXSpy%\" ESCAPE '\\' OR Signature LIKE \"%Aspdoor%\" ESCAPE '\\' OR Signature LIKE \"%filebrowser%\" ESCAPE '\\' OR Signature LIKE \"%PHP\\_%\" ESCAPE '\\' OR Signature LIKE \"%JSP\\_%\" ESCAPE '\\' OR Signature LIKE \"%ASP\\_%\" ESCAPE '\\' OR Signature LIKE \"%PHP:%\" ESCAPE '\\' OR Signature LIKE \"%JSP:%\" ESCAPE '\\' OR Signature LIKE \"%ASP:%\" ESCAPE '\\' OR Signature LIKE \"%Perl:%\" ESCAPE '\\' OR Signature LIKE \"%PHPShell%\" ESCAPE '\\' OR Signature LIKE \"%Trojan.PHP%\" ESCAPE '\\' OR Signature LIKE \"%Trojan.ASP%\" ESCAPE '\\' OR Signature LIKE \"%Trojan.JSP%\" ESCAPE '\\' OR Signature LIKE \"%Trojan.VBS%\" ESCAPE '\\' OR Signature LIKE \"%PHP_Agent%\" ESCAPE '\\' OR Signature LIKE \"%ASP_Agent%\" ESCAPE '\\' OR Signature LIKE \"%JSP_Agent%\" ESCAPE '\\' OR Signature LIKE \"%VBS_Agent%\" ESCAPE '\\' OR Signature LIKE \"%Backdoor_PHP%\" ESCAPE '\\' OR Signature LIKE \"%Backdoor_JSP%\" ESCAPE '\\' OR Signature LIKE \"%Backdoor_ASP%\" ESCAPE '\\' OR Signature LIKE \"%Backdoor_VBS%\" ESCAPE '\\' OR Signature LIKE \"%Backdoor_Java%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Octopus Scanner Malware",
        "description": "Detects Octopus Scanner Malware.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"11\" AND (TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Microsoft\\\\Cache134.dat\" ESCAPE '\\' OR TargetFilename LIKE \"%\\\\AppData\\\\Local\\\\Microsoft\\\\ExplorerSync.db\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Blue Mockingbird",
        "description": "Attempts to detect system changes made by Blue Mockingbird",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%sc config%\" ESCAPE '\\' AND CommandLine LIKE \"%wercplsupporte.dll%\" ESCAPE '\\') OR (Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' AND CommandLine LIKE \"%COR\\_PROFILER\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "DarkSide Ransomware Pattern",
        "description": "Detects DarkSide Ransomware and helpers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%=[char][byte]('0x'+%\" ESCAPE '\\' OR CommandLine LIKE \"% -work worker0 -path %\" ESCAPE '\\') OR ((ParentCommandLine LIKE \"%DllHost.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}%\" ESCAPE '\\') AND (Image LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "LockerGoga Ransomware",
        "description": "Detects LockerGoga Ransomware command line.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%-i SM-tgytutrc -s%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Ryuk Ransomware",
        "description": "Detects Ryuk Ransomware command lines",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"%stop%\" ESCAPE '\\' AND (CommandLine LIKE \"%samss%\" ESCAPE '\\' OR CommandLine LIKE \"%audioendpointbuilder%\" ESCAPE '\\' OR CommandLine LIKE \"%unistoresvc\\______%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Registry Entries For Azorult Malware",
        "description": "Detects the presence of a registry key created during Azorult execution",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventID IN (\"12\", \"13\") AND TargetObject LIKE \"%SYSTEM\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\services\\\\localNETService\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Blue Mockingbird",
        "description": "Attempts to detect system changes made by Blue Mockingbird",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\CurrentControlSet\\\\Services\\\\wercplsupport\\\\Parameters\\\\ServiceDll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "FlowCloud Malware",
        "description": "Detects FlowCloud malware from threat group TA410.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND ((TargetObject LIKE \"HKLM\\\\HARDWARE\\\\{804423C2-F490-4ac3-BFA5-13DEDE63A71A}\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\HARDWARE\\\\{A5124AF5-DF23-49bf-B0ED-A18ED3DEA027}\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\HARDWARE\\\\{2DB80286-1784-48b5-A751-B6ED1F490303}\" ESCAPE '\\') OR (TargetObject LIKE \"HKLM\\\\SYSTEM\\\\Setup\\\\PrintResponsor\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "NetWire RAT Registry Key",
        "description": "Attempts to detect registry events for common NetWire key HKCU\\Software\\NetWire",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\software\\\\NetWire%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Ursnif",
        "description": "Detects new registry key created by Ursnif malware.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Software\\\\AppDataLow\\\\Software\\\\Microsoft\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Silenttrinity Stager Msbuild Activity",
        "description": "Detects a possible remote connections to Silenttrinity c2",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND ParentImage LIKE \"%\\\\msbuild.exe\" ESCAPE '\\' AND DestinationPort IN (\"80\", \"443\") AND Initiated = \"true\")"
        ]
    },
    {
        "title": "Dllhost Internet Connection",
        "description": "Detects Dllhost that communicates with public IP addresses",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND (Image LIKE \"%\\\\dllhost.exe\" ESCAPE '\\' AND Initiated = \"true\") AND NOT ((DestinationIp LIKE \"10.%\" ESCAPE '\\' OR DestinationIp LIKE \"192.168.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.16.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.17.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.18.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.19.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.20.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.21.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.22.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.23.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.24.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.25.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.26.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.27.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.28.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.29.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.30.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.31.%\" ESCAPE '\\' OR DestinationIp LIKE \"127.%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Typical Malware Back Connect Ports",
        "description": "Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND (Initiated = \"true\" AND DestinationPort IN (\"4443\", \"2448\", \"8143\", \"1777\", \"1443\", \"243\", \"65535\", \"13506\", \"3360\", \"200\", \"198\", \"49180\", \"13507\", \"6625\", \"4444\", \"4438\", \"1904\", \"13505\", \"13504\", \"12102\", \"9631\", \"5445\", \"2443\", \"777\", \"13394\", \"13145\", \"12103\", \"5552\", \"3939\", \"3675\", \"666\", \"473\", \"5649\", \"4455\", \"4433\", \"1817\", \"100\", \"65520\", \"1960\", \"1515\", \"743\", \"700\", \"14154\", \"14103\", \"14102\", \"12322\", \"10101\", \"7210\", \"4040\", \"9943\")) AND NOT ((EventID = \"3\" AND (Image LIKE \"%\\\\Program Files%\" ESCAPE '\\' OR ((DestinationIp LIKE \"10.%\" ESCAPE '\\' OR DestinationIp LIKE \"192.168.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.16.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.17.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.18.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.19.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.20.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.21.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.22.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.23.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.24.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.25.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.26.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.27.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.28.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.29.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.30.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.31.%\" ESCAPE '\\' OR DestinationIp LIKE \"127.%\" ESCAPE '\\') AND DestinationIsIpv6 = \"false\")))))"
        ]
    },
    {
        "title": "Notepad Making Network Connection",
        "description": "Detects suspicious network connection by Notepad",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND Image LIKE \"%\\\\notepad.exe\" ESCAPE '\\' AND NOT (DestinationPort = \"9100\"))"
        ]
    },
    {
        "title": "PowerShell Network Connections",
        "description": "Detects a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company's ip range')",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND Initiated = \"true\" AND DestinationIsIpv6 = \"false\") AND NOT ((DestinationIp LIKE \"10.%\" ESCAPE '\\' OR DestinationIp LIKE \"192.168.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.16.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.17.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.18.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.19.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.20.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.21.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.22.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.23.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.24.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.25.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.26.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.27.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.28.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.29.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.30.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.31.%\" ESCAPE '\\' OR DestinationIp LIKE \"127.0.0.1%\" ESCAPE '\\') AND DestinationIsIpv6 = \"false\" AND User LIKE \"NT AUTHORITY\\\\SYSTEM\" ESCAPE '\\' AND User LIKE \"%AUT%\" ESCAPE '\\' AND User LIKE \"% NT%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "RDP Over Reverse SSH Tunnel",
        "description": "Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND (Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' AND Initiated = \"true\" AND SourcePort = \"3389\") AND ((DestinationIp LIKE \"127.%\" ESCAPE '\\') OR (DestinationIp LIKE \"::1\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Regsvr32 Network Activity",
        "description": "Detects network connections and DNS queries initiated by Regsvr32.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Remote PowerShell Session",
        "description": "Detects remote PowerShell connections by monitoring network outbound connections to ports 5985 or 5986 from a non-network service account.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND DestinationPort IN (\"5985\", \"5986\") AND NOT (User LIKE \"NT AUTHORITY\\\\NETWORK SERVICE\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Rundll32 Internet Connection",
        "description": "Detects a rundll32 that communicates with public IP addresses",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND (Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND Initiated = \"true\") AND NOT ((DestinationIp LIKE \"10.%\" ESCAPE '\\' OR DestinationIp LIKE \"192.168.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.16.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.17.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.18.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.19.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.20.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.21.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.22.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.23.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.24.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.25.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.26.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.27.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.28.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.29.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.30.%\" ESCAPE '\\' OR DestinationIp LIKE \"172.31.%\" ESCAPE '\\' OR DestinationIp LIKE \"127.%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Outbound Kerberos Connection",
        "description": "Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND (DestinationPort = \"88\" AND Initiated = \"true\") AND NOT ((Image LIKE \"%\\\\lsass.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\opera.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\chrome.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\firefox.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Program Location with Network Connections",
        "description": "Detects programs with network connections running in suspicious files system locations",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND ((Image LIKE \"%\\\\Users\\\\All Users\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Default\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Public\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Contacts\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Searches\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\config\\\\systemprofile\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\Fonts\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\IME\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\addins\\\\%\" ESCAPE '\\') OR (Image LIKE \"%\\\\$Recycle.bin\" ESCAPE '\\') OR (Image LIKE \"C:\\\\Perflogs\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Outbound RDP Connections",
        "description": "Detects Non-Standard Tools Connecting to TCP port 3389 indicating possible lateral movement",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND (DestinationPort = \"3389\" AND Initiated = \"true\") AND NOT ((Image LIKE \"%\\\\mstsc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\RTSApp.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\RTS2App.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\RDCMan.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\ws\\_TunnelService.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\RSSensor.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\RemoteDesktopManagerFree.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\RemoteDesktopManager.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\RemoteDesktopManager64.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mRemoteNG.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mRemote.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\Terminals.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\spiceworks-finder.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\FSDiscovery.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\FSAssessment.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\MobaRTE.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\chrome.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\thor.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\thor64.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Microsoft Binary Github Communication",
        "description": "Detects an executable in the Windows folder accessing github.com",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND Initiated = \"true\" AND (DestinationHostname LIKE \"%.github.com\" ESCAPE '\\' OR DestinationHostname LIKE \"%.githubusercontent.com\" ESCAPE '\\') AND Image LIKE \"C:\\\\Windows\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Microsoft Binary Suspicious Communication Endpoint",
        "description": "Detects an executable in the Windows folder accessing suspicious domains",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND Initiated = \"true\" AND (DestinationHostname LIKE \"%dl.dropboxusercontent.com\" ESCAPE '\\' OR DestinationHostname LIKE \"%.pastebin.com\" ESCAPE '\\' OR DestinationHostname LIKE \"%.githubusercontent.com\" ESCAPE '\\') AND Image LIKE \"C:\\\\Windows\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Wuauclt Network Connection",
        "description": "Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code and making a network connections. One could easily make the DLL spawn a new process and inject to it to proxy the network connection and bypass this rule.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"3\" AND Image LIKE \"%wuauclt%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Defender AMSI Trigger Detected",
        "description": "Detects triggering of AMSI by Windows Defender.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1116\" AND Source_Name = \"AMSI\")"
        ]
    },
    {
        "title": "Windows Defender Exclusion Set",
        "description": "Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"4657\", \"4656\", \"4660\", \"4663\") AND ObjectName LIKE \"%\\\\Microsoft\\\\Windows Defender\\\\Exclusions\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Defender Threat Detection Disabled",
        "description": "Detects disabling Windows Defender threat protection",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID IN (\"5001\", \"5010\", \"5012\", \"5101\")"
        ]
    },
    {
        "title": "Windows Defender Exclusions Added",
        "description": "Detects the Setting of Windows Defender Exclusions",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"5007\" AND New_Value LIKE \"%\\\\Microsoft\\\\Windows Defender\\\\Exclusions%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Defender Malware Detection History Deletion",
        "description": "Windows Defender logs when the history of detected infections is deleted. Log file will contain the message \"Windows Defender Antivirus has removed history of malware and other potentially unwanted software\".",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1013\" AND EventType = \"4\")"
        ]
    },
    {
        "title": "PSExec and WMI Process Creations Block",
        "description": "Detects blocking of process creations originating from PSExec and WMI commands",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1121\" AND (ProcessName LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\' OR ProcessName LIKE \"%\\\\psexesvc.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Microsoft Defender Tamper Protection Trigger",
        "description": "Detects block of attempt to disable real time protection of Microsoft Defender by tamper protection",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID LIKE \"5013\" ESCAPE '\\') AND (Value LIKE \"%\\\\Windows Defender\\\\DisableAntiSpyware = 0x1()\" ESCAPE '\\' OR Value LIKE \"%\\\\Real-Time Protection\\\\DisableRealtimeMonitoring = (Current)\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows Defender Threat Detected",
        "description": "Detects all actions taken by Windows Defender malware detection engines",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID IN (\"1006\", \"1116\", \"1015\", \"1117\")"
        ]
    },
    {
        "title": "Remove Exported Mailbox from Exchange Webserver",
        "description": "Detects removal of an exported Exchange mailbox which could be to cover tracks from ProxyShell exploit",
        "rule": [
            "SELECT * FROM eventlog WHERE (eventlog MATCH ('\"Remove-MailboxExportRequest\" AND \" -Identity \" AND \" -Confirm \"False\"\"'))"
        ]
    },
    {
        "title": "Failed MSExchange Transport Agent Installation",
        "description": "Detects a failed installation of a Exchange Transport Agent",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"6\" AND eventlog MATCH ('\"Install-TransportAgent\"'))"
        ]
    },
    {
        "title": "Lateral Movement Indicator ConDrv",
        "description": "This event was observed on the target host during lateral movement. The process name within the event contains the process spawned post compromise. Account Name within the event contains the compromised user account name. This event should to be correlated with 4624 and 4688 for further intrusion context.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4674\" AND ObjectServer = \"Security\" AND ObjectType = \"File\" AND ObjectName LIKE \"\\\\Device\\\\ConDrv\" ESCAPE '\\')"
        ]
    },
    {
        "title": "LDAP Reconnaissance / Active Directory Enumeration",
        "description": "Detects possible Active Directory enumeration via LDAP",
        "rule": [
            "SELECT * FROM eventlog WHERE (((EventID = \"30\" AND (SearchFilter LIKE \"%(groupType:1.2.840.113556.1.4.803:=2147483648)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(groupType:1.2.840.113556.1.4.803:=2147483656)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(groupType:1.2.840.113556.1.4.803:=2147483652)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(groupType:1.2.840.113556.1.4.803:=2147483650)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(sAMAccountType=805306369)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(sAMAccountType=805306368)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(sAMAccountType=536870913)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(sAMAccountType=536870912)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(sAMAccountType=268435457)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(sAMAccountType=268435456)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=groupPolicyContainer)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=organizationalUnit)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=Computer)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=nTDSDSA)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=server)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=domain)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=person)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=group)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectCategory=user)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectClass=trustedDomain)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectClass=computer)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectClass=server)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectClass=group)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectClass=user)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(primaryGroupID=521)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(primaryGroupID=516)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(primaryGroupID=515)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(primaryGroupID=512)%\" ESCAPE '\\' OR SearchFilter LIKE \"%Domain Admins%\" ESCAPE '\\')) AND NOT (EventID = \"30\" AND (SearchFilter LIKE \"%(domainSid=%)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(objectSid=%)%\" ESCAPE '\\'))) OR (EventID = \"30\" AND (SearchFilter LIKE \"%(userAccountControl:1.2.840.113556.1.4.803:=4194304)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(userAccountControl:1.2.840.113556.1.4.803:=2097152)%\" ESCAPE '\\' OR SearchFilter LIKE \"%!(userAccountControl:1.2.840.113556.1.4.803:=1048574)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(userAccountControl:1.2.840.113556.1.4.803:=524288)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(userAccountControl:1.2.840.113556.1.4.803:=65536)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(userAccountControl:1.2.840.113556.1.4.803:=8192)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(userAccountControl:1.2.840.113556.1.4.803:=544)%\" ESCAPE '\\' OR SearchFilter LIKE \"%!(UserAccountControl:1.2.840.113556.1.4.803:=2)%\" ESCAPE '\\' OR SearchFilter LIKE \"%msDS-AllowedToActOnBehalfOfOtherIdentity%\" ESCAPE '\\' OR SearchFilter LIKE \"%msDS-AllowedToDelegateTo%\" ESCAPE '\\' OR SearchFilter LIKE \"%(accountExpires=9223372036854775807)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(accountExpires=0)%\" ESCAPE '\\' OR SearchFilter LIKE \"%(adminCount=1)%\" ESCAPE '\\' OR SearchFilter LIKE \"%ms-MCS-AdmPwd%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Windows Pcap Drivers",
        "description": "Detects Windows Pcap driver installation based on a list of associated .sys files.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4697\" AND (ServiceFileName LIKE \"%pcap%\" ESCAPE '\\' OR ServiceFileName LIKE \"%npcap%\" ESCAPE '\\' OR ServiceFileName LIKE \"%npf%\" ESCAPE '\\' OR ServiceFileName LIKE \"%nm3%\" ESCAPE '\\' OR ServiceFileName LIKE \"%ndiscap%\" ESCAPE '\\' OR ServiceFileName LIKE \"%nmnt%\" ESCAPE '\\' OR ServiceFileName LIKE \"%windivert%\" ESCAPE '\\' OR ServiceFileName LIKE \"%USBPcap%\" ESCAPE '\\' OR ServiceFileName LIKE \"%pktmon%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Zerologon Exploitation Using Well-known Tools",
        "description": "This rule is designed to detect attempts to exploit Zerologon (CVE-2020-1472) vulnerability using mimikatz zerologon module or other exploits from machine with \"kali\" hostname.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"5805\", \"5723\") AND (eventlog MATCH ('\"kali\" OR \"mimikatz\"')))"
        ]
    },
    {
        "title": "Rare Scheduled Task Creations",
        "description": "This rule detects rare scheduled task creations. Typically software gets installed on multiple systems and not only on a few. The aggregation and count function selects tasks with rare names.",
        "rule": [
            "SELECT * FROM (SELECT *,count(*) AS agg FROM eventlog WHERE EventID = \"106\" GROUP BY TaskName) WHERE agg < 5"
        ]
    },
    {
        "title": "WMI Persistence",
        "description": "Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"4662\" AND ObjectType = \"WMI Namespace\" AND ObjectName LIKE \"%subscription%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PsExec Tool Execution",
        "description": "Detects PsExec service installation and execution events (service and Sysmon)",
        "rule": [
            "SELECT * FROM eventlog WHERE (ServiceName = \"PSEXESVC\" AND ((EventID = \"7045\" AND ServiceFileName LIKE \"%\\\\PSEXESVC.exe\" ESCAPE '\\') OR EventID = \"7036\"))"
        ]
    },
    {
        "title": "WMI Persistence",
        "description": "Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"5861\" AND (eventlog MATCH ('\"ActiveScriptEventConsumer\" OR \"CommandLineEventConsumer\" OR \"CommandLineTemplate\"'))) OR EventID = \"5859\")"
        ]
    },
    {
        "title": "PsExec Tool Execution",
        "description": "Detects PsExec service installation and execution events (service and Sysmon)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND PipeName LIKE \"\\\\PSEXESVC\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Alternate PowerShell Hosts Pipe",
        "description": "Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND PipeName LIKE \"\\\\PSHost%\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell\\_ise.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Turla Group Named Pipes",
        "description": "Detects a named pipe used by Turla group samples",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND (PipeName LIKE \"\\\\atctl\" ESCAPE '\\' OR PipeName LIKE \"\\\\userpipe\" ESCAPE '\\' OR PipeName LIKE \"\\\\iehelper\" ESCAPE '\\' OR PipeName LIKE \"\\\\sdlrpc\" ESCAPE '\\' OR PipeName LIKE \"\\\\comnap\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Cred Dump-Tools Named Pipes",
        "description": "Detects well-known credential dumping tools execution via specific named pipes",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND (PipeName LIKE \"%\\\\lsadump%\" ESCAPE '\\' OR PipeName LIKE \"%\\\\cachedump%\" ESCAPE '\\' OR PipeName LIKE \"%\\\\wceservicepipe%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "EfsPotato Named Pipe",
        "description": "Detects the pattern of a pipe name as used by the tool EfsPotato",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND (PipeName LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\' OR PipeName LIKE \"%\\\\pipe\\\\srvsvc%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CobaltStrike Named Pipe",
        "description": "Detects the creation of a named pipe as used by CobaltStrike",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND ((PipeName LIKE \"%\\\\MSSE-%\" ESCAPE '\\' AND PipeName LIKE \"%-server%\" ESCAPE '\\') OR PipeName LIKE \"\\\\postex\\_%\" ESCAPE '\\' OR PipeName LIKE \"\\\\postex\\_ssh\\_%\" ESCAPE '\\' OR PipeName LIKE \"\\\\status\\_%\" ESCAPE '\\' OR PipeName LIKE \"\\\\msagent\\_%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malicious Named Pipe",
        "description": "Detects the creation of a named pipe used by known APT malware",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND (PipeName LIKE \"\\\\isapi\\_http\" ESCAPE '\\' OR PipeName LIKE \"\\\\isapi\\_dg\" ESCAPE '\\' OR PipeName LIKE \"\\\\isapi\\_dg2\" ESCAPE '\\' OR PipeName LIKE \"\\\\sdlrpc\" ESCAPE '\\' OR PipeName LIKE \"\\\\ahexec\" ESCAPE '\\' OR PipeName LIKE \"\\\\winsession\" ESCAPE '\\' OR PipeName LIKE \"\\\\lsassw\" ESCAPE '\\' OR PipeName LIKE \"\\\\46a676ab7f179e511e30dd2dc41bd388\" ESCAPE '\\' OR PipeName LIKE \"\\\\9f81f59bc58452127884ce513865ed20\" ESCAPE '\\' OR PipeName LIKE \"\\\\e710f28d59aa529d6792ca6ff0ca1b34\" ESCAPE '\\' OR PipeName LIKE \"\\\\rpchlp\\_3\" ESCAPE '\\' OR PipeName LIKE \"\\\\NamePipe\\_MoreWindows\" ESCAPE '\\' OR PipeName LIKE \"\\\\pcheap\\_reuse\" ESCAPE '\\' OR PipeName LIKE \"\\\\gruntsvc\" ESCAPE '\\' OR PipeName LIKE \"\\\\583da945-62af-10e8-4902-a8f205c72b2e\" ESCAPE '\\' OR PipeName LIKE \"\\\\bizkaz\" ESCAPE '\\' OR PipeName LIKE \"\\\\svcctl\" ESCAPE '\\' OR PipeName LIKE \"\\\\Posh%\" ESCAPE '\\' OR PipeName LIKE \"\\\\jaccdpqnvbrrxlaf\" ESCAPE '\\' OR PipeName LIKE \"\\\\csexecsvc\" ESCAPE '\\' OR PipeName LIKE \"\\\\6e7645c4-32c5-4fe3-aabf-e94c2f4370e7\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "T1086 PowerShell Execution",
        "description": "Detects execution of PowerShell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND PipeName LIKE \"\\\\PSHost%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PsExec Pipes Artifacts",
        "description": "Detecting use PsExec via Pipe Creation/Access to pipes",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND (PipeName LIKE \"psexec%\" ESCAPE '\\' OR PipeName LIKE \"paexec%\" ESCAPE '\\' OR PipeName LIKE \"remcom%\" ESCAPE '\\' OR PipeName LIKE \"csexec%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "ADFS Database Named Pipe Connection",
        "description": "Detects suspicious local connections via a named pipe to the AD FS configuration database (Windows Internal Database). Used to access information such as the AD FS configuration settings which contains sensitive information used to sign SAML tokens.",
        "rule": [
            "SELECT * FROM eventlog WHERE (PipeName LIKE \"\\\\MICROSOFT##WID\\\\tsql\\\\query\" ESCAPE '\\' AND NOT ((Image LIKE \"%Microsoft.IdentityServer.ServiceHost.exe\" ESCAPE '\\' OR Image LIKE \"%Microsoft.Identity.Health.Adfs.PshSurrogate.exe\" ESCAPE '\\' OR Image LIKE \"%AzureADConnect.exe\" ESCAPE '\\' OR Image LIKE \"%Microsoft.Tri.Sensor.exe\" ESCAPE '\\' OR Image LIKE \"%wsmprovhost.exe\" ESCAPE '\\' OR Image LIKE \"%mmc.exe\" ESCAPE '\\' OR Image LIKE \"%sqlservr.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "CobaltStrike Named Pipe Patterns",
        "description": "Detects the creation of a named pipe with a pattern found in CobaltStrike malleable C2 profiles",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND (((PipeName LIKE \"\\\\mojo.5688.8052.183894939787088877%\" ESCAPE '\\' OR PipeName LIKE \"\\\\mojo.5688.8052.35780273329370473%\" ESCAPE '\\' OR PipeName LIKE \"\\\\mypipe-f%\" ESCAPE '\\' OR PipeName LIKE \"\\\\mypipe-h%\" ESCAPE '\\' OR PipeName LIKE \"\\\\ntsvcs%\" ESCAPE '\\' OR PipeName LIKE \"\\\\scerpc%\" ESCAPE '\\' OR PipeName LIKE \"\\\\win\\_svc%\" ESCAPE '\\' OR PipeName LIKE \"\\\\spoolss%\" ESCAPE '\\' OR PipeName LIKE \"\\\\msrpc\\_%\" ESCAPE '\\' OR PipeName LIKE \"\\\\win\\\\msrpc\\_%\" ESCAPE '\\' OR PipeName LIKE \"\\\\wkssvc%\" ESCAPE '\\' OR PipeName LIKE \"\\\\f53f%\" ESCAPE '\\' OR PipeName LIKE \"\\\\windows.update.manager%\" ESCAPE '\\' OR PipeName LIKE \"\\\\SearchTextHarvester%\" ESCAPE '\\' OR PipeName LIKE \"\\\\DserNamePipe%\" ESCAPE '\\' OR PipeName LIKE \"\\\\PGMessagePipe%\" ESCAPE '\\' OR PipeName LIKE \"\\\\MsFteWds%\" ESCAPE '\\' OR PipeName LIKE \"\\\\f4c3%\" ESCAPE '\\' OR PipeName LIKE \"\\\\fullduplex\\_%\" ESCAPE '\\' OR PipeName LIKE \"\\\\rpc\\_%\" ESCAPE '\\') OR (PipeName LIKE \"\\\\demoagent\\_11\" ESCAPE '\\' OR PipeName LIKE \"\\\\demoagent\\_22\" ESCAPE '\\')) OR (PipeName LIKE \"\\\\Winsock2\\\\CatalogChangeListener-%\" ESCAPE '\\' AND PipeName LIKE \"%-0,\" ESCAPE '\\')) AND NOT ((PipeName LIKE \"\\\\wkssvc\" ESCAPE '\\' OR PipeName LIKE \"\\\\spoolss\" ESCAPE '\\' OR PipeName LIKE \"\\\\scerpc\" ESCAPE '\\' OR PipeName LIKE \"\\\\ntsvcs\" ESCAPE '\\' OR PipeName LIKE \"\\\\SearchTextHarvester\" ESCAPE '\\' OR PipeName LIKE \"\\\\PGMessagePipe\" ESCAPE '\\' OR PipeName LIKE \"\\\\MsFteWds\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "WMI Event Consumer Created Named Pipe",
        "description": "Detects the WMI Event Consumer service scrcons.exe creating a named pipe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"17\", \"18\") AND Image LIKE \"%\\\\scrcons.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Alternate PowerShell Hosts",
        "description": "Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostApplication LIKE \"%\" ESCAPE '\\' AND NOT (HostApplication LIKE \"C:\\\\WINDOWS\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Netcat The Powershell Version",
        "description": "Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostApplication LIKE \"%powercat %\" ESCAPE '\\' OR HostApplication LIKE \"%powercat.ps1%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Remote PowerShell Session",
        "description": "Detects remote PowerShell sessions",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostName = \"ServerRemoteHost\" AND HostApplication LIKE \"%wsmprovhost.exe%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious PowerShell Download",
        "description": "Detects suspicious PowerShell download command",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostApplication LIKE \"%System.Net.WebClient%\" ESCAPE '\\' AND (HostApplication LIKE \"%.DownloadFile(%\" ESCAPE '\\' OR HostApplication LIKE \"%.DownloadString(%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Abusable Invoke-ATHRemoteFXvGPUDisablementCommand",
        "description": "RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostApplication LIKE \"%Invoke-ATHRemoteFXvGPUDisablementCommand %\" ESCAPE '\\' AND (HostApplication LIKE \"%-ModuleName %\" ESCAPE '\\' OR HostApplication LIKE \"%-ModulePath %\" ESCAPE '\\' OR HostApplication LIKE \"%-ScriptBlock %\" ESCAPE '\\' OR HostApplication LIKE \"%-RemoteFXvGPUDisablementFilePath%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Zip A Folder With PowerShell For Staging In Temp",
        "description": "Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostApplication LIKE \"%Compress-Archive %\" ESCAPE '\\' AND HostApplication LIKE \"% -Path %\" ESCAPE '\\' AND HostApplication LIKE \"% -DestinationPath %\" ESCAPE '\\' AND HostApplication LIKE \"%$env:TEMP\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Delete Volume Shadow Copies Via WMI With PowerShell",
        "description": "Shadow Copies deletion using operating systems utilities via PowerShell",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostApplication LIKE \"%Get-WmiObject%\" ESCAPE '\\' AND HostApplication LIKE \"% Win32\\_Shadowcopy%\" ESCAPE '\\' AND (HostApplication LIKE \"%Delete()%\" ESCAPE '\\' OR HostApplication LIKE \"%Remove-WmiObject%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Downgrade Attack",
        "description": "Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0",
        "rule": [
            "SELECT * FROM eventlog WHERE (EngineVersion LIKE \"2.%\" ESCAPE '\\' AND NOT (HostVersion LIKE \"2.%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Called from an Executable Version Mismatch",
        "description": "Detects PowerShell called from an executable by the version mismatch method",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EngineVersion LIKE \"2.%\" ESCAPE '\\' OR EngineVersion LIKE \"4.%\" ESCAPE '\\' OR EngineVersion LIKE \"5.%\" ESCAPE '\\') AND HostVersion LIKE \"3.%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Renamed Powershell Under Powershell Channel",
        "description": "Detects renamed powershell",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostName = \"ConsoleHost\" AND NOT ((HostApplication LIKE \"powershell.exe%\" ESCAPE '\\' OR HostApplication LIKE \"C:\\\\WINDOWS\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Tamper Windows Defender",
        "description": "Attempting to disable scheduled scanning and other parts of windows defender atp.",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostApplication LIKE \"%Set-MpPreference%\" ESCAPE '\\' AND (HostApplication LIKE \"%-DisableRealtimeMonitoring 1%\" ESCAPE '\\' OR HostApplication LIKE \"%-DisableBehaviorMonitoring 1%\" ESCAPE '\\' OR HostApplication LIKE \"%-DisableScriptScanning 1%\" ESCAPE '\\' OR HostApplication LIKE \"%-DisableBlockAtFirstSeen 1%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Non PowerShell WSMAN COM Provider",
        "description": "Detects suspicious use of the WSMAN provider without PowerShell.exe as the host application.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ProviderName = \"WSMan\" AND NOT (HostApplication LIKE \"%powershell%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious XOR Encoded PowerShell Command Line",
        "description": "Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands.",
        "rule": [
            "SELECT * FROM eventlog WHERE (HostName = \"ConsoleHost\" AND (HostApplication LIKE \"%bxor%\" ESCAPE '\\' OR HostApplication LIKE \"%join%\" ESCAPE '\\' OR HostApplication LIKE \"%char%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Alternate PowerShell Hosts",
        "description": "Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (ContextInfo LIKE \"%\" ESCAPE '\\' AND NOT (ContextInfo LIKE \"%powershell.exe%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Bad Opsec Powershell Code Artifacts",
        "description": "Focuses on trivial artifacts observed in variants of prevalent offensive ps1 payloads, including Cobalt Strike Beacon, PoshC2, Powerview, Letmein, Empire, Powersploit, and other attack payloads that often undergo minimal changes by attackers due to bad opsec.",
        "rule": [
            "SELECT * FROM eventlog WHERE (Payload LIKE \"%$DoIt%\" ESCAPE '\\' OR Payload LIKE \"%harmj0y%\" ESCAPE '\\' OR Payload LIKE \"%mattifestation%\" ESCAPE '\\' OR Payload LIKE \"%\\_RastaMouse%\" ESCAPE '\\' OR Payload LIKE \"%tifkin\\_%\" ESCAPE '\\' OR Payload LIKE \"%0xdeadbeef%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Clear PowerShell History",
        "description": "Detects keywords that could indicate clearing PowerShell history",
        "rule": [
            "SELECT * FROM eventlog WHERE (((Payload LIKE \"%del%\" ESCAPE '\\' OR Payload LIKE \"%Remove-Item%\" ESCAPE '\\' OR Payload LIKE \"%rm%\" ESCAPE '\\') AND Payload LIKE \"%(Get-PSReadlineOption).HistorySavePath%\" ESCAPE '\\') OR (Payload LIKE \"%Set-PSReadlineOption%\" ESCAPE '\\' AND Payload LIKE \"%HistorySaveStyle%\" ESCAPE '\\' AND Payload LIKE \"%SaveNothing%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Decompress Commands",
        "description": "A General detection for specific decompress commands in PowerShell logs. This could be an adversary decompressing files.",
        "rule": [
            "SELECT * FROM eventlog WHERE Payload LIKE \"%Expand-Archive%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "PowerShell Get Clipboard",
        "description": "A General detection for the Get-Clipboard commands in PowerShell logs. This could be an adversary capturing clipboard contents.",
        "rule": [
            "SELECT * FROM eventlog WHERE Payload LIKE \"%Get-Clipboard%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Netcat The Powershell Version",
        "description": "Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network",
        "rule": [
            "SELECT * FROM eventlog WHERE (ContextInfo LIKE \"%powercat %\" ESCAPE '\\' OR ContextInfo LIKE \"%powercat.ps1%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Remote PowerShell Session",
        "description": "Detects remote PowerShell sessions",
        "rule": [
            "SELECT * FROM eventlog WHERE (ContextInfo LIKE \"% = ServerRemoteHost %\" ESCAPE '\\' AND ContextInfo LIKE \"%wsmprovhost.exe%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious PowerShell Download",
        "description": "Detects suspicious PowerShell download command",
        "rule": [
            "SELECT * FROM eventlog WHERE (ContextInfo LIKE \"%System.Net.WebClient%\" ESCAPE '\\' AND (ContextInfo LIKE \"%.DownloadFile(%\" ESCAPE '\\' OR ContextInfo LIKE \"%.DownloadString(%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious PowerShell Invocations - Generic",
        "description": "Detects suspicious PowerShell invocation command parameters",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ContextInfo LIKE \"% -enc %\" ESCAPE '\\' OR ContextInfo LIKE \"% -EncodedCommand %\" ESCAPE '\\') AND (ContextInfo LIKE \"% -w hidden %\" ESCAPE '\\' OR ContextInfo LIKE \"% -window hidden %\" ESCAPE '\\' OR ContextInfo LIKE \"% -windowstyle hidden %\" ESCAPE '\\') AND (ContextInfo LIKE \"% -noni %\" ESCAPE '\\' OR ContextInfo LIKE \"% -noninteractive %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious PowerShell Invocations - Specific",
        "description": "Detects suspicious PowerShell invocation command parameters",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ContextInfo LIKE \"%-nop%\" ESCAPE '\\' AND ContextInfo LIKE \"% -w %\" ESCAPE '\\' AND ContextInfo LIKE \"%hidden%\" ESCAPE '\\' AND ContextInfo LIKE \"% -c %\" ESCAPE '\\' AND ContextInfo LIKE \"%[Convert]::FromBase64String%\" ESCAPE '\\') OR (ContextInfo LIKE \"% -w %\" ESCAPE '\\' AND ContextInfo LIKE \"%hidden%\" ESCAPE '\\' AND ContextInfo LIKE \"%-noni%\" ESCAPE '\\' AND ContextInfo LIKE \"%-nop%\" ESCAPE '\\' AND ContextInfo LIKE \"% -c %\" ESCAPE '\\' AND ContextInfo LIKE \"%iex%\" ESCAPE '\\' AND ContextInfo LIKE \"%New-Object%\" ESCAPE '\\') OR (ContextInfo LIKE \"% -w %\" ESCAPE '\\' AND ContextInfo LIKE \"%hidden%\" ESCAPE '\\' AND ContextInfo LIKE \"%-ep%\" ESCAPE '\\' AND ContextInfo LIKE \"%bypass%\" ESCAPE '\\' AND ContextInfo LIKE \"%-Enc%\" ESCAPE '\\') OR (ContextInfo LIKE \"%powershell%\" ESCAPE '\\' AND ContextInfo LIKE \"%reg%\" ESCAPE '\\' AND ContextInfo LIKE \"%add%\" ESCAPE '\\' AND ContextInfo LIKE \"%HKCU\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\run%\" ESCAPE '\\') OR (ContextInfo LIKE \"%bypass%\" ESCAPE '\\' AND ContextInfo LIKE \"%-noprofile%\" ESCAPE '\\' AND ContextInfo LIKE \"%-windowstyle%\" ESCAPE '\\' AND ContextInfo LIKE \"%hidden%\" ESCAPE '\\' AND ContextInfo LIKE \"%new-object%\" ESCAPE '\\' AND ContextInfo LIKE \"%system.net.webclient%\" ESCAPE '\\' AND ContextInfo LIKE \"%.download%\" ESCAPE '\\') OR (ContextInfo LIKE \"%iex%\" ESCAPE '\\' AND ContextInfo LIKE \"%New-Object%\" ESCAPE '\\' AND ContextInfo LIKE \"%Net.WebClient%\" ESCAPE '\\' AND ContextInfo LIKE \"%.Download%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Abusable Invoke-ATHRemoteFXvGPUDisablementCommand",
        "description": "RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).",
        "rule": [
            "SELECT * FROM eventlog WHERE (ContextInfo LIKE \"%Invoke-ATHRemoteFXvGPUDisablementCommand %\" ESCAPE '\\' AND (ContextInfo LIKE \"%-ModuleName %\" ESCAPE '\\' OR ContextInfo LIKE \"%-ModulePath %\" ESCAPE '\\' OR ContextInfo LIKE \"%-ScriptBlock %\" ESCAPE '\\' OR ContextInfo LIKE \"%-RemoteFXvGPUDisablementFilePath%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Zip A Folder With PowerShell For Staging In Temp",
        "description": "Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration",
        "rule": [
            "SELECT * FROM eventlog WHERE (ContextInfo LIKE \"%Compress-Archive %\" ESCAPE '\\' AND ContextInfo LIKE \"% -Path %\" ESCAPE '\\' AND ContextInfo LIKE \"% -DestinationPath %\" ESCAPE '\\' AND ContextInfo LIKE \"%$env:TEMP\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SyncAppvPublishingServer Execution to Bypass Powershell Restriction",
        "description": "Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.",
        "rule": [
            "SELECT * FROM eventlog WHERE ContextInfo LIKE \"%SyncAppvPublishingServer.exe%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Accessing WinAPI in PowerShell",
        "description": "Detecting use WinAPI Functions in PowerShell",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%WaitForSingleObject%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%QueueUserApc%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%RtlCreateUserThread%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%OpenProcess%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%VirtualAlloc%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%VirtualFree%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%WriteProcessMemory%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%CreateUserThread%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%CloseHandle%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%GetDelegateForFunctionPointer%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%CreateThread%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%memcpy%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%LoadLibrary%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%GetModuleHandle%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%GetProcAddress%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%VirtualProtect%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%FreeLibrary%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ReadProcessMemory%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%CreateRemoteThread%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%AdjustTokenPrivileges%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%WriteByte%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%WriteInt32%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%OpenThreadToken%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%PtrToString%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%FreeHGlobal%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ZeroFreeGlobalAllocUnicode%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%OpenProcessToken%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%GetTokenInformation%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%SetThreadToken%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ImpersonateLoggedOnUser%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%RevertToSelf%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%GetLogonSessionData%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%CreateProcessWithToken%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%DuplicateTokenEx%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%OpenWindowStation%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%OpenDesktop%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%MiniDumpWriteDump%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%AddSecurityPackage%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%EnumerateSecurityPackages%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%GetProcessHandle%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%DangerousGetHandle%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%kernel32%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Advapi32%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%msvcrt%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ntdll%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%user32%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%secur32%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PowerShell ADRecon Execution",
        "description": "Detects execution of ADRecon.ps1 for AD reconnaissance which has been reported to be actively used by FIN7",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Function Get-ADRExcelComOb%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ADRecon-Report.xlsx%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Automated Collection Command PowerShell",
        "description": "Once established within a system or network, an adversary may use automated techniques for collecting internal data.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ScriptBlockText LIKE \"%.doc%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.docx%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.xls%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.xlsx%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.ppt%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.pptx%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.rtf%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.pdf%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.txt%\" ESCAPE '\\') AND ScriptBlockText LIKE \"%Get-ChildItem%\" ESCAPE '\\' AND ScriptBlockText LIKE \"% -Recurse %\" ESCAPE '\\' AND ScriptBlockText LIKE \"% -Include %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "AzureHound PowerShell Commands",
        "description": null,
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Invoke-AzureHound%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Execution via CL_Invocation.ps1",
        "description": "Detects Execution via SyncInvoke in CL_Invocation.ps1 module",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%CL\\_Invocation.ps1%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%SyncInvoke%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Execution via CL_Invocation.ps1 (2 Lines)",
        "description": "Detects Execution via SyncInvoke in CL_Invocation.ps1 module",
        "rule": [
            "SELECT * FROM (SELECT *,count(ScriptBlockText) AS agg FROM eventlog WHERE (ScriptBlockText LIKE \"%CL\\_Invocation.ps1%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%SyncInvoke%\" ESCAPE '\\') GROUP BY Computer) WHERE agg > 2"
        ]
    },
    {
        "title": "Execution via CL_Mutexverifiers.ps1",
        "description": "Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%CL\\_Mutexverifiers.ps1%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%runAfterCancelProcess%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Execution via CL_Mutexverifiers.ps1 (2 Lines)",
        "description": "Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module",
        "rule": [
            "SELECT * FROM (SELECT *,count(ScriptBlockText) AS agg FROM eventlog WHERE (ScriptBlockText LIKE \"%CL\\_Mutexverifiers.ps1%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%runAfterCancelProcess%\" ESCAPE '\\') GROUP BY Computer) WHERE agg > 2"
        ]
    },
    {
        "title": "PowerShell Create Local User",
        "description": "Detects creation of a local user via PowerShell",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%New-LocalUser%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Data Compressed - PowerShell",
        "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%-Recurse%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%|%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%Compress-Archive%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Powershell Detect Virtualization Environment",
        "description": "Adversaries may employ various system checks to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Get-WmiObject%\" ESCAPE '\\' AND (ScriptBlockText LIKE \"%MSAcpi\\_ThermalZoneTemperature%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Win32\\_ComputerSystem%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Dnscat Execution",
        "description": "Dnscat exfiltration tool execution",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%Start-Dnscat2%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "PowerShell ICMP Exfiltration",
        "description": "Detects Exfiltration Over Alternative Protocol - ICMP. Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%New-Object%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%System.Net.NetworkInformation.Ping%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%.Send(%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PrintNightmare Powershell Exploitation",
        "description": "Detects Commandlet name for PrintNightmare exploitation.",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%Invoke-Nightmare%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Powershell Keylogging",
        "description": "Adversaries may log user keystrokes to intercept credentials as the user types them.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Get-Keystrokes%\" ESCAPE '\\' OR (ScriptBlockText LIKE \"%Get-ProcAddress user32.dll GetAsyncKeyState%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%Get-ProcAddress user32.dll GetForegroundWindow%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malicious PowerShell Commandlets",
        "description": "Detects Commandlet names from well-known PowerShell exploitation frameworks",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ScriptBlockText LIKE \"%Invoke-DllInjection%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Shellcode%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-WmiCommand%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-GPPPassword%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Keystrokes%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-TimedScreenshot%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-VaultCredential%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-CredentialInjection%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Mimikatz%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-NinjaCopy%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-TokenManipulation%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-Minidump%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%VolumeShadowCopyTools%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ReflectivePEInjection%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-UserHunter%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-GPOLocation%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ACLScanner%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-DowngradeAccount%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ServiceUnquoted%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ServiceFilePermission%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ServicePermission%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ServiceAbuse%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Install-ServiceBinary%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-RegAutoLogon%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-VulnAutoRun%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-VulnSchTask%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-UnattendedInstallFile%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ApplicationHost%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-RegAlwaysInstallElevated%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Unconstrained%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-RegBackdoor%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-ScrnSaveBackdoor%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Gupt-Backdoor%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ADSBackdoor%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Enabled-DuplicateToken%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PsUaCme%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Remove-Update%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Check-VM%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-LSASecret%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-PassHashes%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Show-TargetScreen%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Port-Scan%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PoshRatHttp%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PowerShellTCP%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PowerShellWMI%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-Exfiltration%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-Persistence%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Do-Exfiltration%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Start-CaptureServer%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ChromeDump%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ClipboardContents%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-FoxDump%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-IndexedItem%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Screenshot%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Inveigh%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-NetRipper%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-EgressCheck%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PostExfil%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PSInject%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-RunAs%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%MailRaider%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%New-HoneyHash%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Set-MacAttribute%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-DCSync%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PowerDump%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Exploit-Jboss%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ThunderStruck%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-VoiceTroll%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Set-Wallpaper%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-InveighRelay%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PsExec%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-SSHCommand%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-SecurityPackages%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Install-SSP%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-BackdoorLNK%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%PowerBreach%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-SiteListPassword%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-System%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-BypassUAC%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Tater%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-WScriptBypassUAC%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%PowerUp%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%PowerView%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-RickAstley%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-Fruit%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%HTTP-Login%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-TrustedDocuments%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Paranoia%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-WinEnum%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ARPScan%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PortScan%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ReverseDNSLookup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-SMBScanner%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Mimikittenz%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-AllChecks%\" ESCAPE '\\') AND NOT (ScriptBlockText LIKE \"%Get-SystemDriveInfo%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malicious PowerShell Keywords",
        "description": "Detects keywords from well-known PowerShell exploitation frameworks",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%AdjustTokenPrivileges%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%IMAGE\\_NT\\_OPTIONAL\\_HDR64\\_MAGIC%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Microsoft.Win32.UnsafeNativeMethods%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ReadProcessMemory.Invoke%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%SE\\_PRIVILEGE\\_ENABLED%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%LSA\\_UNICODE\\_STRING%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%MiniDumpWriteDump%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%PAGE\\_EXECUTE\\_READ%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%SECURITY\\_DELEGATION%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_ADJUST\\_PRIVILEGES%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_ALL\\_ACCESS%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_ASSIGN\\_PRIMARY%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_DUPLICATE%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_ELEVATION%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_IMPERSONATE%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_INFORMATION\\_CLASS%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_PRIVILEGES%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TOKEN\\_QUERY%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Metasploit%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Mimikatz%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Live Memory Dump Using Powershell",
        "description": "Detects usage of a PowerShell command to dump the live memory of a Windows machine",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Get-StorageDiagnosticInfo%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-IncludeLiveDump%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Malicious Nishang PowerShell Commandlets",
        "description": "Detects Commandlet names and arguments from the Nishang exploitation framework",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Add-ConstrainedDelegationBackdoor%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Set-DCShadowPermissions%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%DNS\\_TXT\\_Pwnage%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Execute-OnTime%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%HTTP-Backdoor%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Set-RemotePSRemoting%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Set-RemoteWMI%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-AmsiBypass%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-CHM%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-HTA%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-SCF%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-SCT%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-Shortcut%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-WebQuery%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-Word%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Enable-Duplication%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Remove-Update%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Download-Execute-PS%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Download\\_Execute%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Execute-Command-MSSQL%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Execute-DNSTXT-Code%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-RundllCommand%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Copy-VSS%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%FireBuster%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%FireListener%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Information%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-PassHints%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-WLAN-Keys%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Web-Credentials%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-CredentialsPhish%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-MimikatzWDigestDowngrade%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-SSIDExfil%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-SessionGopher%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Keylogger%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Interceptor%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Create-MultipleSessions%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-NetworkRelay%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Run-EXEonRemote%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Prasadhak%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-BruteForce%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Password-List%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-JSRatRegsvr%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-JSRatRundll%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PoshRatHttps%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PowerShellIcmp%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PowerShellUdp%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PSGcat%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-PsGcatAgent%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Remove-PoshRat%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-Persistance%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ExetoText%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Decode%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Encode%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Parse\\_Keys%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Remove-Persistence%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%StringtoBase64%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%TexttoExe%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Powerpreter%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Nishang%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%DataToEncode%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%LoggedKeys%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%OUT-DNSTXT%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ExfilOption%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%DumpCerts%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%DumpCreds%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Shellcode32%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Shellcode64%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%NotAllNameSpaces%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%exfill%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%FakeDC%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "NTFS Alternate Data Stream",
        "description": "Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ScriptBlockText LIKE \"%set-content%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%add-content%\" ESCAPE '\\') AND (ScriptBlockText LIKE \"%-stream%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malicious PowerView PowerShell Commandlets",
        "description": "Detects Commandlet names from PowerView of PowerSploit exploitation framework.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Export-PowerViewCSV%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-IPAddress%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Resolve-IPAddress%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Convert-NameToSid%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ConvertTo-SID%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Convert-ADName%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%ConvertFrom-UACValue%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-RemoteConnection%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Remove-RemoteConnection%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-UserImpersonation%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-RevertToSelf%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Request-SPNTicket%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainSPNTicket%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Kerberoast%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-PathAcl%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DNSZone%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainDNSZone%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DNSRecord%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainDNSRecord%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetDomain%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Domain%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetDomainController%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainController%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetForest%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Forest%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetForestDomain%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ForestDomain%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetForestCatalog%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ForestGlobalCatalog%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-DomainObjectPropertyOutlier%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetUser%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainUser%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%New-DomainUser%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Set-DomainUserPassword%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-UserEvent%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainUserEvent%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetComputer%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainComputer%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ADObject%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainObject%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Set-ADObject%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Set-DomainObject%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ObjectAcl%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainObjectAcl%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-ObjectAcl%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-DomainObjectAcl%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ACLScanner%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-InterestingDomainAcl%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetOU%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainOU%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetSite%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainSite%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetSubnet%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainSubnet%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainSID%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetGroup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainGroup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%New-DomainGroup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-ManagedSecurityGroups%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainManagedSecurityGroup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetGroupMember%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainGroupMember%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Add-DomainGroupMember%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetFileServer%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainFileServer%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DFSshare%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainDFSShare%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetGPO%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainGPO%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetGPOGroup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainGPOLocalGroup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-GPOLocation%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainGPOUserLocalGroupMapping%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-GPOComputerAdmin%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainGPOComputerLocalGroupMapping%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainPolicy%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetLocalGroup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetLocalGroupMember%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetShare%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetLoggedon%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetSession%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-LoggedOnLocal%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-RegLoggedOn%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetRDPSession%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-CheckLocalAdminAccess%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Test-AdminAccess%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-SiteName%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetComputerSiteName%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Proxy%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-WMIRegProxy%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-LastLoggedOn%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-WMIRegLastLoggedOn%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-CachedRDPConnection%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-WMIRegCachedRDPConnection%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-RegistryMountedDrive%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-WMIRegMountedDrive%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetProcess%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-WMIProcess%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-InterestingFile%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-UserHunter%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-DomainUserLocation%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ProcessHunter%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-DomainProcess%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-EventHunter%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-DomainUserEvent%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-ShareFinder%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-DomainShare%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-FileFinder%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-InterestingDomainShareFile%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-LocalAdminAccess%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-EnumerateLocalAdmin%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-DomainLocalGroupMember%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetDomainTrust%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainTrust%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-NetForestTrust%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ForestTrust%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-ForeignUser%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainForeignUser%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Find-ForeignGroup%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainForeignGroupMember%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-MapDomainTrust%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-DomainTrustMapping%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PowerShell Credential Prompt",
        "description": "Detects PowerShell calling a credential prompt",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%PromptForCredential%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "PowerShell PSAttack",
        "description": "Detects the use of PSAttack PowerShell hack tool",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%PS ATTACK!!!%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Change PowerShell Policies to a Unsecure Level",
        "description": "Detects use of Set-ExecutionPolicy to set a unsecure policies",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Set-ExecutionPolicy%\" ESCAPE '\\' AND (ScriptBlockText LIKE \"%Unrestricted%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%bypass%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%RemoteSigned%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell ShellCode",
        "description": "Detects Base64 encoded Shellcode",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%AAAAYInlM%\" ESCAPE '\\' AND (ScriptBlockText LIKE \"%OiCAAAAYInlM%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%OiJAAAAYInlM%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malicious ShellIntel PowerShell Commandlets",
        "description": "Detects Commandlet names from ShellIntel exploitation scripts.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Invoke-SMBAutoBrute%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-GPOLinks%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Out-Minidump%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-Potato%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Powershell Store File In Alternate Data Stream",
        "description": "Storing files in Alternate Data Stream (ADS) similar to Astaroth malware.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Start-Process%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-FilePath \"$env:comspec\" %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-ArgumentList %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%>%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious PowerShell Download",
        "description": "Detects suspicious PowerShell download command",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%System.Net.WebClient%\" ESCAPE '\\' AND (ScriptBlockText LIKE \"%.DownloadFile(%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.DownloadString(%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Export-PfxCertificate",
        "description": "Detects Commandlet that is used to export certificates from the local certificate store and sometimes used by threat actors to steal private keys from compromised machines",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%Export-PfxCertificate%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "PowerShell Get-Process LSASS in ScriptBlock",
        "description": "Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%Get-Process lsass%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Suspicious PowerShell Invocations - Generic",
        "description": "Detects suspicious PowerShell invocation command parameters",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ScriptBlockText LIKE \"% -enc %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% -EncodedCommand %\" ESCAPE '\\') AND (ScriptBlockText LIKE \"% -w hidden %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% -window hidden %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% -windowstyle hidden %\" ESCAPE '\\') AND (ScriptBlockText LIKE \"% -noni %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% -noninteractive %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious PowerShell Invocations - Specific",
        "description": "Detects suspicious PowerShell invocation command parameters",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ScriptBlockText LIKE \"%-nop%\" ESCAPE '\\' AND ScriptBlockText LIKE \"% -w %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%hidden%\" ESCAPE '\\' AND ScriptBlockText LIKE \"% -c %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%[Convert]::FromBase64String%\" ESCAPE '\\') OR (ScriptBlockText LIKE \"% -w %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%hidden%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-noni%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-nop%\" ESCAPE '\\' AND ScriptBlockText LIKE \"% -c %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%iex%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%New-Object%\" ESCAPE '\\') OR (ScriptBlockText LIKE \"% -w %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%hidden%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-ep%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%bypass%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-Enc%\" ESCAPE '\\') OR (ScriptBlockText LIKE \"%powershell%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%reg%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%add%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%HKCU\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\run%\" ESCAPE '\\') OR (ScriptBlockText LIKE \"%bypass%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-noprofile%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-windowstyle%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%hidden%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%new-object%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%system.net.webclient%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%.download%\" ESCAPE '\\') OR (ScriptBlockText LIKE \"%iex%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%New-Object%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%Net.WebClient%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%.Download%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious PowerShell Keywords",
        "description": "Detects keywords that could indicate the use of some PowerShell exploitation framework",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%System.Reflection.Assembly.Load($%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%[System.Reflection.Assembly]::Load($%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%[Reflection.Assembly]::Load($%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%System.Reflection.AssemblyName%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Reflection.Emit.AssemblyBuilderAccess%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Runtime.InteropServices.DllImportAttribute%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%SuspendThread%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%rundll32%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Invoke-WMIMethod%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%http://127.0.0.1%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Powershell Local Email Collection",
        "description": "Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a users local system, such as Outlook storage or cache files.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Get-Inbox.ps1%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Microsoft.Office.Interop.Outlook%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Microsoft.Office.Interop.Outlook.olDefaultFolders%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%-comobject outlook.application%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PowerShell Deleted Mounted Share",
        "description": "Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Remove-SmbShare%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Remove-FileShare%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Recon Information for Export with PowerShell",
        "description": "Once established within a system or network, an adversary may use automated techniques for collecting internal data",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ScriptBlockText LIKE \"%Get-Service %\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-ChildItem %\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Get-Process %\" ESCAPE '\\') AND ScriptBlockText LIKE \"%> $env:TEMP\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Powershell Suspicious Win32_PnPEntity",
        "description": "Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system.",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%Win32\\_PnPEntity%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Suspicious PowerShell WindowStyle Option",
        "description": "Adversaries may use hidden windows to conceal malicious activity from the plain sight of users. In some cases, windows that would typically be displayed when an application carries out an operation can be hidden",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%powershell%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%WindowStyle%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%Hidden%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Zip A Folder With PowerShell For Staging In Temp",
        "description": "Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Compress-Archive %\" ESCAPE '\\' AND ScriptBlockText LIKE \"% -Path %\" ESCAPE '\\' AND ScriptBlockText LIKE \"% -DestinationPath %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%$env:TEMP\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SyncAppvPublishingServer Execution to Bypass Powershell Restriction",
        "description": "Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.",
        "rule": [
            "SELECT * FROM eventlog WHERE ScriptBlockText LIKE \"%SyncAppvPublishingServer.exe%\" ESCAPE '\\'"
        ]
    },
    {
        "title": "Powershell Timestomp",
        "description": "Adversaries may modify file time attributes to hide new or changes to existing files. Timestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%.CreationTime =%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.LastWriteTime =%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%.LastAccessTime =%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%[IO.File]::SetCreationTime%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%[IO.File]::SetLastAccessTime%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%[IO.File]::SetLastWriteTime%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Powershell Trigger Profiles by Add_Content",
        "description": "Adversaries may gain persistence and elevate privileges by executing malicious content triggered by PowerShell profiles.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Add-Content%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%$profile%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-Value%\" ESCAPE '\\' AND (ScriptBlockText LIKE \"%Start-Process%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%\"\"%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows PowerShell Web Request",
        "description": "Detects the use of various web request methods (including aliases) via Windows PowerShell command",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Invoke-WebRequest%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%iwr %\" ESCAPE '\\' OR ScriptBlockText LIKE \"%wget %\" ESCAPE '\\' OR ScriptBlockText LIKE \"%curl %\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Net.WebClient%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%Start-BitsTransfer%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Firewall Profile Disabled",
        "description": "Detects when a user disables the Windows Firewall via a Profile to help evade defense.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%Set-NetFirewallProfile%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-Profile%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-Enabled%\" ESCAPE '\\' AND ScriptBlockText LIKE \"%False%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Winlogon Helper DLL",
        "description": "Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\\Software[Wow6432Node]Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are used to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to load and execute malicious DLLs and/or executables.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%CurrentVersion\\\\Winlogon%\" ESCAPE '\\' AND (ScriptBlockText LIKE \"%Set-ItemProperty%\" ESCAPE '\\' OR ScriptBlockText LIKE \"%New-Item%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "WMImplant Hack Tool",
        "description": "Detects parameters used by WMImplant",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%WMImplant%\" ESCAPE '\\' OR ScriptBlockText LIKE \"% change\\_user %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% gen\\_cli %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% command\\_exec %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% disable\\_wdigest %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% disable\\_winrm %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% enable\\_wdigest %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% enable\\_winrm %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% registry\\_mod %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% remote\\_posh %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% sched\\_job %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% service\\_mod %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% process\\_kill %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% active\\_users %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% basic\\_info %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% power\\_off %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% vacant\\_system %\" ESCAPE '\\' OR ScriptBlockText LIKE \"% logon\\_events %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Powershell WMI Persistence",
        "description": "Adversaries may establish persistence and elevate privileges by executing malicious content triggered by a Windows Management Instrumentation (WMI) event subscription.",
        "rule": [
            "SELECT * FROM eventlog WHERE (ScriptBlockText LIKE \"%New-CimInstance %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-Namespace root/subscription %\" ESCAPE '\\' AND ScriptBlockText LIKE \"%-Property %\" ESCAPE '\\' AND (ScriptBlockText LIKE \"%-ClassName \\_\\_EventFilter %\" ESCAPE '\\' OR ScriptBlockText LIKE \"%-ClassName CommandLineEventConsumer %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CMSTP Execution Process Access",
        "description": "Detects various indicators of Microsoft Connection Manager Profile Installer execution",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND CallTrace LIKE \"%cmlua.dll%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Credentials Dumping Tools Accessing LSASS Memory",
        "description": "Detects process access LSASS memory which is typical for credentials dumping tools",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND (TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND (GrantedAccess LIKE \"%0x40%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1000%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1400%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x100000%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1410%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1010%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1438%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x143a%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1418%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1f0fff%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1f1fff%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1f2fff%\" ESCAPE '\\' OR GrantedAccess LIKE \"%0x1f3fff%\" ESCAPE '\\')) AND NOT ((SourceImage LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\taskmgr.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\procexp64.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\procexp.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\lsm.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\MsMpEng.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\csrss.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\wininit.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\vmtoolsd.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Direct Syscall of NtOpenProcess",
        "description": "Detects the usage of the direct syscall of NtOpenProcess which might be done from a CobaltStrike BOF.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND CallTrace LIKE \"UNKNOWN%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspect Svchost Memory Asccess",
        "description": "Detects suspect access to svchost process memory such as that used by Invoke-Phantom to kill the winRM windows event logging service.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND TargetImage LIKE \"%\\\\WINDOWS\\\\System32\\\\svchost.exe\" ESCAPE '\\' AND GrantedAccess = \"0x1F3FFF\" AND CallTrace LIKE \"%UNKNOWN%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious In-Memory Module Execution",
        "description": "Detects the access to processes by other suspicious processes which have reflectively loaded libraries in their memory space. An example is SilentTrinity C2 behaviour. Generally speaking, when Sysmon EventID 10 cannot reference a stack call to a dll loaded from disk (the standard way), it will display \"UNKNOWN\" as the module name. Usually this means the stack call points to a module that was reflectively loaded in memory. Adding to this, it is not common to see such few calls in the stack (ntdll.dll --> kernelbase.dll --> unknown) which essentially means that most of the functions required by the process to execute certain routines are already present in memory, not requiring any calls to external libraries. The latter should also be considered suspicious.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND (((CallTrace LIKE \"%C:\\\\WINDOWS\\\\SYSTEM32\\\\ntdll.dll+%\" ESCAPE '\\' AND CallTrace LIKE \"%|C:\\\\WINDOWS\\\\System32\\\\KERNELBASE.dll+%\" ESCAPE '\\' AND CallTrace LIKE \"%|UNKNOWN(%\" ESCAPE '\\' AND CallTrace LIKE \"%)%\" ESCAPE '\\') OR (CallTrace LIKE \"%UNKNOWN(%\" ESCAPE '\\' AND CallTrace LIKE \"%)|UNKNOWN(%\" ESCAPE '\\' AND CallTrace LIKE \"%)\" ESCAPE '\\')) OR ((CallTrace LIKE \"%UNKNOWN%\" ESCAPE '\\' AND GrantedAccess IN (\"0x1F0FFF\", \"0x1F1FFF\", \"0x143A\", \"0x1410\", \"0x1010\", \"0x1F2FFF\", \"0x1F3FFF\", \"0x1FFFFF\")) AND NOT ((SourceImage LIKE \"%\\\\Windows\\\\System32\\\\sdiagnhost.exe\" ESCAPE '\\')))))"
        ]
    },
    {
        "title": "Credential Dumping by LaZagne",
        "description": "Detects LSASS process access by LaZagne for credential dumping.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND CallTrace LIKE \"%C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+%\" ESCAPE '\\' AND CallTrace LIKE \"%|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+%\" ESCAPE '\\' AND CallTrace LIKE \"%\\_ctypes.pyd+%\" ESCAPE '\\' AND CallTrace LIKE \"%python27.dll+%\" ESCAPE '\\' AND GrantedAccess = \"0x1FFFFF\")"
        ]
    },
    {
        "title": "LittleCorporal Generated Maldoc Injection",
        "description": "Detects the process injection of a LittleCorporal generated Maldoc.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND SourceImage LIKE \"%winword.exe\" ESCAPE '\\' AND CallTrace LIKE \"%:\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\v2.%\" ESCAPE '\\' AND CallTrace LIKE \"%UNKNOWN%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Load Undocumented Autoelevated COM Interface",
        "description": "COM interface (EditionUpgradeManager) that is not used by standard executables.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND CallTrace LIKE \"%editionupgrademanagerobj.dll%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Lsass Memory Dump via Comsvcs DLL",
        "description": "Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND SourceImage LIKE \"C:\\\\Windows\\\\System32\\\\rundll32.exe\" ESCAPE '\\' AND CallTrace LIKE \"%comsvcs.dll%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "LSASS Memory Dump",
        "description": "Detects process LSASS memory dump using procdump or taskmgr based on the CallTrace pointing to dbghelp.dll or dbgcore.dll for win10",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND GrantedAccess = \"0x1fffff\" AND (CallTrace LIKE \"%dbghelp.dll%\" ESCAPE '\\' OR CallTrace LIKE \"%dbgcore.dll%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malware Shellcode in Verclsid Target Process",
        "description": "Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND (TargetImage LIKE \"%\\\\verclsid.exe\" ESCAPE '\\' AND GrantedAccess = \"0x1FFFFF\") AND ((CallTrace LIKE \"%|UNKNOWN(%\" ESCAPE '\\' AND CallTrace LIKE \"%VBE7.DLL%\" ESCAPE '\\') OR (SourceImage LIKE \"%\\\\Microsoft Office\\\\%\" ESCAPE '\\' AND CallTrace LIKE \"%|UNKNOWN%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Mimikatz through Windows Remote Management",
        "description": "Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND SourceImage LIKE \"C:\\\\Windows\\\\system32\\\\wsmprovhost.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Credential Dumping by Pypykatz",
        "description": "Detects LSASS process access by pypykatz for credential dumping.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' AND CallTrace LIKE \"%C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+%\" ESCAPE '\\' AND CallTrace LIKE \"%C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+%\" ESCAPE '\\' AND CallTrace LIKE \"%libffi-7.dll%\" ESCAPE '\\' AND CallTrace LIKE \"%\\_ctypes.pyd+%\" ESCAPE '\\' AND CallTrace LIKE \"%python3%.dll+%\" ESCAPE '\\' AND GrantedAccess = \"0x1FFFFF\")"
        ]
    },
    {
        "title": "SVCHOST Credential Dump",
        "description": "Detects when a process, such as mimikatz, accesses the memory of svchost to dump credentials",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND (TargetImage LIKE \"%\\\\svchost.exe\" ESCAPE '\\' AND GrantedAccess = \"0x143a\") AND NOT ((SourceImage LIKE \"%\\\\services.exe\" ESCAPE '\\' OR SourceImage LIKE \"%\\\\msiexec.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "UAC Bypass Using WOW64 Logger DLL Hijack",
        "description": "Detects the pattern of UAC Bypass using a WoW64 logger DLL hijack (UACMe 30)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"10\" AND SourceImage LIKE \"%:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\' AND GrantedAccess = \"0x1fffff\" AND CallTrace LIKE \"UNKNOWN(0000000000000000)|UNKNOWN(0000000000000000)|%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Shells Spawn by WinRM",
        "description": "Detects suspicious shell spawn from WinRM host process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\wsmprovhost.exe\" ESCAPE '\\' AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\certutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bitsadmin.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Chafer Activity",
        "description": "Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%\\\\Service.exe%\" ESCAPE '\\' AND (CommandLine LIKE \"%i\" ESCAPE '\\' OR CommandLine LIKE \"%u\" ESCAPE '\\')) OR (CommandLine LIKE \"%\\\\microsoft\\\\Taskbar\\\\autoit3.exe\" ESCAPE '\\' OR CommandLine LIKE \"C:\\\\wsc.exe%\" ESCAPE '\\') OR (Image LIKE \"%\\\\Windows\\\\Temp\\\\DB\\\\%\" ESCAPE '\\' AND Image LIKE \"%.exe\" ESCAPE '\\') OR (CommandLine LIKE \"%\\\\nslookup.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%-q=TXT%\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\Autoit%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Advanced IP Scanner",
        "description": "Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\advanced\\_ip\\_scanner%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Execute From Alternate Data Streams",
        "description": "Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%txt:%\" ESCAPE '\\' AND ((CommandLine LIKE \"%type %\" ESCAPE '\\' AND CommandLine LIKE \"% > %\" ESCAPE '\\') OR (CommandLine LIKE \"%makecab %\" ESCAPE '\\' AND CommandLine LIKE \"%.cab%\" ESCAPE '\\') OR (CommandLine LIKE \"%reg %\" ESCAPE '\\' AND CommandLine LIKE \"% export %\" ESCAPE '\\') OR (CommandLine LIKE \"%regedit %\" ESCAPE '\\' AND CommandLine LIKE \"% /E %\" ESCAPE '\\') OR (CommandLine LIKE \"%esentutl %\" ESCAPE '\\' AND CommandLine LIKE \"% /y %\" ESCAPE '\\' AND CommandLine LIKE \"% /d %\" ESCAPE '\\' AND CommandLine LIKE \"% /o %\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "GALLIUM Artefacts",
        "description": "Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (sha1 LIKE \"e570585edc69f9074cb5e8a790708336bd45ca0f\" ESCAPE '\\') AND NOT ((Image LIKE \"%:\\\\Program Files(x86)\\\\%\" ESCAPE '\\' OR Image LIKE \"%:\\\\Program Files\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "GALLIUM Artefacts",
        "description": "Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND sha1 IN (\"53a44c2396d15c3a03723fa5e5db54cafd527635\", \"9c5e496921e3bc882dc40694f1dcc3746a75db19\", \"aeb573accfd95758550cf30bf04f389a92922844\", \"79ef78a797403a4ed1a616c68e07fff868a8650a\", \"4f6f38b4cec35e895d91c052b1f5a83d665c2196\", \"1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d\", \"e841a63e47361a572db9a7334af459ddca11347a\", \"c28f606df28a9bc8df75a4d5e5837fc5522dd34d\", \"2e94b305d6812a9f96e6781c888e48c7fb157b6b\", \"dd44133716b8a241957b912fa6a02efde3ce3025\", \"8793bf166cb89eb55f0593404e4e933ab605e803\", \"a39b57032dbb2335499a51e13470a7cd5d86b138\", \"41cc2b15c662bc001c0eb92f6cc222934f0beeea\", \"d209430d6af54792371174e70e27dd11d3def7a7\", \"1c6452026c56efd2c94cea7e0f671eb55515edb0\", \"c6b41d3afdcdcaf9f442bbe772f5da871801fd5a\", \"4923d460e22fbbf165bbbaba168e5a46b8157d9f\", \"f201504bd96e81d0d350c3a8332593ee1c9e09de\", \"ddd2db1127632a2a52943a2fe516a2e7d05d70d2\"))"
        ]
    },
    {
        "title": "Pandemic Registry Key",
        "description": "Detects Pandemic Windows Implant",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%loaddll -a %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Defrag Deactivation",
        "description": "Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%/delete%\" ESCAPE '\\' OR CommandLine LIKE \"%/change%\" ESCAPE '\\') AND CommandLine LIKE \"%/TN%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Microsoft\\\\Windows\\\\Defrag\\\\ScheduledDefrag%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Turla Group Lateral Movement",
        "description": "Detects automated lateral movement by Turla group",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"net use \\\\\\%DomainController\\%\\\\C$ \"P@ssw0rd\" %\" ESCAPE '\\' OR CommandLine LIKE \"dir c:\\\\%.doc% /s\" ESCAPE '\\' OR CommandLine LIKE \"dir \\%TEMP\\%\\\\%.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Operation Wocao Activity",
        "description": "Detects activity mentioned in Operation Wocao report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%checkadmin.exe 127.0.0.1 -all%\" ESCAPE '\\' OR CommandLine LIKE \"%netsh advfirewall firewall add rule name=powershell dir=in%\" ESCAPE '\\' OR CommandLine LIKE \"%cmd /c powershell.exe -ep bypass -file c:\\\\s.ps1%\" ESCAPE '\\' OR CommandLine LIKE \"%/tn win32times /f%\" ESCAPE '\\' OR CommandLine LIKE \"%create win32times binPath=%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\c$\\\\windows\\\\system32\\\\devmgr.dll%\" ESCAPE '\\' OR CommandLine LIKE \"% -exec bypass -enc JgAg%\" ESCAPE '\\' OR CommandLine LIKE \"%type %keepass\\\\KeePass.config.xml%\" ESCAPE '\\' OR CommandLine LIKE \"%iie.exe iie.txt%\" ESCAPE '\\' OR CommandLine LIKE \"%reg query HKEY\\_CURRENT\\_USER\\\\Software\\\\%\\\\PuTTY\\\\Sessions\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Automated Collection Command Prompt",
        "description": "Once established within a system or network, an adversary may use automated techniques for collecting internal data.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%.doc%\" ESCAPE '\\' OR CommandLine LIKE \"%.docx%\" ESCAPE '\\' OR CommandLine LIKE \"%.xls%\" ESCAPE '\\' OR CommandLine LIKE \"%.xlsx%\" ESCAPE '\\' OR CommandLine LIKE \"%.ppt%\" ESCAPE '\\' OR CommandLine LIKE \"%.pptx%\" ESCAPE '\\' OR CommandLine LIKE \"%.rtf%\" ESCAPE '\\' OR CommandLine LIKE \"%.pdf%\" ESCAPE '\\' OR CommandLine LIKE \"%.txt%\" ESCAPE '\\') AND ((CommandLine LIKE \"%dir %\" ESCAPE '\\' AND CommandLine LIKE \"% /b %\" ESCAPE '\\' AND CommandLine LIKE \"% /s %\" ESCAPE '\\') OR (OriginalFileName = \"FINDSTR.EXE\" AND CommandLine LIKE \"% /e %\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "F-Secure C3 Load by Rundll32",
        "description": "F-Secure C3 produces DLLs with a default exported StartNodeRelay function.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%rundll32.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%StartNodeRelay%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Load DLL via CertOC.exe",
        "description": "Detects when a user installs certificates by using CertOC.exe to loads the target DLL file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\certoc.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-LoadDLL%\" ESCAPE '\\' AND CommandLine LIKE \"%.dll%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Use of CLIP",
        "description": "Adversaries may collect data stored in the clipboard from users copying information within or between applications.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND OriginalFileName = \"clip.exe\")"
        ]
    },
    {
        "title": "CobaltStrike Load by Rundll32",
        "description": "Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%rundll32.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%StartW%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "WMI Command Execution by Office Applications",
        "description": "Initial execution of malicious document calls wmic Win32_Process::Create to execute the file with regsvr32",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventLog = \"EDR\" AND EventType = \"WMIExecution\" AND WMIcommand LIKE \"%Win32\\_Process\\\\:\\\\:Create%\" ESCAPE '\\' AND (Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Conti Ransomware Execution",
        "description": "Conti ransomware command line ioc",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%-m %\" ESCAPE '\\' AND CommandLine LIKE \"%-net %\" ESCAPE '\\' AND CommandLine LIKE \"%-size %\" ESCAPE '\\' AND CommandLine LIKE \"%-nomutex %\" ESCAPE '\\' AND CommandLine LIKE \"%-p \\\\\\*\" ESCAPE '\\' AND CommandLine LIKE \"%$%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Conti Backup Database",
        "description": "Detects a command used by conti to dump database",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%sqlcmd %\" ESCAPE '\\' OR CommandLine LIKE \"%sqlcmd.exe%\" ESCAPE '\\') AND CommandLine LIKE \"% -S localhost %\" ESCAPE '\\' AND (CommandLine LIKE \"%sys.sysprocesses%\" ESCAPE '\\' OR CommandLine LIKE \"%master.dbo.sysdatabases%\" ESCAPE '\\' OR CommandLine LIKE \"%BACKUP DATABASE%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Discover Private Keys",
        "description": "Adversaries may search for private key certificate files on compromised systems for insecurely stored credential",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%dir %\" ESCAPE '\\' OR CommandLine LIKE \"%findstr %\" ESCAPE '\\') AND (CommandLine LIKE \"%.key%\" ESCAPE '\\' OR CommandLine LIKE \"%.pgp%\" ESCAPE '\\' OR CommandLine LIKE \"%.gpg%\" ESCAPE '\\' OR CommandLine LIKE \"%.ppk%\" ESCAPE '\\' OR CommandLine LIKE \"%.p12%\" ESCAPE '\\' OR CommandLine LIKE \"%.pem%\" ESCAPE '\\' OR CommandLine LIKE \"%.pfx%\" ESCAPE '\\' OR CommandLine LIKE \"%.cer%\" ESCAPE '\\' OR CommandLine LIKE \"%.p7b%\" ESCAPE '\\' OR CommandLine LIKE \"%.asc%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "DNS ServerLevelPluginDll Install",
        "description": "Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\dnscmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/config%\" ESCAPE '\\' AND CommandLine LIKE \"%/serverlevelplugindll%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Dotnet.exe Exec Dll and Execute Unsigned Code LOLBIN",
        "description": "dotnet.exe will execute any DLL and execute unsigned code",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%.dll\" ESCAPE '\\' OR CommandLine LIKE \"%.csproj\" ESCAPE '\\') AND (Image LIKE \"%\\\\dotnet.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Dumpert Process Dumper",
        "description": "Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Imphash = \"09D278F9DE118EF09163C6140255C690\")"
        ]
    },
    {
        "title": "InfDefaultInstall.exe .inf Execution",
        "description": "Executes SCT script using scrobj.dll from a command in entered into a specially prepared INF file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%InfDefaultInstall.exe %\" ESCAPE '\\' AND CommandLine LIKE \"%.inf%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "LOLBAS Data Exfiltration by DataSvcUtil.exe",
        "description": "Detects when a user performs data exfiltration by using DataSvcUtil.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%/in:%\" ESCAPE '\\' AND CommandLine LIKE \"%/out:%\" ESCAPE '\\' AND (Image LIKE \"%\\\\DataSvcUtil.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "New Lolbin Process by Office Applications",
        "description": "This rule will monitor any office apps that spins up a new LOLBin process. This activity is pretty suspicious and should be investigated.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((Image LIKE \"%regsvr32\" ESCAPE '\\' OR Image LIKE \"%rundll32\" ESCAPE '\\' OR Image LIKE \"%msiexec\" ESCAPE '\\' OR Image LIKE \"%mshta\" ESCAPE '\\' OR Image LIKE \"%verclsid\" ESCAPE '\\') AND (ParentImage LIKE \"%winword.exe\" ESCAPE '\\' OR ParentImage LIKE \"%excel.exe\" ESCAPE '\\' OR ParentImage LIKE \"%powerpnt.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Driver Install by pnputil.exe",
        "description": "Detects when a possible suspicious driver is being installed via pnputil.exe lolbin",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%-i%\" ESCAPE '\\' OR CommandLine LIKE \"%/install%\" ESCAPE '\\' OR CommandLine LIKE \"%-a%\" ESCAPE '\\' OR CommandLine LIKE \"%/add-driver%\" ESCAPE '\\' OR CommandLine LIKE \"%.inf%\" ESCAPE '\\') AND (Image LIKE \"%\\\\pnputil.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Lolbins Process Creation with WmiPrvse",
        "description": "This rule will monitor LOLBin process creations by wmiprvse. Add more LOLBins to rule logic if needed.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((Image LIKE \"%regsvr32\" ESCAPE '\\' OR Image LIKE \"%rundll32\" ESCAPE '\\' OR Image LIKE \"%msiexec\" ESCAPE '\\' OR Image LIKE \"%mshta\" ESCAPE '\\' OR Image LIKE \"%verclsid\" ESCAPE '\\') AND ParentImage LIKE \"%\\\\wbem\\\\WmiPrvSE.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Execute Files with Msdeploy.exe",
        "description": "Detects file execution using the msdeploy.exe lolbin",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%verb:sync%\" ESCAPE '\\' AND CommandLine LIKE \"%-source:RunCommand%\" ESCAPE '\\' AND CommandLine LIKE \"%-dest:runCommand%\" ESCAPE '\\' AND (Image LIKE \"%\\\\msdeploy.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Office Applications Spawning Wmi Cli",
        "description": "Initial execution of malicious document calls wmic to execute the file with regsvr32",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"\\\\wbem\\\\WMIC.exe\" ESCAPE '\\' OR CommandLine LIKE \"%wmic %\" ESCAPE '\\' OR OriginalFileName = \"wmic.exe\" OR Description = \"WMI Commandline Utility\") AND (ParentPrcessName LIKE \"%winword.exe\" ESCAPE '\\' OR ParentPrcessName LIKE \"%excel.exe\" ESCAPE '\\' OR ParentPrcessName LIKE \"%powerpnt.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Excel Proxy Executing Regsvr32 With Payload",
        "description": "Excel called wmic to finally proxy execute regsvr32 with the payload. An attacker wanted to break suspicious parent-child chain (Office app spawns LOLBin).But we have command-line in the event which allow us to \"restore\" this suspicious parent-child chain and detect it. Monitor process creation with \"wmic process call create\" and LOLBins in command-line with parent Office application processes.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((Image LIKE \"%\\\\wbem\\\\WMIC.exe\" ESCAPE '\\' OR ProcessCommandLine LIKE \"%wmic %\" ESCAPE '\\' OR OriginalFileName = \"wmic.exe\" OR Description = \"WMI Commandline Utility\") AND (CommandLine LIKE \"%regsvr32%\" ESCAPE '\\' OR CommandLine LIKE \"%rundll32%\" ESCAPE '\\' OR CommandLine LIKE \"%msiexec%\" ESCAPE '\\' OR CommandLine LIKE \"%mshta%\" ESCAPE '\\' OR CommandLine LIKE \"%verclsid%\" ESCAPE '\\') AND (ParentImage LIKE \"%winword.exe\" ESCAPE '\\' OR ParentImage LIKE \"%excel.exe\" ESCAPE '\\' OR ParentImage LIKE \"%powerpnt.exe\" ESCAPE '\\') AND processCommandLine LIKE \"%process%\" ESCAPE '\\' AND processCommandLine LIKE \"%create%\" ESCAPE '\\' AND processCommandLine LIKE \"%call%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Excel Proxy Executing Regsvr32 With Payload",
        "description": "Excel called wmic to finally proxy execute regsvr32 with the payload. An attacker wanted to break suspicious parent-child chain (Office app spawns LOLBin).But we have command-line in the event which allow us to \"restore\" this suspicious parent-child chain and detect it. Monitor process creation with \"wmic process call create\" and LOLBins in command-line with parent Office application processes.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((ProcessCommandLine LIKE \"%regsvr32%\" ESCAPE '\\' OR ProcessCommandLine LIKE \"%rundll32%\" ESCAPE '\\' OR ProcessCommandLine LIKE \"%msiexec%\" ESCAPE '\\' OR ProcessCommandLine LIKE \"%mshta%\" ESCAPE '\\' OR ProcessCommandLine LIKE \"%verclsid%\" ESCAPE '\\') AND (Image LIKE \"%\\\\wbem\\\\WMIC.exe\" ESCAPE '\\' OR ProcessCommandLine LIKE \"%wmic %\" ESCAPE '\\') AND (ParentImage LIKE \"%winword.exe\" ESCAPE '\\' OR ParentImage LIKE \"%excel.exe\" ESCAPE '\\' OR ParentImage LIKE \"%powerpnt.exe\" ESCAPE '\\') AND processCommandLine LIKE \"%process%\" ESCAPE '\\' AND processCommandLine LIKE \"%create%\" ESCAPE '\\' AND processCommandLine LIKE \"%call%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Office Applications Spawning Wmi Cli",
        "description": "Initial execution of malicious document calls wmic to execute the file with regsvr32",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\wbem\\\\WMIC.exe\" ESCAPE '\\' OR ProcessCommandLine LIKE \"%wmic %\" ESCAPE '\\') AND ParentImage IN (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\"))"
        ]
    },
    {
        "title": "Pingback Backdoor",
        "description": "Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%updata.exe\" ESCAPE '\\' AND CommandLine LIKE \"%config%\" ESCAPE '\\' AND CommandLine LIKE \"%msdtc%\" ESCAPE '\\' AND CommandLine LIKE \"%start%\" ESCAPE '\\' AND CommandLine LIKE \"%auto%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows PowerShell Web Request",
        "description": "Detects the use of various web request methods (including aliases) via Windows PowerShell command",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%Invoke-WebRequest%\" ESCAPE '\\' OR CommandLine LIKE \"%iwr %\" ESCAPE '\\' OR CommandLine LIKE \"%wget %\" ESCAPE '\\' OR CommandLine LIKE \"%curl %\" ESCAPE '\\' OR CommandLine LIKE \"%Net.WebClient%\" ESCAPE '\\' OR CommandLine LIKE \"%Start-BitsTransfer%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "ProtocolHandler.exe Downloaded Suspicious File",
        "description": "Emulates attack via documents through protocol handler in Microsoft Office. On successful execution you should see Microsoft Word launch a blank file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\protocolhandler.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\"ms-word%\" ESCAPE '\\' AND CommandLine LIKE \"%.docx\"%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Root Certificate Installed",
        "description": "Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%root%\" ESCAPE '\\' AND ((Image LIKE \"%\\\\certutil.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-addstore%\" ESCAPE '\\') OR (Image LIKE \"%\\\\CertMgr.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/add%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Sysinternals SDelete Delete File",
        "description": "Use of SDelete to erase a file not the free space",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND OriginalFileName = \"sdelete.exe\" AND NOT ((CommandLine LIKE \"% -h%\" ESCAPE '\\' OR CommandLine LIKE \"% -c%\" ESCAPE '\\' OR CommandLine LIKE \"% -z%\" ESCAPE '\\' OR CommandLine LIKE \"% /_%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Detected Windows Software Discovery",
        "description": "Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\reg.exe\" ESCAPE '\\' AND CommandLine LIKE \"%query%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\software\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%/v%\" ESCAPE '\\' AND CommandLine LIKE \"%svcversion%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Sticky Key Like Backdoor Usage",
        "description": "Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\winlogon.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%sethc.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%utilman.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%osk.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%Magnify.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%Narrator.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%DisplaySwitch.exe%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Compress Data and Lock With Password for Exfiltration With 7-ZIP",
        "description": "An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%7z.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%7za.exe%\" ESCAPE '\\') AND CommandLine LIKE \"% -p%\" ESCAPE '\\' AND (CommandLine LIKE \"% a %\" ESCAPE '\\' OR CommandLine LIKE \"% u %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Abusable Invoke-ATHRemoteFXvGPUDisablementCommand",
        "description": "RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%Invoke-ATHRemoteFXvGPUDisablementCommand %\" ESCAPE '\\' AND (CommandLine LIKE \"%-ModuleName %\" ESCAPE '\\' OR CommandLine LIKE \"%-ModulePath %\" ESCAPE '\\' OR CommandLine LIKE \"%-ScriptBlock %\" ESCAPE '\\' OR CommandLine LIKE \"%-RemoteFXvGPUDisablementFilePath%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Recon Information for Export with Command Prompt",
        "description": "Once established within a system or network, an adversary may use automated techniques for collecting internal data.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\tree.com\" ESCAPE '\\' OR Image LIKE \"%\\\\WMIC.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\doskey.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sc.exe\" ESCAPE '\\') AND ParentCommandLine LIKE \"% > \\%TEMP\\%\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Compress Data and Lock With Password for Exfiltration With WINZIP",
        "description": "An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%winzip.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%winzip64.exe%\" ESCAPE '\\') AND (CommandLine LIKE \"%-s\"%\" ESCAPE '\\') AND (CommandLine LIKE \"% -min %\" ESCAPE '\\' OR CommandLine LIKE \"% -a %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Zip A Folder With PowerShell For Staging In Temp",
        "description": "Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%Compress-Archive %\" ESCAPE '\\' AND CommandLine LIKE \"% -Path %\" ESCAPE '\\' AND CommandLine LIKE \"% -DestinationPath %\" ESCAPE '\\' AND CommandLine LIKE \"%$env:TEMP\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SyncAppvPublishingServer Execute Arbitrary PowerShell Code",
        "description": "Executes arbitrary PowerShell code using SyncAppvPublishingServer.exe.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\SyncAppvPublishingServer.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\"n; %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SyncAppvPublishingServer VBS Execute Arbitrary PowerShell Code",
        "description": "Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%\\\\SyncAppvPublishingServer.vbs%\" ESCAPE '\\' AND CommandLine LIKE \"%\"n;%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Usage of Sysinternals Tools",
        "description": "Detects the usage of Sysinternals Tools due to accepteula key being added to Registry",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% -accepteula%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass via Event Viewer",
        "description": "Detects UAC bypass method using Windows event viewer",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\eventvwr.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\mmc.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PsExec Tool Execution",
        "description": "Detects PsExec service installation and execution events (service and Sysmon)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\PSEXESVC.exe\" ESCAPE '\\' AND User LIKE \"NT AUTHORITY\\\\SYSTEM%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "MSExchange Transport Agent Installation",
        "description": "Detects the Installation of a Exchange Transport Agent",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%Install-TransportAgent%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious PowerShell Mailbox Export to Share",
        "description": "Detects a PowerShell New-MailboxExportRequest that exports a mailbox to a local share, as used in ProxyShell exploitations",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%New-MailboxExport%\" ESCAPE '\\' AND CommandLine LIKE \"% -Mailbox %\" ESCAPE '\\' AND CommandLine LIKE \"% -FilePath \\\\127.0.0.1\\\\C$%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Esentutl Gather Credentials",
        "description": "Conti recommendation to its affiliates to use esentult to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%esentutl%\" ESCAPE '\\' AND CommandLine LIKE \"% /p%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Abused Debug Privilege by Arbitrary Parent Processes",
        "description": "Detection of unusual child processes by different system processes",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((ParentImage LIKE \"%\\\\winlogon.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\services.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\csrss.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\smss.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\wininit.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\spoolsv.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\searchindexer.exe\" ESCAPE '\\') AND (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\') AND (User LIKE \"NT AUTHORITY\\\\SYSTEM%\" ESCAPE '\\' OR User LIKE \"AUTORITE NT\\\\Sys%\" ESCAPE '\\')) AND NOT (CommandLine LIKE \"% route %\" ESCAPE '\\' AND CommandLine LIKE \"% ADD %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Accesschk Usage After Privilege Escalation",
        "description": "Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify if a privilege escalation process successful or not",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND IntegrityLevel = \"Medium\" AND (Product LIKE \"%AccessChk\" ESCAPE '\\' OR Description LIKE \"%Reports effective permissions%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Always Install Elevated MSI Spawned Cmd And Powershell",
        "description": "This rule will looks for Windows Installer service (msiexec.exe) spawned command line and/or powershell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\') AND ParentImage LIKE \"%\\\\Windows\\\\Installer\\\\%\" ESCAPE '\\' AND ParentImage LIKE \"%msi%\" ESCAPE '\\' AND (ParentImage LIKE \"%tmp\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Always Install Elevated Windows Installer",
        "description": "This rule will looks for Windows Installer service (msiexec.exe) when it tries to install MSI packages with SYSTEM privilege",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (User LIKE \"NT AUTHORITY\\\\SYSTEM%\" ESCAPE '\\' OR User LIKE \"AUTORITE NT\\\\Sys%\" ESCAPE '\\') AND ((Image LIKE \"%\\\\Windows\\\\Installer\\\\%\" ESCAPE '\\' AND Image LIKE \"%msi%\" ESCAPE '\\' AND (Image LIKE \"%tmp\" ESCAPE '\\')) OR ((Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\') AND IntegrityLevel = \"System\")))"
        ]
    },
    {
        "title": "DNS Tunnel Technique from MuddyWater",
        "description": "Detecting DNS tunnel activity for Muddywater actor",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\') AND (ParentImage LIKE \"%\\\\excel.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%DataExchange.dll%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "SOURGUM Actor Behaviours",
        "description": "Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%windows\\\\system32\\\\Physmem.sys%\" ESCAPE '\\' OR (Image LIKE \"%Windows\\\\system32\\\\ime\\\\SHARED\\\\WimBootConfigurations.ini%\" ESCAPE '\\' OR Image LIKE \"%Windows\\\\system32\\\\ime\\\\IMEJP\\\\WimBootConfigurations.ini%\" ESCAPE '\\' OR Image LIKE \"%Windows\\\\system32\\\\ime\\\\IMETC\\\\WimBootConfigurations.ini%\" ESCAPE '\\')) OR (EventID = \"1\" AND (Image LIKE \"%windows\\\\system32\\\\filepath2%\" ESCAPE '\\' OR Image LIKE \"%windows\\\\system32\\\\ime%\" ESCAPE '\\') AND (CommandLine LIKE \"%reg add%\" ESCAPE '\\') AND (CommandLine LIKE \"%HKEY\\_LOCAL\\_MACHINE\\\\software\\\\classes\\\\clsid\\\\{7c857801-7381-11cf-884d-00aa004b2e24}\\\\inprocserver32%\" ESCAPE '\\' OR CommandLine LIKE \"%HKEY\\_LOCAL\\_MACHINE\\\\software\\\\classes\\\\clsid\\\\{cf4cc405-e2c5-4ddd-b3ce-5e7582d8c9fa}\\\\inprocserver32%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Atlassian Confluence CVE-2021-26084",
        "description": "Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\Atlassian\\\\Confluence\\\\jre\\\\bin\\\\java.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%cmd /c%\" ESCAPE '\\' OR CommandLine LIKE \"%cmd /k%\" ESCAPE '\\' OR CommandLine LIKE \"%powershell%\" ESCAPE '\\' OR CommandLine LIKE \"%certutil%\" ESCAPE '\\' OR CommandLine LIKE \"%curl%\" ESCAPE '\\' OR CommandLine LIKE \"%whoami%\" ESCAPE '\\' OR CommandLine LIKE \"%ipconfig%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CMSTP Execution Process Creation",
        "description": "Detects various indicators of Microsoft Connection Manager Profile Installer execution",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\cmstp.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Mavinject Inject DLL Into Running Process",
        "description": "Injects arbitrary DLL into running process specified by process ID. Requires Windows 10.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% /INJECTRUNNING%\" ESCAPE '\\' AND CommandLine LIKE \"%.dll%\" ESCAPE '\\' AND OriginalFileName LIKE \"%mavinject%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CVE-2021-26857 Exchange Exploitation",
        "description": "Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Servers Unified Messaging service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%UMWorkerProcess.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%wermgr.exe\" ESCAPE '\\' OR Image LIKE \"%WerFault.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Cabinet File Expansion",
        "description": "Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\expand.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%.cab%\" ESCAPE '\\' OR CommandLine LIKE \"%/F:%\" ESCAPE '\\' OR CommandLine LIKE \"%-F:%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\ProgramData\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Public\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\AppData\\\\Roaming\\\\Temp\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows Credential Editor",
        "description": "Detects the use of Windows Credential Editor (WCE)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (EventID = \"1\" AND (Imphash IN (\"a53a02b997935fd8eedcb5f7abab9b9f\", \"e96a73c7bf33a464c510ede582318bf2\") OR (CommandLine LIKE \"%.exe -S\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\services.exe\" ESCAPE '\\'))) AND NOT (Image LIKE \"%\\\\clussvc.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "High Integrity Sdclt Process",
        "description": "A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%sdclt.exe\" ESCAPE '\\' AND IntegrityLevel = \"High\")"
        ]
    },
    {
        "title": "Logon Scripts (UserInitMprLogonScript)",
        "description": "Detects creation or execution of UserInitMprLogonScript persistence method",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((EventID = \"1\" AND (ParentImage LIKE \"%\\\\userinit.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\explorer.exe\" ESCAPE '\\')) AND NOT ((CommandLine LIKE \"%netlogon.bat%\" ESCAPE '\\' OR CommandLine LIKE \"%UsrLogon.cmd%\" ESCAPE '\\'))) OR CommandLine LIKE \"%UserInitMprLogonScript%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Ncat Execution",
        "description": "Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\ncat.exe\" ESCAPE '\\') OR (CommandLine LIKE \"% -lvp %\" ESCAPE '\\' OR CommandLine LIKE \"% -l --proxy-type http %\" ESCAPE '\\' OR CommandLine LIKE \"% --exec cmd.exe %\" ESCAPE '\\' OR CommandLine LIKE \"% -vnl --exec %\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Proxy Execution via Wuauclt",
        "description": "Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%wuauclt%\" ESCAPE '\\' OR OriginalFileName = \"wuauclt.exe\") AND (CommandLine LIKE \"%UpdateDeploymentProvider%\" ESCAPE '\\' AND CommandLine LIKE \"%.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%RunHandlerComServer%\" ESCAPE '\\')) AND NOT ((CommandLine LIKE \"% /UpdateDeploymentProvider UpdateDeploymentProvider.dll %\" ESCAPE '\\' OR CommandLine LIKE \"% wuaueng.dll %\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "RClone Execution",
        "description": "Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Description = \"Rsync for cloud storage\" OR (CommandLine LIKE \"%--config %\" ESCAPE '\\' AND CommandLine LIKE \"%--no-check-certificate %\" ESCAPE '\\' AND CommandLine LIKE \"% copy %\" ESCAPE '\\') OR ((Image LIKE \"%\\\\rclone.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%mega%\" ESCAPE '\\' OR CommandLine LIKE \"%pcloud%\" ESCAPE '\\' OR CommandLine LIKE \"%ftp%\" ESCAPE '\\' OR CommandLine LIKE \"%--progress%\" ESCAPE '\\' OR CommandLine LIKE \"%--ignore-existing%\" ESCAPE '\\' OR CommandLine LIKE \"%--auto-confirm%\" ESCAPE '\\' OR CommandLine LIKE \"%--transfers%\" ESCAPE '\\' OR CommandLine LIKE \"%--multi-thread-streams%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Remove Windows Defender Definition Files",
        "description": "Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND OriginalFileName = \"MpCmdRun.exe\" AND CommandLine LIKE \"% -RemoveDefinitions%\" ESCAPE '\\' AND CommandLine LIKE \"% -All%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Sdclt Child Processes",
        "description": "A General detection for sdclt spawning new processes. This could be an indicator of sdclt being used for bypass UAC techniques.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\sdclt.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Plink Remote Forwarding",
        "description": "Detects suspicious Plink tunnel remote forarding to a local port",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Description IN \"Command-line SSH, Telnet, and Rlogin client\" AND CommandLine LIKE \"% -R %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Stop Or Remove Antivirus Service",
        "description": "Adversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%Stop-Service %\" ESCAPE '\\' OR CommandLine LIKE \"%Remove-Service %\" ESCAPE '\\') AND (CommandLine LIKE \"% McAfeeDLPAgentService%\" ESCAPE '\\' OR CommandLine LIKE \"% Trend Micro Deep Security Manager%\" ESCAPE '\\' OR CommandLine LIKE \"% TMBMServer%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious WebDav Client Execution",
        "description": "A General detection for svchost.exe spawning rundll32.exe with command arguments like C:\\windows\\system32\\davclnt.dll,DavSetCookie. This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\windows\\\\system32\\\\davclnt.dll,DavSetCookie%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Uninstall Crowdstrike Falcon",
        "description": "Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%\\\\WindowsSensor.exe%\" ESCAPE '\\' AND CommandLine LIKE \"% /uninstall%\" ESCAPE '\\' AND CommandLine LIKE \"% /quiet%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "VMToolsd Suspicious Child Process",
        "description": "Detects suspicious child process creations of VMware Tools process which may indicate persistence setup",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\vmtoolsd.exe\" ESCAPE '\\' AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\')) AND NOT ((CommandLine LIKE \"%\\\\VMware\\\\VMware Tools\\\\poweron-vm-default.bat%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\VMware\\\\VMware Tools\\\\poweroff-vm-default.bat%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\VMware\\\\VMware Tools\\\\resume-vm-default.bat%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\VMware\\\\VMware Tools\\\\suspend-vm-default.bat%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "AdFind Usage Detection",
        "description": "AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%domainlist%\" ESCAPE '\\' OR CommandLine LIKE \"%trustdmp%\" ESCAPE '\\' OR CommandLine LIKE \"%dcmodes%\" ESCAPE '\\' OR CommandLine LIKE \"%adinfo%\" ESCAPE '\\' OR CommandLine LIKE \"% dclist %\" ESCAPE '\\' OR CommandLine LIKE \"%computer\\_pwdnotreqd%\" ESCAPE '\\' OR CommandLine LIKE \"%objectcategory=%\" ESCAPE '\\' OR CommandLine LIKE \"%-subnets -f%\" ESCAPE '\\' OR CommandLine LIKE \"%name=\"Domain Admins\"%\" ESCAPE '\\' OR CommandLine LIKE \"%-sc u:%\" ESCAPE '\\' OR CommandLine LIKE \"%domainncs%\" ESCAPE '\\' OR CommandLine LIKE \"%dompol%\" ESCAPE '\\' OR CommandLine LIKE \"% oudmp %\" ESCAPE '\\' OR CommandLine LIKE \"%subnetdmp%\" ESCAPE '\\' OR CommandLine LIKE \"%gpodmp%\" ESCAPE '\\' OR CommandLine LIKE \"%fspdmp%\" ESCAPE '\\' OR CommandLine LIKE \"%users\\_noexpire%\" ESCAPE '\\' OR CommandLine LIKE \"%computers\\_active%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "AnyDesk Silent Installation",
        "description": "AnyDesk Remote Desktop silent installation can be used by attacker to gain remote access.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%--install%\" ESCAPE '\\' AND CommandLine LIKE \"%--start-with-win%\" ESCAPE '\\' AND CommandLine LIKE \"%--silent%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "APT29",
        "description": "This method detects a suspicious PowerShell command line combination as used by APT29 in a campaign against U.S. think tanks.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%-noni%\" ESCAPE '\\' AND CommandLine LIKE \"%-ep%\" ESCAPE '\\' AND CommandLine LIKE \"%bypass%\" ESCAPE '\\' AND CommandLine LIKE \"%$%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Baby Shark Activity",
        "description": "Detects activity that could be related to Baby Shark malware",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"reg query \"HKEY\\_CURRENT\\_USER\\\\Software\\\\Microsoft\\\\Terminal Server Client\\\\Default\"\" ESCAPE '\\' OR CommandLine LIKE \"powershell.exe mshta.exe http%\" ESCAPE '\\' OR CommandLine LIKE \"cmd.exe /c taskkill /im cmd.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Judgement Panda Credential Access Activity",
        "description": "Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\xcopy.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/S%\" ESCAPE '\\' AND CommandLine LIKE \"%/E%\" ESCAPE '\\' AND CommandLine LIKE \"%/C%\" ESCAPE '\\' AND CommandLine LIKE \"%/Q%\" ESCAPE '\\' AND CommandLine LIKE \"%/H%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\\\*\" ESCAPE '\\') OR (Image LIKE \"%\\\\adexplorer.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-snapshot%\" ESCAPE '\\' AND CommandLine LIKE \"%\"\"%\" ESCAPE '\\' AND CommandLine LIKE \"%c:\\\\users\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "BlueMashroom DLL Load",
        "description": "Detects a suspicious DLL loading from AppData Local path as described in BlueMashroom report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%\\\\AppData\\\\Local\\\\%\" ESCAPE '\\' AND (CommandLine LIKE \"%\\\\regsvr32%\" ESCAPE '\\' OR CommandLine LIKE \"%,DllEntry%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "WMIExec VBS Script",
        "description": "Detects suspicious file execution by wscript and cscript",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' AND CommandLine LIKE \"%.vbs%\" ESCAPE '\\' AND CommandLine LIKE \"%/shell%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CrackMapExecWin",
        "description": "Detects CrackMapExecWin Activity as Described by NCSC",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\crackmapexec.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Elise Backdoor",
        "description": "Detects Elise backdoor acitivty as used by APT32",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"C:\\\\Windows\\\\SysWOW64\\\\cmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Windows\\\\Caches\\\\NavShExt.dll %\" ESCAPE '\\') OR CommandLine LIKE \"%\\\\AppData\\\\Roaming\\\\MICROS~1\\\\Windows\\\\Caches\\\\NavShExt.dll,Setting\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Emissary Panda Malware SLLauncher",
        "description": "Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\sllauncher.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Empire Monkey",
        "description": "Detects EmpireMonkey APT reported Activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%/i:\\%APPDATA\\%\\\\logs.txt scrobj.dll\" ESCAPE '\\' AND (Image LIKE \"%\\\\cutil.exe\" ESCAPE '\\' OR Description = \"Microsoft(C) Registerserver\"))"
        ]
    },
    {
        "title": "Equation Group DLL_U Load",
        "description": "Detects a specific tool and export used by EquationGroup",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND CommandLine LIKE \"%,dll\\_u\" ESCAPE '\\') OR CommandLine LIKE \"% -export dll\\_u %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "EvilNum Golden Chickens Deployment via OCX Files",
        "description": "Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%regsvr32%\" ESCAPE '\\' AND CommandLine LIKE \"%/s%\" ESCAPE '\\' AND CommandLine LIKE \"%/i%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\AppData\\\\Roaming\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%.ocx%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Greenbug Campaign Indicators",
        "description": "Detects tools and process executions as observed in a Greenbug campaign in May 2020",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%bitsadmin%\" ESCAPE '\\' AND CommandLine LIKE \"%/transfer%\" ESCAPE '\\' AND CommandLine LIKE \"%CSIDL\\_APPDATA%\" ESCAPE '\\') OR (CommandLine LIKE \"%CSIDL\\_SYSTEM\\_DRIVE%\" ESCAPE '\\') OR (CommandLine LIKE \"%\\\\msf.ps1%\" ESCAPE '\\' OR CommandLine LIKE \"%8989 -e cmd.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%system.Data.SqlClient.SqlDataAdapter($cmd); [void]$da.fill%\" ESCAPE '\\' OR CommandLine LIKE \"%-nop -w hidden -c $k=new-object%\" ESCAPE '\\' OR CommandLine LIKE \"%[Net.CredentialCache]::DefaultCredentials;IEX %\" ESCAPE '\\' OR CommandLine LIKE \"% -nop -w hidden -c $m=new-object net.webclient;$m%\" ESCAPE '\\' OR CommandLine LIKE \"%-noninteractive -executionpolicy bypass whoami%\" ESCAPE '\\' OR CommandLine LIKE \"%-noninteractive -executionpolicy bypass netstat -a%\" ESCAPE '\\' OR CommandLine LIKE \"%L3NlcnZlcj1%\" ESCAPE '\\') OR (Image LIKE \"%\\\\adobe\\\\Adobe.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\oracle\\\\local.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\revshell.exe\" ESCAPE '\\' OR Image LIKE \"%infopagesbackup\\\\ncat.exe\" ESCAPE '\\' OR Image LIKE \"%CSIDL\\_SYSTEM\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\programdata\\\\oracle\\\\java.exe\" ESCAPE '\\' OR Image LIKE \"%CSIDL\\_COMMON\\_APPDATA\\\\comms\\\\comms.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\Programdata\\\\VMware\\\\Vmware.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Exchange Exploitation Activity",
        "description": "Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%attrib%\" ESCAPE '\\' AND CommandLine LIKE \"% +h %\" ESCAPE '\\' AND CommandLine LIKE \"% +s %\" ESCAPE '\\' AND CommandLine LIKE \"% +r %\" ESCAPE '\\' AND CommandLine LIKE \"%.aspx%\" ESCAPE '\\') OR (CommandLine LIKE \"%schtasks%\" ESCAPE '\\' AND CommandLine LIKE \"%VSPerfMon%\" ESCAPE '\\') OR (CommandLine LIKE \"%vssadmin list shadows%\" ESCAPE '\\' AND CommandLine LIKE \"%Temp\\\\\\_\\_output%\" ESCAPE '\\') OR CommandLine LIKE \"%\\%TEMP\\%\\\\execute.bat%\" ESCAPE '\\' OR Image LIKE \"%Users\\\\Public\\\\opera\\\\Opera\\_browser.exe\" ESCAPE '\\' OR (Image LIKE \"%Opera\\_browser.exe\" ESCAPE '\\' AND (ParentImage LIKE \"%\\\\services.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\svchost.exe\" ESCAPE '\\')) OR Image LIKE \"%\\\\ProgramData\\\\VSPerfMon\\\\%\" ESCAPE '\\' OR (CommandLine LIKE \"% -t7z %\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\Programdata\\\\pst%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\it.zip%\" ESCAPE '\\') OR (Image LIKE \"%\\\\makecab.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%Microsoft\\\\Exchange Server\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%inetpub\\\\wwwroot%\" ESCAPE '\\')) OR (CommandLine LIKE \"%\\\\Temp\\\\xx.bat%\" ESCAPE '\\' OR CommandLine LIKE \"%Windows\\\\WwanSvcdcs%\" ESCAPE '\\' OR CommandLine LIKE \"%Windows\\\\Temp\\\\cw.exe%\" ESCAPE '\\') OR (CommandLine LIKE \"%\\\\comsvcs.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%Minidump%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\inetpub\\\\wwwroot%\" ESCAPE '\\') OR (CommandLine LIKE \"%dsquery%\" ESCAPE '\\' AND CommandLine LIKE \"% -uco %\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\inetpub\\\\wwwroot%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Hurricane Panda Activity",
        "description": "Detects Hurricane Panda Activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%localgroup%\" ESCAPE '\\' AND CommandLine LIKE \"%admin%\" ESCAPE '\\' AND CommandLine LIKE \"%/add%\" ESCAPE '\\') OR (CommandLine LIKE \"%\\\\Win64.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Judgement Panda Exfil Activity",
        "description": "Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%eprod.ldf\" ESCAPE '\\' OR (CommandLine LIKE \"%\\\\ldifde.exe -f -n %\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\7za.exe a 1.7z %\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\aaaa\\\\procdump64.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\aaaa\\\\netsess.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\aaaa\\\\7za.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%copy .\\\\1.7z \\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%copy \\\\client\\\\c$\\\\aaaa\\\\%\" ESCAPE '\\') OR Image LIKE \"C:\\\\Users\\\\Public\\\\7za.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Ke3chang Registry Key Modifications",
        "description": "Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%-Property DWORD -name DisableFirstRunCustomize -value 2 -Force%\" ESCAPE '\\' OR CommandLine LIKE \"%-Property String -name Check\\_Associations -value%\" ESCAPE '\\' OR CommandLine LIKE \"%-Property DWORD -name IEHarden -value 0 -Force%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Lazarus Activity",
        "description": "Detects different process creation events as described in Malwarebytes's threat report on Lazarus group activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%mshta%\" ESCAPE '\\' AND CommandLine LIKE \"%.zip%\" ESCAPE '\\') OR ((ParentImage LIKE \"C:\\\\Windows\\\\System32\\\\wbem\\\\wmiprvse.exe\" ESCAPE '\\') AND (Image LIKE \"C:\\\\Windows\\\\System32\\\\mshta.exe\" ESCAPE '\\')) OR ((ParentImage LIKE \"%:\\\\Users\\\\Public\\\\%\" ESCAPE '\\') AND (Image LIKE \"C:\\\\Windows\\\\System32\\\\rundll32.exe\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Lazarus Activity",
        "description": "Detects different process creation events as described in various threat reports on Lazarus group activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%reg.exe save hklm\\\\sam \\%temp\\%\\\\~reg\\_sam.save%\" ESCAPE '\\' OR CommandLine LIKE \"%1q2w3e4r@#$@#$@#$%\" ESCAPE '\\' OR CommandLine LIKE \"% -hp1q2w3e4 %\" ESCAPE '\\' OR CommandLine LIKE \"%.dat data03 10000 -p %\" ESCAPE '\\') OR (CommandLine LIKE \"%process call create%\" ESCAPE '\\' AND CommandLine LIKE \"% > \\%temp\\%\\\\~%\" ESCAPE '\\') OR (CommandLine LIKE \"%netstat -aon | find %\" ESCAPE '\\' AND CommandLine LIKE \"% > \\%temp\\%\\\\~%\" ESCAPE '\\') OR (CommandLine LIKE \"%.255 10 C:\\\\ProgramData\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Lazarus Loaders",
        "description": "Detects different loaders as described in various threat reports on Lazarus group activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%cmd.exe /c %\" ESCAPE '\\' AND CommandLine LIKE \"% -p 0x%\" ESCAPE '\\' AND (CommandLine LIKE \"%C:\\\\ProgramData\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\RECYCLER\\\\%\" ESCAPE '\\')) OR (CommandLine LIKE \"%rundll32.exe %\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\ProgramData\\\\%\" ESCAPE '\\' AND (CommandLine LIKE \"%.bin,%\" ESCAPE '\\' OR CommandLine LIKE \"%.tmp,%\" ESCAPE '\\' OR CommandLine LIKE \"%.dat,%\" ESCAPE '\\' OR CommandLine LIKE \"%.io,%\" ESCAPE '\\' OR CommandLine LIKE \"%.ini,%\" ESCAPE '\\' OR CommandLine LIKE \"%.db,%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Lazarus Session Highjacker",
        "description": "Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\msdtc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\gpvc.exe\" ESCAPE '\\') AND NOT ((Image LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Mustang Panda Dropper",
        "description": "Detects specific process parameters as used by Mustang Panda droppers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%Temp\\\\wtask.exe /create%\" ESCAPE '\\' OR CommandLine LIKE \"%\\%windir:~-3,1\\%\\%PUBLIC:~-9,1\\%%\" ESCAPE '\\' OR CommandLine LIKE \"%/tn \"Security Script %\" ESCAPE '\\' OR CommandLine LIKE \"%\\%windir:~-1,1\\%%\" ESCAPE '\\') OR (CommandLine LIKE \"%/E:vbscript%\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\Users\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%.txt%\" ESCAPE '\\' AND CommandLine LIKE \"%/F%\" ESCAPE '\\') OR Image LIKE \"%Temp\\\\winwsh.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "REvil Kaseya Incident Malware Patterns",
        "description": "Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%C:\\\\Windows\\\\cert.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%Set-MpPreference -DisableRealtimeMonitoring $true -DisableIntrusionPreventionSystem $true -DisableIOAVProtection $true -DisableScriptScanning $true -EnableControlledFolderAccess Disabled -EnableNetworkProtection AuditMode -Force -MAPSReporting Disabled%\" ESCAPE '\\' OR CommandLine LIKE \"%del /q /f c:\\\\kworking\\\\agent.crt%\" ESCAPE '\\' OR CommandLine LIKE \"%Kaseya VSA Agent Hot-fix%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\MsMpEng.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%rmdir /s /q \\%SystemDrive\\%\\\\inetpub\\\\logs%\" ESCAPE '\\' OR CommandLine LIKE \"%del /s /q /f \\%SystemDrive\\%\\\\%.log%\" ESCAPE '\\' OR CommandLine LIKE \"%c:\\\\kworking1\\\\agent.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%c:\\\\kworking1\\\\agent.crt%\" ESCAPE '\\') AND (Image LIKE \"C:\\\\Windows\\\\MsMpEng.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\cert.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\kworking\\\\agent.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\kworking1\\\\agent.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Sofacy Trojan Loader Activity",
        "description": "Detects Trojan loader acitivty as used by APT28",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%rundll32.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%\\%APPDATA\\%\\\\%\" ESCAPE '\\') AND (CommandLine LIKE \"%.dat\",%\" ESCAPE '\\' OR CommandLine LIKE \"%.dll\",#1\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Ps.exe Renamed SysInternals Tool",
        "description": "Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine = \"ps.exe -accepteula\")"
        ]
    },
    {
        "title": "TA505 Dropper Load Pattern",
        "description": "Detects mshta loaded by wmiprvse as parent as used by TA505 malicious documents",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "TAIDOOR RAT DLL Load",
        "description": "Detects specific process characteristics of Chinese TAIDOOR RAT malware load",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%dll,MyStart%\" ESCAPE '\\' OR CommandLine LIKE \"%dll MyStart%\" ESCAPE '\\') OR (EventID = \"1\" AND (CommandLine LIKE \"% MyStart\" ESCAPE '\\') AND (CommandLine LIKE \"%rundll32.exe%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "TropicTrooper Campaign November 2018",
        "description": "Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Turla Group Commands May 2020",
        "description": "Detects commands used by Turla group as reported by ESET in May 2020",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%tracert -h 10 yahoo.com%\" ESCAPE '\\' OR CommandLine LIKE \"%.WSqmCons))|iex;%\" ESCAPE '\\' OR CommandLine LIKE \"%Fr`omBa`se6`4Str`ing%\" ESCAPE '\\') OR (CommandLine LIKE \"%net use https://docs.live.net%\" ESCAPE '\\' AND CommandLine LIKE \"%@aol.co.uk%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "UNC2452 Process Creation Patterns",
        "description": "Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((((CommandLine LIKE \"%7z.exe a -v500m -mx9 -r0 -p%\" ESCAPE '\\') OR (ParentCommandLine LIKE \"%wscript.exe%\" ESCAPE '\\' AND ParentCommandLine LIKE \"%.vbs%\" ESCAPE '\\' AND CommandLine LIKE \"%rundll32.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\Windows%\" ESCAPE '\\' AND CommandLine LIKE \"%.dll,Tk\\_%\" ESCAPE '\\')) OR (ParentImage LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND ParentCommandLine LIKE \"%C:\\\\Windows%\" ESCAPE '\\' AND CommandLine LIKE \"%cmd.exe /C %\" ESCAPE '\\')) OR (CommandLine LIKE \"%rundll32 c:\\\\windows\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%.dll %\" ESCAPE '\\')) OR (EventID = \"1\" AND (ParentImage LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\dllhost.exe\" ESCAPE '\\') AND NOT (CommandLine IN (\" \", \"\")))))"
        ]
    },
    {
        "title": "UNC2452 PowerShell Pattern",
        "description": "Detects a specific PowerShell command line pattern used by the UNC2452 actors as mentioned in Microsoft and Symantec reports",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%Invoke-WMIMethod win32\\_process -name create -argumentlist%\" ESCAPE '\\' AND CommandLine LIKE \"%rundll32 c:\\\\windows%\" ESCAPE '\\') OR (CommandLine LIKE \"%wmic /node:%\" ESCAPE '\\' AND CommandLine LIKE \"%process call create \"rundll32 c:\\\\windows%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Unidentified Attacker November 2018",
        "description": "A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%cyzfc.dat,%\" ESCAPE '\\' AND CommandLine LIKE \"%PointFunctionCall\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Winnti Malware HK University Campaign",
        "description": "Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((ParentImage LIKE \"%C:\\\\Windows\\\\Temp%\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\hpqhvind.exe%\" ESCAPE '\\') AND Image LIKE \"C:\\\\ProgramData\\\\DRM%\" ESCAPE '\\') OR (ParentImage LIKE \"C:\\\\ProgramData\\\\DRM%\" ESCAPE '\\' AND Image LIKE \"%\\\\wmplayer.exe\" ESCAPE '\\') OR (ParentImage LIKE \"%\\\\Test.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\wmplayer.exe\" ESCAPE '\\') OR Image LIKE \"C:\\\\ProgramData\\\\DRM\\\\CLR\\\\CLR.exe\" ESCAPE '\\' OR (ParentImage LIKE \"C:\\\\ProgramData\\\\DRM\\\\Windows%\" ESCAPE '\\' AND Image LIKE \"%\\\\SearchFilterHost.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Winnti Pipemon Characteristics",
        "description": "Detects specific process characteristics of Winnti Pipemon malware reported by ESET",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%setup0.exe -p%\" ESCAPE '\\') OR (CommandLine LIKE \"%setup.exe%\" ESCAPE '\\' AND (CommandLine LIKE \"%-x:0\" ESCAPE '\\' OR CommandLine LIKE \"%-x:1\" ESCAPE '\\' OR CommandLine LIKE \"%-x:2\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "ZxShell Malware",
        "description": "Detects a ZxShell start by the called and well-known function name",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%zxFunction%\" ESCAPE '\\' OR CommandLine LIKE \"%RemoteDiskXXXXX%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Hiding Files with Attrib.exe",
        "description": "Detects usage of attrib.exe to hide files from users.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\attrib.exe\" ESCAPE '\\' AND CommandLine LIKE \"% +h %\" ESCAPE '\\') AND NOT ((EventID = \"1\" AND (CommandLine LIKE \"%\\\\desktop.ini %\" ESCAPE '\\' OR (ParentImage LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"+R +H +S +A \\\\%.cui\" ESCAPE '\\' AND ParentCommandLine LIKE \"C:\\\\WINDOWS\\\\system32\\\\%.bat\" ESCAPE '\\')))))"
        ]
    },
    {
        "title": "Bad Opsec Defaults Sacrificial Processes With Improper Arguments",
        "description": "Detects attackers using tooling with bad opsec defaults e.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run, one trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\WerFault.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\WerFault.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\rundll32.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\regsvcs.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\regsvcs.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\regasm.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\regasm.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Modification of Boot Configuration",
        "description": "Identifies use of the bcdedit command to delete boot configuration data. This tactic is sometimes used as by malware or an attacker as a destructive technique.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\bcdedit.exe\" ESCAPE '\\' AND CommandLine LIKE \"%set%\" ESCAPE '\\') AND ((CommandLine LIKE \"%bootstatuspolicy%\" ESCAPE '\\' AND CommandLine LIKE \"%ignoreallfailures%\" ESCAPE '\\') OR (CommandLine LIKE \"%recoveryenabled%\" ESCAPE '\\' AND CommandLine LIKE \"%no%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "SquiblyTwo",
        "description": "Detects WMI SquiblyTwo Attack with possible renamed WMI by looking for imphash",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%http%\" ESCAPE '\\' AND (((Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\') AND CommandLine LIKE \"%wmic%\" ESCAPE '\\' AND CommandLine LIKE \"%format%\" ESCAPE '\\') OR (Imphash IN (\"1B1A3F43BF37B5BFE60751F2EE2F326E\", \"37777A96245A3C74EB217308F3546F4C\", \"9D87C9D67CE724033C0B40CC4CA1B206\") AND CommandLine LIKE \"%format:%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Change Default File Association",
        "description": "When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%cmd%\" ESCAPE '\\' AND CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%assoc%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Execution via CL_Invocation.ps1",
        "description": "Detects Execution via SyncInvoke in CL_Invocation.ps1 module",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%CL\\_Invocation.ps1%\" ESCAPE '\\' AND CommandLine LIKE \"%SyncInvoke%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Execution via CL_Mutexverifiers.ps1",
        "description": "Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%CL\\_Mutexverifiers.ps1%\" ESCAPE '\\' AND CommandLine LIKE \"%runAfterCancelProcess%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Cmdkey Cached Credentials Recon",
        "description": "Detects usage of cmdkey to look for cached credentials",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\cmdkey.exe\" ESCAPE '\\' AND CommandLine LIKE \"% /list%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CMSTP UAC Bypass via COM Object Access",
        "description": "Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\DllHost.exe\" ESCAPE '\\' AND IntegrityLevel IN (\"High\", \"System\") AND (ParentCommandLine LIKE \"% /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}%\" ESCAPE '\\' OR ParentCommandLine LIKE \"% /Processid:{3E000D72-A845-4CD9-BD83-80C07C3B881F}%\" ESCAPE '\\' OR ParentCommandLine LIKE \"% /Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}%\" ESCAPE '\\' OR ParentCommandLine LIKE \"% /Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}%\" ESCAPE '\\' OR ParentCommandLine LIKE \"% /Processid:{E9495B87-D950-4AB5-87A5-FF6D70BF3E90}%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CobaltStrike Process Patterns",
        "description": "Detects process patterns found in Cobalt Strike beacon activity (see reference for more details)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%\\\\cmd.exe /C whoami%\" ESCAPE '\\' AND ParentImage LIKE \"C:\\\\Temp%\" ESCAPE '\\') OR (CommandLine LIKE \"%conhost.exe 0xffffffff -ForceV1%\" ESCAPE '\\' AND (ParentCommandLine LIKE \"%/C whoami%\" ESCAPE '\\' OR ParentCommandLine LIKE \"%cmd.exe /C echo%\" ESCAPE '\\' OR ParentCommandLine LIKE \"% > \\\\.\\\\pipe%\" ESCAPE '\\')) OR ((CommandLine LIKE \"%cmd.exe /c echo%\" ESCAPE '\\' OR CommandLine LIKE \"%> \\\\.\\\\pipe%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\whoami.exe%\" ESCAPE '\\') AND ParentImage LIKE \"%\\\\dllhost.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\runonce.exe\" ESCAPE '\\' AND ParentCommandLine LIKE \"%\\\\runonce.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Cmd.exe CommandLine Path Traversal",
        "description": "detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentCommandLine LIKE \"%cmd%\" ESCAPE '\\' AND ParentCommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%/../../%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Control Panel Items",
        "description": "Detects the malicious use of a control panel item",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%.cpl\" ESCAPE '\\' AND NOT ((CommandLine LIKE \"%\\\\System32\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%\\%System\\%%\" ESCAPE '\\'))) OR (Image LIKE \"%\\\\reg.exe\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\' AND (CommandLine LIKE \"%CurrentVersion\\\\Control Panel\\\\CPLs%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Copying Sensitive Files with Credential Data",
        "description": "Files with well-known filenames (sensitive files with credential data) copying",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\esentutl.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%vss%\" ESCAPE '\\' OR CommandLine LIKE \"% /m %\" ESCAPE '\\' OR CommandLine LIKE \"% /y %\" ESCAPE '\\')) OR (CommandLine LIKE \"%\\\\windows\\\\ntds\\\\ntds.dit%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\config\\\\sam%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\config\\\\security%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\config\\\\system %\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\repair\\\\sam%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\repair\\\\system%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\repair\\\\security%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\config\\\\RegBack\\\\sam%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\config\\\\RegBack\\\\system%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\config\\\\RegBack\\\\security%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Dropping Of Password Filter DLL",
        "description": "Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\Lsa%\" ESCAPE '\\' AND CommandLine LIKE \"%scecli\\\\0%\" ESCAPE '\\' AND CommandLine LIKE \"%reg add%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Fireball Archer Install",
        "description": "Detects Archer malware invocation via rundll32",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%rundll32.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%InstallArcherSvc%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Maze Ransomware",
        "description": "Detects specific process characteristics of Maze ransomware word document droppers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((ParentImage LIKE \"%\\\\WINWORD.exe\" ESCAPE '\\') AND (Image LIKE \"%.tmp\" ESCAPE '\\')) OR (Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\Temp\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%shadowcopy delete\" ESCAPE '\\') OR (CommandLine LIKE \"%shadowcopy delete\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\..\\\\..\\\\system32%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Snatch Ransomware",
        "description": "Detects specific process characteristics of Snatch ransomware word document droppers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%shutdown /r /f /t 00%\" ESCAPE '\\' OR CommandLine LIKE \"%net stop SuperBackupMan%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Data Compressed - rar.exe",
        "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\rar.exe\" ESCAPE '\\' AND CommandLine LIKE \"% a %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Xwizard DLL Sideloading",
        "description": "Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\xwizard.exe\" ESCAPE '\\' AND NOT (Image LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "DNSCat2 Powershell Implementation Detection Via Process Creation",
        "description": "The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally.",
        "rule": [
            "SELECT * FROM (SELECT *,count(Image) AS agg FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\nslookup.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\nslookup.exe\" ESCAPE '\\') GROUP BY ParentImage) WHERE agg > 100"
        ]
    },
    {
        "title": "DNS Exfiltration and Tunneling Tools Execution",
        "description": "Well-known DNS Exfiltration tools execution",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\iodine.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\dnscat2%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Encoded FromBase64String",
        "description": "Detects a base64 encoded FromBase64String keyword in a process command line",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%OjpGcm9tQmFzZTY0U3RyaW5n%\" ESCAPE '\\' OR CommandLine LIKE \"%o6RnJvbUJhc2U2NFN0cmluZ%\" ESCAPE '\\' OR CommandLine LIKE \"%6OkZyb21CYXNlNjRTdHJpbm%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Encoded IEX",
        "description": "Detects a base64 encoded IEX command string in a process command line",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%SUVYIChb%\" ESCAPE '\\' OR CommandLine LIKE \"%lFWCAoW%\" ESCAPE '\\' OR CommandLine LIKE \"%JRVggKF%\" ESCAPE '\\' OR CommandLine LIKE \"%aWV4IChb%\" ESCAPE '\\' OR CommandLine LIKE \"%lleCAoW%\" ESCAPE '\\' OR CommandLine LIKE \"%pZXggKF%\" ESCAPE '\\' OR CommandLine LIKE \"%aWV4IChOZX%\" ESCAPE '\\' OR CommandLine LIKE \"%lleCAoTmV3%\" ESCAPE '\\' OR CommandLine LIKE \"%pZXggKE5ld%\" ESCAPE '\\' OR CommandLine LIKE \"%SUVYIChOZX%\" ESCAPE '\\' OR CommandLine LIKE \"%lFWCAoTmV3%\" ESCAPE '\\' OR CommandLine LIKE \"%JRVggKE5ld%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "COMPlus_ETWEnabled Command Line Arguments",
        "description": "Potential adversaries stopping ETW providers recording loaded .NET assemblies.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%COMPlus\\_ETWEnabled=0%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Disable of ETW Trace",
        "description": "Detects a command that clears or disables any ETW trace log which could indicate a logging evasion.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%cl%\" ESCAPE '\\' AND CommandLine LIKE \"%/Trace%\" ESCAPE '\\') OR (CommandLine LIKE \"%clear-log%\" ESCAPE '\\' AND CommandLine LIKE \"%/Trace%\" ESCAPE '\\') OR (CommandLine LIKE \"%sl%\" ESCAPE '\\' AND CommandLine LIKE \"%/e:false%\" ESCAPE '\\') OR (CommandLine LIKE \"%set-log%\" ESCAPE '\\' AND CommandLine LIKE \"%/e:false%\" ESCAPE '\\') OR (CommandLine LIKE \"%Remove-EtwTraceProvider%\" ESCAPE '\\' AND CommandLine LIKE \"%EventLog-Microsoft-Windows-WMI-Activity-Trace%\" ESCAPE '\\' AND CommandLine LIKE \"%{1418ef04-b0b4-4623-bf7e-d74ab47bbdaa}%\" ESCAPE '\\') OR (CommandLine LIKE \"%Set-EtwTraceProvider%\" ESCAPE '\\' AND CommandLine LIKE \"%{1418ef04-b0b4-4623-bf7e-d74ab47bbdaa}%\" ESCAPE '\\' AND CommandLine LIKE \"%EventLog-Microsoft-Windows-WMI-Activity-Trace%\" ESCAPE '\\' AND CommandLine LIKE \"%0x11%\" ESCAPE '\\') OR (CommandLine LIKE \"%logman%\" ESCAPE '\\' AND CommandLine LIKE \"%update%\" ESCAPE '\\' AND CommandLine LIKE \"%trace%\" ESCAPE '\\' AND CommandLine LIKE \"%--p%\" ESCAPE '\\' AND CommandLine LIKE \"%-ets%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Exfiltration and Tunneling Tools Execution",
        "description": "Execution of well known tools for data exfiltration and tunneling",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\plink.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\socat.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\stunnel.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\httptunnel.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Exploit for CVE-2015-1641",
        "description": "Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\WINWORD.EXE\" ESCAPE '\\' AND Image LIKE \"%\\\\MicroScMgmt.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Exploit for CVE-2017-0261",
        "description": "Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\WINWORD.EXE\" ESCAPE '\\' AND Image LIKE \"%\\\\FLTLDR.exe%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Droppers Exploiting CVE-2017-11882",
        "description": "Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\EQNEDT32.EXE\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Exploit for CVE-2017-8759",
        "description": "Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\WINWORD.EXE\" ESCAPE '\\' AND Image LIKE \"%\\\\csc.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Exploiting SetupComplete.cmd CVE-2019-1378",
        "description": "Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentCommandLine LIKE \"%\\\\cmd.exe%\" ESCAPE '\\' AND ParentCommandLine LIKE \"%/c%\" ESCAPE '\\' AND ParentCommandLine LIKE \"%C:\\\\Windows\\\\Setup\\\\Scripts\\\\%\" ESCAPE '\\' AND (ParentCommandLine LIKE \"%SetupComplete.cmd\" ESCAPE '\\' OR ParentCommandLine LIKE \"%PartnerSetupComplete.cmd\" ESCAPE '\\')) AND NOT ((Image LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\WinSxS\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\Setup\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Exploiting CVE-2019-1388",
        "description": "Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\consent.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\iexplore.exe\" ESCAPE '\\' AND CommandLine LIKE \"% http%\" ESCAPE '\\' AND (IntegrityLevel = \"System\" OR (User LIKE \"NT AUTHORITY\\\\SYSTEM%\" ESCAPE '\\' OR User LIKE \"AUTORITE NT\\\\Sys%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Exploited CVE-2020-10189 Zoho ManageEngine",
        "description": "Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%DesktopCentral\\_Server\\\\jre\\\\bin\\\\java.exe\" ESCAPE '\\' AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bitsadmin.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious PrinterPorts Creation (CVE-2020-1048)",
        "description": "Detects new commands that add new printer port which point to suspicious file",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((EventID = \"1\" AND (CommandLine LIKE \"%Add-PrinterPort -Name%\" ESCAPE '\\') AND (CommandLine LIKE \"%.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%.dll%\" ESCAPE '\\' OR CommandLine LIKE \"%.bat%\" ESCAPE '\\')) OR (CommandLine LIKE \"%Generic / Text Only%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "DNS RCE CVE-2020-1350",
        "description": "Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\System32\\\\dns.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\System32\\\\werfault.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\System32\\\\conhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\System32\\\\dnscmd.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "SystemNightmare Exploitation Script Execution",
        "description": "Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%printnightmare.gentilkiwi.com%\" ESCAPE '\\' OR CommandLine LIKE \"% /user:gentilguest %\" ESCAPE '\\' OR CommandLine LIKE \"%Kiwi Legit Printer%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "File or Folder Permissions Modifications",
        "description": "Detects a file or folder's permissions being modified.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((Image LIKE \"%\\\\takeown.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cacls.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\icacls.exe\" ESCAPE '\\') AND CommandLine LIKE \"%/grant%\" ESCAPE '\\') OR (Image LIKE \"%\\\\attrib.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-r%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Grabbing Sensitive Hives via Reg Utility",
        "description": "Dump sam, system or security hives using REG.exe utility",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\reg.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%save%\" ESCAPE '\\' OR CommandLine LIKE \"%export%\" ESCAPE '\\' OR CommandLine LIKE \"%ave%\" ESCAPE '\\' OR CommandLine LIKE \"%eport%\" ESCAPE '\\') AND (CommandLine LIKE \"%hklm%\" ESCAPE '\\' OR CommandLine LIKE \"%hkm%\" ESCAPE '\\' OR CommandLine LIKE \"%hkey\\_local\\_machine%\" ESCAPE '\\' OR CommandLine LIKE \"%hkey\\_ocal\\_machine%\" ESCAPE '\\' OR CommandLine LIKE \"%hkey\\_loca\\_machine%\" ESCAPE '\\' OR CommandLine LIKE \"%hkey\\_oca\\_machine%\" ESCAPE '\\') AND (CommandLine LIKE \"%\\\\system\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\sam\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\security\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\ystem\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\sytem\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\ytem\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\am\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\ecurity\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "ADCSPwn Hack Tool",
        "description": "Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% --adcs %\" ESCAPE '\\' AND CommandLine LIKE \"% --port %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Bloodhound and Sharphound Hack Tool",
        "description": "Detects command line parameters used by Bloodhound and Sharphound hack tools",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\Bloodhound.exe%\" ESCAPE '\\' OR Image LIKE \"%\\\\SharpHound.exe%\" ESCAPE '\\') OR (CommandLine LIKE \"% -CollectionMethod All %\" ESCAPE '\\' OR CommandLine LIKE \"%.exe -c All -d %\" ESCAPE '\\' OR CommandLine LIKE \"%Invoke-Bloodhound%\" ESCAPE '\\' OR CommandLine LIKE \"%Get-BloodHoundData%\" ESCAPE '\\') OR (CommandLine LIKE \"% -JsonFolder %\" ESCAPE '\\' AND CommandLine LIKE \"% -ZipFileName %\" ESCAPE '\\') OR (CommandLine LIKE \"% DCOnly %\" ESCAPE '\\' AND CommandLine LIKE \"% --NoSaveCache %\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Koadic Execution",
        "description": "Detects command line parameters used by Koadic hack tool",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/q%\" ESCAPE '\\' AND CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%chcp%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Rubeus Hack Tool",
        "description": "Detects command line parameters used by Rubeus hack tool",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"% asreproast %\" ESCAPE '\\' OR CommandLine LIKE \"% dump /service:krbtgt %\" ESCAPE '\\' OR CommandLine LIKE \"% kerberoast %\" ESCAPE '\\' OR CommandLine LIKE \"% createnetonly /program:%\" ESCAPE '\\' OR CommandLine LIKE \"% ptt /ticket:%\" ESCAPE '\\' OR CommandLine LIKE \"% /impersonateuser:%\" ESCAPE '\\' OR CommandLine LIKE \"% renew /ticket:%\" ESCAPE '\\' OR CommandLine LIKE \"% asktgt /user:%\" ESCAPE '\\' OR CommandLine LIKE \"% harvest /interval:%\" ESCAPE '\\' OR CommandLine LIKE \"% s4u /user:%\" ESCAPE '\\' OR CommandLine LIKE \"% s4u /ticket:%\" ESCAPE '\\' OR CommandLine LIKE \"% hash /password:%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "SecurityXploded Tool",
        "description": "Detects the execution of SecurityXploded Tools",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Company = \"SecurityXploded\" OR Image LIKE \"%PasswordDump.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"%PasswordDump.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "HH.exe Execution",
        "description": "Identifies usage of hh.exe executing recently modified .chm files.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\hh.exe\" ESCAPE '\\' AND CommandLine LIKE \"%.chm%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CreateMiniDump Hacktool",
        "description": "Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\CreateMiniDump.exe%\" ESCAPE '\\' OR Imphash = \"4a07f944a83e8a7c2525efa35dd30e2f\"))"
        ]
    },
    {
        "title": "UAC Bypass Tool UACMe",
        "description": "Detects execution of UACMe (a tool used for UAC bypass) via default PE metadata",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Product = \"UACMe\" OR Company = \"REvol Corp\" OR OriginalFileName = \"Akagi.exe\"))"
        ]
    },
    {
        "title": "HTML Help Shell Spawn",
        "description": "Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"C:\\\\Windows\\\\hh.exe\" ESCAPE '\\' AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious HWP Sub Processes",
        "description": "Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\Hwp.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\gbb.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Impacket Tool Execution",
        "description": "Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\goldenPac%\" ESCAPE '\\' OR Image LIKE \"%\\\\karmaSMB%\" ESCAPE '\\' OR Image LIKE \"%\\\\kintercept%\" ESCAPE '\\' OR Image LIKE \"%\\\\ntlmrelayx%\" ESCAPE '\\' OR Image LIKE \"%\\\\rpcdump%\" ESCAPE '\\' OR Image LIKE \"%\\\\samrdump%\" ESCAPE '\\' OR Image LIKE \"%\\\\secretsdump%\" ESCAPE '\\' OR Image LIKE \"%\\\\smbexec%\" ESCAPE '\\' OR Image LIKE \"%\\\\smbrelayx%\" ESCAPE '\\' OR Image LIKE \"%\\\\wmiexec%\" ESCAPE '\\' OR Image LIKE \"%\\\\wmipersist%\" ESCAPE '\\') OR (Image LIKE \"%\\\\atexec\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\dcomexec\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\dpapi\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\findDelegation\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\GetADUsers\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\GetNPUsers\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\getPac\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\getST\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\getTGT\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\GetUserSPNs\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\ifmap\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mimikatz\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\netview\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\nmapAnswerMachine\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\opdump\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\psexec\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rdp\\_check\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sambaPipe\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\smbclient\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\smbserver\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sniffer\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sniff\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\split\\_windows.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\ticketer\\_windows.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Impacket Lateralization Detection",
        "description": "Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%cmd.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%&1%\" ESCAPE '\\' AND (((ParentImage LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\mmc.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\explorer.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\services.exe\" ESCAPE '\\') AND CommandLine LIKE \"%/Q%\" ESCAPE '\\' AND CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\\\\\127.0.0.1\\\\%\" ESCAPE '\\') OR ((ParentCommandLine LIKE \"%svchost.exe -k netsvcs%\" ESCAPE '\\' OR ParentCommandLine LIKE \"%taskeng.exe%\" ESCAPE '\\') AND CommandLine LIKE \"%/C%\" ESCAPE '\\' AND CommandLine LIKE \"%Windows\\\\Temp\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Indirect Command Execution",
        "description": "Detect indirect command execution via Program Compatibility Assistant (pcalua.exe or forfiles.exe).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\pcalua.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\forfiles.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Indirect Command Execution By Program Compatibility Wizard",
        "description": "Detect indirect command execution via Program Compatibility Assistant pcwrun.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\pcwrun.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Debugger Registration Cmdline",
        "description": "Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%\\\\CurrentVersion\\\\Image File Execution Options\\\\%\" ESCAPE '\\' AND (CommandLine LIKE \"%sethc.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%utilman.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%osk.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%magnify.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%narrator.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%displayswitch.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%atbroker.exe%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Interactive AT Job",
        "description": "Detect an interactive AT job, which may be used as a form of privilege escalation.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\at.exe\" ESCAPE '\\' AND CommandLine LIKE \"%interactive%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "MSHTA Spwaned by SVCHOST",
        "description": "Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\svchost.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Local Accounts Discovery",
        "description": "Local accounts, System Owner/User discovery using operating systems utilities",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\' OR (Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' AND CommandLine LIKE \"%useraccount%\" ESCAPE '\\' AND CommandLine LIKE \"%get%\" ESCAPE '\\') OR (Image LIKE \"%\\\\quser.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\qwinsta.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\cmdkey.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/list%\" ESCAPE '\\') OR (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%dir %\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Users\\\\%\" ESCAPE '\\')) AND NOT ((CommandLine LIKE \"% rmdir %\" ESCAPE '\\'))) OR (((Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"%user%\" ESCAPE '\\') AND NOT ((CommandLine LIKE \"%/domain%\" ESCAPE '\\' OR CommandLine LIKE \"%/add%\" ESCAPE '\\' OR CommandLine LIKE \"%/delete%\" ESCAPE '\\' OR CommandLine LIKE \"%/active%\" ESCAPE '\\' OR CommandLine LIKE \"%/expires%\" ESCAPE '\\' OR CommandLine LIKE \"%/passwordreq%\" ESCAPE '\\' OR CommandLine LIKE \"%/scriptpath%\" ESCAPE '\\' OR CommandLine LIKE \"%/times%\" ESCAPE '\\' OR CommandLine LIKE \"%/workstations%\" ESCAPE '\\')))))"
        ]
    },
    {
        "title": "Monitoring Winget For LOLbin Execution",
        "description": "Adversaries can abuse winget to download payloads remotely and execute them without touching disk. Winget will be included by default in Windows 10 and is already available in Windows 10 insider programs. The manifest option enables you to install an application by passing in a YAML file directly to the client. Winget can be used to download and install exe's, msi, msix files later.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%.%(_i)winget install (--m|-m).%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "LSASS Memory Dumping",
        "description": "Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials. Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((CommandLine LIKE \"%lsass%\" ESCAPE '\\' AND CommandLine LIKE \"%.dmp%\" ESCAPE '\\') AND NOT (Image LIKE \"%\\\\werfault.exe\" ESCAPE '\\')) OR (Image LIKE \"%\\\\procdump%\" ESCAPE '\\' AND Image LIKE \"%.exe\" ESCAPE '\\' AND CommandLine LIKE \"%lsass%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Conti Volume Shadow Listing",
        "description": "Detects a command used by conti to find volume shadow backups",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%vssadmin list shadows%\" ESCAPE '\\' AND CommandLine LIKE \"%log.txt%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Conti Volume Shadow Listing",
        "description": "Detects a command used by conti to exfiltrate NTDS",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%7za.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\C$\\\\temp\\\\log.zip%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Conti Volume Shadow Listing",
        "description": "Detects a command used by conti to access volume shadow backups",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%\\\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy%\" ESCAPE '\\' AND (CommandLine LIKE \"%\\\\NTDS.dit%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\SYSTEM%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\SECURITY%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\tmp\\\\log%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Dridex Process Pattern",
        "description": "Detects typical Dridex process patterns",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\Users\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Desktop\\\\%\" ESCAPE '\\') OR (ParentImage LIKE \"%\\\\svchost.exe\" ESCAPE '\\' AND EventID = \"1\" AND ((Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\' AND CommandLine LIKE \"%all%\" ESCAPE '\\') OR ((Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"%view%\" ESCAPE '\\')))))"
        ]
    },
    {
        "title": "DTRACK Process Creation",
        "description": "Detects specific process parameters as seen in DTRACK infections",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% echo EEEE > %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Emotet Process Creation",
        "description": "Detects all Emotet like process executions that are not covered by the more generic rules",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"% -e% PAA%\" ESCAPE '\\' OR CommandLine LIKE \"%JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ%\" ESCAPE '\\' OR CommandLine LIKE \"%QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA%\" ESCAPE '\\' OR CommandLine LIKE \"%kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA%\" ESCAPE '\\' OR CommandLine LIKE \"%IgAoACcAKgAnACkAOwAkA%\" ESCAPE '\\' OR CommandLine LIKE \"%IAKAAnACoAJwApADsAJA%\" ESCAPE '\\' OR CommandLine LIKE \"%iACgAJwAqACcAKQA7ACQA%\" ESCAPE '\\' OR CommandLine LIKE \"%JABGAGwAeAByAGgAYwBmAGQ%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Formbook Process Creation",
        "description": "Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentCommandLine LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR ParentCommandLine LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\') AND (ParentCommandLine LIKE \"%.exe\" ESCAPE '\\') AND CommandLine LIKE \"%C:\\\\Users\\\\%\" ESCAPE '\\' AND ((CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%del%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\') OR (CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%del%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Desktop\\\\%\" ESCAPE '\\') OR (CommandLine LIKE \"%/C%\" ESCAPE '\\' AND CommandLine LIKE \"%type nul >%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Desktop\\\\%\" ESCAPE '\\')) AND CommandLine LIKE \"%.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "QBot Process Creation",
        "description": "Detects QBot like process executions",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((ParentImage LIKE \"%\\\\WinRAR.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\') OR CommandLine LIKE \"% /c ping.exe -n 6 127.0.0.1 & type %\" ESCAPE '\\') OR (CommandLine LIKE \"%regsvr32.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\ProgramData%\" ESCAPE '\\' AND CommandLine LIKE \"%.tmp%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Ryuk Ransomware",
        "description": "Detects Ryuk ransomware activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%Microsoft\\\\Windows\\\\CurrentVersion\\\\Run%\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\users\\\\Public\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "WScript or CScript Dropper",
        "description": "Detects wscript/cscript executions of scripts located in user directories",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%C:\\\\Users\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\ProgramData\\\\%\" ESCAPE '\\') AND (CommandLine LIKE \"%.jse%\" ESCAPE '\\' OR CommandLine LIKE \"%.vbe%\" ESCAPE '\\' OR CommandLine LIKE \"%.js%\" ESCAPE '\\' OR CommandLine LIKE \"%.vba%\" ESCAPE '\\' OR CommandLine LIKE \"%.vbs%\" ESCAPE '\\')) AND NOT (ParentImage LIKE \"%\\\\winzip%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Trickbot Malware Recon Activity",
        "description": "Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\cmd.exe\" ESCAPE '\\') AND (Image LIKE \"%\\\\nltest.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%/domain\\_trusts /all\\_trusts%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Trickbot Malware Activity",
        "description": "Detects Trickbot malware process tree pattern in which rundll32.exe is parent of wermgr.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\wermgr.exe\" ESCAPE '\\') AND (ParentImage LIKE \"%\\\\rundll32.exe\" ESCAPE '\\') AND (ParentCommandLine LIKE \"%DllRegisterServer%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "WannaCry Ransomware",
        "description": "Detects WannaCry ransomware activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\tasksche.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mssecsvc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\taskdl.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\taskhsvc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\taskse.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\111.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\lhdfrgui.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\diskpart.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\linuxnew.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wannacry.exe\" ESCAPE '\\') OR Image LIKE \"%WanaDecryptor%\" ESCAPE '\\' OR (CommandLine LIKE \"%icacls%\" ESCAPE '\\' AND CommandLine LIKE \"%/grant%\" ESCAPE '\\' AND CommandLine LIKE \"%Everyone:F%\" ESCAPE '\\' AND CommandLine LIKE \"%/T%\" ESCAPE '\\' AND CommandLine LIKE \"%/C%\" ESCAPE '\\' AND CommandLine LIKE \"%/Q%\" ESCAPE '\\') OR (CommandLine LIKE \"%bcdedit%\" ESCAPE '\\' AND CommandLine LIKE \"%/set%\" ESCAPE '\\' AND CommandLine LIKE \"%{default}%\" ESCAPE '\\' AND CommandLine LIKE \"%recoveryenabled%\" ESCAPE '\\' AND CommandLine LIKE \"%no%\" ESCAPE '\\') OR (CommandLine LIKE \"%wbadmin%\" ESCAPE '\\' AND CommandLine LIKE \"%delete%\" ESCAPE '\\' AND CommandLine LIKE \"%catalog%\" ESCAPE '\\' AND CommandLine LIKE \"%-quiet%\" ESCAPE '\\') OR CommandLine LIKE \"%@Please\\_Read\\_Me@.txt%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Adwind RAT / JRAT",
        "description": "Detects javaw.exe in AppData folder as used by Adwind / JRAT",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%\\\\AppData\\\\Roaming\\\\Oracle%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\java%\" ESCAPE '\\' AND CommandLine LIKE \"%.exe %\" ESCAPE '\\') OR (CommandLine LIKE \"%cscript.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%Retrive%\" ESCAPE '\\' AND CommandLine LIKE \"%.vbs %\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Usage of the Manage-bde.wsf Script",
        "description": "Detects a usage of the manage-bde.wsf script that may indicate an attempt of proxy execution from script",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%cscript%\" ESCAPE '\\' AND CommandLine LIKE \"%manage-bde.wsf%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "MavInject Process Injection",
        "description": "Detects process injection using the signed Windows tool Mavinject32.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% /INJECTRUNNING %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Meterpreter or Cobalt Strike Getsystem Service Start",
        "description": "Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\services.exe\" ESCAPE '\\' AND ((CommandLine LIKE \"%cmd%\" ESCAPE '\\' AND CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%echo%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (CommandLine LIKE \"%\\%COMSPEC\\%%\" ESCAPE '\\' AND CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%echo%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (CommandLine LIKE \"%cmd.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%echo%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\pipe\\\\%\" ESCAPE '\\') OR (CommandLine LIKE \"%rundll32%\" ESCAPE '\\' AND CommandLine LIKE \"%.dll,a%\" ESCAPE '\\' AND CommandLine LIKE \"%/p:%\" ESCAPE '\\'))) AND NOT (CommandLine LIKE \"%MpCmdRun%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Mimikatz Command Line",
        "description": "Detection well-known mimikatz command line arguments",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%DumpCreds%\" ESCAPE '\\' OR CommandLine LIKE \"%invoke-mimikatz%\" ESCAPE '\\') OR ((CommandLine LIKE \"%rpc%\" ESCAPE '\\' OR CommandLine LIKE \"%token%\" ESCAPE '\\' OR CommandLine LIKE \"%crypto%\" ESCAPE '\\' OR CommandLine LIKE \"%dpapi%\" ESCAPE '\\' OR CommandLine LIKE \"%sekurlsa%\" ESCAPE '\\' OR CommandLine LIKE \"%kerberos%\" ESCAPE '\\' OR CommandLine LIKE \"%lsadump%\" ESCAPE '\\' OR CommandLine LIKE \"%privilege%\" ESCAPE '\\' OR CommandLine LIKE \"%process%\" ESCAPE '\\') AND (CommandLine LIKE \"%::%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "MMC Spawning Windows Shell",
        "description": "Detects a Windows command line executable started from MMC",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\mmc.exe\" ESCAPE '\\' AND ((Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\reg.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\BITSADMIN%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Mouse Lock Credential Gathering",
        "description": "In Kaspersky's 2020 Incident Response Analyst Report they listed legitimate tool \"Mouse Lock\" as being used for both credential access and collection in security incidents.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Product LIKE \"%Mouse Lock%\" ESCAPE '\\' OR Company LIKE \"%Misc314%\" ESCAPE '\\' OR CommandLine LIKE \"%Mouse Lock\\_%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Mshta JavaScript Execution",
        "description": "Identifies suspicious mshta.exe commands.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' AND CommandLine LIKE \"%javascript%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "MSHTA Spawning Windows Shell",
        "description": "Detects a Windows command line executable started from MSHTA",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\mshta.exe\" ESCAPE '\\' AND ((Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\reg.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\BITSADMIN%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Quick Execution of a Series of Suspicious Commands",
        "description": "Detects multiple suspicious process in a limited timeframe",
        "rule": [
            "SELECT * FROM (SELECT *,count(*) AS agg FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%arp.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%at.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%attrib.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%cscript.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%dsquery.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%hostname.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%ipconfig.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%mimikatz.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%nbtstat.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%net.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%netsh.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%nslookup.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%ping.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%quser.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%qwinsta.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%reg.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%runas.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%sc.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%schtasks.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%ssh.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%systeminfo.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%taskkill.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%telnet.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%tracert.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%wscript.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%xcopy.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%pscp.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%copy.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%robocopy.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%certutil.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%vssadmin.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%powershell.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%wevtutil.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%psexec.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%bcedit.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%wbadmin.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%icacls.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%diskpart.exe%\" ESCAPE '\\')) GROUP BY MachineName) WHERE agg > 5"
        ]
    },
    {
        "title": "Netsh RDP Port Opening",
        "description": "Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%netsh%\" ESCAPE '\\' AND ((CommandLine LIKE \"%firewall add portopening%\" ESCAPE '\\' AND CommandLine LIKE \"%tcp 3389%\" ESCAPE '\\') OR (CommandLine LIKE \"%advfirewall firewall add rule%\" ESCAPE '\\' AND CommandLine LIKE \"%action=allow%\" ESCAPE '\\' AND CommandLine LIKE \"%protocol=TCP%\" ESCAPE '\\' AND CommandLine LIKE \"%localport=3389%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Netsh Port or Application Allowed",
        "description": "Allow Incoming Connections by Port or Application on Windows Firewall",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\netsh.exe\" ESCAPE '\\' AND CommandLine LIKE \"%firewall%\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Netsh Program Allowed with Suspcious Location",
        "description": "Detects Netsh commands that allows a suspcious application location on Windows Firewall",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (EventID = \"1\" AND Image LIKE \"%\\\\netsh.exe\" ESCAPE '\\' AND CommandLine LIKE \"%firewall%\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\' AND (CommandLine LIKE \"%allowedprogram%\" ESCAPE '\\' OR (CommandLine LIKE \"%advfirewall%\" ESCAPE '\\' AND CommandLine LIKE \"%rule%\" ESCAPE '\\' AND CommandLine LIKE \"%action=allow%\" ESCAPE '\\' AND CommandLine LIKE \"%program=%\" ESCAPE '\\'))) AND ((CommandLine LIKE \"%\\%TEMP\\%%\" ESCAPE '\\' OR CommandLine LIKE \"%:\\\\RECYCLER\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\$Recycle.bin\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%:\\\\SystemVolumeInformation\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Windows\\\\Temp\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Temp\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Users\\\\Public\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Users\\\\Default\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Users\\\\Desktop\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\Downloads\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\Temporary Internet Files\\\\Content.Outlook\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\Local Settings\\\\Temporary Internet Files\\\\%\" ESCAPE '\\') OR (CommandLine LIKE \"C:\\\\Windows\\\\Tasks\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"C:\\\\Windows\\\\debug\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"C:\\\\Windows\\\\fonts\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"C:\\\\Windows\\\\help\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"C:\\\\Windows\\\\drivers\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"C:\\\\Windows\\\\addins\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"C:\\\\Windows\\\\cursors\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"C:\\\\Windows\\\\system32\\\\tasks\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"\\%Public\\%\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Capture a Network Trace with netsh.exe",
        "description": "Detects capture a network trace via netsh.exe trace functionality",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%netsh%\" ESCAPE '\\' AND CommandLine LIKE \"%trace%\" ESCAPE '\\' AND CommandLine LIKE \"%start%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Netsh Port Forwarding",
        "description": "Detects netsh commands that configure a port forwarding (PortProxy)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\netsh.exe\" ESCAPE '\\' AND ((CommandLine LIKE \"%interface%\" ESCAPE '\\' AND CommandLine LIKE \"%portproxy%\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\' AND CommandLine LIKE \"%v4tov4%\" ESCAPE '\\') OR (CommandLine LIKE \"%connectp%\" ESCAPE '\\' AND CommandLine LIKE \"%listena%\" ESCAPE '\\' AND CommandLine LIKE \"%c=%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Netsh RDP Port Forwarding",
        "description": "Detects netsh commands that configure a port forwarding of port 3389 used for RDP",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\netsh.exe\" ESCAPE '\\' AND CommandLine LIKE \"%i%\" ESCAPE '\\' AND CommandLine LIKE \"% p%\" ESCAPE '\\' AND CommandLine LIKE \"%=3389%\" ESCAPE '\\' AND CommandLine LIKE \"% c%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Harvesting of Wifi Credentials Using netsh.exe",
        "description": "Detect the harvesting of wifi credentials using netsh.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\netsh.exe\" ESCAPE '\\' AND CommandLine LIKE \"%wlan%\" ESCAPE '\\' AND CommandLine LIKE \"% s%\" ESCAPE '\\' AND CommandLine LIKE \"% p%\" ESCAPE '\\' AND CommandLine LIKE \"% k%\" ESCAPE '\\' AND CommandLine LIKE \"%=clear%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Network Sniffing",
        "description": "Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\tshark.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-i%\" ESCAPE '\\') OR Image LIKE \"%\\\\windump.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows Network Enumeration",
        "description": "Identifies attempts to enumerate hosts in a network using the built-in Windows net.exe tool.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"%view%\" ESCAPE '\\') AND NOT (CommandLine LIKE \"%\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Net.exe User Account Creation",
        "description": "Identifies creation of local users via the net.exe command.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"%user%\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "New Service Creation",
        "description": "Detects creation of a new service.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\sc.exe\" ESCAPE '\\' AND CommandLine LIKE \"%create%\" ESCAPE '\\' AND CommandLine LIKE \"%binpath%\" ESCAPE '\\') OR (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND CommandLine LIKE \"%new-service%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Recon Activity with NLTEST",
        "description": "Detects nltest commands that can be used for information discovery",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\nltest.exe\" ESCAPE '\\' AND ((CommandLine LIKE \"%/server%\" ESCAPE '\\' AND CommandLine LIKE \"%/query%\" ESCAPE '\\') OR (CommandLine LIKE \"%/dclist:%\" ESCAPE '\\' OR CommandLine LIKE \"%/parentdomain%\" ESCAPE '\\' OR CommandLine LIKE \"%/domain\\_trusts%\" ESCAPE '\\' OR CommandLine LIKE \"%/trusted\\_domains%\" ESCAPE '\\' OR CommandLine LIKE \"%/user%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Non Interactive PowerShell",
        "description": "Detects non-interactive PowerShell activity by looking at powershell.exe with not explorer.exe as a parent.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND NOT ((ParentImage LIKE \"%\\\\explorer.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\CompatTelRunner.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Non-privileged Usage of Reg or Powershell",
        "description": "Search for usage of reg or Powershell by non-priveleged users to modify service configuration in registry",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND IntegrityLevel = \"Medium\" AND ((CommandLine LIKE \"%reg%\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\') OR (CommandLine LIKE \"%powershell%\" ESCAPE '\\' AND (CommandLine LIKE \"%set-itemproperty%\" ESCAPE '\\' OR CommandLine LIKE \"% sp %\" ESCAPE '\\' OR CommandLine LIKE \"%new-itemproperty%\" ESCAPE '\\'))) AND CommandLine LIKE \"%ControlSet%\" ESCAPE '\\' AND CommandLine LIKE \"%Services%\" ESCAPE '\\' AND (CommandLine LIKE \"%ImagePath%\" ESCAPE '\\' OR CommandLine LIKE \"%FailureCommand%\" ESCAPE '\\' OR CommandLine LIKE \"%ServiceDLL%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Microsoft Office Product Spawning Windows Shell",
        "description": "Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\WINWORD.EXE\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\EXCEL.EXE\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\POWERPNT.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\MSPUB.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\VISIO.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\OUTLOOK.EXE\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\MSACCESS.EXE\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\EQNEDT32.EXE\" ESCAPE '\\') AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\scrcons.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\hh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\forfiles.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\scriptrunner.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mftrace.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\AppVLP.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\msbuild.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "MS Office Product Spawning Exe in User Dir",
        "description": "Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((ParentImage LIKE \"%\\\\WINWORD.EXE\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\EXCEL.EXE\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\POWERPNT.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\MSPUB.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\VISIO.exe\" ESCAPE '\\') AND Image LIKE \"C:\\\\users\\\\%\" ESCAPE '\\' AND Image LIKE \"%.exe\" ESCAPE '\\') AND NOT (Image LIKE \"%\\\\Teams.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Executable Used by PlugX in Uncommon Location",
        "description": "Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((((((((((((Image LIKE \"%\\\\CamMute.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\Lenovo\\\\Communication Utility\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Lenovo\\\\Communications Utility\\\\%\" ESCAPE '\\'))) OR (Image LIKE \"%\\\\chrome\\_frame\\_helper.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\Google\\\\Chrome\\\\application\\\\%\" ESCAPE '\\'))) OR (Image LIKE \"%\\\\dvcemumanager.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\Microsoft Device Emulator\\\\%\" ESCAPE '\\'))) OR (Image LIKE \"%\\\\Gadget.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\Windows Media Player\\\\%\" ESCAPE '\\'))) OR (Image LIKE \"%\\\\hcc.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\HTML Help Workshop\\\\%\" ESCAPE '\\'))) OR (Image LIKE \"%\\\\hkcmd.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\System32\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\SysNative\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\SysWowo64\\\\%\" ESCAPE '\\')))) OR (Image LIKE \"%\\\\Mc.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\Microsoft Visual Studio%\" ESCAPE '\\' OR Image LIKE \"%\\\\Microsoft SDK%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows Kit%\" ESCAPE '\\')))) OR (Image LIKE \"%\\\\MsMpEng.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\Microsoft Security Client\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows Defender\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\AntiMalware\\\\%\" ESCAPE '\\')))) OR (Image LIKE \"%\\\\msseces.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\Microsoft Security Center\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Microsoft Security Client\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Microsoft Security Essentials\\\\%\" ESCAPE '\\')))) OR (Image LIKE \"%\\\\OInfoP11.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\Common Files\\\\Microsoft Shared\\\\%\" ESCAPE '\\'))) OR (Image LIKE \"%\\\\OleView.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\Microsoft Visual Studio%\" ESCAPE '\\' OR Image LIKE \"%\\\\Microsoft SDK%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows Kit%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows Resource Kit\\\\%\" ESCAPE '\\')))) OR (Image LIKE \"%\\\\rc.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\Microsoft Visual Studio%\" ESCAPE '\\' OR Image LIKE \"%\\\\Microsoft SDK%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows Kit%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows Resource Kit\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Microsoft.NET\\\\%\" ESCAPE '\\')))))"
        ]
    },
    {
        "title": "Possible Applocker Bypass",
        "description": "Detects execution of executables that can be used to bypass Applocker whitelisting",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%\\\\msdt.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\installutil.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\regsvcs.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\regasm.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\msbuild.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\ieexec.exe%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Possible Privilege Escalation via Service Permissions Weakness",
        "description": "Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND IntegrityLevel = \"Medium\" AND CommandLine LIKE \"%ControlSet%\" ESCAPE '\\' AND CommandLine LIKE \"%services%\" ESCAPE '\\' AND (CommandLine LIKE \"%\\\\ImagePath%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\FailureCommand%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\ServiceDll%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Powershell AMSI Bypass via .NET Reflection",
        "description": "Detects Request to amsiInitFailed that can be used to disable AMSI Scanning",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%System.Management.Automation.AmsiUtils%\" ESCAPE '\\') AND (CommandLine LIKE \"%amsiInitFailed%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Audio Capture via PowerShell",
        "description": "Detects audio capture via PowerShell Cmdlet.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%WindowsAudioDevice-Powershell-Cmdlet%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PowerShell Base64 Encoded Shellcode",
        "description": "Detects Base64 encoded Shellcode",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%AAAAYInlM%\" ESCAPE '\\' AND (CommandLine LIKE \"%OiCAAAAYInlM%\" ESCAPE '\\' OR CommandLine LIKE \"%OiJAAAAYInlM%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Bitsadmin Job via PowerShell",
        "description": "Detect download by BITS jobs via PowerShell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND CommandLine LIKE \"%Start-BitsTransfer%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious PowerShell Cmdline",
        "description": "Detects the PowerShell command lines with reversed strings",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%hctac%\" ESCAPE '\\' OR CommandLine LIKE \"%kearb%\" ESCAPE '\\' OR CommandLine LIKE \"%dnammoc%\" ESCAPE '\\' OR CommandLine LIKE \"%ekovn%\" ESCAPE '\\' OR CommandLine LIKE \"%eliFd%\" ESCAPE '\\' OR CommandLine LIKE \"%rahc%\" ESCAPE '\\' OR CommandLine LIKE \"%etirw%\" ESCAPE '\\' OR CommandLine LIKE \"%golon%\" ESCAPE '\\' OR CommandLine LIKE \"%tninon%\" ESCAPE '\\' OR CommandLine LIKE \"%eddih%\" ESCAPE '\\' OR CommandLine LIKE \"%tpircS%\" ESCAPE '\\' OR CommandLine LIKE \"%ssecorp%\" ESCAPE '\\' OR CommandLine LIKE \"%llehsrewop%\" ESCAPE '\\' OR CommandLine LIKE \"%esnopser%\" ESCAPE '\\' OR CommandLine LIKE \"%daolnwod%\" ESCAPE '\\' OR CommandLine LIKE \"%tneilCbeW%\" ESCAPE '\\' OR CommandLine LIKE \"%tneilc%\" ESCAPE '\\' OR CommandLine LIKE \"%ptth%\" ESCAPE '\\' OR CommandLine LIKE \"%elifotevas%\" ESCAPE '\\' OR CommandLine LIKE \"%46esab%\" ESCAPE '\\' OR CommandLine LIKE \"%htaPpmeTteG%\" ESCAPE '\\' OR CommandLine LIKE \"%tcejbO%\" ESCAPE '\\' OR CommandLine LIKE \"%maerts%\" ESCAPE '\\' OR CommandLine LIKE \"%hcaerof%\" ESCAPE '\\' OR CommandLine LIKE \"%ekovni%\" ESCAPE '\\' OR CommandLine LIKE \"%retupmoc%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Encoded PowerShell Command Line",
        "description": "Detects specific combinations of encoding methods in the PowerShell command lines",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND ((((EventID = \"1\" AND (CommandLine LIKE \"%ToInt%\" ESCAPE '\\' OR CommandLine LIKE \"%ToDecimal%\" ESCAPE '\\' OR CommandLine LIKE \"%ToByte%\" ESCAPE '\\' OR CommandLine LIKE \"%ToUint%\" ESCAPE '\\' OR CommandLine LIKE \"%ToSingle%\" ESCAPE '\\' OR CommandLine LIKE \"%ToSByte%\" ESCAPE '\\') AND (CommandLine LIKE \"%ToChar%\" ESCAPE '\\' OR CommandLine LIKE \"%ToString%\" ESCAPE '\\' OR CommandLine LIKE \"%String%\" ESCAPE '\\')) OR (CommandLine LIKE \"%char%\" ESCAPE '\\' AND CommandLine LIKE \"%join%\" ESCAPE '\\')) OR (CommandLine LIKE \"%split%\" ESCAPE '\\' AND CommandLine LIKE \"%join%\" ESCAPE '\\')) OR (CommandLine LIKE \"%ForEach%\" ESCAPE '\\' AND CommandLine LIKE \"%Xor%\" ESCAPE '\\') OR (CommandLine LIKE \"%cOnvErTTO-SECUreStRIng%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Powershell Defender Exclusion",
        "description": "Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((EventID = \"1\" AND CommandLine LIKE \"%Add-MpPreference %\" ESCAPE '\\' AND (CommandLine LIKE \"% -ExclusionPath %\" ESCAPE '\\' OR CommandLine LIKE \"% -ExclusionExtension %\" ESCAPE '\\' OR CommandLine LIKE \"% -ExclusionProcess %\" ESCAPE '\\')) OR (CommandLine LIKE \"%QWRkLU1wUHJlZmVyZW5jZ%\" ESCAPE '\\' OR CommandLine LIKE \"%FkZC1NcFByZWZlcmVuY2%\" ESCAPE '\\' OR CommandLine LIKE \"%BZGQtTXBQcmVmZXJlbmNl%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Powershell Used To Disable Windows Defender AV Security Monitoring",
        "description": "Detects attackers attempting to disable Windows Defender using Powershell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%-DisableBehaviorMonitoring $true%\" ESCAPE '\\' OR CommandLine LIKE \"%-DisableRuntimeMonitoring $true%\" ESCAPE '\\')) OR (CommandLine LIKE \"%sc%\" ESCAPE '\\' AND CommandLine LIKE \"%stop%\" ESCAPE '\\' AND CommandLine LIKE \"%WinDefend%\" ESCAPE '\\') OR (CommandLine LIKE \"%sc%\" ESCAPE '\\' AND CommandLine LIKE \"%config%\" ESCAPE '\\' AND CommandLine LIKE \"%WinDefend%\" ESCAPE '\\' AND CommandLine LIKE \"%start=disabled%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Detection of PowerShell Execution via DLL",
        "description": "Detects PowerShell Strings applied to rundll as seen in PowerShdll.dll",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\') OR (Description LIKE \"%Windows-Hostprozess (Rundll32)%\" ESCAPE '\\')) AND (CommandLine LIKE \"%Default.GetString%\" ESCAPE '\\' OR CommandLine LIKE \"%FromBase64String%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Downgrade Attack",
        "description": "Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"% -version 2 %\" ESCAPE '\\' OR CommandLine LIKE \"% -versio 2 %\" ESCAPE '\\' OR CommandLine LIKE \"% -versi 2 %\" ESCAPE '\\' OR CommandLine LIKE \"% -vers 2 %\" ESCAPE '\\' OR CommandLine LIKE \"% -ver 2 %\" ESCAPE '\\' OR CommandLine LIKE \"% -ve 2 %\" ESCAPE '\\') AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PowerShell Download from URL",
        "description": "Detects a Powershell process that contains download commands in its command line string",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND CommandLine LIKE \"%new-object%\" ESCAPE '\\' AND CommandLine LIKE \"%net.webclient).%\" ESCAPE '\\' AND CommandLine LIKE \"%download%\" ESCAPE '\\' AND (CommandLine LIKE \"%string(%\" ESCAPE '\\' OR CommandLine LIKE \"%file(%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "FromBase64String Command Line",
        "description": "Detects suspicious FromBase64String expressions in command line arguments",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%::FromBase64String(%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Powershell Reverse Shell Connection",
        "description": "Detects the Nishang Invoke-PowerShellTcpOneLine reverse shell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%new-object system.net.sockets.tcpclient%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious PowerShell Parameter Substring",
        "description": "Detects suspicious PowerShell invocation with a parameter substring",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\Powershell.exe\" ESCAPE '\\') AND (CommandLine LIKE \"% -windowstyle h %\" ESCAPE '\\' OR CommandLine LIKE \"% -windowstyl h%\" ESCAPE '\\' OR CommandLine LIKE \"% -windowsty h%\" ESCAPE '\\' OR CommandLine LIKE \"% -windowst h%\" ESCAPE '\\' OR CommandLine LIKE \"% -windows h%\" ESCAPE '\\' OR CommandLine LIKE \"% -windo h%\" ESCAPE '\\' OR CommandLine LIKE \"% -wind h%\" ESCAPE '\\' OR CommandLine LIKE \"% -win h%\" ESCAPE '\\' OR CommandLine LIKE \"% -wi h%\" ESCAPE '\\' OR CommandLine LIKE \"% -win h %\" ESCAPE '\\' OR CommandLine LIKE \"% -win hi %\" ESCAPE '\\' OR CommandLine LIKE \"% -win hid %\" ESCAPE '\\' OR CommandLine LIKE \"% -win hidd %\" ESCAPE '\\' OR CommandLine LIKE \"% -win hidde %\" ESCAPE '\\' OR CommandLine LIKE \"% -NoPr %\" ESCAPE '\\' OR CommandLine LIKE \"% -NoPro %\" ESCAPE '\\' OR CommandLine LIKE \"% -NoProf %\" ESCAPE '\\' OR CommandLine LIKE \"% -NoProfi %\" ESCAPE '\\' OR CommandLine LIKE \"% -NoProfil %\" ESCAPE '\\' OR CommandLine LIKE \"% -nonin %\" ESCAPE '\\' OR CommandLine LIKE \"% -nonint %\" ESCAPE '\\' OR CommandLine LIKE \"% -noninte %\" ESCAPE '\\' OR CommandLine LIKE \"% -noninter %\" ESCAPE '\\' OR CommandLine LIKE \"% -nonintera %\" ESCAPE '\\' OR CommandLine LIKE \"% -noninterac %\" ESCAPE '\\' OR CommandLine LIKE \"% -noninteract %\" ESCAPE '\\' OR CommandLine LIKE \"% -noninteracti %\" ESCAPE '\\' OR CommandLine LIKE \"% -noninteractiv %\" ESCAPE '\\' OR CommandLine LIKE \"% -ec %\" ESCAPE '\\' OR CommandLine LIKE \"% -encodedComman %\" ESCAPE '\\' OR CommandLine LIKE \"% -encodedComma %\" ESCAPE '\\' OR CommandLine LIKE \"% -encodedComm %\" ESCAPE '\\' OR CommandLine LIKE \"% -encodedCom %\" ESCAPE '\\' OR CommandLine LIKE \"% -encodedCo %\" ESCAPE '\\' OR CommandLine LIKE \"% -encodedC %\" ESCAPE '\\' OR CommandLine LIKE \"% -encoded %\" ESCAPE '\\' OR CommandLine LIKE \"% -encode %\" ESCAPE '\\' OR CommandLine LIKE \"% -encod %\" ESCAPE '\\' OR CommandLine LIKE \"% -enco %\" ESCAPE '\\' OR CommandLine LIKE \"% -en %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious XOR Encoded PowerShell Command Line",
        "description": "Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Description = \"Windows PowerShell\" OR Product = \"PowerShell Core 6\") AND (CommandLine LIKE \"%bxor%\" ESCAPE '\\' OR CommandLine LIKE \"%join%\" ESCAPE '\\' OR CommandLine LIKE \"%char%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Default PowerSploit and Empire Schtasks Persistence",
        "description": "Detects the creation of a schtask via PowerSploit or Empire Default Configuration.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/Create%\" ESCAPE '\\' AND CommandLine LIKE \"%/SC%\" ESCAPE '\\' AND (CommandLine LIKE \"%ONLOGON%\" ESCAPE '\\' OR CommandLine LIKE \"%DAILY%\" ESCAPE '\\' OR CommandLine LIKE \"%ONIDLE%\" ESCAPE '\\' OR CommandLine LIKE \"%Updater%\" ESCAPE '\\') AND CommandLine LIKE \"%/TN%\" ESCAPE '\\' AND CommandLine LIKE \"%Updater%\" ESCAPE '\\' AND CommandLine LIKE \"%/TR%\" ESCAPE '\\' AND CommandLine LIKE \"%powershell%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Procdump Usage",
        "description": "Detects uses of the SysInternals Procdump utility",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\procdump.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\procdump64.exe\" ESCAPE '\\') OR (CommandLine LIKE \"% -ma %\" ESCAPE '\\' AND CommandLine LIKE \"%.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Bitsadmin Download",
        "description": "Detects usage of bitsadmin downloading a file",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((EventID = \"1\" AND (Image LIKE \"%\\\\bitsadmin.exe\" ESCAPE '\\') AND (((CommandLine LIKE \"% /create %\" ESCAPE '\\' OR CommandLine LIKE \"% /addfile %\" ESCAPE '\\') AND (CommandLine LIKE \"%http%\" ESCAPE '\\')) OR (CommandLine LIKE \"% /transfer %\" ESCAPE '\\'))) OR (CommandLine LIKE \"%copy bitsadmin.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Process Dump via RdrLeakDiag.exe",
        "description": "Detects a process memory dump performed by RdrLeakDiag.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND OriginalFileName = \"RdrLeakDiag.exe\" AND CommandLine LIKE \"%fullmemdmp%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Process Dump via Rundll32 and Comsvcs.dll",
        "description": "Detects a process memory dump performed via ordinal function 24 in comsvcs.dll",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%comsvcs.dll,#24%\" ESCAPE '\\' OR CommandLine LIKE \"%comsvcs.dll,MiniDump%\" ESCAPE '\\' OR CommandLine LIKE \"%comsvcs.dll MiniDump%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PsExec Service Start",
        "description": "Detects a PsExec service start",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"C:\\\\Windows\\\\PSEXESVC.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PurpleSharp Indicator",
        "description": "Detect",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%xyz123456.exe%\" ESCAPE '\\' OR CommandLine LIKE \"%PurpleSharp%\" ESCAPE '\\') OR (OriginalFileName LIKE \"PurpleSharp.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Query Registry",
        "description": "Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\reg.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%query%\" ESCAPE '\\' OR CommandLine LIKE \"%save%\" ESCAPE '\\' OR CommandLine LIKE \"%export%\" ESCAPE '\\') AND (CommandLine LIKE \"%currentVersion\\\\windows%\" ESCAPE '\\' OR CommandLine LIKE \"%currentVersion\\\\runServicesOnce%\" ESCAPE '\\' OR CommandLine LIKE \"%currentVersion\\\\runServices%\" ESCAPE '\\' OR CommandLine LIKE \"%winlogon\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%currentVersion\\\\shellServiceObjectDelayLoad%\" ESCAPE '\\' OR CommandLine LIKE \"%currentVersion\\\\runOnce%\" ESCAPE '\\' OR CommandLine LIKE \"%currentVersion\\\\runOnceEx%\" ESCAPE '\\' OR CommandLine LIKE \"%currentVersion\\\\run%\" ESCAPE '\\' OR CommandLine LIKE \"%currentVersion\\\\policies\\\\explorer\\\\run%\" ESCAPE '\\' OR CommandLine LIKE \"%currentcontrolset\\\\services%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "DLL Execution via Rasautou.exe",
        "description": "Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\rasautou.exe\" ESCAPE '\\' OR OriginalFileName = \"rasdlui.exe\") AND (CommandLine LIKE \"%-d%\" ESCAPE '\\' AND CommandLine LIKE \"%-p%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "MSTSC Shadowing",
        "description": "Detects RDP session hijacking by using MSTSC shadowing",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%noconsentprompt%\" ESCAPE '\\' AND CommandLine LIKE \"%shadow:%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "RedMimicry Winnti Playbook Execute",
        "description": "Detects actions caused by the RedMimicry Winnti playbook",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%rundll32.exe%\" ESCAPE '\\' OR Image LIKE \"%cmd.exe%\" ESCAPE '\\') AND (CommandLine LIKE \"%gthread-3.6.dll%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\Windows\\\\Temp\\\\tmp.bat%\" ESCAPE '\\' OR CommandLine LIKE \"%sigcmm-2.4.dll%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Exports Critical Registry Keys To a File",
        "description": "Detects the export of a crital Registry key to a file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\regedit.exe\" ESCAPE '\\' AND CommandLine LIKE \"% /E %\" ESCAPE '\\' AND (CommandLine LIKE \"%hklm%\" ESCAPE '\\' OR CommandLine LIKE \"%hkey\\_local\\_machine%\" ESCAPE '\\') AND (CommandLine LIKE \"%\\\\system\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\sam\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\security\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Exports Registry Key To a File",
        "description": "Detects the export of the target Registry key to a file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\regedit.exe\" ESCAPE '\\' AND CommandLine LIKE \"% /E %\" ESCAPE '\\') AND NOT ((EventID = \"1\" AND (CommandLine LIKE \"%hklm%\" ESCAPE '\\' OR CommandLine LIKE \"%hkey\\_local\\_machine%\" ESCAPE '\\') AND (CommandLine LIKE \"%\\\\system\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\sam\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\security\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Reg Add RUN Key",
        "description": "Detects suspicious command line reg.exe tool adding key to RUN key in Registry",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%reg%\" ESCAPE '\\' AND CommandLine LIKE \"% ADD %\" ESCAPE '\\' AND CommandLine LIKE \"%Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Remote PowerShell Session Host Process (WinRM)",
        "description": "Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM host process) as a parent or child process (sign of an active PowerShell remote session).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\wsmprovhost.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\wsmprovhost.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Discovery of a System Time",
        "description": "Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"%time%\" ESCAPE '\\') OR (Image LIKE \"%\\\\w32tm.exe\" ESCAPE '\\' AND CommandLine LIKE \"%tz%\" ESCAPE '\\') OR (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND CommandLine LIKE \"%Get-Date%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Renamed Binary",
        "description": "Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (OriginalFileName LIKE \"cmd.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"powershell.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"powershell\\_ise.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"psexec.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"psexec.c\" ESCAPE '\\' OR OriginalFileName LIKE \"cscript.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"wscript.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"mshta.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"regsvr32.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"wmic.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"certutil.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"rundll32.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"cmstp.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"msiexec.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"7z.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"winrar.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"wevtutil.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"net.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"net1.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"netsh.exe\" ESCAPE '\\') AND NOT ((Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell\\_ise.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\psexec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\psexec64.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\certutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cmstp.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\7z.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\winrar.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wevtutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\netsh.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Highly Relevant Renamed Binary",
        "description": "Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (OriginalFileName LIKE \"powershell.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"powershell\\_ise.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"psexec.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"psexec.c\" ESCAPE '\\' OR OriginalFileName LIKE \"cscript.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"wscript.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"mshta.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"regsvr32.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"wmic.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"certutil.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"rundll32.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"cmstp.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"msiexec.exe\" ESCAPE '\\') AND NOT ((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell\\_ise.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\psexec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\psexec64.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\certutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cmstp.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Renamed jusched.exe",
        "description": "Detects renamed jusched.exe used by cobalt group",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (EventID = \"1\" AND (Description = \"Java Update Scheduler\" OR Description = \"Java(TM) Update Scheduler\")) AND NOT ((Image LIKE \"%\\\\jusched.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Renamed MegaSync",
        "description": "Detects the execution of a renamed meg.exe of MegaSync during incident response engagements associated with ransomware families like Nefilim, Sodinokibi, Pysa, and Conti.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((ParentImage LIKE \"%\\\\explorer.exe\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\Windows\\\\Temp\\\\meg.exe%\" ESCAPE '\\') OR (EventID = \"1\" AND OriginalFileName = \"meg.exe\" AND NOT (Image LIKE \"%\\\\meg.exe\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Execution of Renamed PaExec",
        "description": "Detects execution of renamed paexec via imphash and executable product string",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (EventID = \"1\" AND (Product LIKE \"%PAExec%\" ESCAPE '\\') AND Imphash IN (\"11D40A7B7876288F919AB819CC2D9802\", \"6444f8a34e99b8f7d9647de66aabe516\", \"dfd6aa3f7b2b1035b76b718f1ddc689f\", \"1a6cca4d5460b1710a12dea39e4a592c\")) AND NOT (Image LIKE \"%paexec%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Renamed PowerShell",
        "description": "Detects the execution of a renamed PowerShell often used by attackers or malware",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Description LIKE \"Windows PowerShell%\" ESCAPE '\\' OR Description LIKE \"pwsh%\" ESCAPE '\\') AND Company = \"Microsoft Corporation\") AND NOT ((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell\\_ise.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\pwsh.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Renamed ProcDump",
        "description": "Detects the execution of a renamed ProcDump executable often used by attackers or malware",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (EventID = \"1\" AND ((OriginalFileName = \"procdump\" OR (CommandLine LIKE \"% -ma %\" ESCAPE '\\' AND CommandLine LIKE \"% -accepteula %\" ESCAPE '\\')) OR (CommandLine LIKE \"% -ma %\" ESCAPE '\\' AND CommandLine LIKE \"%.dmp%\" ESCAPE '\\'))) AND NOT ((Image LIKE \"%\\\\procdump.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\procdump64.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Renamed PsExec",
        "description": "Detects the execution of a renamed PsExec often used by attackers or malware",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Description = \"Execute processes remotely\" AND Product = \"Sysinternals PsExec\") AND NOT ((Image LIKE \"%\\\\PsExec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\PsExec64.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Renamed Whoami Execution",
        "description": "Detects the execution of whoami that has been renamed to a different name to avoid detection",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND OriginalFileName = \"whoami.exe\" AND NOT (Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Rundll32 Without Parameters",
        "description": "Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine = \"rundll32.exe\")"
        ]
    },
    {
        "title": "Run PowerShell Script from ADS",
        "description": "Detects PowerShell script execution from Alternate Data Stream (ADS)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND CommandLine LIKE \"%Get-Content%\" ESCAPE '\\' AND CommandLine LIKE \"%-Stream%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Detect Virtualbox Driver Installation OR Starting Of VMs",
        "description": "Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%VBoxRT.dll,RTR3Init%\" ESCAPE '\\' OR CommandLine LIKE \"%VBoxC.dll%\" ESCAPE '\\' OR CommandLine LIKE \"%VBoxDrv.sys%\" ESCAPE '\\') OR (CommandLine LIKE \"%startvm%\" ESCAPE '\\' OR CommandLine LIKE \"%controlvm%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Script Event Consumer Spawning Process",
        "description": "Detects a suspicious child process of Script Event Consumer (scrcons.exe).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\scrcons.exe\" ESCAPE '\\') AND (Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\dllhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\msbuild.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Possible Shim Database Persistence via sdbinst.exe",
        "description": "Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\sdbinst.exe\" ESCAPE '\\' AND CommandLine LIKE \"%.sdb%\" ESCAPE '\\') AND NOT ((CommandLine LIKE \"%iisexpressshim.sdb%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Service Execution",
        "description": "Detects manual service execution (start) via system utilities.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"% start %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Stop Windows Service",
        "description": "Detects a windows service to be stopped",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\sc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND CommandLine LIKE \"%stop%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Shadow Copies Access via Symlink",
        "description": "Shadow Copies storage symbolic link creation using operating systems utilities",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%mklink%\" ESCAPE '\\' AND CommandLine LIKE \"%HarddiskVolumeShadowCopy%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Shadow Copies Creation Using Operating Systems Utilities",
        "description": "Shadow Copies creation using operating systems utilities, possible credential access",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\vssadmin.exe\" ESCAPE '\\') AND CommandLine LIKE \"%shadow%\" ESCAPE '\\' AND CommandLine LIKE \"%create%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Shadow Copies Deletion Using Operating Systems Utilities",
        "description": "Shadow Copies deletion using operating systems utilities",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%delete%\" ESCAPE '\\' AND (((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\vssadmin.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\diskshadow.exe\" ESCAPE '\\') AND CommandLine LIKE \"%shadow%\" ESCAPE '\\') OR ((Image LIKE \"%\\\\wbadmin.exe\" ESCAPE '\\') AND CommandLine LIKE \"%catalog%\" ESCAPE '\\' AND CommandLine LIKE \"%quiet%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Mshta Spawning Windows Shell",
        "description": "Detects a suspicious child process of a mshta.exe process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\mshta.exe\" ESCAPE '\\' AND (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\WScript.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows Shell Spawning Suspicious Program",
        "description": "Detects a suspicious child process of a Windows shell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((ParentImage LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\') AND (Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\nslookup.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\certutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bitsadmin.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\')) AND NOT (CurrentDirectory LIKE \"%\\\\ccmcache\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "SILENTTRINITY Stager Execution",
        "description": "Detects SILENTTRINITY stager use",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Description LIKE \"%st2stager%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Audio Capture via SoundRecorder",
        "description": "Detect attacker collecting audio via SoundRecorder application.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\SoundRecorder.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/FILE%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Possible SPN Enumeration",
        "description": "Detects Service Principal Name Enumeration used for Kerberoasting",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\setspn.exe\" ESCAPE '\\' OR (Description LIKE \"%Query or reset the computer%\" ESCAPE '\\' AND Description LIKE \"%SPN attribute%\" ESCAPE '\\')) AND CommandLine LIKE \"%-q%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Using Sticky-keys To Obtain Unauthenticated, Privileged Console Access",
        "description": "By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system. When the sticky keys are \"activated\" the privilleged shell is launched.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"copy /y C:\\\\windows\\\\system32\\\\cmd.exe C:\\\\windows\\\\system32\\\\sethc.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious AdFind Execution",
        "description": "Detects the execution of a AdFind for Active Directory enumeration",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%objectcategory%\" ESCAPE '\\' OR CommandLine LIKE \"%trustdmp%\" ESCAPE '\\' OR CommandLine LIKE \"%dcmodes%\" ESCAPE '\\' OR CommandLine LIKE \"%dclist%\" ESCAPE '\\' OR CommandLine LIKE \"%computers\\_pwdnotreqd%\" ESCAPE '\\') AND Image LIKE \"%\\\\adfind.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Atbroker Execution",
        "description": "Atbroker executing non-deafualt Assistive Technology applications",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%AtBroker.exe\" ESCAPE '\\' AND CommandLine LIKE \"%start%\" ESCAPE '\\') AND NOT ((CommandLine LIKE \"%animations%\" ESCAPE '\\' OR CommandLine LIKE \"%audiodescription%\" ESCAPE '\\' OR CommandLine LIKE \"%caretbrowsing%\" ESCAPE '\\' OR CommandLine LIKE \"%caretwidth%\" ESCAPE '\\' OR CommandLine LIKE \"%colorfiltering%\" ESCAPE '\\' OR CommandLine LIKE \"%cursorscheme%\" ESCAPE '\\' OR CommandLine LIKE \"%filterkeys%\" ESCAPE '\\' OR CommandLine LIKE \"%focusborderheight%\" ESCAPE '\\' OR CommandLine LIKE \"%focusborderwidth%\" ESCAPE '\\' OR CommandLine LIKE \"%highcontrast%\" ESCAPE '\\' OR CommandLine LIKE \"%keyboardcues%\" ESCAPE '\\' OR CommandLine LIKE \"%keyboardpref%\" ESCAPE '\\' OR CommandLine LIKE \"%magnifierpane%\" ESCAPE '\\' OR CommandLine LIKE \"%messageduration%\" ESCAPE '\\' OR CommandLine LIKE \"%minimumhitradius%\" ESCAPE '\\' OR CommandLine LIKE \"%mousekeys%\" ESCAPE '\\' OR CommandLine LIKE \"%Narrator%\" ESCAPE '\\' OR CommandLine LIKE \"%osk%\" ESCAPE '\\' OR CommandLine LIKE \"%overlappedcontent%\" ESCAPE '\\' OR CommandLine LIKE \"%showsounds%\" ESCAPE '\\' OR CommandLine LIKE \"%soundsentry%\" ESCAPE '\\' OR CommandLine LIKE \"%stickykeys%\" ESCAPE '\\' OR CommandLine LIKE \"%togglekeys%\" ESCAPE '\\' OR CommandLine LIKE \"%windowarranging%\" ESCAPE '\\' OR CommandLine LIKE \"%windowtracking%\" ESCAPE '\\' OR CommandLine LIKE \"%windowtrackingtimeout%\" ESCAPE '\\' OR CommandLine LIKE \"%windowtrackingzorder%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Possible Ransomware or Unauthorized MBR Modifications",
        "description": "Detects, possibly, malicious unauthorized usage of bcdedit.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\bcdedit.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%delete%\" ESCAPE '\\' OR CommandLine LIKE \"%deletevalue%\" ESCAPE '\\' OR CommandLine LIKE \"%import%\" ESCAPE '\\' OR CommandLine LIKE \"%safeboot%\" ESCAPE '\\' OR CommandLine LIKE \"%network%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Application Whitelisting Bypass via Bginfo",
        "description": "Execute VBscript code that is referenced within the *.bgi file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\bginfo.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/popup%\" ESCAPE '\\' AND CommandLine LIKE \"%/nolicprompt%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Bitstransfer via PowerShell",
        "description": "Detects transferring files from system on a server bitstransfer Powershell cmdlets",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell\\_ise.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\pwsh.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%Get-BitsTransfer%\" ESCAPE '\\' OR CommandLine LIKE \"%Add-BitsFile%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Calculator Usage",
        "description": "Detects suspicious use of calc.exe with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%\\\\calc.exe %\" ESCAPE '\\' OR (EventID = \"1\" AND Image LIKE \"%\\\\calc.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\Windows\\\\Sys%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Possible App Whitelisting Bypass via WinDbg/CDB as a Shellcode Runner",
        "description": "Launch 64-bit shellcode from a debugger script file using cdb.exe.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\cdb.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-cf%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Certutil Command",
        "description": "Detects a suspicious Microsoft certutil execution with sub commands like 'decode' sub command, which is sometimes used to decode malicious code with the built-in certutil utility",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"% -decode %\" ESCAPE '\\' OR CommandLine LIKE \"% -decodehex %\" ESCAPE '\\' OR CommandLine LIKE \"% -urlcache %\" ESCAPE '\\' OR CommandLine LIKE \"% -verifyctl %\" ESCAPE '\\' OR CommandLine LIKE \"% -encode %\" ESCAPE '\\' OR CommandLine LIKE \"% /decode %\" ESCAPE '\\' OR CommandLine LIKE \"% /decodehex %\" ESCAPE '\\' OR CommandLine LIKE \"% /urlcache %\" ESCAPE '\\' OR CommandLine LIKE \"% /verifyctl %\" ESCAPE '\\' OR CommandLine LIKE \"% /encode %\" ESCAPE '\\') OR (Image LIKE \"%\\\\certutil.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%URL%\" ESCAPE '\\' OR CommandLine LIKE \"%ping%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Certutil Encode",
        "description": "Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\certutil.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-f%\" ESCAPE '\\' AND CommandLine LIKE \"%-encode%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Commandline Escape",
        "description": "Detects suspicious process that use escape characters",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%h^t^t^p%\" ESCAPE '\\' OR CommandLine LIKE \"%h\"t\"t\"p%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Command Line Execution with Suspicious URL and AppData Strings",
        "description": "Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs > powershell)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%http%\" ESCAPE '\\' AND CommandLine LIKE \"%://%\" ESCAPE '\\' AND CommandLine LIKE \"%\\%AppData\\%%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Conti Volume Shadow Listing",
        "description": "Detects a command used by conti to access volume shadow backups",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%copy \\\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Code Page Switch",
        "description": "Detects a code page switch in command line or batch scripts to a rare language",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\chcp.com\" ESCAPE '\\' AND (CommandLine LIKE \"% 936\" ESCAPE '\\' OR CommandLine LIKE \"% 1258\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Reconnaissance Activity with Net Command",
        "description": "Detects a set of commands often used in recon stages by different attack groups",
        "rule": [
            "SELECT * FROM (SELECT *,count(*) AS agg FROM eventlog WHERE (EventID = \"1\" AND (CommandLine IN (\"tasklist\", \"net time\", \"systeminfo\", \"whoami\", \"nbtstat\", \"net start\", \"qprocess\", \"nslookup\", \"hostname.exe\", \"netstat -an\") OR (CommandLine LIKE \"%\\\\net1 start\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\net1 user /domain\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\net1 group /domain\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\net1 group \"domain admins\" /domain\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\net1 group \"Exchange Trusted Subsystem\" /domain\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\net1 accounts /domain\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\net1 user net localgroup administrators\" ESCAPE '\\'))) GROUP BY CommandLine) WHERE agg > 4"
        ]
    },
    {
        "title": "Suspicious Compression Tool Parameters",
        "description": "Detects suspicious command line arguments of common data compression tools",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((OriginalFileName LIKE \"7z%.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"%rar.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"%Command%Line%RAR%\" ESCAPE '\\') AND (CommandLine LIKE \"% -p%\" ESCAPE '\\' OR CommandLine LIKE \"% -ta%\" ESCAPE '\\' OR CommandLine LIKE \"% -tb%\" ESCAPE '\\' OR CommandLine LIKE \"% -sdel%\" ESCAPE '\\' OR CommandLine LIKE \"% -dw%\" ESCAPE '\\' OR CommandLine LIKE \"% -hp%\" ESCAPE '\\')) AND NOT (ParentImage LIKE \"C:\\\\Program%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Process Dump via Comsvcs DLL",
        "description": "Detects process memory dump via comsvcs.dll and rundll32",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR OriginalFileName = \"RUNDLL32.EXE\") AND (CommandLine LIKE \"%comsvcs%\" ESCAPE '\\' AND CommandLine LIKE \"%MiniDump%\" ESCAPE '\\' AND CommandLine LIKE \"%full%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Conhost Parent Process Executions",
        "description": "Detects the conhost execution as parent process. Can be used to evaded defense mechanism.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\conhost.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CVE-2021-40444 Process Pattern",
        "description": "Detects a suspicious process pattern found in CVE-2021-40444 exploitation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\control.exe\" ESCAPE '\\' AND (ParentImage LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\excel.exe\" ESCAPE '\\')) AND NOT (CommandLine LIKE \"%\\\\control.exe input.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Control Panel DLL Load",
        "description": "Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\System32\\\\control.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\rundll32.exe \" ESCAPE '\\') AND NOT (CommandLine LIKE \"%Shell32.dll%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Copy from Admin Share",
        "description": "Detects a suspicious copy command to or from an Admin share",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((Image LIKE \"%\\\\robocopy.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\xcopy.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%copy%\" ESCAPE '\\')) OR (Image LIKE \"%\\\\powershell%\" ESCAPE '\\' AND (CommandLine LIKE \"%copy-item%\" ESCAPE '\\' OR CommandLine LIKE \"%copy%\" ESCAPE '\\' OR CommandLine LIKE \"%cpi %\" ESCAPE '\\' OR CommandLine LIKE \"% cp %\" ESCAPE '\\'))) AND (CommandLine LIKE \"%\\\\\\\\\\*\" ESCAPE '\\' AND CommandLine LIKE \"%$%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Copy From or To System32",
        "description": "Detects a suspicious copy command that copies a system program from System32 to another directory on disk - sometimes used to use LOLBINs like certutil or desktopimgdownldr to a different location with a different name",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"% /c copy%\" ESCAPE '\\' OR CommandLine LIKE \"%xcopy%\" ESCAPE '\\') AND CommandLine LIKE \"%\\\\System32\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Covenant Launcher Indicators",
        "description": "Detects suspicious command lines used in Covenant luanchers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%-Sta%\" ESCAPE '\\' AND CommandLine LIKE \"%-Nop%\" ESCAPE '\\' AND CommandLine LIKE \"%-Window%\" ESCAPE '\\' AND CommandLine LIKE \"%Hidden%\" ESCAPE '\\' AND (CommandLine LIKE \"%-Command%\" ESCAPE '\\' OR CommandLine LIKE \"%-EncodedCommand%\" ESCAPE '\\')) OR (CommandLine LIKE \"%sv o (New-Object IO.MemorySteam);sv d %\" ESCAPE '\\' OR CommandLine LIKE \"%mshta file.hta%\" ESCAPE '\\' OR CommandLine LIKE \"%GruntHTTP%\" ESCAPE '\\' OR CommandLine LIKE \"%-EncodedCommand cwB2ACAAbwAgA%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "CrackMapExec Command Execution",
        "description": "Detect various execution methods of the CrackMapExec pentesting framework",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%cmd.exe /Q /c % 1> \\\\%\\\\%\\\\% 2>&1\" ESCAPE '\\' OR CommandLine LIKE \"%cmd.exe /C % > \\\\%\\\\%\\\\% 2>&1\" ESCAPE '\\' OR CommandLine LIKE \"%cmd.exe /C % > %\\\\Temp\\\\% 2>&1\" ESCAPE '\\') AND (CommandLine LIKE \"%powershell.exe -exec bypass -noni -nop -w 1 -C \"%\" ESCAPE '\\' OR CommandLine LIKE \"%powershell.exe -noni -nop -w 1 -enc %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CrackMapExec PowerShell Obfuscation",
        "description": "The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%powershell.exe%\" ESCAPE '\\' AND (CommandLine LIKE \"%join%split%\" ESCAPE '\\' OR CommandLine LIKE \"%( $ShellId[1]+$ShellId[13]+'x')%\" ESCAPE '\\' OR CommandLine LIKE \"%( $PSHome[%]+$PSHOME[%]+%\" ESCAPE '\\' OR CommandLine LIKE \"%( $env:Public[13]+$env:Public[5]+'x')%\" ESCAPE '\\' OR CommandLine LIKE \"%( $env:ComSpec[4,%,25]-Join'')%\" ESCAPE '\\' OR CommandLine LIKE \"%[1,3]+'x'-Join'')%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Parent of Csc.exe",
        "description": "Detects a suspicious parent of csc.exe, which could by a sign of payload delivery",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\csc.exe\" ESCAPE '\\' AND (ParentImage LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\mshta.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Csc.exe Source File Folder",
        "description": "Detects a suspicious execution of csc.exe, which uses a source in a suspicious folder (e.g. AppData)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\csc.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%\\\\AppData\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\Windows\\\\Temp\\\\%\" ESCAPE '\\')) AND NOT (ParentImage LIKE \"C:\\\\Program Files%\" ESCAPE '\\' OR (ParentImage LIKE \"%\\\\sdiagnhost.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\w3wp.exe\" ESCAPE '\\') OR (ParentCommandLine LIKE \"%\\\\ProgramData\\\\Microsoft\\\\Windows Defender Advanced Threat Protection%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Csi.exe Usage",
        "description": "Csi.exe is a signed binary from Microsoft that comes with Visual Studio and provides C# interactive capabilities. It can be used to run C# code from a file passed as a parameter in command line. Early version of this utility provided with Microsoft Roslyn Community Technology Preview was named 'rcsi.exe'",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\csi.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rcsi.exe\" ESCAPE '\\' OR OriginalFileName = \"csi.exe\" OR OriginalFileName = \"rcsi.exe\") AND Company = \"Microsoft Corporation\")"
        ]
    },
    {
        "title": "Suspicious Curl Usage on Windows",
        "description": "Detects a suspicious curl process start on Windows and outputs the requested document to a local file",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\curl.exe\" ESCAPE '\\' OR Product = \"The curl executable\") AND CommandLine LIKE \"% -O %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Curl File Upload",
        "description": "Detects a suspicious curl process start the adds a file to a web request",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\curl.exe\" ESCAPE '\\' AND CommandLine LIKE \"% -F %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Curl Start Combination",
        "description": "Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%curl%\" ESCAPE '\\' AND CommandLine LIKE \"% start %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "ZOHO Dctask64 Process Injection",
        "description": "Detects suspicious process injection using ZOHO's dctask64.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\dctask64.exe\" ESCAPE '\\') AND NOT ((CommandLine LIKE \"%DesktopCentral\\_Agent\\\\agent%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Desktopimgdownldr Command",
        "description": "Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((EventID = \"1\" AND CommandLine LIKE \"% /lockscreenurl:%\" ESCAPE '\\' AND NOT ((CommandLine LIKE \"%.jpg%\" ESCAPE '\\' OR CommandLine LIKE \"%.jpeg%\" ESCAPE '\\' OR CommandLine LIKE \"%.png%\" ESCAPE '\\'))) OR (CommandLine LIKE \"%reg delete%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\PersonalizationCSP%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Devtoolslauncher.exe Executes Specified Binary",
        "description": "The Devtoolslauncher.exe executes other binary",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\devtoolslauncher.exe\" ESCAPE '\\' AND CommandLine LIKE \"%LaunchForDeploy%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Direct Autorun Keys Modification",
        "description": "Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\reg.exe\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\' AND (CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnceEx%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunServices%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunServicesOnce%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Userinit%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Shell%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\User Shell Folders%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\system\\\\CurrentControlSet\\\\Control\\\\SafeBoot\\\\AlternateShell%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Disable or Delete Windows Eventlog",
        "description": "Detects command that is used to disable or delete Windows eventlog via logman Windows utility",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%logman %\" ESCAPE '\\') AND (CommandLine LIKE \"%stop %\" ESCAPE '\\' OR CommandLine LIKE \"%delete %\" ESCAPE '\\') AND (CommandLine LIKE \"%EventLog-System%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Disabled IE Security Features",
        "description": "Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"% -name IEHarden %\" ESCAPE '\\' AND CommandLine LIKE \"% -value 0 %\" ESCAPE '\\') OR (CommandLine LIKE \"% -name DEPOff %\" ESCAPE '\\' AND CommandLine LIKE \"% -value 1 %\" ESCAPE '\\') OR (CommandLine LIKE \"% -name DisableFirstRunCustomize %\" ESCAPE '\\' AND CommandLine LIKE \"% -value 2 %\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Raccine Uninstall",
        "description": "Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%taskkill %\" ESCAPE '\\' AND CommandLine LIKE \"%RaccineSettings.exe%\" ESCAPE '\\') OR (CommandLine LIKE \"%reg.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%delete%\" ESCAPE '\\' AND CommandLine LIKE \"%Raccine Tray%\" ESCAPE '\\') OR (CommandLine LIKE \"%schtasks%\" ESCAPE '\\' AND CommandLine LIKE \"%/DELETE%\" ESCAPE '\\' AND CommandLine LIKE \"%Raccine Rules Updater%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Execution via Diskshadow.exe",
        "description": "Detects using Diskshadow.exe to execute arbitrary code in text file",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\diskshadow.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%/s%\" ESCAPE '\\' OR CommandLine LIKE \"%-s%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "DIT Snapshot Viewer Use",
        "description": "Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\ditsnap.exe\" ESCAPE '\\') OR (CommandLine LIKE \"%ditsnap.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Application Whitelisting Bypass via Dnx.exe",
        "description": "Execute C# code located in the consoleapp folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\dnx.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Double Extension",
        "description": "Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%.doc.exe\" ESCAPE '\\' OR Image LIKE \"%.docx.exe\" ESCAPE '\\' OR Image LIKE \"%.xls.exe\" ESCAPE '\\' OR Image LIKE \"%.xlsx.exe\" ESCAPE '\\' OR Image LIKE \"%.ppt.exe\" ESCAPE '\\' OR Image LIKE \"%.pptx.exe\" ESCAPE '\\' OR Image LIKE \"%.rtf.exe\" ESCAPE '\\' OR Image LIKE \"%.pdf.exe\" ESCAPE '\\' OR Image LIKE \"%.txt.exe\" ESCAPE '\\' OR Image LIKE \"%      .exe\" ESCAPE '\\' OR Image LIKE \"%\\_\\_\\_\\_\\_\\_.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Application Whitelisting Bypass via Dxcap.exe",
        "description": "Detects execution of of Dxcap.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\dxcap.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-c%\" ESCAPE '\\' AND CommandLine LIKE \"%.exe%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Emotet RunDLL32 Process Creation",
        "description": "Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,#1",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%,RunDLL\" ESCAPE '\\')) AND NOT ((ParentImage LIKE \"%\\\\tracker.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Eventlog Clear or Configuration Using Wevtutil",
        "description": "Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%Clear-EventLog%\" ESCAPE '\\' OR CommandLine LIKE \"%Remove-EventLog%\" ESCAPE '\\' OR CommandLine LIKE \"%Limit-EventLog%\" ESCAPE '\\')) OR (Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' AND CommandLine LIKE \"% ClearEventLog %\" ESCAPE '\\')) OR (EventID = \"1\" AND Image LIKE \"%\\\\wevtutil.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%clear-log%\" ESCAPE '\\' OR CommandLine LIKE \"% cl %\" ESCAPE '\\' OR CommandLine LIKE \"%set-log%\" ESCAPE '\\' OR CommandLine LIKE \"% sl %\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Execution from Suspicious Folder",
        "description": "Detects a suspicious execution from an uncommon folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\$Recycle.bin\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\config\\\\systemprofile\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Intel\\\\Logs\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\RSA\\\\MachineKeys\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\All Users\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Default\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\NetworkService\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Public\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\addins\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\debug\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\Fonts\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\Help\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\IME\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\Media\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\repair\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\security\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\system32\\\\config\\\\systemprofile\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\System32\\\\Tasks\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\Tasks\\\\%\" ESCAPE '\\') OR Image LIKE \"C:\\\\Perflogs\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Execution in Webserver Root Folder",
        "description": "Detects a suspicious program execution in a web service root folder (filter out false positives)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\wwwroot\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\wmpub\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\htdocs\\\\%\" ESCAPE '\\') AND NOT ((Image LIKE \"%bin\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Tools\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\SMSComponent\\\\%\" ESCAPE '\\') AND (ParentImage LIKE \"%\\\\services.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Proxy Execution Via Explorer.exe",
        "description": "Attackers can use explorer.exe for evading defense mechanisms",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\explorer.exe\" ESCAPE '\\') AND (ParentImage LIKE \"%\\\\cmd.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%explorer.exe%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Explorer Root Flag Process Tree Break",
        "description": "Detects a command line process that uses explorer.exe /root, which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%explorer.exe%\" ESCAPE '\\' AND CommandLine LIKE \"% /root,%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious File Characteristics Due to Missing Fields",
        "description": "Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Description LIKE \"\\?\" ESCAPE '\\' AND (FileVersion LIKE \"\\?\" ESCAPE '\\' OR Product LIKE \"\\?\" ESCAPE '\\' OR Company LIKE \"\\?\" ESCAPE '\\') AND Image LIKE \"%\\\\Downloads\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "GfxDownloadWrapper.exe Downloads File from Suspicious URL",
        "description": "Detects when GfxDownloadWrapper.exe downloads file from non standard URL",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\GfxDownloadWrapper.exe\" ESCAPE '\\' AND NOT (CommandLine LIKE \"%gameplayapi.intel.com%\" ESCAPE '\\')) AND NOT (ParentImage LIKE \"%\\\\GfxDownloadWrapper.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Abusing Findstr for Defense Evasion",
        "description": "Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%findstr%\" ESCAPE '\\') AND ((CommandLine LIKE \"%/V%\" ESCAPE '\\' AND CommandLine LIKE \"%/L%\" ESCAPE '\\') OR (CommandLine LIKE \"%/S%\" ESCAPE '\\' AND CommandLine LIKE \"%/I%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Findstr Launching .lnk File",
        "description": "Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\findstr.exe\" ESCAPE '\\' AND CommandLine LIKE \"%.lnk\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Finger.exe Suspicious Invocation",
        "description": "Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\finger.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Firewall Disabled via Netsh",
        "description": "Detects netsh commands that turns off the Windows firewall",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"netsh firewall set opmode mode=disable\" ESCAPE '\\' OR CommandLine LIKE \"netsh advfirewall set % state off\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Fsutil Suspicious Invocation",
        "description": "Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc). Might be used by ransomwares during the attack (seen by NotPetya and others).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\fsutil.exe\" ESCAPE '\\' OR OriginalFileName = \"fsutil.exe\") AND (CommandLine LIKE \"%deletejournal%\" ESCAPE '\\' OR CommandLine LIKE \"%createjournal%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious ftp.exe",
        "description": "Detects renamed ftp.exe, ftp.exe script execution and child processes ran by ftp.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((EventID = \"1\" AND CommandLine LIKE \"%-s:%\" ESCAPE '\\' AND (Image LIKE \"%ftp.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"%ftp.exe%\" ESCAPE '\\')) OR (EventID = \"1\" AND OriginalFileName LIKE \"%ftp.exe%\" ESCAPE '\\' AND NOT (Image LIKE \"%ftp.exe\" ESCAPE '\\')) OR ParentImage LIKE \"%ftp.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious GUP Usage",
        "description": "Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\GUP.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\Users\\\\%\\\\AppData\\\\Local\\\\Notepad++\\\\updater\\\\GUP.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\%\\\\AppData\\\\Roaming\\\\Notepad++\\\\updater\\\\GUP.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\Program Files\\\\Notepad++\\\\updater\\\\GUP.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\Program Files (x86)\\\\Notepad++\\\\updater\\\\GUP.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "IIS Native-Code Module Command Line Installation",
        "description": "Detects suspicious IIS native-code module installations via command line",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\appcmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%install%\" ESCAPE '\\' AND CommandLine LIKE \"%module%\" ESCAPE '\\' AND CommandLine LIKE \"%/name:%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Mounted Share Deleted",
        "description": "Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\net.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\net1.exe\" ESCAPE '\\' AND CommandLine LIKE \"%share%\" ESCAPE '\\' AND CommandLine LIKE \"%/delete%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Defender Download Activity",
        "description": "Detect the use of Windows Defender to download payloads",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%MpCmdRun.exe%\" ESCAPE '\\' OR Description = \"Microsoft Malware Protection Command Line Utility\") AND (CommandLine LIKE \"%DownloadFile%\" ESCAPE '\\' AND CommandLine LIKE \"%url%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious MSHTA Process Patterns",
        "description": "Detects suspicious mshta process patterns",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' AND ((((ParentImage LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\') OR (CommandLine LIKE \"%\\\\AppData\\\\Local%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Windows\\\\Temp%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Users\\\\Public%\" ESCAPE '\\')) OR NOT ((Image LIKE \"%C:\\\\Windows\\\\System32%\" ESCAPE '\\' OR Image LIKE \"%C:\\\\Windows\\\\SysWOW64%\" ESCAPE '\\'))) OR NOT ((CommandLine LIKE \"%.htm%\" ESCAPE '\\' OR CommandLine LIKE \"%.hta%\" ESCAPE '\\') AND (CommandLine LIKE \"%mshta.exe\" ESCAPE '\\' OR CommandLine LIKE \"%mshta\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Suspicious MsiExec Directory",
        "description": "Detects suspicious msiexec process starts in an uncommon directory",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\WinSxS\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "MsiExec Web Install",
        "description": "Detects suspicious msiexec process starts with web addresses as parameter",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% msiexec%\" ESCAPE '\\' AND CommandLine LIKE \"%://%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Malicious Payload Download via Office Binaries",
        "description": "Downloads payload from remote server",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\excel.exe\" ESCAPE '\\') AND CommandLine LIKE \"%http%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Netsh DLL Persistence",
        "description": "Detects persitence via netsh helper",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\netsh.exe\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\' AND CommandLine LIKE \"%helper%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Net.exe Execution",
        "description": "Detects execution of Net.exe, whether suspicious or benign.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND (CommandLine LIKE \"% group%\" ESCAPE '\\' OR CommandLine LIKE \"% localgroup%\" ESCAPE '\\' OR CommandLine LIKE \"% user%\" ESCAPE '\\' OR CommandLine LIKE \"% view%\" ESCAPE '\\' OR CommandLine LIKE \"% share%\" ESCAPE '\\' OR CommandLine LIKE \"% accounts%\" ESCAPE '\\' OR CommandLine LIKE \"% stop %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Ngrok Usage",
        "description": "Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available. Involved domains are bin.equinox.io for download and *.ngrok.io for connections.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"% tcp 139%\" ESCAPE '\\' OR CommandLine LIKE \"% tcp 445%\" ESCAPE '\\' OR CommandLine LIKE \"% tcp 3389%\" ESCAPE '\\' OR CommandLine LIKE \"% tcp 5985%\" ESCAPE '\\' OR CommandLine LIKE \"% tcp 5986%\" ESCAPE '\\') OR (CommandLine LIKE \"% start %\" ESCAPE '\\' AND CommandLine LIKE \"%--all%\" ESCAPE '\\' AND CommandLine LIKE \"%--config%\" ESCAPE '\\' AND CommandLine LIKE \"%.yml%\" ESCAPE '\\') OR ((Image LIKE \"%ngrok.exe\" ESCAPE '\\') AND (CommandLine LIKE \"% tcp %\" ESCAPE '\\' OR CommandLine LIKE \"% http %\" ESCAPE '\\' OR CommandLine LIKE \"% authtoken %\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Invocation of Active Directory Diagnostic Tool (ntdsutil.exe)",
        "description": "Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\ntdsutil.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Application Whitelisting Bypass via DLL Loaded by odbcconf.exe",
        "description": "Detects defence evasion attempt via odbcconf.exe execution to load DLL",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\odbcconf.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%-f%\" ESCAPE '\\' OR CommandLine LIKE \"%regsvr%\" ESCAPE '\\')) OR (ParentImage LIKE \"%\\\\odbcconf.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "OpenWith.exe Executes Specified Binary",
        "description": "The OpenWith.exe executes other binary",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\OpenWith.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/c%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Execution from Outlook",
        "description": "Detects EnableUnsafeClientMailRules used for Script Execution from Outlook",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%EnableUnsafeClientMailRules%\" ESCAPE '\\' OR (ParentImage LIKE \"%\\\\outlook.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\\\\\\\*\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\\\*\" ESCAPE '\\' AND CommandLine LIKE \"%.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Execution in Outlook Temp Folder",
        "description": "Detects a suspicious program execution in Outlook temp folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\Temporary Internet Files\\\\Content.Outlook\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Code Execution via Pcwutl.dll",
        "description": "Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND CommandLine LIKE \"%pcwutl%\" ESCAPE '\\' AND CommandLine LIKE \"%LaunchApplication%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Execute Code with Pester.bat",
        "description": "Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND CommandLine LIKE \"%Pester%\" ESCAPE '\\' AND CommandLine LIKE \"%Get-Help%\" ESCAPE '\\') OR (EventID = \"1\" AND Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND CommandLine LIKE \"%pester%\" ESCAPE '\\' AND CommandLine LIKE \"%;%\" ESCAPE '\\' AND (CommandLine LIKE \"%help%\" ESCAPE '\\' OR CommandLine LIKE \"%_%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Ping Hex IP",
        "description": "Detects a ping command that uses a hex encoded IP address",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\ping.exe\" ESCAPE '\\' AND CommandLine LIKE \"%0x%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Empire PowerShell Launch Parameters",
        "description": "Detects suspicious powershell command line parameters used in Empire",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"% -NoP -sta -NonI -W Hidden -Enc %\" ESCAPE '\\' OR CommandLine LIKE \"% -noP -sta -w 1 -enc %\" ESCAPE '\\' OR CommandLine LIKE \"% -NoP -NonI -W Hidden -enc %\" ESCAPE '\\' OR CommandLine LIKE \"% -noP -sta -w 1 -enc%\" ESCAPE '\\' OR CommandLine LIKE \"% -enc  SQB%\" ESCAPE '\\' OR CommandLine LIKE \"% -nop -exec bypass -EncodedCommand %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Empire PowerShell UAC Bypass",
        "description": "Detects some Empire PowerShell UAC bypass methods",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"% -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\\\Microsoft\\\\Windows Update).Update)%\" ESCAPE '\\' OR CommandLine LIKE \"% -NoP -NonI -c $x=$((gp HKCU:Software\\\\Microsoft\\\\Windows Update).Update);%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Encoded Character Syntax",
        "description": "Detects suspicious encoded character syntax often used for defense evasion",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%(WCHAR)0x%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Encoded PowerShell Command Line",
        "description": "Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (EventID = \"1\" AND ((EventID = \"1\" AND CommandLine LIKE \"% -e%\" ESCAPE '\\' AND CommandLine LIKE \"% JAB%\" ESCAPE '\\' AND CommandLine LIKE \"% -w%\" ESCAPE '\\' AND CommandLine LIKE \"% hidden %\" ESCAPE '\\') OR (EventID = \"1\" AND CommandLine LIKE \"% -e%\" ESCAPE '\\' AND (CommandLine LIKE \"% BA^J%\" ESCAPE '\\' OR CommandLine LIKE \"% SUVYI%\" ESCAPE '\\' OR CommandLine LIKE \"% SQBFAFgA%\" ESCAPE '\\' OR CommandLine LIKE \"% aQBlAHgA%\" ESCAPE '\\' OR CommandLine LIKE \"% aWV4I%\" ESCAPE '\\' OR CommandLine LIKE \"% IAA%\" ESCAPE '\\' OR CommandLine LIKE \"% IAB%\" ESCAPE '\\' OR CommandLine LIKE \"% UwB%\" ESCAPE '\\' OR CommandLine LIKE \"% cwB%\" ESCAPE '\\')) OR (CommandLine LIKE \"%.exe -ENCOD %\" ESCAPE '\\'))) AND NOT (CommandLine LIKE \"% -ExecutionPolicy%\" ESCAPE '\\' AND CommandLine LIKE \"%remotesigned %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell Get-Process LSASS",
        "description": "Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%Get-Process lsass%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malicious Base64 Encoded PowerShell Keywords in Command Lines",
        "description": "Detects base64 encoded strings used in hidden malicious PowerShell command lines",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND CommandLine LIKE \"% hidden %\" ESCAPE '\\' AND (CommandLine LIKE \"%AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA%\" ESCAPE '\\' OR CommandLine LIKE \"%aXRzYWRtaW4gL3RyYW5zZmVy%\" ESCAPE '\\' OR CommandLine LIKE \"%IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA%\" ESCAPE '\\' OR CommandLine LIKE \"%JpdHNhZG1pbiAvdHJhbnNmZX%\" ESCAPE '\\' OR CommandLine LIKE \"%YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg%\" ESCAPE '\\' OR CommandLine LIKE \"%Yml0c2FkbWluIC90cmFuc2Zlc%\" ESCAPE '\\' OR CommandLine LIKE \"%AGMAaAB1AG4AawBfAHMAaQB6AGUA%\" ESCAPE '\\' OR CommandLine LIKE \"%JABjAGgAdQBuAGsAXwBzAGkAegBlA%\" ESCAPE '\\' OR CommandLine LIKE \"%JGNodW5rX3Npem%\" ESCAPE '\\' OR CommandLine LIKE \"%QAYwBoAHUAbgBrAF8AcwBpAHoAZQ%\" ESCAPE '\\' OR CommandLine LIKE \"%RjaHVua19zaXpl%\" ESCAPE '\\' OR CommandLine LIKE \"%Y2h1bmtfc2l6Z%\" ESCAPE '\\' OR CommandLine LIKE \"%AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A%\" ESCAPE '\\' OR CommandLine LIKE \"%kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg%\" ESCAPE '\\' OR CommandLine LIKE \"%lPLkNvbXByZXNzaW9u%\" ESCAPE '\\' OR CommandLine LIKE \"%SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA%\" ESCAPE '\\' OR CommandLine LIKE \"%SU8uQ29tcHJlc3Npb2%\" ESCAPE '\\' OR CommandLine LIKE \"%Ty5Db21wcmVzc2lvb%\" ESCAPE '\\' OR CommandLine LIKE \"%AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ%\" ESCAPE '\\' OR CommandLine LIKE \"%kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA%\" ESCAPE '\\' OR CommandLine LIKE \"%lPLk1lbW9yeVN0cmVhb%\" ESCAPE '\\' OR CommandLine LIKE \"%SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A%\" ESCAPE '\\' OR CommandLine LIKE \"%SU8uTWVtb3J5U3RyZWFt%\" ESCAPE '\\' OR CommandLine LIKE \"%Ty5NZW1vcnlTdHJlYW%\" ESCAPE '\\' OR CommandLine LIKE \"%4ARwBlAHQAQwBoAHUAbgBrA%\" ESCAPE '\\' OR CommandLine LIKE \"%5HZXRDaHVua%\" ESCAPE '\\' OR CommandLine LIKE \"%AEcAZQB0AEMAaAB1AG4Aaw%\" ESCAPE '\\' OR CommandLine LIKE \"%LgBHAGUAdABDAGgAdQBuAGsA%\" ESCAPE '\\' OR CommandLine LIKE \"%LkdldENodW5r%\" ESCAPE '\\' OR CommandLine LIKE \"%R2V0Q2h1bm%\" ESCAPE '\\' OR CommandLine LIKE \"%AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A%\" ESCAPE '\\' OR CommandLine LIKE \"%QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA%\" ESCAPE '\\' OR CommandLine LIKE \"%RIUkVBRF9JTkZPNj%\" ESCAPE '\\' OR CommandLine LIKE \"%SFJFQURfSU5GTzY0%\" ESCAPE '\\' OR CommandLine LIKE \"%VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA%\" ESCAPE '\\' OR CommandLine LIKE \"%VEhSRUFEX0lORk82N%\" ESCAPE '\\' OR CommandLine LIKE \"%AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA%\" ESCAPE '\\' OR CommandLine LIKE \"%cmVhdGVSZW1vdGVUaHJlYW%\" ESCAPE '\\' OR CommandLine LIKE \"%MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA%\" ESCAPE '\\' OR CommandLine LIKE \"%NyZWF0ZVJlbW90ZVRocmVhZ%\" ESCAPE '\\' OR CommandLine LIKE \"%Q3JlYXRlUmVtb3RlVGhyZWFk%\" ESCAPE '\\' OR CommandLine LIKE \"%QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA%\" ESCAPE '\\' OR CommandLine LIKE \"%0AZQBtAG0AbwB2AGUA%\" ESCAPE '\\' OR CommandLine LIKE \"%1lbW1vdm%\" ESCAPE '\\' OR CommandLine LIKE \"%AGUAbQBtAG8AdgBlA%\" ESCAPE '\\' OR CommandLine LIKE \"%bQBlAG0AbQBvAHYAZQ%\" ESCAPE '\\' OR CommandLine LIKE \"%bWVtbW92Z%\" ESCAPE '\\' OR CommandLine LIKE \"%ZW1tb3Zl%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious PowerShell Invocation Based on Parent Process",
        "description": "Detects suspicious powershell invocations from interpreters or unusual programs",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((ParentImage LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\cscript.exe\" ESCAPE '\\') AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\') AND NOT (CurrentDirectory LIKE \"%\\\\Health Service State\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious PowerShell Parent Process",
        "description": "Detects a suspicious parents of powershell.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((ParentImage LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\services.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\winword.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\powerpnt.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\excel.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\msaccess.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\mspub.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\visio.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\outlook.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\amigo.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\chrome.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\firefox.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\iexplore.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\microsoftedgecp.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\microsoftedge.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\browser.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\vivaldi.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\safari.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\sqlagent.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\sqlserver.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\sqlservr.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\w3wp.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\httpd.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\nginx.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\php-cgi.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\jbosssvc.exe\" ESCAPE '\\' OR ParentImage LIKE \"%MicrosoftEdgeSH.exe\" ESCAPE '\\') OR ParentImage LIKE \"%tomcat%\" ESCAPE '\\') AND ((CommandLine LIKE \"%powershell%\" ESCAPE '\\' OR CommandLine LIKE \"%pwsh%\" ESCAPE '\\') OR Description = \"Windows PowerShell\" OR Product = \"PowerShell Core 6\"))"
        ]
    },
    {
        "title": "PowerShell SAM Copy",
        "description": "Detects suspicious PowerShell scripts accessing SAM hives",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%\\\\HarddiskVolumeShadowCopy%\" ESCAPE '\\' AND CommandLine LIKE \"%ystem32\\\\config\\\\sam%\" ESCAPE '\\' AND (CommandLine LIKE \"%Copy-Item%\" ESCAPE '\\' OR CommandLine LIKE \"%cp $\\_.%\" ESCAPE '\\' OR CommandLine LIKE \"%cpi $\\_.%\" ESCAPE '\\' OR CommandLine LIKE \"%copy $\\_.%\" ESCAPE '\\' OR CommandLine LIKE \"%.File]::Copy(%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Abusing Print Executable",
        "description": "Attackers can use print.exe for remote file copy",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\print.exe\" ESCAPE '\\') AND (CommandLine LIKE \"print%\" ESCAPE '\\') AND (CommandLine LIKE \"%/D%\" ESCAPE '\\') AND (CommandLine LIKE \"%.exe%\" ESCAPE '\\')) AND NOT ((CommandLine LIKE \"%print.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Use of Procdump",
        "description": "Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter ' -ma ' and ' -accepteula' in a single step. This way we're also able to catch cases in which the attacker has renamed the procdump executable.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% -ma %\" ESCAPE '\\' AND CommandLine LIKE \"% -accepteula %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Use of Procdump on LSASS",
        "description": "Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we're also able to catch cases in which the attacker has renamed the procdump executable.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% -ma %\" ESCAPE '\\' AND ((EventID = \"1\" AND CommandLine LIKE \"% lsass%\" ESCAPE '\\') OR CommandLine LIKE \"% ls%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Psexec Accepteula Condition",
        "description": "Detect ed user accept agreement execution in psexec commandline",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\psexec.exe\" ESCAPE '\\' AND CommandLine LIKE \"%accepteula%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PsExec/PAExec Flags",
        "description": "Detects suspicious flags used by PsExec and PAExec but no usual program name in command line",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (EventID = \"1\" AND ((CommandLine LIKE \"%\\\\127.0.0.1%\" ESCAPE '\\' AND CommandLine LIKE \"% -s %\" ESCAPE '\\' AND CommandLine LIKE \"%cmd.exe%\" ESCAPE '\\') OR (CommandLine LIKE \"% /accepteula %\" ESCAPE '\\' AND CommandLine LIKE \"%cmd /c %\" ESCAPE '\\' AND CommandLine LIKE \"% -u %\" ESCAPE '\\' AND CommandLine LIKE \"% -p %\" ESCAPE '\\'))) AND NOT ((CommandLine LIKE \"%paexec%\" ESCAPE '\\' OR CommandLine LIKE \"%PsExec%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Psr.exe Capture Screenshots",
        "description": "The psr.exe captures desktop screenshots and saves them on the local machine",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\Psr.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/start%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PowerShell Script Run in AppData",
        "description": "Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%/c%\" ESCAPE '\\' AND CommandLine LIKE \"%powershell%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\AppData\\\\%\" ESCAPE '\\' AND (CommandLine LIKE \"%Local\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"%Roaming\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell DownloadFile",
        "description": "Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%powershell%\" ESCAPE '\\' AND CommandLine LIKE \"%.DownloadFile%\" ESCAPE '\\' AND CommandLine LIKE \"%System.Net.WebClient%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Rar with Password or Compression Level",
        "description": "Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"% -hp%\" ESCAPE '\\') AND (CommandLine LIKE \"% -m%\" ESCAPE '\\' OR CommandLine LIKE \"% a %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious RASdial Activity",
        "description": "Detects suspicious process related to rasdial.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%rasdial.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious RazerInstaller Explorer Subprocess",
        "description": "Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\RazerInstaller.exe\" ESCAPE '\\' AND IntegrityLevel = \"System\") AND NOT (Image LIKE \"C:\\\\Windows\\\\Installer\\\\Razer\\\\Installer\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Rclone Execution via Command Line or PowerShell",
        "description": "Detects Rclone which is commonly used by ransomware groups for exfiltration",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"% pass %\" ESCAPE '\\' OR CommandLine LIKE \"% user %\" ESCAPE '\\' OR CommandLine LIKE \"% copy %\" ESCAPE '\\' OR CommandLine LIKE \"% mega %\" ESCAPE '\\' OR CommandLine LIKE \"% sync %\" ESCAPE '\\' OR CommandLine LIKE \"% config %\" ESCAPE '\\' OR CommandLine LIKE \"% lsd %\" ESCAPE '\\' OR CommandLine LIKE \"% remote %\" ESCAPE '\\' OR CommandLine LIKE \"% ls %\" ESCAPE '\\') AND (Description = \"Rsync for cloud storage\" OR (Image LIKE \"%\\\\rclone.exe\" ESCAPE '\\' AND (ParentImage LIKE \"%\\\\PowerShell.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\cmd.exe\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Suspicious Reconnaissance Activity",
        "description": "Detects suspicious command line activity on Windows systems",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine IN (\"net group \"domain admins\" /dom\", \"net localgroup administrators\", \"net group \"enterprise admins\" /dom\", \"net accounts /dom\"))"
        ]
    },
    {
        "title": "Regedit as Trusted Installer",
        "description": "Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\regedit.exe\" ESCAPE '\\' AND (ParentImage LIKE \"%\\\\TrustedInstaller.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\ProcessHacker.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "DLL Execution Via Register-cimprovider.exe",
        "description": "Detects using register-cimprovider.exe to execute arbitrary dll file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\register-cimprovider.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-path%\" ESCAPE '\\' AND CommandLine LIKE \"%dll%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Regsvr32 Anomaly",
        "description": "Detects various anomalies in relation to regsvr32.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Temp\\\\%\" ESCAPE '\\') OR (Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\cmd.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/i:%\" ESCAPE '\\' AND (CommandLine LIKE \"%http%\" ESCAPE '\\' OR CommandLine LIKE \"%ftp%\" ESCAPE '\\') AND CommandLine LIKE \"%scrobj.dll\" ESCAPE '\\') OR (Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\EXCEL.EXE\" ESCAPE '\\' AND CommandLine LIKE \"%..\\\\..\\\\..\\\\Windows\\\\System32\\\\regsvr32.exe %\" ESCAPE '\\') OR (ParentImage LIKE \"%\\\\mshta.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\') OR (Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%\\\\AppData\\\\Local%\" ESCAPE '\\' OR CommandLine LIKE \"%C:\\\\Users\\\\Public%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Regsvr32 Flags Anomaly",
        "description": "Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' AND CommandLine LIKE \"% /i:%\" ESCAPE '\\') AND NOT (CommandLine LIKE \"% /n %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Reg Disable Security Service",
        "description": "Detects a suspicious reg.exe invocation that looks as if it would disable an important security service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%reg%\" ESCAPE '\\' AND CommandLine LIKE \"%add%\" ESCAPE '\\' AND CommandLine LIKE \"% /d 4%\" ESCAPE '\\' AND CommandLine LIKE \"% /v Start%\" ESCAPE '\\' AND (CommandLine LIKE \"%\\\\Sense %\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\WinDefend%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\MsMpSvc%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\NisSrv%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\WdBoot %\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\WdNisDrv%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\WdNisSvc%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\wscsvc %\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\SecurityHealthService%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\wuauserv%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\UsoSvc %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Renamed ZOHO Dctask64",
        "description": "Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Imphash = \"6834B1B94E49701D77CCB3C0895E1AFD\" AND NOT (Image LIKE \"%\\\\dctask64.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Renamed SysInternals Debug View",
        "description": "Detects suspicious renamed SysInternals DebugView execution",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Product IN (\"Sysinternals DebugView\", \"Sysinternals Debugview\") AND NOT (OriginalFileName = \"Dbgview.exe\" AND Image LIKE \"%\\\\Dbgview.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Renamed PAExec",
        "description": "Detects suspicious renamed PAExec execution as often used by attackers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (EventID = \"1\" AND (Description = \"PAExec Application\" OR OriginalFileName = \"PAExec.exe\")) AND NOT ((Image LIKE \"%\\\\PAexec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\paexec.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Capture Credentials with Rpcping.exe",
        "description": "Detects using Rpcping.exe to send a RPC test connection to the target server (-s) and force the NTLM hash to be sent in the process.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\rpcping.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%-s%\" ESCAPE '\\' OR CommandLine LIKE \"%/s%\" ESCAPE '\\')) AND ((CommandLine LIKE \"%-u%\" ESCAPE '\\' AND CommandLine LIKE \"%NTLM%\" ESCAPE '\\') OR (CommandLine LIKE \"%/u%\" ESCAPE '\\' AND CommandLine LIKE \"%NTLM%\" ESCAPE '\\') OR (CommandLine LIKE \"%-t%\" ESCAPE '\\' AND CommandLine LIKE \"%ncacn\\_np%\" ESCAPE '\\') OR (CommandLine LIKE \"%/t%\" ESCAPE '\\' AND CommandLine LIKE \"%ncacn\\_np%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Rundll32 Activity",
        "description": "Detects suspicious process related to rundll32 based on arguments",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%javascript:%\" ESCAPE '\\' OR CommandLine LIKE \"%.RegisterXLL%\" ESCAPE '\\') OR (CommandLine LIKE \"%url.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%OpenURL%\" ESCAPE '\\') OR (CommandLine LIKE \"%url.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%OpenURLA%\" ESCAPE '\\') OR (CommandLine LIKE \"%url.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%FileProtocolHandler%\" ESCAPE '\\') OR (CommandLine LIKE \"%zipfldr.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%RouteTheCall%\" ESCAPE '\\') OR (CommandLine LIKE \"%shell32.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%Control\\_RunDLL%\" ESCAPE '\\') OR (CommandLine LIKE \"%shell32.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%ShellExec\\_RunDLL%\" ESCAPE '\\') OR (CommandLine LIKE \"%mshtml.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%PrintHTML%\" ESCAPE '\\') OR (CommandLine LIKE \"%advpack.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%LaunchINFSection%\" ESCAPE '\\') OR (CommandLine LIKE \"%advpack.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%RegisterOCX%\" ESCAPE '\\') OR (CommandLine LIKE \"%ieadvpack.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%LaunchINFSection%\" ESCAPE '\\') OR (CommandLine LIKE \"%ieadvpack.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%RegisterOCX%\" ESCAPE '\\') OR (CommandLine LIKE \"%ieframe.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%OpenURL%\" ESCAPE '\\') OR (CommandLine LIKE \"%shdocvw.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%OpenURL%\" ESCAPE '\\') OR (CommandLine LIKE \"%syssetup.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%SetupInfObjectInstallAction'%\" ESCAPE '\\') OR (CommandLine LIKE \"%setupapi.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%InstallHinfSection%\" ESCAPE '\\') OR (CommandLine LIKE \"%pcwutl.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%LaunchApplication%\" ESCAPE '\\') OR (CommandLine LIKE \"%dfshim.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%ShOpenVerbApplication%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Call by Ordinal",
        "description": "Detects suspicious calls of DLLs in rundll32.dll exports by ordinal",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%\\\\rundll32.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%,#%\" ESCAPE '\\') AND NOT (CommandLine LIKE \"%EDGEHTML.dll%\" ESCAPE '\\' AND CommandLine LIKE \"%#141%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Rundll32 Invoking Inline VBScript",
        "description": "Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%rundll32.exe%\" ESCAPE '\\' AND CommandLine LIKE \"%Execute%\" ESCAPE '\\' AND CommandLine LIKE \"%RegRead%\" ESCAPE '\\' AND CommandLine LIKE \"%window.close%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Rundll32 Without Any CommandLine Params",
        "description": "Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND NOT (ParentImage LIKE \"%\\\\svchost.exe\" ESCAPE '\\')) AND NOT ((ParentImage LIKE \"%\\\\AppData\\\\Local\\\\%\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\Microsoft\\\\Edge\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Rundll32 Setupapi.dll Activity",
        "description": "setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\runonce.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND ParentCommandLine LIKE \"%setupapi.dll%\" ESCAPE '\\' AND ParentCommandLine LIKE \"%InstallHinfSection%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Rundll32 Activity Invoking Sys File",
        "description": "Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%rundll32.exe%\" ESCAPE '\\' AND (CommandLine LIKE \"%.sys,%\" ESCAPE '\\' OR CommandLine LIKE \"%.sys %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Run Once Task Execution as Configured in Registry",
        "description": "This rule detects the execution of Run Once task as configured in the registry",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\runonce.exe\" ESCAPE '\\') OR (Description LIKE \"Run Once Wrapper\" ESCAPE '\\')) AND (CommandLine LIKE \"% /AlternateShellStartup%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Runscripthelper.exe",
        "description": "Detects execution of powershell scripts via Runscripthelper.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\Runscripthelper.exe\" ESCAPE '\\' AND CommandLine LIKE \"%surfacecheck%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Process Start Locations",
        "description": "Detects suspicious process run from unusual locations",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%:\\\\RECYCLER\\\\%\" ESCAPE '\\' OR Image LIKE \"%:\\\\SystemVolumeInformation\\\\%\" ESCAPE '\\') OR (Image LIKE \"C:\\\\Windows\\\\Tasks\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\debug\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\fonts\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\help\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\drivers\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\addins\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\cursors\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\system32\\\\tasks\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Scheduled Task Creation",
        "description": "Detects the creation of scheduled tasks in user session",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' AND CommandLine LIKE \"% /create %\" ESCAPE '\\') AND NOT ((User LIKE \"NT AUTHORITY\\\\SYSTEM%\" ESCAPE '\\' OR User LIKE \"AUTORITE NT\\\\Sys%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Scheduled Task Creation Involving Temp Folder",
        "description": "Detects the creation of scheduled tasks that involves a temporary folder and runs only once",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' AND CommandLine LIKE \"% /create %\" ESCAPE '\\' AND CommandLine LIKE \"% /sc once %\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Temp\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "ScreenConnect Remote Access",
        "description": "Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%e=Access&%\" ESCAPE '\\' AND CommandLine LIKE \"%y=Guest&%\" ESCAPE '\\' AND CommandLine LIKE \"%&p=%\" ESCAPE '\\' AND CommandLine LIKE \"%&c=%\" ESCAPE '\\' AND CommandLine LIKE \"%&k=%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious ScreenSave Change by Reg.exe",
        "description": "Adversaries may establish persistence by executing malicious content triggered by user inactivity.\nScreensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension\n",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%reg.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%HKEY\\_CURRENT\\_USER\\\\Control Panel\\\\Desktop%\" ESCAPE '\\' OR CommandLine LIKE \"%HKCU\\\\Control Panel\\\\Desktop%\" ESCAPE '\\') AND CommandLine LIKE \"%/t REG\\_SZ%\" ESCAPE '\\' AND CommandLine LIKE \"%/f%\" ESCAPE '\\' AND ((CommandLine LIKE \"%/v ScreenSaveActive%\" ESCAPE '\\' AND CommandLine LIKE \"%/d 1%\" ESCAPE '\\') OR (CommandLine LIKE \"%/v ScreenSaveTimeout%\" ESCAPE '\\' AND CommandLine LIKE \"%/d %\" ESCAPE '\\') OR (CommandLine LIKE \"%/v ScreenSaverIsSecure%\" ESCAPE '\\' AND CommandLine LIKE \"%/d 0%\" ESCAPE '\\') OR (CommandLine LIKE \"%/v SCRNSAVE.EXE%\" ESCAPE '\\' AND CommandLine LIKE \"%/d %\" ESCAPE '\\' AND CommandLine LIKE \"%.scr%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "WSF/JSE/JS/VBA/VBE File Execution",
        "description": "Detects suspicious file execution by wscript and cscript",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%.jse%\" ESCAPE '\\' OR CommandLine LIKE \"%.vbe%\" ESCAPE '\\' OR CommandLine LIKE \"%.js%\" ESCAPE '\\' OR CommandLine LIKE \"%.vba%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Script Execution From Temp Folder",
        "description": "Detects a suspicious script executions from temporary folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%\\\\Windows\\\\Temp%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\Temporary Internet%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\AppData\\\\Local\\\\Temp%\" ESCAPE '\\' OR CommandLine LIKE \"%\\\\AppData\\\\Roaming\\\\Temp%\" ESCAPE '\\' OR CommandLine LIKE \"%\\%TEMP\\%%\" ESCAPE '\\' OR CommandLine LIKE \"%\\%TMP\\%%\" ESCAPE '\\' OR CommandLine LIKE \"%\\%LocalAppData\\%\\\\Temp%\" ESCAPE '\\')) AND NOT ((CommandLine LIKE \"% >%\" ESCAPE '\\' OR CommandLine LIKE \"%Out-File%\" ESCAPE '\\' OR CommandLine LIKE \"%ConvertTo-Json%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Service DACL Modification",
        "description": "Detects suspicious DACL modifications that can  be used to hide services or make them unstopable",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\sc.exe\" ESCAPE '\\') AND CommandLine LIKE \"%sdset%\" ESCAPE '\\' AND CommandLine LIKE \"%D;;%\" ESCAPE '\\' AND (CommandLine LIKE \"%;;;IU%\" ESCAPE '\\' OR CommandLine LIKE \"%;;;SU%\" ESCAPE '\\' OR CommandLine LIKE \"%;;;BA%\" ESCAPE '\\' OR CommandLine LIKE \"%;;;SY%\" ESCAPE '\\' OR CommandLine LIKE \"%;;;WD%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Service Binary Directory",
        "description": "Detects a service binary running in a suspicious directory",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\Users\\\\Public\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\$Recycle.bin%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\All Users\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Default\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Contacts\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Users\\\\Searches\\\\%\" ESCAPE '\\' OR Image LIKE \"%C:\\\\Perflogs\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\config\\\\systemprofile\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\Fonts\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\IME\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Windows\\\\addins\\\\%\" ESCAPE '\\') AND (ParentImage LIKE \"%\\\\services.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\svchost.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Service Path Modification",
        "description": "Detects service path modification to PowerShell or cmd.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\sc.exe\" ESCAPE '\\' AND CommandLine LIKE \"%config%\" ESCAPE '\\' AND CommandLine LIKE \"%binpath%\" ESCAPE '\\' AND (CommandLine LIKE \"%powershell%\" ESCAPE '\\' OR CommandLine LIKE \"%cmd%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Serv-U Exploitation CVE-2021-35211 by DEV-0322",
        "description": "Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((CommandLine LIKE \"%whoami%\" ESCAPE '\\' AND (CommandLine LIKE \"%./Client/Common/%\" ESCAPE '\\' OR CommandLine LIKE \"%.\\\\Client\\\\Common\\\\%\" ESCAPE '\\')) OR CommandLine LIKE \"%C:\\\\Windows\\\\Temp\\\\Serv-U.bat%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Serv-U Process Pattern",
        "description": "Detects a suspicious process pattern which could be a sign of an exploited Serv-U service",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\Serv-U.exe\" ESCAPE '\\' AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mshta.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\forfiles.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\scriptrunner.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Shells Spawn by SQL Server",
        "description": "Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\sqlservr.exe\" ESCAPE '\\' AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bitsadmin.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "ShimCache Flush",
        "description": "Detects actions that clear the local ShimCache and remove forensic evidence",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%rundll32%\" ESCAPE '\\' AND ((CommandLine LIKE \"%apphelp.dll%\" ESCAPE '\\' AND (CommandLine LIKE \"%ShimFlushCache%\" ESCAPE '\\' OR CommandLine LIKE \"%#250%\" ESCAPE '\\')) OR (CommandLine LIKE \"%kernel32.dll%\" ESCAPE '\\' AND (CommandLine LIKE \"%BaseFlushAppcompatCache%\" ESCAPE '\\' OR CommandLine LIKE \"%#46%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Suspicious Splwow64 Without Params",
        "description": "Detects suspicious Splwow64.exe process without any command line parameters",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\splwow64.exe\" ESCAPE '\\' AND NOT (CommandLine LIKE \"%splwow64.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Spool Service Child Process",
        "description": "Detects suspicious print spool service (spoolsv.exe) child processes.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\spoolsv.exe\" ESCAPE '\\' AND IntegrityLevel = \"System\" AND ((((((Image LIKE \"%\\\\gpupdate.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\nltest.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\taskkill.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\taskmgr.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\findstr.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\curl.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wget.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\certutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bitsadmin.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\accesschk.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wevtutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bcdedit.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\fsutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\cipher.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\write.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wuauclt.exe\" ESCAPE '\\') OR (EventID = \"1\" AND Image LIKE \"%\\\\net.exe\" ESCAPE '\\' AND NOT (CommandLine LIKE \"%start%\" ESCAPE '\\'))) OR (EventID = \"1\" AND Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' AND NOT ((CommandLine LIKE \"%.spl%\" ESCAPE '\\' OR CommandLine LIKE \"%route add%\" ESCAPE '\\' OR CommandLine LIKE \"%program files%\" ESCAPE '\\')))) OR (EventID = \"1\" AND Image LIKE \"%\\\\netsh.exe\" ESCAPE '\\' AND NOT ((CommandLine LIKE \"%add portopening%\" ESCAPE '\\' OR CommandLine LIKE \"%rule name%\" ESCAPE '\\')))) OR (EventID = \"1\" AND Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND NOT (CommandLine LIKE \"%.spl%\" ESCAPE '\\'))) OR (Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' AND CommandLine LIKE \"%rundll32.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Dumping Process via Sqldumper.exe",
        "description": "Detects process dump via legitimate sqldumper.exe binary",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\sqldumper.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%0x0110%\" ESCAPE '\\' OR CommandLine LIKE \"%0x01100:40%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Squirrel Lolbin",
        "description": "Detects Possible Squirrel Packages Manager as Lolbin",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\update.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%--processStart%\" ESCAPE '\\' OR CommandLine LIKE \"%--processStartAndWait%\" ESCAPE '\\' OR CommandLine LIKE \"%--createShortcut%\" ESCAPE '\\') AND CommandLine LIKE \"%.exe%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Sysprep on AppData Folder",
        "description": "Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\sysprep.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%\\\\AppData\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious SYSVOL Domain Group Policy Access",
        "description": "Detects Access to Domain Group Policies stored in SYSVOL",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%\\\\SYSVOL\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\policies\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Taskmgr as LOCAL_SYSTEM",
        "description": "Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (User LIKE \"NT AUTHORITY\\\\SYSTEM%\" ESCAPE '\\' OR User LIKE \"AUTORITE NT\\\\Sys%\" ESCAPE '\\') AND Image LIKE \"%\\\\taskmgr.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Taskmgr as Parent",
        "description": "Detects the creation of a process from Windows task manager",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\taskmgr.exe\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\resmon.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\mmc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\taskmgr.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "DLL Injection with Tracker.exe",
        "description": "This rule detects DLL injection and execution via LOLBAS - Tracker.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\tracker.exe\" ESCAPE '\\') OR (Description LIKE \"Tracker\" ESCAPE '\\')) AND (CommandLine LIKE \"% /d %\" ESCAPE '\\') AND (CommandLine LIKE \"% /c %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious TSCON Start",
        "description": "Detects a tscon.exe start as LOCAL SYSTEM",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (User LIKE \"NT AUTHORITY\\\\SYSTEM%\" ESCAPE '\\' OR User LIKE \"AUTORITE NT\\\\Sys%\" ESCAPE '\\') AND Image LIKE \"%\\\\tscon.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious RDP Redirect Using TSCON",
        "description": "Detects a suspicious RDP session redirect using tscon.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"% /dest:rdp-tcp:%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "TrustedPath UAC Bypass Pattern",
        "description": "Detects indicators of a UAC bypass method by mocking directories",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%C:\\\\Windows \\\\System32\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious Userinit Child Process",
        "description": "Detects a suspicious child process of userinit",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\userinit.exe\" ESCAPE '\\' AND NOT (CommandLine LIKE \"%\\\\netlogon\\\\%\" ESCAPE '\\')) AND NOT (Image LIKE \"%\\\\explorer.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Use of CSharp Interactive Console",
        "description": "Detects the execution of CSharp interactive console by PowerShell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\csi.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND OriginalFileName = \"csi.exe\")"
        ]
    },
    {
        "title": "Detection of PowerShell Execution via Sqlps.exe",
        "description": "This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\sqlps.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\sqlps.exe\" ESCAPE '\\') OR (OriginalFileName LIKE \"\\\\sqlps.exe\" ESCAPE '\\' AND NOT (ParentImage LIKE \"%\\\\sqlagent.exe\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "SQL Client Tools PowerShell Session Detection",
        "description": "This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\sqltoolsps.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\sqltoolsps.exe\" ESCAPE '\\') OR (OriginalFileName LIKE \"\\\\sqltoolsps.exe\" ESCAPE '\\' AND NOT (ParentImage LIKE \"%\\\\smss.exe\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Malicious Windows Script Components File Execution by TAEF Detection",
        "description": "Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces). Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\te.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\te.exe\" ESCAPE '\\' OR OriginalFileName LIKE \"\\\\te.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Malicious PE Execution by Microsoft Visual Studio Debugger",
        "description": "There is an option for a MS VS Just-In-Time Debugger \"vsjitdebugger.exe\" to launch specified executable and attach a debugger. This option may be used adversaries to execute malicious code by signed verified binary. The debugger is installed alongside with Microsoft Visual Studio package.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\vsjitdebugger.exe\" ESCAPE '\\' AND NOT ((EventID = \"1\" AND (Image LIKE \"%\\\\vsimmersiveactivatehelper%.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\devenv.exe\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Suspicious VBoxDrvInst.exe Parameters",
        "description": "Detect VBoxDrvInst.exe run with parameters allowing processing INF file. This allows to create values in the registry and install drivers. For example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\VBoxDrvInst.exe\" ESCAPE '\\' AND CommandLine LIKE \"%driver%\" ESCAPE '\\' AND CommandLine LIKE \"%executeinf%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious VBScript UN2452 Pattern",
        "description": "Detects suspicious inline VBScript keywords as used by UNC2452",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (CommandLine LIKE \"%Execute%\" ESCAPE '\\' AND CommandLine LIKE \"%CreateObject%\" ESCAPE '\\' AND CommandLine LIKE \"%RegRead%\" ESCAPE '\\' AND CommandLine LIKE \"%window.close%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Microsoft\\\\Windows\\\\CurrentVersion%\" ESCAPE '\\') AND NOT ((CommandLine LIKE \"%\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Disabled Volume Snapshots",
        "description": "Detects commands that temporarily turn off Volume Snapshots",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%reg%\" ESCAPE '\\' AND CommandLine LIKE \"% add %\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\Services\\\\VSS\\\\Diag%\" ESCAPE '\\' AND CommandLine LIKE \"%/d Disabled%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Whoami Execution",
        "description": "Detects the execution of whoami, which is often used by attackers after exloitation / privilege escalation but rarely used by administrators",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl",
        "description": "Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%winrm%\" ESCAPE '\\' AND (CommandLine LIKE \"%format:pretty%\" ESCAPE '\\' OR CommandLine LIKE \"%format:\"pretty\"%\" ESCAPE '\\' OR CommandLine LIKE \"%format:\"text\"%\" ESCAPE '\\' OR CommandLine LIKE \"%format:text%\" ESCAPE '\\') AND NOT ((Image LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Remote Code Execute via Winrm.vbs",
        "description": "Detects an attempt to execute code or create service on remote host via winrm.vbs.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\cscript.exe\" ESCAPE '\\' AND CommandLine LIKE \"%winrm%\" ESCAPE '\\' AND CommandLine LIKE \"%invoke Create wmicimv2/Win32\\_%\" ESCAPE '\\' AND CommandLine LIKE \"%-r:http%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious WMIC ActiveScriptEventConsumer Creation",
        "description": "Detects WMIC executions in which a event consumer gets created in order to establish persistence",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%ActiveScriptEventConsumer%\" ESCAPE '\\' AND CommandLine LIKE \"% CREATE %\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Suspicious WMI Execution Using Rundll32",
        "description": "Detects WMI executing rundll32",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%process call create%\" ESCAPE '\\' AND CommandLine LIKE \"%rundll32%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Wmic Uninstall Security Product",
        "description": "Detects deinstallation of security products using WMIC utility",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%wmic%\" ESCAPE '\\' AND CommandLine LIKE \"%product where name=%\" ESCAPE '\\' AND CommandLine LIKE \"%call uninstall%\" ESCAPE '\\' AND CommandLine LIKE \"%/nointeractive%\" ESCAPE '\\' AND (CommandLine LIKE \"%Antivirus%\" ESCAPE '\\' OR CommandLine LIKE \"%AVG %\" ESCAPE '\\' OR CommandLine LIKE \"%Crowdstrike Sensor%\" ESCAPE '\\' OR CommandLine LIKE \"%DLP Endpoint%\" ESCAPE '\\' OR CommandLine LIKE \"%Endpoint Detection%\" ESCAPE '\\' OR CommandLine LIKE \"%Endpoint Protection%\" ESCAPE '\\' OR CommandLine LIKE \"%Endpoint Security%\" ESCAPE '\\' OR CommandLine LIKE \"%Endpoint Sensor%\" ESCAPE '\\' OR CommandLine LIKE \"%ESET File Security%\" ESCAPE '\\' OR CommandLine LIKE \"%Malwarebytes%\" ESCAPE '\\' OR CommandLine LIKE \"%McAfee Agent%\" ESCAPE '\\' OR CommandLine LIKE \"%Microsoft Security Client%\" ESCAPE '\\' OR CommandLine LIKE \"%Threat Protection%\" ESCAPE '\\' OR CommandLine LIKE \"%VirusScan%\" ESCAPE '\\' OR CommandLine LIKE \"%Webroot SecureAnywhere%\" ESCAPE '\\' OR CommandLine LIKE \"%Windows Defender%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious WMI Execution",
        "description": "Detects WMI executing suspicious commands",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' AND ((CommandLine LIKE \"%process%\" ESCAPE '\\' AND CommandLine LIKE \"%call%\" ESCAPE '\\' AND CommandLine LIKE \"%create %\" ESCAPE '\\') OR (CommandLine LIKE \"% path %\" ESCAPE '\\' AND (CommandLine LIKE \"%AntiVirus%\" ESCAPE '\\' OR CommandLine LIKE \"%Firewall%\" ESCAPE '\\') AND CommandLine LIKE \"%Product%\" ESCAPE '\\' AND CommandLine LIKE \"% get %\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Execution via WorkFolders.exe",
        "description": "Detects using WorkFolders.exe to execute an arbitrary control.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\control.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\WorkFolders.exe\" ESCAPE '\\') AND NOT (Image LIKE \"C:\\\\Windows\\\\System32\\\\control.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "WSL Execution",
        "description": "Detects Possible usage of Windows Subsystem for Linux (WSL) binary as a LOLBIN",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\wsl.exe\" ESCAPE '\\') AND (CommandLine LIKE \"% -e %\" ESCAPE '\\' OR CommandLine LIKE \"% --exec %\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Windows Update Client LOLBIN",
        "description": "Detects code execution via the Windows Update client (wuauclt)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ProcessCommandLine LIKE \"%/UpdateDeploymentProvider%\" ESCAPE '\\' AND ProcessCommandLine LIKE \"%/RunHandlerComServer%\" ESCAPE '\\' AND (Image LIKE \"%\\\\wuauclt.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Auditpol Usage",
        "description": "Threat actors can use auditpol binary to change audit policy configuration to impair detection capability. This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\auditpol.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%disable%\" ESCAPE '\\' OR CommandLine LIKE \"%clear%\" ESCAPE '\\' OR CommandLine LIKE \"%remove%\" ESCAPE '\\' OR CommandLine LIKE \"%restore%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Sysmon Driver Unload",
        "description": "Detect possible Sysmon driver unload",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\fltmc.exe\" ESCAPE '\\' AND CommandLine LIKE \"%unload%\" ESCAPE '\\' AND CommandLine LIKE \"%sys%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "System File Execution Location Anomaly",
        "description": "Detects a Windows program executable started in a suspicious folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\svchost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\services.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\regsvr32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\spoolsv.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\lsass.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\smss.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\csrss.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\conhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wininit.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\lsm.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\winlogon.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\explorer.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\taskhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\Taskmgr.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sihost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\RuntimeBroker.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\smartscreen.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\dllhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\audiodg.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wlanext.exe\" ESCAPE '\\') AND NOT ((Image LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\system32\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\SysWow64\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\winsxs\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\WinSxS\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\avast! sandbox%\" ESCAPE '\\') OR Image LIKE \"%\\\\SystemRoot\\\\System32\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\explorer.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Tap Installer Execution",
        "description": "Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\tapinstall.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Tasks Folder Evasion",
        "description": "The Tasks folder in system32 and syswow64 are globally writable paths. Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr",
        "rule": [
            "SELECT * FROM eventlog WHERE ((CommandLine LIKE \"%echo %\" ESCAPE '\\' OR CommandLine LIKE \"%copy %\" ESCAPE '\\' OR CommandLine LIKE \"%type %\" ESCAPE '\\' OR CommandLine LIKE \"%file createnew%\" ESCAPE '\\') AND (CommandLine LIKE \"% C:\\\\Windows\\\\System32\\\\Tasks\\\\%\" ESCAPE '\\' OR CommandLine LIKE \"% C:\\\\Windows\\\\SysWow64\\\\Tasks\\\\%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Terminal Service Process Spawn",
        "description": "Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentCommandLine LIKE \"%\\\\svchost.exe%\" ESCAPE '\\' AND ParentCommandLine LIKE \"%termsvcs%\" ESCAPE '\\') AND NOT (Image LIKE \"%\\\\rdpclip.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "SMB Relay Attack Tools",
        "description": "Detects different hacktools used for relay attacks on Windows for privilege escalation",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%PetitPotam%\" ESCAPE '\\' OR Image LIKE \"%RottenPotato%\" ESCAPE '\\' OR Image LIKE \"%HotPotato%\" ESCAPE '\\' OR Image LIKE \"%JuicyPotato%\" ESCAPE '\\' OR Image LIKE \"%\\\\just\\_dce\\_%\" ESCAPE '\\' OR Image LIKE \"%Juicy Potato%\" ESCAPE '\\' OR Image LIKE \"%\\\\temp\\\\rot.exe%\" ESCAPE '\\' OR Image LIKE \"%\\\\Potato.exe%\" ESCAPE '\\' OR Image LIKE \"%\\\\SpoolSample.exe%\" ESCAPE '\\' OR Image LIKE \"%\\\\Responder.exe%\" ESCAPE '\\' OR Image LIKE \"%\\\\smbrelayx%\" ESCAPE '\\' OR Image LIKE \"%\\\\ntlmrelayx%\" ESCAPE '\\') OR (CommandLine LIKE \"%Invoke-Tater%\" ESCAPE '\\' OR CommandLine LIKE \"% smbrelay%\" ESCAPE '\\' OR CommandLine LIKE \"% ntlmrelay%\" ESCAPE '\\' OR CommandLine LIKE \"%cme smb %\" ESCAPE '\\' OR CommandLine LIKE \"% /ntlm:NTLMhash %\" ESCAPE '\\' OR CommandLine LIKE \"%Invoke-PetitPotam%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Domain Trust Discovery",
        "description": "Identifies execution of nltest.exe and dsquery.exe for domain trust discovery. This technique is used by attackers to enumerate Active Directory trusts.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\nltest.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%domain\\_trusts%\" ESCAPE '\\' OR CommandLine LIKE \"%all\\_trusts%\" ESCAPE '\\' OR CommandLine LIKE \"%/trusted\\_domains%\" ESCAPE '\\' OR CommandLine LIKE \"%/dclist%\" ESCAPE '\\')) OR (Image LIKE \"%\\\\dsquery.exe\" ESCAPE '\\' AND CommandLine LIKE \"%trustedDomain%\" ESCAPE '\\') OR (Image LIKE \"%\\\\dsquery.exe\" ESCAPE '\\' AND CommandLine LIKE \"%-filter%\" ESCAPE '\\' AND CommandLine LIKE \"%trustedDomain%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "UAC Bypass Using ChangePK and SLUI",
        "description": "Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\changepk.exe\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\slui.exe\" ESCAPE '\\' AND IntegrityLevel IN (\"High\", \"System\"))"
        ]
    },
    {
        "title": "UAC Bypass Using Disk Cleanup",
        "description": "Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%\"\\\\system32\\\\cleanmgr.exe /autoclean /d C:\" ESCAPE '\\' AND ParentCommandLine LIKE \"C:\\\\Windows\\\\system32\\\\svchost.exe -k netsvcs -p -s Schedule\" ESCAPE '\\' AND IntegrityLevel IN (\"High\", \"System\"))"
        ]
    },
    {
        "title": "UAC Bypass Using ComputerDefaults",
        "description": "Detects the pattern of UAC Bypass using computerdefaults.exe (UACMe 59)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (IntegrityLevel IN (\"High\", \"System\") AND Image LIKE \"C:\\\\Windows\\\\System32\\\\ComputerDefaults.exe\" ESCAPE '\\') AND NOT ((ParentImage LIKE \"%:\\\\Windows\\\\System32%\" ESCAPE '\\' OR ParentImage LIKE \"%:\\\\Program Files%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "UAC Bypass Using Consent and Comctl32 - Process",
        "description": "Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\consent.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\werfault.exe\" ESCAPE '\\' AND IntegrityLevel IN (\"High\", \"System\"))"
        ]
    },
    {
        "title": "UAC Bypass Using DismHost",
        "description": "Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%C:\\\\Users\\\\%\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' AND ParentImage LIKE \"%\\\\DismHost.exe%\" ESCAPE '\\' AND IntegrityLevel IN (\"High\", \"System\"))"
        ]
    },
    {
        "title": "UAC Bypass Using IEInstal - Process",
        "description": "Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND IntegrityLevel IN (\"High\", \"System\") AND ParentImage LIKE \"%\\\\ieinstal.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' AND Image LIKE \"%consent.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using MSConfig Token Modification - Process",
        "description": "Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND IntegrityLevel IN (\"High\", \"System\") AND ParentImage LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\pkgmgr.exe\" ESCAPE '\\' AND CommandLine LIKE \"\"C:\\\\Windows\\\\system32\\\\msconfig.exe\" -5\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using NTFS Reparse Point - Process",
        "description": "Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND IntegrityLevel IN (\"High\", \"System\") AND ((CommandLine LIKE \"\"C:\\\\Windows\\\\system32\\\\wusa.exe\"  /quiet C:\\\\Users\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\update.msu\" ESCAPE '\\') OR (ParentCommandLine LIKE \"\"C:\\\\Windows\\\\system32\\\\dism.exe\" /online /quiet /norestart /add-package /packagepath:\"C:\\\\Windows\\\\system32\\\\pe386\" /ignorecheck\" ESCAPE '\\' AND CommandLine LIKE \"%C:\\\\Users\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\%\" ESCAPE '\\' AND CommandLine LIKE \"%\\\\dismhost.exe {%\" ESCAPE '\\' AND Image LIKE \"%\\\\DismHost.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "UAC Bypass Using PkgMgr and DISM",
        "description": "Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\pkgmgr.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\dism.exe\" ESCAPE '\\' AND IntegrityLevel IN (\"High\", \"System\"))"
        ]
    },
    {
        "title": "UAC Bypass Abusing Winsat Path Parsing - Process",
        "description": "Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND IntegrityLevel IN (\"High\", \"System\") AND ParentImage LIKE \"%\\\\AppData\\\\Local\\\\Temp\\\\system32\\\\winsat.exe\" ESCAPE '\\' AND ParentCommandLine LIKE \"%C:\\\\Windows \\\\system32\\\\winsat.exe%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using Windows Media Player - Process",
        "description": "Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND IntegrityLevel IN (\"High\", \"System\") AND (Image LIKE \"C:\\\\Program Files\\\\Windows Media Player\\\\osk.exe\" ESCAPE '\\' OR (Image LIKE \"C:\\\\Windows\\\\System32\\\\cmd.exe\" ESCAPE '\\' AND ParentCommandLine LIKE \"\"C:\\\\Windows\\\\system32\\\\mmc.exe\" \"C:\\\\Windows\\\\system32\\\\eventvwr.msc\" /s\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "UAC Bypass WSReset",
        "description": "Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\wsreset.exe\" ESCAPE '\\' AND IntegrityLevel IN (\"High\", \"System\"))"
        ]
    },
    {
        "title": "Bypass UAC via CMSTP",
        "description": "Detect child processes of automatically elevated instances of Microsoft Connection Manager Profile Installer (cmstp.exe).",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\cmstp.exe\" ESCAPE '\\' AND (CommandLine LIKE \"%/s%\" ESCAPE '\\' OR CommandLine LIKE \"%/au%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Bypass UAC via Fodhelper.exe",
        "description": "Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\fodhelper.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Bypass UAC via WSReset.exe",
        "description": "Identifies use of WSReset.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\wsreset.exe\" ESCAPE '\\' AND NOT (Image LIKE \"%\\\\conhost.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Possible Privilege Escalation via Weak Service Permissions",
        "description": "Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\sc.exe\" ESCAPE '\\' AND IntegrityLevel = \"Medium\" AND ((CommandLine LIKE \"%config%\" ESCAPE '\\' AND CommandLine LIKE \"%binPath%\" ESCAPE '\\') OR (CommandLine LIKE \"%failure%\" ESCAPE '\\' AND CommandLine LIKE \"%command%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Using SettingSyncHost.exe as LOLBin",
        "description": "Detects using SettingSyncHost.exe to run hijacked binary",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND NOT ((Image LIKE \"C:\\\\Windows\\\\System32\\\\%\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\SysWOW64\\\\%\" ESCAPE '\\')) AND (ParentCommandLine LIKE \"%cmd.exe /c%\" ESCAPE '\\' AND ParentCommandLine LIKE \"%RoamDiag.cmd%\" ESCAPE '\\' AND ParentCommandLine LIKE \"%-outputpath%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Verclsid.exe Runs COM Object",
        "description": "Detects when verclsid.exe is used to run COM object via GUID",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\verclsid.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/C%\" ESCAPE '\\' AND CommandLine LIKE \"%/S%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Visual Basic Command Line Compiler Usage",
        "description": "Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\vbc.exe\" ESCAPE '\\' AND Image LIKE \"%\\\\cvtres.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Java Running with Remote Debugging",
        "description": "Detects a JAVA process running with remote debugging allowing more than just localhost to connect",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND CommandLine LIKE \"%transport=dt\\_socket,address=%\" ESCAPE '\\' AND NOT (CommandLine LIKE \"%address=127.0.0.1%\" ESCAPE '\\' OR CommandLine LIKE \"%address=localhost%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Webshell Detection With Command Line Keywords",
        "description": "Detects certain command line parameters often used during reconnaissance activity via web shells",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((ParentImage LIKE \"%\\\\w3wp.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\php-cgi.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\nginx.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\httpd.exe\" ESCAPE '\\') OR (ParentImage LIKE \"%\\\\apache%\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\tomcat%\" ESCAPE '\\')) AND (EventID = \"1\" AND ((((Image LIKE \"%\\\\net.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\net1.exe\" ESCAPE '\\') AND (CommandLine LIKE \"% user %\" ESCAPE '\\' OR CommandLine LIKE \"% use %\" ESCAPE '\\' OR CommandLine LIKE \"% group %\" ESCAPE '\\')) OR (Image LIKE \"%\\\\ping.exe\" ESCAPE '\\' AND CommandLine LIKE \"% -n %\" ESCAPE '\\') OR (CommandLine LIKE \"%&cd&echo%\" ESCAPE '\\' OR CommandLine LIKE \"%cd /d %\" ESCAPE '\\')) OR (Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' AND CommandLine LIKE \"% /node:%\" ESCAPE '\\') OR (Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\systeminfo.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\quser.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\ipconfig.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\pathping.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\tracert.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\netstat.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\vssadmin.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wevtutil.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\tasklist.exe\" ESCAPE '\\') OR (CommandLine LIKE \"% Test-NetConnection %\" ESCAPE '\\' OR CommandLine LIKE \"%dir \\\\%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Webshell Recon Detection Via CommandLine & Processes",
        "description": "Looking for processes spawned by web server components that indicate reconnaissance by popular public domain webshells for whether perl, python or wget are installed.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((ParentImage LIKE \"%\\\\apache%\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\tomcat%\" ESCAPE '\\') OR (ParentImage LIKE \"%\\\\w3wp.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\php-cgi.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\nginx.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\httpd.exe\" ESCAPE '\\')) AND ((Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\') AND (CommandLine LIKE \"%perl --help%\" ESCAPE '\\' OR CommandLine LIKE \"%python --help%\" ESCAPE '\\' OR CommandLine LIKE \"%wget --help%\" ESCAPE '\\' OR CommandLine LIKE \"%perl -h%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Shells Spawned by Web Servers",
        "description": "Web servers that spawn shell processes could be the result of a successfully placed web shell or an other attack",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\w3wp.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\httpd.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\nginx.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\php-cgi.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\tomcat.exe\" ESCAPE '\\' OR ParentImage LIKE \"%\\\\UMWorkerProcess.exe\" ESCAPE '\\') AND (Image LIKE \"%\\\\cmd.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sh.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bash.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\powershell.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\bitsadmin.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Run Whoami as SYSTEM",
        "description": "Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (User LIKE \"NT AUTHORITY\\\\SYSTEM%\" ESCAPE '\\' OR User LIKE \"AUTORITE NT\\\\Sys%\" ESCAPE '\\') AND Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Run Whoami Showing Privileges",
        "description": "Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privieleges. This is often used after a privilege escalation attempt.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\whoami.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/priv%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows 10 Scheduled Task SandboxEscaper 0-day",
        "description": "Detects Task Scheduler .job import arbitrary DACL write\\par",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/change%\" ESCAPE '\\' AND CommandLine LIKE \"%/TN%\" ESCAPE '\\' AND CommandLine LIKE \"%/RU%\" ESCAPE '\\' AND CommandLine LIKE \"%/RP%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Winword.exe Loads Suspicious DLL",
        "description": "Detects Winword.exe loading of custmom dll via /l cmd switch",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"%\\\\winword.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/l%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "WMI Backdoor Exchange Transport Agent",
        "description": "Detects a WMI backdoor in Exchange Transport Agents via WMI event filters",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ParentImage LIKE \"%\\\\EdgeTransport.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "WMI Persistence - Script Event Consumer",
        "description": "Detects WMI script event consumers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND Image LIKE \"C:\\\\WINDOWS\\\\system32\\\\wbem\\\\scrcons.exe\" ESCAPE '\\' AND ParentImage LIKE \"C:\\\\Windows\\\\System32\\\\svchost.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Microsoft Workflow Compiler",
        "description": "Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (Image LIKE \"%\\\\Microsoft.Workflow.Compiler.exe\" ESCAPE '\\' OR (OriginalFileName = \"Microsoft.Workflow.Compiler.exe\" AND CommandLine LIKE \"%.xml%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Wsreset UAC Bypass",
        "description": "Detects a method that uses Wsreset.exe tool that can be used to reset the Windows Store to bypass UAC",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\WSreset.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "XSL Script Processing",
        "description": "Extensible Stylesheet Language (XSL) files are commonly used to describe the processing and rendering of data within XML files. Rule detects when adversaries abuse this functionality to execute arbitrary files while potentially bypassing application whitelisting defenses.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND ((Image LIKE \"%\\\\wmic.exe\" ESCAPE '\\' AND CommandLine LIKE \"%/format%\" ESCAPE '\\') OR Image LIKE \"%\\\\msxsl.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Execution via stordiag.exe",
        "description": "Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"1\" AND (ParentImage LIKE \"%\\\\stordiag.exe\" ESCAPE '\\' AND (Image LIKE \"%\\\\schtasks.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\systeminfo.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\fltmc.exe\" ESCAPE '\\')) AND NOT ((ParentImage LIKE \"c:\\\\windows\\\\system32\\\\%\" ESCAPE '\\' OR ParentImage LIKE \"c:\\\\windows\\\\syswow64\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Raw Disk Access Using Illegitimate Tools",
        "description": "Raw disk access using illegitimate tools, possible defence evasion",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"9\" AND NOT (Device LIKE \"%floppy%\" ESCAPE '\\') AND NOT ((Image LIKE \"%\\\\wmiprvse.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\sdiagnhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\searchindexer.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\csrss.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\defrag.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\smss.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\vssvc.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\compattelrunner.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\wininit.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\autochk.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\taskhost.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\dfsrs.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\vds.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\lsass.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Abusing Windows Telemetry For Persistence",
        "description": "Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections. This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run. The problem is, it will run any arbitrary command without restriction of location or type.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\TelemetryController\\\\%\" ESCAPE '\\' AND (Details LIKE \"%.sh\" ESCAPE '\\' OR Details LIKE \"%.exe\" ESCAPE '\\' OR Details LIKE \"%.dll\" ESCAPE '\\' OR Details LIKE \"%.bin\" ESCAPE '\\' OR Details LIKE \"%.bat\" ESCAPE '\\' OR Details LIKE \"%.cmd\" ESCAPE '\\' OR Details LIKE \"%.js\" ESCAPE '\\' OR Details LIKE \"%.ps\" ESCAPE '\\' OR Details LIKE \"%.vb\" ESCAPE '\\' OR Details LIKE \"%.jar\" ESCAPE '\\' OR Details LIKE \"%.hta\" ESCAPE '\\' OR Details LIKE \"%.msi\" ESCAPE '\\' OR Details LIKE \"%.vbs\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Chafer Activity",
        "description": "Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\UMe\" ESCAPE '\\' OR TargetObject LIKE \"%SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\UT\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Pandemic Registry Key",
        "description": "Detects Pandemic Windows Implant",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\SYSTEM\\\\CurrentControlSet\\\\services\\\\null\\\\Instance%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CVE-2021-31979 CVE-2021-33771 Exploits by Sourgum",
        "description": "Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\Software\\\\Classes\\\\CLSID\\\\{CF4CC405-E2C5-4DDD-B3CE-5E7582D8C9FA}\\\\InprocServer32%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Classes\\\\CLSID\\\\{7C857801-7381-11CF-884D-00AA004B2E24}\\\\InProcServer32%\" ESCAPE '\\') AND eventlog MATCH ('\"IMJPUEXP.DLL\"'))"
        ]
    },
    {
        "title": "Windows Defender Threat Detection Disabled",
        "description": "Detects disabling Windows Defender threat protection",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND Details = \"DWORD (0x00000001)\" AND ((EventType = \"SetValue\" AND (TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\DisableAntiSpyware\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\DisableAntiVirus\" ESCAPE '\\')) OR (TargetObject LIKE \"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\WinDefend\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows Defender\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Windows Defender Exclusions Added",
        "description": "Detects the Setting of Windows Defender Exclusions",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"SetValue\" AND TargetObject LIKE \"%\\\\Microsoft\\\\Windows Defender\\\\Exclusions%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Defender Real-Time Protection Disabled",
        "description": "Detects disabling Windows Defender Real-Time Protection by modifying registry",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"SetValue\" AND (((TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\\DisableBehaviorMonitoring\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\\DisableIOAVProtection\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\\DisableOnAccessProtection\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\\DisableRealtimeMonitoring\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\\DisableScanOnRealtimeEnable\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\\\DisableBlockAtFirstSeen\" ESCAPE '\\') AND Details = \"DWORD (0x00000001)\") OR ((TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\\\SpynetReporting\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\\\SubmitSamplesConsent\" ESCAPE '\\') AND Details = \"DWORD (0x00000000)\")))"
        ]
    },
    {
        "title": "DNS ServerLevelPluginDll Install",
        "description": "Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\services\\\\DNS\\\\Parameters\\\\ServerLevelPluginDll\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Adwind RAT / JRAT",
        "description": "Detects javaw.exe in AppData folder as used by Adwind / JRAT",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run%\" ESCAPE '\\' AND Details LIKE \"\\%AppData\\%\\\\Roaming\\\\Oracle\\\\bin\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Terminal Server Client Connection History Cleared",
        "description": "Detects the deletion of registry keys containing the MSTSC connection history",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND ((EventType = \"DeleteValue\" AND TargetObject LIKE \"%\\\\Microsoft\\\\Terminal Server Client\\\\Default\\\\MRU%\" ESCAPE '\\') OR (EventType = \"DeleteKey\" AND TargetObject LIKE \"%\\\\Microsoft\\\\Terminal Server Client\\\\Servers\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "NetNTLM Downgrade Attack",
        "description": "Detects NetNTLM downgrade attack",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%SYSTEM\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%ControlSet%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\Control\\\\Lsa%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\lmcompatibilitylevel\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\NtlmMinClientSec\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\RestrictSendingNTLMTraffic\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Sticky Key Like Backdoor Usage",
        "description": "Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\sethc.exe\\\\Debugger\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\utilman.exe\\\\Debugger\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\osk.exe\\\\Debugger\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\Magnify.exe\\\\Debugger\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\Narrator.exe\\\\Debugger\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\DisplaySwitch.exe\\\\Debugger\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Usage of Sysinternals Tools",
        "description": "Detects the usage of Sysinternals Tools due to accepteula key being added to Registry",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\EulaAccepted\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass via Event Viewer",
        "description": "Detects UAC bypass method using Windows event viewer",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"HKCU\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\mscfile\\\\shell\\\\open\\\\command\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Abusing Winsat Path Parsing - Registry",
        "description": "Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Root\\\\InventoryApplicationFile\\\\winsat.exe|%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\LowerCaseLongPath\" ESCAPE '\\' AND Details LIKE \"c:\\\\users\\\\%\" ESCAPE '\\' AND Details LIKE \"%\\\\appdata\\\\local\\\\temp\\\\system32\\\\winsat.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass Using Windows Media Player - Registry",
        "description": "Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\Compatibility Assistant\\\\Store\\\\C:\\\\Program Files\\\\Windows Media Player\\\\osk.exe\" ESCAPE '\\' AND Details = \"Binary Data\")"
        ]
    },
    {
        "title": "Leviathan Registry Key Activity",
        "description": "Detects registry key used by Leviathan APT in Malaysian focused campaign",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\ntkd\" ESCAPE '\\')"
        ]
    },
    {
        "title": "OceanLotus Registry Activity",
        "description": "Detects registry keys created in OceanLotus (also known as APT32) attacks",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND ((TargetObject LIKE \"HKCU\\\\SOFTWARE\\\\Classes\\\\CLSID\\\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\\\Model\" ESCAPE '\\' OR ((TargetObject LIKE \"HKCU\\\\SOFTWARE\\\\App\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\App\\\\%\" ESCAPE '\\') AND (TargetObject LIKE \"%AppXbf13d4ea2945444d8b13e2121cb6b663\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%AppX70162486c7554f7f80f481985d67586d\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%AppX37cc7fdccd644b4f85f4b22d5a3f105a\\\\%\" ESCAPE '\\') AND (TargetObject LIKE \"%Application\" ESCAPE '\\' OR TargetObject LIKE \"%DefaultIcon\" ESCAPE '\\'))) OR ((TargetObject LIKE \"HKCU\\\\%\" ESCAPE '\\') AND (TargetObject LIKE \"%Classes\\\\AppXc52346ec40fb4061ad96be0e6cb7d16a\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%Classes\\\\AppX3bbba44c6cae4d9695755183472171e2\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%Classes\\\\CLSID\\\\{E3517E26-8E93-458D-A6DF-8030BC80528B}\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%Classes\\\\CLSID\\\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\\\Model%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Autorun Keys Modification",
        "description": "Detects modification of autostart extensibility point (ASEP) in registry.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (((((((((((((TargetObject LIKE \"%\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows CE Services\\\\AutoStart%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Wow6432Node\\\\Microsoft\\\\Command Processor\\\\Autorun%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Active Setup\\\\Installed Components%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows CE Services\\\\AutoStartOnDisconnect%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows CE Services\\\\AutoStartOnConnect%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SYSTEM\\\\Setup\\\\CmdLine%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Ctf\\\\LangBarAddin%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Command Processor\\\\Autorun%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Active Setup\\\\Installed Components%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Classes\\\\Protocols\\\\Handler%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Classes\\\\Protocols\\\\Filter%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Classes\\\\Htmlfile\\\\Shell\\\\Open\\\\Command\\\\(Default)%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Environment\\\\UserInitMprLogonScript%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\Control Panel\\\\Desktop\\\\Scrnsave.exe%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Internet Explorer\\\\UrlSearchHooks%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Internet Explorer\\\\Desktop\\\\Components%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Classes\\\\Clsid\\\\{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}\\\\Inprocserver32%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Control Panel\\\\Desktop\\\\Scrnsave.exe%\" ESCAPE '\\') OR (TargetObject LIKE \"%\\\\System\\\\CurrentControlSet\\\\Control\\\\Session Manager%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\SetupExecute%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\S0InitialCommand%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\KnownDlls%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Execute%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\BootExecute%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\AppCertDlls%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\ShellServiceObjectDelayLoad%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Run%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Policies\\\\System\\\\Shell%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Policies\\\\Explorer\\\\Run%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Group Policy\\\\Scripts\\\\Startup%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Group Policy\\\\Scripts\\\\Shutdown%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Group Policy\\\\Scripts\\\\Logon%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Group Policy\\\\Scripts\\\\Logoff%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\ShellServiceObjects%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\ShellIconOverlayIdentifiers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\ShellExecuteHooks%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\SharedTaskScheduler%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\Browser Helper Objects%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Authentication\\\\PLAP Providers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Authentication\\\\Credential Providers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Authentication\\\\Credential Provider Filters%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\Winlogon\\\\VmApplet%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Winlogon\\\\Userinit%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Winlogon\\\\Taskman%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Winlogon\\\\Shell%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Winlogon\\\\GpExtensions%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Winlogon\\\\AppSetup%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Winlogon\\\\AlternateShells\\\\AvailableShells%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Windows\\\\IconServiceLib%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Windows\\\\Appinit\\_Dlls%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Image File Execution Options%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Font Drivers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Drivers32%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Windows\\\\Run%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Windows\\\\Load%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\ShellServiceObjectDelayLoad%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Run%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\ShellServiceObjects%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\ShellIconOverlayIdentifiers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\ShellExecuteHooks%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\SharedTaskScheduler%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer\\\\Browser Helper Objects%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows NT\\\\CurrentVersion%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\Windows\\\\Appinit\\_Dlls%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Image File Execution Options%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Drivers32%\" ESCAPE '\\'))) OR (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\Software\\\\Wow6432Node\\\\Microsoft\\\\Office%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Office%\" ESCAPE '\\') AND (TargetObject LIKE \"%\\\\Word\\\\Addins%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\PowerPoint\\\\Addins%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Outlook\\\\Addins%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Onenote\\\\Addins%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Excel\\\\Addins%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Access\\\\Addins%\" ESCAPE '\\' OR TargetObject LIKE \"%test\\\\Special\\\\Perf%\" ESCAPE '\\'))) OR (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\Software\\\\Wow6432Node\\\\Microsoft\\\\Internet Explorer%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Internet Explorer%\" ESCAPE '\\') AND (TargetObject LIKE \"%\\\\Toolbar%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Extensions%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Explorer Bars%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\Software\\\\Wow6432Node\\\\Classes%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\Folder\\\\ShellEx\\\\ExtShellFolderViews%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Folder\\\\ShellEx\\\\DragDropHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Folder\\\\ShellEx\\\\ColumnHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Directory\\\\Shellex\\\\DragDropHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Directory\\\\Shellex\\\\CopyHookHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CLSID\\\\{AC757296-3522-4E11-9862-C17BE5A1767E}\\\\Instance%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CLSID\\\\{ABE3B9A4-257D-4B97-BD1A-294AF496222E}\\\\Instance%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CLSID\\\\{7ED96837-96F0-4812-B211-F13C24117ED3}\\\\Instance%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CLSID\\\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\\\Instance%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\AllFileSystemObjects\\\\ShellEx\\\\DragDropHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\ShellEx\\\\PropertySheetHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\ShellEx\\\\ContextMenuHandlers%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\Software\\\\Classes%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\Folder\\\\ShellEx\\\\ExtShellFolderViews%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Folder\\\\ShellEx\\\\DragDropHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Folder\\\\Shellex\\\\ColumnHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Filter%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Exefile\\\\Shell\\\\Open\\\\Command\\\\(Default)%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Directory\\\\Shellex\\\\DragDropHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Directory\\\\Shellex\\\\CopyHookHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CLSID\\\\{AC757296-3522-4E11-9862-C17BE5A1767E}\\\\Instance%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CLSID\\\\{ABE3B9A4-257D-4B97-BD1A-294AF496222E}\\\\Instance%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CLSID\\\\{7ED96837-96F0-4812-B211-F13C24117ED3}\\\\Instance%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CLSID\\\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\\\Instance%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Classes\\\\AllFileSystemObjects\\\\ShellEx\\\\DragDropHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\.exe%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\.cmd%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\ShellEx\\\\PropertySheetHandlers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\ShellEx\\\\ContextMenuHandlers%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\Software\\\\Policies\\\\Microsoft\\\\Windows\\\\System\\\\Scripts%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\Startup%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Shutdown%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Logon%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Logoff%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\System\\\\CurrentControlSet\\\\Services\\\\WinSock2\\\\Parameters%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\Protocol\\_Catalog9\\\\Catalog\\_Entries%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\NameSpace\\_Catalog5\\\\Catalog\\_Entries%\" ESCAPE '\\'))) OR (TargetObject LIKE \"%\\\\SYSTEM\\\\CurrentControlSet\\\\Control%\" ESCAPE '\\' AND (TargetObject LIKE \"%\\\\Terminal Server\\\\WinStations\\\\RDP-Tcp\\\\InitialProgram%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Terminal Server\\\\Wds\\\\rdpwd\\\\StartupPrograms%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SecurityProviders\\\\SecurityProviders%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SafeBoot\\\\AlternateShell%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Print\\\\Providers%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Print\\\\Monitors%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\NetworkProvider\\\\Order%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Lsa\\\\Notification Packages%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Lsa\\\\Authentication Packages%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\BootVerificationProgram\\\\ImagePath%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "UAC Bypass Via Wsreset",
        "description": "Unfixed method for UAC bypass from windows 10. WSReset.exe file associated with the Windows Store. It will run a binary file contained in a low-privilege registry.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\\\\Shell\\\\open\\\\command\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "CMSTP Execution Registry Event",
        "description": "Detects various indicators of Microsoft Connection Manager Profile Installer execution",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\cmmgr32.exe%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "CobaltStrike Service Installations in Registry",
        "description": "Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement. We can also catch this by system log 7045 (https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_cobaltstrike_service_installs.yml) In some SIEM you can catch those events also in HKLM\\System\\ControlSet001\\Services or HKLM\\System\\ControlSet002\\Services, however, this rule is based on a regular sysmon's events.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"SetValue\" AND TargetObject LIKE \"%HKLM\\\\System\\\\CurrentControlSet\\\\Services%\" ESCAPE '\\' AND ((Details LIKE \"%ADMIN$%\" ESCAPE '\\' AND Details LIKE \"%.exe%\" ESCAPE '\\') OR (Details LIKE \"%\\%COMSPEC\\%%\" ESCAPE '\\' AND Details LIKE \"%start%\" ESCAPE '\\' AND Details LIKE \"%powershell%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "COM Hijack via Sdclt",
        "description": "Detects changes to 'HKCU\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute'",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"HKCU\\\\Software\\\\Classes\\\\Folder\\\\shell\\\\open\\\\command\\\\DelegateExecute\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious New Printer Ports in Registry (CVE-2020-1048)",
        "description": "Detects a new and suspicious printer port creation in Registry that could be an attempt to exploit CVE-2020-1048",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Ports%\" ESCAPE '\\' AND (Details LIKE \"%.dll%\" ESCAPE '\\' OR Details LIKE \"%.exe%\" ESCAPE '\\' OR Details LIKE \"%.bat%\" ESCAPE '\\' OR Details LIKE \"%.com%\" ESCAPE '\\' OR Details LIKE \"%C:%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "DHCP Callout DLL Installation",
        "description": "Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled parameter in Registry, which can be used to execute code in context of the DHCP server (restart required)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\Services\\\\DHCPServer\\\\Parameters\\\\CalloutDlls\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Services\\\\DHCPServer\\\\Parameters\\\\CalloutEnabled\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Disable Exploit Guard Network Protection on Windows Defender",
        "description": "Detects disabling Windows Defender Exploit Guard Network Protection",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"SetValue\" AND TargetObject LIKE \"%HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender Security Center\\\\App and Browser protection\\\\DisallowExploitProtectionOverride%\" ESCAPE '\\' AND Details = \"DWORD (00000001)\")"
        ]
    },
    {
        "title": "Disable PUA Protection on Windows Defender",
        "description": "Detects disabling Windows Defender PUA protection",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"SetValue\" AND TargetObject LIKE \"%HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\PUAProtection%\" ESCAPE '\\' AND Details = \"DWORD (0x00000000)\")"
        ]
    },
    {
        "title": "Disable Tamper Protection on Windows Defender",
        "description": "Detects disabling Windows Defender Tamper Protection",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"SetValue\" AND TargetObject LIKE \"%HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows Defender\\\\Features\\\\TamperProtection%\" ESCAPE '\\' AND Details = \"DWORD (0)\")"
        ]
    },
    {
        "title": "Disable Microsoft Office Security Features",
        "description": "Disable Microsoft Office Security Features by registry",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"SetValue\" AND TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Office\\\\%\" ESCAPE '\\' AND (TargetObject LIKE \"%VBAWarnings\" ESCAPE '\\' OR TargetObject LIKE \"%DisableInternetFilesInPV\" ESCAPE '\\' OR TargetObject LIKE \"%DisableUnsafeLocationsInPV\" ESCAPE '\\' OR TargetObject LIKE \"%DisableAttachementsInPV\" ESCAPE '\\') AND Details = \"DWORD (0x00000001)\")"
        ]
    },
    {
        "title": "Disable Security Events Logging Adding Reg Key MiniNt",
        "description": "Detects the addition of a key 'MiniNt' to the registry. Upon a reboot, Windows Event Log service will stopped write events.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND ((TargetObject LIKE \"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\MiniNt\" ESCAPE '\\' AND EventType = \"CreateKey\") OR NewName LIKE \"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\MiniNt\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Wdigest CredGuard Registry Modification",
        "description": "Detects potential malicious modification of the property value of IsCredGuardEnabled from HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to disable Cred Guard on a system. This is usually used with UseLogonCredential to manipulate the caching credentials.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\IsCredGuardEnabled\" ESCAPE '\\')"
        ]
    },
    {
        "title": "DNS-over-HTTPS Enabled by Registry",
        "description": "Detects when a user enables DNS-over-HTTPS. This can be used to hide internet activity or be used to hide the process of exfiltrating data. With this enabled organization will lose visibility into data such as query type, response and originating IP that are used to determine bad actors.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (((TargetObject LIKE \"%\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Edge\\\\BuiltInDnsClientEnabled\" ESCAPE '\\' AND Details = \"DWORD (1)\") OR (TargetObject LIKE \"%\\\\SOFTWARE\\\\Google\\\\Chrome\\\\DnsOverHttpsMode\" ESCAPE '\\' AND Details = \"DWORD (secure)\")) OR (TargetObject LIKE \"%\\\\SOFTWARE\\\\Policies\\\\Mozilla\\\\Firefox\\\\DNSOverHTTPS\\\\Enabled\" ESCAPE '\\' AND Details = \"DWORD (1)\")))"
        ]
    },
    {
        "title": "Enabling COR Profiler Environment Variables",
        "description": "This rule detects cor_enable_profiling and cor_profiler environment variables being set and configured.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\COR\\_ENABLE\\_PROFILING\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\COR\\_PROFILER\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "COMPlus_ETWEnabled Registry Modification",
        "description": "Potential adversaries stopping ETW providers recording loaded .NET assemblies.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%SOFTWARE\\\\Microsoft\\\\.NETFramework\\\\ETWEnabled\" ESCAPE '\\' AND Details = \"DWORD (0x00000000)\")"
        ]
    },
    {
        "title": "Windows Credential Editor Registry",
        "description": "Detects the use of Windows Credential Editor (WCE)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%Services\\\\WCESERVICE\\\\Start%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "HybridConnectionManager Service Installation",
        "description": "Detects the installation of the Azure Hybrid Connection Manager service to allow remote code execution from Azure function.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\Services\\\\HybridConnectionManager%\" ESCAPE '\\' OR Details LIKE \"%Microsoft.HybridConnectionManager.Listener.exe%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Logon Scripts (UserInitMprLogonScript) Registry",
        "description": "Detects creation or execution of UserInitMprLogonScript persistence method",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%UserInitMprLogonScript%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Path To Screensaver Binary Modified",
        "description": "Detects value modification of registry key containing path to binary used as screensaver.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Control Panel\\\\Desktop\\\\SCRNSAVE.EXE\" ESCAPE '\\' AND NOT ((Image LIKE \"%\\\\rundll32.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\explorer.exe\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Narrator's Feedback-Hub Persistence",
        "description": "Detects abusing Windows 10 Narrator's Feedback-Hub",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND ((EventType = \"DeleteValue\" AND TargetObject LIKE \"%\\\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\\\Shell\\\\open\\\\command\\\\DelegateExecute\" ESCAPE '\\') OR TargetObject LIKE \"%\\\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\\\Shell\\\\open\\\\command\\\\(Default)\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "New Application in AppCompat",
        "description": "A General detection for a new application in AppCompat. This indicates an application executing for the first time on an endpoint.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\AppCompatFlags\\\\Compatibility Assistant\\\\Store\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "New DLL Added to AppCertDlls Registry Key",
        "description": "Dynamic-link libraries (DLLs) that are specified in the AppCertDLLs value in the Registry key can be abused to obtain persistence and privilege escalation by causing a malicious DLL to be loaded and run in the context of separate processes on the computer.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\Session Manager\\\\AppCertDlls\" ESCAPE '\\' OR NewName LIKE \"HKLM\\\\SYSTEM\\\\CurentControlSet\\\\Control\\\\Session Manager\\\\AppCertDlls\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "New DLL Added to AppInit_DLLs Registry Key",
        "description": "DLLs that are specified in the AppInit_DLLs value in the Registry key HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows are loaded by user32.dll into every process that loads user32.dll",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND ((TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows\\\\AppInit\\_Dlls\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows\\\\AppInit\\_Dlls\" ESCAPE '\\') OR (NewName LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows\\\\AppInit\\_Dlls\" ESCAPE '\\' OR NewName LIKE \"%\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows\\\\AppInit\\_Dlls\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Office Application Startup - Office Test",
        "description": "Detects the addition of office test registry that allows a user to specify an arbitrary DLL that will be executed every time an Office application is started",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"HKCU\\\\Software\\\\Microsoft\\\\Office test\\\\Special\\\\Perf\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\Software\\\\Microsoft\\\\Office test\\\\Special\\\\Perf\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Stealthy VSTO Persistence",
        "description": "Detects persistence via Visual Studio Tools for Office (VSTO) add-ins in Office applications.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (EventType = \"SetValue\" AND (TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Office\\\\Outlook\\\\Addins\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Office\\\\Word\\\\Addins\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Office\\\\Excel\\\\Addins\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Office\\\\Powerpoint\\\\Addins\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\VSTO\\\\Security\\\\Inclusion\\\\%\" ESCAPE '\\')) AND NOT (Image LIKE \"%\\\\msiexec.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PowerShell as a Service in Registry",
        "description": "Detects that a powershell code is written to the registry as a service.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Services\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\ImagePath\" ESCAPE '\\' AND (Details LIKE \"%powershell%\" ESCAPE '\\' OR Details LIKE \"%pwsh%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "RDP Registry Modification",
        "description": "Detects potential malicious modification of the property value of fDenyTSConnections and UserAuthentication to enable remote desktop connections.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\CurrentControlSet\\\\Control\\\\Terminal Server\\\\WinStations\\\\RDP-Tcp\\\\UserAuthentication\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CurrentControlSet\\\\Control\\\\Terminal Server\\\\fDenyTSConnections\" ESCAPE '\\') AND Details = \"DWORD (0x00000000)\")"
        ]
    },
    {
        "title": "RDP Sensitive Settings Changed",
        "description": "Detects changes to RDP terminal service sensitive settings",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\services\\\\TermService\\\\Parameters\\\\ServiceDll%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Control\\\\Terminal Server\\\\fSingleSessionPerUser%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Control\\\\Terminal Server\\\\fDenyTSConnections%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "RedMimicry Winnti Playbook Registry Manipulation",
        "description": "Detects actions caused by the RedMimicry Winnti playbook",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%HKLM\\\\SOFTWARE\\\\Microsoft\\\\HTMLHelp\\\\data%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Creation of a Local Hidden User Account by Registry",
        "description": "Sysmon registry detection of a local hidden user account.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"HKLM\\\\SAM\\\\SAM\\\\Domains\\\\Account\\\\Users\\\\Names\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%$\" ESCAPE '\\' AND Image LIKE \"%lsass.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Registry Persistence COM Key Linking",
        "description": "Detects COM object hijacking via TreatAs subkey",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"CreateKey\" AND TargetObject LIKE \"%HKU\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%Classes\\\\CLSID\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\TreatAs%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Windows Registry Persistence COM Search Order Hijacking",
        "description": "Detects potential COM object hijacking leveraging the COM Search Order",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND ((TargetObject LIKE \"HKCR\\\\CLSID\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"HKCU\\\\Software\\\\Classes\\\\CLSID\\\\%\" ESCAPE '\\') AND TargetObject LIKE \"%\\\\InprocServer32\\\\(Default)\" ESCAPE '\\') AND NOT ((EventID IN (\"12\", \"13\", \"14\") AND ((((Details LIKE \"%\\%\\%systemroot\\%\\%\\\\system32\\\\%\" ESCAPE '\\' OR Details LIKE \"%\\%\\%systemroot\\%\\%\\\\SysWow64\\\\%\" ESCAPE '\\') OR (EventID IN (\"12\", \"13\", \"14\") AND Details LIKE \"%\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\%\" ESCAPE '\\' AND (Details LIKE \"%\\\\FileCoAuthLib64.dll%\" ESCAPE '\\' OR Details LIKE \"%\\\\FileSyncShell64.dll%\" ESCAPE '\\' OR Details LIKE \"%\\\\FileSyncApi64.dll%\" ESCAPE '\\'))) OR (Details LIKE \"%\\\\AppData\\\\Local\\\\Microsoft\\\\TeamsMeetingAddin\\\\%\" ESCAPE '\\' AND Details LIKE \"%\\\\Microsoft.Teams.AddinLoader.dll%\" ESCAPE '\\')) OR (Details LIKE \"%\\\\AppData\\\\Roaming\\\\Dropbox\\\\%\" ESCAPE '\\' AND Details LIKE \"%\\\\DropboxExt64.%.dll%\" ESCAPE '\\')))))"
        ]
    },
    {
        "title": "Suspicious Printer Driver Empty Manufacturer",
        "description": "Detects a suspicious printer driver installation with an empty Manufacturer value",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Control\\\\Print\\\\Environments\\\\Windows x64\\\\Drivers%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\Manufacturer%\" ESCAPE '\\' AND Details = \"(Empty)\")"
        ]
    },
    {
        "title": "Windows Registry Trust Record Modification",
        "description": "Alerts on trust record modification within the registry, indicating usage of macros",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%TrustRecords%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Office Security Settings Changed",
        "description": "Detects registry changes to Office macro settings",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\Security\\\\Trusted Documents\\\\TrustRecords\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Security\\\\AccessVBOM\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Security\\\\VBAWarnings\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "SilentProcessExit Monitor Registrytion",
        "description": "Detects changes to the Registry in which a monitor program gets registered to monitor the exit of another process",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%Microsoft\\\\Windows NT\\\\CurrentVersion\\\\SilentProcessExit%\" ESCAPE '\\' AND Details LIKE \"%MonitorProcess%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "SilentProcessExit Monitor Registrytion for LSASS",
        "description": "Detects changes to the Registry in which a monitor program gets registered to dump process memory of the lsass.exe process memory",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%Microsoft\\\\Windows NT\\\\CurrentVersion\\\\SilentProcessExit\\\\lsass.exe%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "VBScript Payload Stored in Registry",
        "description": "Detects VBScript content stored into registry keys as seen being used by UNC2452 group",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%Software\\\\Microsoft\\\\Windows\\\\CurrentVersion%\" ESCAPE '\\' AND (Details LIKE \"%vbscript%\" ESCAPE '\\' OR Details LIKE \"%jscript%\" ESCAPE '\\' OR Details LIKE \"%mshtml%\" ESCAPE '\\' OR Details LIKE \"%mshtml,%\" ESCAPE '\\' OR Details LIKE \"%mshtml %\" ESCAPE '\\' OR Details LIKE \"%RunHTMLApplication%\" ESCAPE '\\' OR Details LIKE \"%Execute(%\" ESCAPE '\\' OR Details LIKE \"%CreateObject%\" ESCAPE '\\' OR Details LIKE \"%RegRead%\" ESCAPE '\\' OR Details LIKE \"%window.close%\" ESCAPE '\\')) AND NOT (TargetObject LIKE \"%Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Removal Amsi Provider Reg Key",
        "description": "Remove the AMSI Provider registry key in HKLM\\Software\\Microsoft\\AMSI to disable AMSI inspection",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"DeleteKey\" AND (TargetObject LIKE \"%{2781761E-28E0-4109-99FE-B9D127C57AFE}\" ESCAPE '\\' OR TargetObject LIKE \"%{A7C452EF-8E9F-42EB-9F2B-245613CA0DC9}\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Removal of Potential COM Hijacking Registry Keys",
        "description": "A General detection to trigger for processes removing .*\\shell\\open\\command registry keys. Registry keys that might have been used for COM hijacking activities.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"DeleteKey\" AND TargetObject LIKE \"%\\\\shell\\\\open\\\\command\" ESCAPE '\\')"
        ]
    },
    {
        "title": "WINEKEY Registry Modification",
        "description": "Detects potential malicious modification of run keys by winekey or team9 backdoor",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Backup Mgr\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Run Once Task Configuration in Registry",
        "description": "Rule to detect the configuration of Run Once registry key. Configured payload can be run by runonce.exe /AlternateShellStartup",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Active Setup\\\\Installed Components%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\StubPath\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Security Support Provider (SSP) Added to LSA Configuration",
        "description": "Detects the addition of a SSP to the registry. Upon a reboot or API call, SSP DLLs gain access to encrypted and plaintext passwords stored in Windows.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\Security Packages\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\OSConfig\\\\Security Packages\" ESCAPE '\\') AND NOT (Image LIKE \"C:\\\\Windows\\\\system32\\\\msiexec.exe\" ESCAPE '\\' OR Image LIKE \"C:\\\\Windows\\\\syswow64\\\\MsiExec.exe\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Keyboard Layout Load",
        "description": "Detects the keyboard preload installation with a suspicious keyboard layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems maintained by US staff only",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\Keyboard Layout\\\\Preload\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Keyboard Layout\\\\Substitutes\\\\%\" ESCAPE '\\') AND (Details LIKE \"%00000429%\" ESCAPE '\\' OR Details LIKE \"%00050429%\" ESCAPE '\\' OR Details LIKE \"%0000042a%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Atbroker Registry Change",
        "description": "Detects creation/modification of Assisitive Technology applications and persistence with usage of ATs",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Accessibility\\\\ATs%\" ESCAPE '\\' OR TargetObject LIKE \"%Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Accessibility\\\\Configuration%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Run Key from Download",
        "description": "Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (Image LIKE \"%\\\\Downloads\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Temporary Internet Files\\\\Content.Outlook\\\\%\" ESCAPE '\\' OR Image LIKE \"%\\\\Local Settings\\\\Temporary Internet Files\\\\%\" ESCAPE '\\') AND TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "DLL Load via LSASS",
        "description": "Detects a method to load DLL via LSASS process using an undocumented Registry key",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\CurrentControlSet\\\\Services\\\\NTDS\\\\DirectoryServiceExtPt%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CurrentControlSet\\\\Services\\\\NTDS\\\\LsaDbExtPt%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Camera and Microphone Access",
        "description": "Detects Processes accessing the camera and microphone from suspicious folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\CapabilityAccessManager\\\\ConsentStore\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\NonPackaged%\" ESCAPE '\\' AND (TargetObject LIKE \"%microphone%\" ESCAPE '\\' OR TargetObject LIKE \"%webcam%\" ESCAPE '\\') AND (TargetObject LIKE \"%:#Windows#Temp#%\" ESCAPE '\\' OR TargetObject LIKE \"%:#$Recycle.bin#%\" ESCAPE '\\' OR TargetObject LIKE \"%:#Temp#%\" ESCAPE '\\' OR TargetObject LIKE \"%:#Users#Public#%\" ESCAPE '\\' OR TargetObject LIKE \"%:#Users#Default#%\" ESCAPE '\\' OR TargetObject LIKE \"%:#Users#Desktop#%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Registry Persistence via Explorer Run Key",
        "description": "Detects a possible persistence mechanism using RUN key for Windows Explorer and pointing to a suspicious folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\Run\" ESCAPE '\\' AND ((Details LIKE \"C:\\\\Windows\\\\Temp\\\\%\" ESCAPE '\\' OR Details LIKE \"C:\\\\ProgramData\\\\%\" ESCAPE '\\' OR Details LIKE \"C:\\\\$Recycle.bin\\\\%\" ESCAPE '\\' OR Details LIKE \"C:\\\\Temp\\\\%\" ESCAPE '\\' OR Details LIKE \"C:\\\\Users\\\\Public\\\\%\" ESCAPE '\\' OR Details LIKE \"C:\\\\Users\\\\Default\\\\%\" ESCAPE '\\') OR (Details LIKE \"%\\\\AppData\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "New RUN Key Pointing to Suspicious Folder",
        "description": "Detects suspicious new RUN key element pointing to an executable in a suspicious folder",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\%\" ESCAPE '\\') AND ((Details LIKE \"%C:\\\\Windows\\\\Temp\\\\%\" ESCAPE '\\' OR Details LIKE \"%C:\\\\$Recycle.bin\\\\%\" ESCAPE '\\' OR Details LIKE \"%C:\\\\Temp\\\\%\" ESCAPE '\\' OR Details LIKE \"%C:\\\\Users\\\\Public\\\\%\" ESCAPE '\\' OR Details LIKE \"%C:\\\\Users\\\\Default\\\\%\" ESCAPE '\\' OR Details LIKE \"%C:\\\\Users\\\\Desktop\\\\%\" ESCAPE '\\') OR (Details LIKE \"\\%Public\\%\\\\%\" ESCAPE '\\' OR Details LIKE \"wscript%\" ESCAPE '\\' OR Details LIKE \"cscript%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Suspicious Service Installed",
        "description": "Detects installation of NalDrv or PROCEXP152 services via registry-keys to non-system32 folders. Both services are used in the tool Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU (https://github.com/hfiref0x/KDU)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND ((TargetObject LIKE \"HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\NalDrv\\\\ImagePath\" ESCAPE '\\' OR TargetObject LIKE \"HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\PROCEXP152\\\\ImagePath\" ESCAPE '\\') AND NOT ((Image LIKE \"%\\\\procexp64.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\procexp.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\procmon64.exe\" ESCAPE '\\' OR Image LIKE \"%\\\\procmon.exe\" ESCAPE '\\'))) AND NOT ((Details LIKE \"%\\\\WINDOWS\\\\system32\\\\Drivers\\\\PROCEXP152.SYS%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Sysinternals SDelete Registry Keys",
        "description": "A General detection to trigger for the creation or modification of .*\\Software\\Sysinternals\\SDelete registry keys. Indicators of the use of Sysinternals SDelete tool.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Software\\\\Sysinternals\\\\SDelete%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "New TaskCache Entry",
        "description": "Monitor the creation of a new key under 'TaskCache' when a new scheduled task is registered",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND EventType = \"SetValue\" AND TargetObject LIKE \"%SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\Tree\\\\%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "UAC Bypass via Sdclt",
        "description": "Detects the pattern of UAC Bypass using registry key manipulation of sdclt.exe (e.g. UACMe 53)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%Software\\\\Classes\\\\exefile\\\\shell\\\\runas\\\\command\\\\isolatedCommand\" ESCAPE '\\' OR (TargetObject LIKE \"%Software\\\\Classes\\\\Folder\\\\shell\\\\open\\\\command\\\\SymbolicLinkValue\" ESCAPE '\\' AND Details LIKE \"%-1___\\\\Software\\\\Classes\\\\%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "UAC Bypass Using Registry Shell Open Keys",
        "description": "Detects the pattern of UAC Bypass using fodhelper.exe, computerdefaults.exe, slui.exe via registry keys (e.g. UACMe 33 or 62)",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (((TargetObject LIKE \"%Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\SymbolicLinkValue\" ESCAPE '\\' AND Details LIKE \"%\\\\Software\\\\Classes\\\\{%\" ESCAPE '\\') OR TargetObject LIKE \"%Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\DelegateExecute\" ESCAPE '\\') OR (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\(Default)\" ESCAPE '\\' OR TargetObject LIKE \"%Classes\\\\exefile\\\\shell\\\\open\\\\command\\\\(Default)\" ESCAPE '\\') AND NOT (Details = \"(Empty)\"))))"
        ]
    },
    {
        "title": "Volume Shadow Copy Service Keys",
        "description": "Detects the volume shadow copy service initialization and processing. Registry keys such as HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\VSS\\\\Diag\\\\VolSnap\\\\Volume are captured.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%System\\\\CurrentControlSet\\\\Services\\\\VSS%\" ESCAPE '\\' AND NOT (TargetObject LIKE \"%System\\\\CurrentControlSet\\\\Services\\\\VSS\\\\Start%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Execution DLL of Choice Using WAB.EXE",
        "description": "This rule detects that the path to the DLL written in the registry is different from the default one. Launched WAB.exe tries to load the DLL from Registry.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%\\\\Software\\\\Microsoft\\\\WAB\\\\DLLPath\" ESCAPE '\\' AND NOT (Details LIKE \"\\%CommonProgramFiles\\%\\\\System\\\\wab32.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Wdigest Enable UseLogonCredential",
        "description": "Detects potential malicious modification of the property value of UseLogonCredential from HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to enable clear-text credentials",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"%WDigest\\\\UseLogonCredential\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Registry Persistence Mechanisms",
        "description": "Detects persistence registry keys",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion%\" ESCAPE '\\') AND ((TargetObject LIKE \"%\\\\Image File Execution Options\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\GlobalFlag%\" ESCAPE '\\') OR (TargetObject LIKE \"%SilentProcessExit\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\ReportingMode%\" ESCAPE '\\') OR (TargetObject LIKE \"%SilentProcessExit\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\MonitorProcess%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Registry Persistence Mechanism via Windows Telemetry",
        "description": "Detects persistence method using windows telemetry",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\TelemetryController\\\\%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\Command%\" ESCAPE '\\' AND Details LIKE \"%.exe%\" ESCAPE '\\') AND NOT ((Details LIKE \"%\\\\system32\\\\CompatTelRunner.exe%\" ESCAPE '\\' OR Details LIKE \"%\\\\system32\\\\DeviceCensus.exe%\" ESCAPE '\\')))"
        ]
    },
    {
        "title": "Outlook C2 Registry Key",
        "description": "Detects the modification of Outlook Security Setting to allow unprompted execution. Goes with win_outlook_c2_macro_creation.yml and is particularly interesting if both events occur near to each other.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"HKCU\\\\Software\\\\Microsoft\\\\Office\\\\16.0\\\\Outlook\\\\Security\\\\Level\" ESCAPE '\\' AND Details LIKE \"%0x00000001%\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Persistent Outlook Landing Pages",
        "description": "Detects the manipulation of persistent URLs which could execute malicious code",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%Software\\\\Microsoft\\\\Office\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Outlook\\\\Today\\\\%\" ESCAPE '\\') AND ((TargetObject LIKE \"%Stamp\" ESCAPE '\\' AND Details = \"DWORD (0x00000001)\") OR TargetObject LIKE \"%UserDefinedUrl\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Persistent Outlook Landing Pages",
        "description": "Detects the manipulation of persistent URLs which can be malicious",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%Software\\\\Microsoft\\\\Office\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%Outlook\\\\WebView\\\\%\" ESCAPE '\\') AND TargetObject LIKE \"%URL\" ESCAPE '\\' AND (TargetObject LIKE \"%Calendar%\" ESCAPE '\\' OR TargetObject LIKE \"%Inbox%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "PortProxy Registry Key",
        "description": "Detects the modification of PortProxy registry key which is used for port forwarding. For command execution see rule win_netsh_port_fwd.yml.",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND TargetObject LIKE \"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\PortProxy\\\\v4tov4\\\\tcp\" ESCAPE '\\')"
        ]
    },
    {
        "title": "PrinterNightmare Mimimkatz Driver Name",
        "description": "Detects static QMS 810 and mimikatz driver name used by Mimikatz as exploited in CVE-2021-1675 and CVE-2021-34527",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"12\", \"13\", \"14\") AND (((TargetObject LIKE \"%\\\\Control\\\\Print\\\\Environments\\\\Windows x64\\\\Drivers\\\\Version-3\\\\QMS 810\\\\%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\Control\\\\Print\\\\Environments\\\\Windows x64\\\\Drivers\\\\Version-3\\\\mimikatz%\" ESCAPE '\\') OR (TargetObject LIKE \"%legitprinter%\" ESCAPE '\\' AND TargetObject LIKE \"%\\\\Control\\\\Print\\\\Environments\\\\Windows%\" ESCAPE '\\')) OR (EventID IN (\"12\", \"13\", \"14\") AND (TargetObject LIKE \"%\\\\Control\\\\Print\\\\Environments%\" ESCAPE '\\' OR TargetObject LIKE \"%\\\\CurrentVersion\\\\Print\\\\Printers%\" ESCAPE '\\') AND (TargetObject LIKE \"%Gentil Kiwi%\" ESCAPE '\\' OR TargetObject LIKE \"%mimikatz printer%\" ESCAPE '\\' OR TargetObject LIKE \"%Kiwi Legit Printer%\" ESCAPE '\\'))))"
        ]
    },
    {
        "title": "Accessing WinAPI in PowerShell for Credentials Dumping",
        "description": "Detects Accessing to lsass.exe by Powershell",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"8\", \"10\") AND SourceImage LIKE \"%\\\\powershell.exe\" ESCAPE '\\' AND TargetImage LIKE \"%\\\\lsass.exe\" ESCAPE '\\')"
        ]
    },
    {
        "title": "Sysmon Configuration Error",
        "description": "Someone try to hide from Sysmon",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID = \"255\" AND (Description LIKE \"%Failed to open service configuration with error%\" ESCAPE '\\' OR Description LIKE \"%Failed to connect to the driver to update configuration%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Sysmon Configuration Modification",
        "description": "Someone try to hide from Sysmon",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"4\", \"16\") AND (State = \"Stopped\" OR eventlog MATCH ('\"Sysmon config state changed\"')))"
        ]
    },
    {
        "title": "T1021 DCOM InternetExplorer.Application Iertutil DLL Hijack",
        "description": "Detects a threat actor creating a file named `iertutil.dll` in the `C:\\Program Files\\Internet Explorer\\` directory over the network and loading it for a DCOM InternetExplorer DLL Hijack scenario.",
        "rule": [
            "SELECT * FROM eventlog WHERE ((EventID = \"11\" AND Image = \"System\" AND TargetFilename LIKE \"%\\\\Internet Explorer\\\\iertutil.dll\" ESCAPE '\\') OR (EventID = \"7\" AND Image LIKE \"%\\\\Internet Explorer\\\\iexplore.exe\" ESCAPE '\\' AND ImageLoaded LIKE \"%\\\\Internet Explorer\\\\iertutil.dll\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "WMI Event Subscription",
        "description": "Detects creation of WMI event subscription persistence method",
        "rule": [
            "SELECT * FROM eventlog WHERE EventID IN (\"19\", \"20\", \"21\")"
        ]
    },
    {
        "title": "Suspicious Encoded Scripts in a WMI Consumer",
        "description": "Detects suspicious encoded payloads in WMI Event Consumers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"19\", \"20\", \"21\") AND (Destination LIKE \"%V3JpdGVQcm9jZXNzTWVtb3J5%\" ESCAPE '\\' OR Destination LIKE \"%dyaXRlUHJvY2Vzc01lbW9ye%\" ESCAPE '\\' OR Destination LIKE \"%Xcml0ZVByb2Nlc3NNZW1vcn%\" ESCAPE '\\' OR Destination LIKE \"%VGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZG%\" ESCAPE '\\' OR Destination LIKE \"%RoaXMgcHJvZ3JhbSBjYW5ub3QgYmUgcnVuIGluIERPUyBtb2Rl%\" ESCAPE '\\' OR Destination LIKE \"%UaGlzIHByb2dyYW0gY2Fubm90IGJlIHJ1biBpbiBET1MgbW9kZ%\" ESCAPE '\\' OR Destination LIKE \"%VGhpcyBwcm9ncmFtIG11c3QgYmUgcnVuIHVuZGVyIFdpbjMy%\" ESCAPE '\\' OR Destination LIKE \"%RoaXMgcHJvZ3JhbSBtdXN0IGJlIHJ1biB1bmRlciBXaW4zM%\" ESCAPE '\\' OR Destination LIKE \"%UaGlzIHByb2dyYW0gbXVzdCBiZSBydW4gdW5kZXIgV2luMz%\" ESCAPE '\\'))"
        ]
    },
    {
        "title": "Suspicious Scripting in a WMI Consumer",
        "description": "Detects suspicious scripting in WMI Event Consumers",
        "rule": [
            "SELECT * FROM eventlog WHERE (EventID IN (\"19\", \"20\", \"21\") AND ((Destination LIKE \"%new-object%\" ESCAPE '\\' AND Destination LIKE \"%net.webclient%\" ESCAPE '\\' AND Destination LIKE \"%.downloadstring%\" ESCAPE '\\') OR (Destination LIKE \"%new-object%\" ESCAPE '\\' AND Destination LIKE \"%net.webclient%\" ESCAPE '\\' AND Destination LIKE \"%.downloadfile%\" ESCAPE '\\') OR (Destination LIKE \"% iex(%\" ESCAPE '\\' OR Destination LIKE \"%WScript.shell%\" ESCAPE '\\' OR Destination LIKE \"% -nop %\" ESCAPE '\\' OR Destination LIKE \"% -noprofile %\" ESCAPE '\\' OR Destination LIKE \"% -decode %\" ESCAPE '\\' OR Destination LIKE \"% -enc %\" ESCAPE '\\') OR (Destination LIKE \"%WScript.Shell%\" ESCAPE '\\' OR Destination LIKE \"%System.Security.Cryptography.FromBase64Transform%\" ESCAPE '\\')))"
        ]
    }
]
